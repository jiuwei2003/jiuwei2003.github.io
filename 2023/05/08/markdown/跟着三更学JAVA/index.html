<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://example.com">
  <title>JAVA | 久违的Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="JavaSE-SpringBoot知识点">
<meta property="og:type" content="article">
<meta property="og:title" content="JAVA">
<meta property="og:url" content="http://example.com/2023/05/08/markdown/%E8%B7%9F%E7%9D%80%E4%B8%89%E6%9B%B4%E5%AD%A6JAVA/index.html">
<meta property="og:site_name" content="久违的Blog">
<meta property="og:description" content="JavaSE-SpringBoot知识点">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javase-6.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231008125840813.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231008190533447.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231009144754961.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231009184136416.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231009185104668.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231009195119383.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231009195154552.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231011162154691.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231011165640479.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231011172005678.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231011171904538.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231011183335381.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231011193855883.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-2.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-3.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-4.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231011195713951.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231011200259331.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231011205506742.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231012190150277.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231012191119070.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231013181910168.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231014193530811.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231014202813190.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231015144307536.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231015144359968.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231017110844185.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231017111013908.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231017111714683.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231017124616237.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231017142336922.png">
<meta property="og:image" content="d:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145622163-16354041894551.png">
<meta property="og:image" content="d:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145707862-16354042291112.png">
<meta property="og:image" content="d:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145818743-16354043004393.png">
<meta property="og:image" content="d:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145843368-16354043246954.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018192634178.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018192849584.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018194932659.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018201111598.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018201303232.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018202420434.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018202609125.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018202942512.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018203100212.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018204407691.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231018204500156.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019141643837.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019142025592.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019142852345.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019143236104.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019150803593.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019153128394.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019155151828.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019160000565.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019184532353.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019185318428.png">
<meta property="og:image" content="https://pics7.baidu.com/feed/0b46f21fbe096b6333a209ed69513d4feaf8ac46.jpeg@f_auto?token=756cdc29eb11f4a51f75466ba32bfa03">
<meta property="og:image" content="https://pics7.baidu.com/feed/0df3d7ca7bcb0a46d355bde70e014c2f6a60af62.jpeg@f_auto?token=23d6a6c455e8dd01bec353dde030ac64">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019185712773.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019190149895.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019190203335.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231019192205898.png">
<meta property="og:image" content="http://img.voycn.com/images/2019/05/0b4704075682889e2cccf454ec5e1921.png">
<meta property="og:image" content="http://img.voycn.com/images/2019/05/7861a32d754c6b5d403e70ae74f1a668.png">
<meta property="og:image" content="http://img.voycn.com/images/2019/05/38d50a2c658bb124972bcabe9e33a653.png">
<meta property="og:image" content="http://img.voycn.com/images/2019/05/ac6c85e4a7f41022c80580811927eda7.png">
<meta property="og:image" content="http://img.voycn.com/images/2019/05/b1af252b24b6505be1bf2936c9650ee7.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231020191530029.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231020191738503.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231020192329132.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022142605610.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022142656908.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022143400084.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022143540222.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022143848670.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022144214788.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022144444156.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022144528740.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022144706217.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022145049869.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022164000278.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022164018236.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022164114952.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022164358881.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022200627041.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022200832824.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022200938773.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022203004341.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022202018584.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022202231226.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231022202318413.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023151433702.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023144115851.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023154851963.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023144455046.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023145201602.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023150609316.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023151528340.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023155649195.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023160437000.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023164010596.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023164959433.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023170809476.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023170845254.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023172604805.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023190524388.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023190716264.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023191139650.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023192318407.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023193330630.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023194731205.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023195634654.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023195754043.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231023200002595.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231024145601764.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231024151004858.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231024154540732.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231024154242681.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231024154416191.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231024153818204.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231024185543554.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231024185642783.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231024190731831.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025103859150.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025103454016.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025104718951.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025105348914.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025111115203.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025190959807.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025191119048.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025192127011.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025194548787.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025194942037.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025195316867.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025200041399.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025201806573.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025203116766.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025203056639.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025202707763.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026124625019.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026130631758.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026131647341.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026132831360.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026133059092.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026133955027.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026134059126.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026133922886.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026135228538.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026135630159.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026140241868.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026144544411.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026145648705.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026160844696.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026161049336.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026191120359.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026191738672.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026194210040.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026194646533.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026194957520.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026195528203.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231026200544078.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027130026205.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027130516178.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027131403831.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027131706277.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027131830376.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027132534076.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027132552012.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027132503773.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027132453280.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027132810466.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027133052584.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027183835739.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027184615003.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027190839647.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027191235556.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027191718789.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027193913905.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027193817375.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027194237759.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027194413102.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231027195441836.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029102240811.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029102444264.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029103634995.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029103010297.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029103603071.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029105442509.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029110059680.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029111211528.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029111603804.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029140643628.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029141041913.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029141216383.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029142014175.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029142217185.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029142756093.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029144001807.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029170249530.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029172312350.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029173020536.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029173228893.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029174243848.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029174342111.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029192447282.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029192349266.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029193614919.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231029193626846.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231119174233868.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231117171012488.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231117171840772.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231117224222957.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231117232955083.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231117233516009.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231117233400108.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025131624543.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025132845175.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231025133125795.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/jpg/35597420/1693034006959-451cfd5d-5196-49a5-9a7a-f5e9169abb85.jpg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/jpg/35597420/1693034008056-8dbc6d71-5d02-4ab8-b7eb-4b217db7aa9d.jpg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/jpg/35597420/1693034010104-0019ad45-03f8-4751-a7ad-81aea2b76c47.jpg?x-oss-process=image/resize,w_1500,limit_0/interlace,1">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231126110850159.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231126171216022.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231126171245869.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231126172635520.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231126191211641.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231126191242604.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231126194757170.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231126201236871.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231126211729011.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231127171117154.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231127172135147.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231127210559511.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231127211017762.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231128134903314.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231128203652811.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231128203712544.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231129163739057.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231129162352039.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231129171606246.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231129190408032.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130131652659.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130132146167.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130132443314.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130140707746.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130140613822.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130143113622.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130160302938.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130160715358.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130164233435.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130165912395.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130171335226.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130200554539.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130201117697.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130201618963.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130201802839.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130193927468.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130202552450.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130203501652.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130203629930.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231130205402127.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201083524731.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201085142322.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201085730990.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201090245547.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201091746875.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201092512509.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201093155861.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201101048056.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201101339076.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201101412122.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201101445405.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201101458722.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201101543847.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201164913448.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201165429716.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201170004116.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231201172144858.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231203221702948.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231203221841556.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231203223736546.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231203224101175.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231203224313475.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231203224324776.png">
<meta property="og:image" content="c:/Users/康/AppData/Roaming/Typora/typora-user-images/image-20231203224654161.png">
<meta property="article:published_time" content="2023-05-08T14:11:36.000Z">
<meta property="article:modified_time" content="2024-04-02T10:20:23.689Z">
<meta property="article:author" content="是小康呀.">
<meta property="article:tag" content="JAVA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javase-6.png">
  
    <link rel="alternative" href="/atom.xml" title="久违的Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/avatar.jpg">
  
  <link rel="stylesheet" type="text/css" href="/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

<meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #87CEFA"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/img/avatar.jpg" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/"></a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags">随笔</a></li>
	        
				<li><a href="/categories">分类</a></li>
	        
				<li><a href="/archives/index.html">归档</a></li>
	        
			</ul>
		</nav>
		<nav>
			总文章数 12
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/mykang2003" title="github"><i class="icon-github"></i></a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
		        
					<a class="qq" target="_blank" href="/img/qq.jpg" title="qq"><i class="icon-qq"></i></a>
		        
					<a class="weixin" target="_blank" href="/img/vx.jpg" title="weixin"><i class="icon-weixin"></i></a>
		        
					<a class="mail" target="_blank" href="/501858029@qq.com" title="mail"><i class="icon-mail"></i></a>
		        
				
					
					
					
					
					<div style="margin-right:10px;margin-left:0; padding:5px 0">
						<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1371780785&auto=1&height=66"></iframe>						</div>
					
						
						<p style="font-size: 12px;">愿以温柔撼动世界<p>
					
				
		
			</div>
		</nav>
		
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #87CEFA"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/img/avatar.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author"></h1>
			</hgroup>
			
			
			
				
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/mykang2003" title="github"><i class="icon-github"></i></a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo"><i class="icon-weibo"></i></a>
			        
						<a class="qq" target="_blank" href="/img/qq.jpg" title="qq"><i class="icon-qq"></i></a>
			        
						<a class="weixin" target="_blank" href="/img/vx.jpg" title="weixin"><i class="icon-weixin"></i></a>
			        
						<a class="mail" target="_blank" href="/501858029@qq.com" title="mail"><i class="icon-mail"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 25%"><a href="/">主页</a></li>
		        
					<li style="width: 25%"><a href="/tags">随笔</a></li>
		        
					<li style="width: 25%"><a href="/categories">分类</a></li>
		        
					<li style="width: 25%"><a href="/archives/index.html">归档</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            <article id="post-markdown/跟着三更学JAVA" class="article article-type-post " itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      JAVA
    </h1>
  

        
        <a href="/2023/05/08/markdown/%E8%B7%9F%E7%9D%80%E4%B8%89%E6%9B%B4%E5%AD%A6JAVA/" class="archive-article-date">
  	<time datetime="2023-05-08T14:11:36.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-05-08</time>
</a>

        
        <div align="center" class="post-count">
          字数：52.6k字 | 预计阅读时长：239分钟
      </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
          
            <p>JavaSE-SpringBoot知识点</p>
<span id="more"></span>

<h1 id="跟着三更学JAVA-基础篇"><a href="#跟着三更学JAVA-基础篇" class="headerlink" title="跟着三更学JAVA-基础篇"></a>跟着三更学JAVA-基础篇</h1><h2 id="第一部分：基本数据类型"><a href="#第一部分：基本数据类型" class="headerlink" title="第一部分：基本数据类型"></a>第一部分：基本数据类型</h2><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><table>
<thead>
<tr>
<th></th>
<th>类型名称</th>
<th>字节空间</th>
<th>取值范围</th>
</tr>
</thead>
<tbody><tr>
<td>整数型</td>
<td>byte</td>
<td>1字节(8位)</td>
<td>-128到127 或者 -2^(8-1)到2^7</td>
</tr>
<tr>
<td></td>
<td>short</td>
<td>2</td>
<td>-2^15到2^15-1</td>
</tr>
<tr>
<td></td>
<td>int</td>
<td>4</td>
<td>-2^31到2^31-1</td>
</tr>
<tr>
<td></td>
<td>long</td>
<td>8</td>
<td>-2^63到2^63-1</td>
</tr>
<tr>
<td>浮点型</td>
<td>float</td>
<td>4</td>
<td>单精度，对小数点精确度不够高</td>
</tr>
<tr>
<td></td>
<td>double</td>
<td>8</td>
<td>双精度，对小数点精确度高</td>
</tr>
<tr>
<td>字符型</td>
<td>char</td>
<td>2</td>
<td>0到65535</td>
</tr>
<tr>
<td></td>
<td>boolean</td>
<td>1</td>
<td>true或false</td>
</tr>
</tbody></table>
<p><strong>引用数据类型</strong>：数组，String</p>
<p>整数默认为int，小数默认为double</p>
<h3 id="Java-有哪些数据类型？"><a href="#Java-有哪些数据类型？" class="headerlink" title="Java 有哪些数据类型？"></a>Java 有哪些数据类型？</h3><p><strong>定义：</strong>Java 语言是强类型语言，对于每一种数据都定义了明确的具体的数据类型，在内存中分配了不同大小的内存空间。</p>
<p>Java 语言数据类型分为两种：<strong>基本数据类型</strong>和<strong>引用数据类型</strong>。</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javase-6.png" alt="Java数据类型">Java数据类型</p>
<p><strong>基本数据类型：</strong></p>
<ul>
<li>数值型<ul>
<li>整数类型（byte、short、int、long）</li>
<li>浮点类型（float、double）</li>
</ul>
</li>
<li>字符型（char）</li>
<li>布尔型（boolean）</li>
</ul>
<p>Java 基本数据类型范围和默认值：</p>
<table>
<thead>
<tr>
<th>基本类型</th>
<th>位数</th>
<th>字节</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td><code>int</code></td>
<td>32</td>
<td>4</td>
<td>0</td>
</tr>
<tr>
<td><code>short</code></td>
<td>16</td>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td><code>long</code></td>
<td>64</td>
<td>8</td>
<td>0L</td>
</tr>
<tr>
<td><code>byte</code></td>
<td>8</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td><code>char</code></td>
<td>16</td>
<td>2</td>
<td>‘u0000’</td>
</tr>
<tr>
<td><code>float</code></td>
<td>32</td>
<td>4</td>
<td>0f</td>
</tr>
<tr>
<td><code>double</code></td>
<td>64</td>
<td>8</td>
<td>0d</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td>8</td>
<td>1</td>
<td>false</td>
</tr>
</tbody></table>
<p><strong>引用数据类型：</strong></p>
<ul>
<li>类（class）</li>
<li>接口（interface）</li>
<li>数组([])</li>
</ul>
<h2 id="第二部分：数组"><a href="#第二部分：数组" class="headerlink" title="第二部分：数组"></a>第二部分：数组</h2><h3 id="动态初始化-长度确定推荐用"><a href="#动态初始化-长度确定推荐用" class="headerlink" title="动态初始化(长度确定推荐用)"></a><strong>动态初始化</strong>(长度确定推荐用)</h3><p>String[] arr = new String[3];初始化字符串数组为3的数组，String为引用数据类型，初始值为null</p>
<p>int[] arr = new int[3];初始化整形数组为3的数组，int的初始值为0</p>
<h3 id="静态初始化（已经确定元素值推荐使用）"><a href="#静态初始化（已经确定元素值推荐使用）" class="headerlink" title="静态初始化（已经确定元素值推荐使用）"></a><strong>静态初始化</strong>（已经确定元素值推荐使用）</h3><p>String[] arr = {“kang”,”wang”,”wei”};</p>
<p>int[] arr = {1,2,3,4};</p>
<h3 id="数组元素的表示"><a href="#数组元素的表示" class="headerlink" title="数组元素的表示"></a><strong>数组元素的表示</strong></h3><p>arr[0] = 1;</p>
<p>arr[2] = 3;</p>
<h3 id="介绍堆栈"><a href="#介绍堆栈" class="headerlink" title="介绍堆栈"></a><strong>介绍堆栈</strong></h3><p><strong>栈</strong>：方法调用都要进栈,局部变量（方法当中定义的变量）都存储在栈中</p>
<p><strong>堆</strong> ：new出来的东西都在堆中</p>
<p><strong>数组的内存图</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231008125840813.png" alt="image-20231008125840813"></p>
<p>数组的实体保存在堆中，数组名实际保存的是数组实体所对应的地址值</p>
<p><strong>数组中最大值</strong></p>
<p>用擂台法，将数组第一个值作为擂主，依次让下一个数进入擂台，大于擂台上的数就成为擂主，最后打印这个擂主（从第二个数开始，分别拿元素值和max比较，如果元素值大于max。就把元素值赋值给max）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> arr[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>; i&lt; arr.length; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[i]&gt;max)</span><br><span class="line">    &#123;</span><br><span class="line">        max = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>练习2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入10个值，找出最大值，最小值，总和</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            arr[i] = sc.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> arr[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            sum += arr[i];</span><br><span class="line">            <span class="keyword">if</span> (arr[i]&gt;max)</span><br><span class="line">            &#123;</span><br><span class="line">                max = arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (arr[i]&lt;min)</span><br><span class="line">            &#123;</span><br><span class="line">                min = arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;sum = &quot;</span> + sum);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;max = &quot;</span> + max);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;min = &quot;</span> + min);</span><br></pre></td></tr></table></figure>



<p>练习4</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//求个位和十位都是7并且是偶数</span></span><br><span class="line">       <span class="type">int</span>[] arr = &#123;<span class="number">171</span>,<span class="number">72</span>,<span class="number">19</span>,<span class="number">16</span>,<span class="number">118</span>,<span class="number">51</span>,<span class="number">210</span>,<span class="number">7</span>,<span class="number">18</span>&#125;;</span><br><span class="line">       <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">           <span class="keyword">if</span> (arr[i]%<span class="number">10</span>!=<span class="number">7</span>&amp;&amp;arr[i]/<span class="number">10</span>%<span class="number">10</span>!=<span class="number">7</span>&amp;&amp;arr[i]%<span class="number">2</span>==<span class="number">0</span>) &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;i = &quot;</span> + arr[i]);</span><br><span class="line">               sum += arr[i];</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(<span class="string">&quot;sum = &quot;</span> + sum);</span><br><span class="line">       <span class="comment">/*个位数 i%10</span></span><br><span class="line"><span class="comment">       十位数 i/10%10</span></span><br><span class="line"><span class="comment">       百位数 i/100%10</span></span><br><span class="line"><span class="comment">       千位数 i/1000%10</span></span><br><span class="line"><span class="comment">       */</span>  </span><br></pre></td></tr></table></figure>



<h3 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h3><p>对数组元素从大到小进行排序</p>
<p>冒泡排序：从第一个开始往后一个进行比较，小就互换，直到最后一个数是最小的。再循环一次倒数第二个最小…..依次进行</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231008190533447.png" alt="image-20231008190533447"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 冒泡排序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span>[] arr1 = &#123;<span class="number">5</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">13</span>,<span class="number">43</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; arr1.length-<span class="number">1</span>; j++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr1.length - <span class="number">1</span> - j; i++)         &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr1[i] &lt; arr1[i + <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr1[i];</span><br><span class="line">            arr1[i] = arr1[i + <span class="number">1</span>];</span><br><span class="line">            arr1[i + <span class="number">1</span>] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr1.length; i++) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;arr1 = &quot;</span> + arr1[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="不死神兔"><a href="#不死神兔" class="headerlink" title="不死神兔"></a><strong>不死神兔</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不死神兔,1,1,2,3,5,8,13,21......</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span>[] arr3 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">20</span>];</span><br><span class="line">arr3[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">arr3[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;arr3.length; i++) &#123;</span><br><span class="line">    arr3[i] = arr3[i-<span class="number">1</span>]+arr3[i-<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(arr3[<span class="number">19</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="第三部分：方法"><a href="#第三部分：方法" class="headerlink" title="第三部分：方法"></a>第三部分：方法</h2><h3 id="方法定义格式："><a href="#方法定义格式：" class="headerlink" title="方法定义格式："></a>方法定义格式：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">修饰符 返回类型 变量名 （形参）&#123;</span><br><span class="line">       方法体;</span><br><span class="line">       <span class="keyword">return</span> 返回值;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第四部分：面向对象"><a href="#第四部分：面向对象" class="headerlink" title="第四部分：面向对象"></a>第四部分：面向对象</h2><h3 id="this关键字"><a href="#this关键字" class="headerlink" title="this关键字"></a>this关键字</h3><p>this关键字：this可以区分成员变量和局部变量，加了this关键字的是成员变量。</p>
<p>this关键字只能在一个类的成员方法和构造方法中使用</p>
<ul>
<li><p>this关键字代表着什么呢？</p>
<p>哪个对象调用成员方法，就代表那个对象</p>
</li>
</ul>
<h3 id="构造方法和set方法"><a href="#构造方法和set方法" class="headerlink" title="构造方法和set方法"></a>构造方法和set方法</h3><p>构造方法初始化给对象赋值，不能再通过构造方法赋值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> (<span class="string">&quot;张三&quot;</span>,<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line">s = <span class="keyword">new</span> (<span class="string">&quot;李四&quot;</span>,<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这样是不对的</span></span><br></pre></td></tr></table></figure>

<p>但是可以通过set方法给对象重新赋值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> (<span class="string">&quot;张三&quot;</span>,<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line">s.setName=<span class="string">&quot;李四&quot;</span>;</span><br><span class="line">s.setAge=<span class="number">20</span>;</span><br><span class="line"><span class="comment">//这样是对的</span></span><br></pre></td></tr></table></figure>

<h3 id="this和super关键字"><a href="#this和super关键字" class="headerlink" title="this和super关键字"></a>this和super关键字</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009144754961.png" alt="image-20231009144754961"></p>
<h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a><strong>多态</strong></h3><p>同一个数据类型的不同对象对同一行为有着不同的表现</p>
<p>比如动物（猫、狗对叫和吃有不同的表现）</p>
<p><strong>三个条件：</strong></p>
<ul>
<li>父类引用指向子类对象</li>
<li>方法的重写（子类重写父类的方法）</li>
<li>方法的继承</li>
</ul>
<p><strong>访问特点</strong></p>
<ul>
<li><p>成员变量：编译看左边，运行看左边。意思是编译的时候看Animal有没有age变量，没有报错，运行的时候看Animal的age的值，值为父类的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">System.out.println(animal.age);</span><br></pre></td></tr></table></figure></li>
<li><p>成员方法：编译看左边，运行看右边。意思是编译的时候看Animal有没有eat方法，没有报错，运行的时候看Dog类中有没有重写父类的eat方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">cat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">cat.eat();</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>向上转型和向下转型</strong></p>
<ul>
<li><p>向上转型：子类转父类(绝对安全，自动类型转换)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br></pre></td></tr></table></figure></li>
<li><p>向下转型：父类强转为子类(不绝对安全所以必须使用强制类型转化)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line"><span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> (Dog)a;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>instanceof进行类型判断</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if(对象 instanceof 类名/接口名)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">if (a instanceof  Dog) &#123;</span><br><span class="line">   //a属于狗,将a强转为狗</span><br><span class="line">   Dog dog = Dog(a);</span><br><span class="line">&#125;</span><br><span class="line">if (a instanceof  Cat) &#123;</span><br><span class="line">   //a属于猫,将a强转为猫</span><br><span class="line">   Cat cat = Cat(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>static关键字</strong></p>
<p>static是一个修饰符，被其修饰的成员就属于类了，会被类所有的对象共享</p>
<p>加了static的变量，可以用类名.变量名/方法名调用</p>
<p>无需构建实例对象就可以调用这个方法或者变量</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009184136416.png" alt="image-20231009184136416"></p>
<ul>
<li><p>静态方法不能访问非静态的成员</p>
</li>
<li><p>静态方法中不能有this关键字</p>
</li>
</ul>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009185104668.png" alt="image-20231009185104668"></p>
<p><strong>final</strong></p>
<p>修饰类、成员方法、局部变量、成员变量</p>
<p>不能继承、不能重写、变为常量赋值之后不能改变、 成员变量必须初始化。有两种初始化方式，一种是直接赋值另一种是再类的所有构造方法中对其赋值</p>
<p><strong>abstract</strong></p>
<p>abstract在方法中加入，然后可以提示·让这个方法来重写</p>
<p>当一个类有一个方法，这个方法在不同的子类中都有不同的实现的时候，在父类中我们没有去写具体的方法体，这个时候就可以使用抽象（不写方法体）</p>
<p>父类方法有个抽象方法，子类必须重写这个抽象方法</p>
<p><strong>注意</strong></p>
<ul>
<li> 抽象类可以有抽象方法</li>
<li>抽象类不能够直接创建对象</li>
<li>父类方法有个抽象方法，子类必须重写这个抽象方法或者把这个子类定义成抽象类</li>
</ul>
<p><strong>接口</strong></p>
<p>变量为 public static final </p>
<p>方法为 public abstract </p>
<p><strong>接口新增成员</strong></p>
<ul>
<li><p>默认方法</p>
<p>默认方法可以有方法体，可以选择不进行重写 default</p>
<p>如果两个接口中有相同的默认方法，一个类同时实现了这个两个接口，必须也要重写该方法</p>
</li>
<li><p>静态方法</p>
<p>不让实现类去重写该方法。直接用方法接口.这个方法来体现 static</p>
</li>
<li><p>私有方法（jdk9以上）</p>
<p>可以存在方法体，方法不可以被重写 private</p>
<p>private static void privateMethod(){</p>
<p>}</p>
<p>private void privateMethod(){</p>
<p>}</p>
<p>对默认方法和静态方法中的代码进行抽取，提高代码的复用</p>
</li>
</ul>
<p><strong>继承和接口的关系</strong></p>
<p>继承单继承  </p>
<p>一个类可以实现多个接口</p>
<p><strong>抽象类和接口的区别</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009195119383.png" alt="image-20231009195119383"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009195154552.png" alt="image-20231009195154552"></p>
<p><strong>代码块</strong></p>
<ul>
<li><p>局部代码块</p>
<p>控制局部变量的生命周期，想让它再使用完之后尽快销毁，可以把局部变量定义在局部代码块当中，在局部代码块之外不能访问局部代码块里面的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;这是局部代码块&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>构造代码块</p>
<p>创建对象的时候先执行静态代码块，再执行构造方法</p>
<p>构造方法当中重复的代码，放到构造代码块当中，让其先执行，解决代码重复度</p>
<p>（用来抽取构造方法中的重复代码，提高代码的复用性）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;这是构造代码块&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>静态代码块</p>
<p>调用时机：在类的加载的时候会执行，同一个类在程序运行过程中只会加载一次，所以静态代码块也只会执行一次，并且执行顺序是在构造代码块之前的</p>
<p>用来给类当中的静态成员变量初始化，来避免用类名调用这个变量的时候没有被初始化</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> staticNum;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        staticNum = <span class="number">10</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;这里是静态代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        age=<span class="number">1</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;这里是构造代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="comment">// age =1;</span></span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="comment">// age =1;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;这是局部代码块&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>内部类</strong></p>
<ul>
<li><p>局部内部类</p>
<p>如果想定义一个在方法中临时使用的累时可以使用局部内部类</p>
<p>换句话说，如果只想让一个方法使用一个类的另一个方法时，定义局部内部类。</p>
<p>注意事项：局部内部类可以使用外部局部（事实）常量 final</p>
</li>
<li><p>成员内部类</p>
<p>在一个类中定义另外一个类（成员内部类），成员内部类可以访问外部类的私有变量</p>
<p>外部类名.this.成员名来表示外部类的成员</p>
<p>成员内部类不能定义静态成员（非静态中不使用静态）</p>
<p>应用场景：一个类不会单独使用，需要和另外的类一起使用才有意义，并且在用到外部类中的私有方法的时候，可以把这个类定义成内部类</p>
<p>IntegerCache</p>
</li>
<li><p>静态内部类</p>
<p>静态内部类里面可以定义静态成员变量和静态成员方法</p>
<p>静态内部类可以调用外部类的（私有的）静态成员变量（事实常量）</p>
</li>
<li><p>匿名内部类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> 接口名/类名()&#123;</span><br><span class="line">要重写的方法(抽象方法)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果需要创建一个类或者接口的子类对象。但是这个子类只会使用一次，就没有必要创建单独的类。可以使用匿名内部类的形式。</p>
<p>匿名内部类就相当于一个对象，他是某个类（接口）的子类（实现类）的对象</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Inter <span class="title function_">createItr</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//对象的创建格式</span></span><br><span class="line">        <span class="type">Inter</span> <span class="variable">inter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inter</span>();</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//成员内部类</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Inter</span>&#123;</span><br><span class="line">        String s;</span><br><span class="line">        <span class="type">int</span> age;</span><br><span class="line">        </span><br><span class="line">        Demo02.<span class="built_in">this</span>.age;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Inter</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Inter</span><span class="params">(String s, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.s = s;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//静态内部类</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">staticMethod</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//可以调用外部类的静态成员变量</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testMe</span><span class="params">()</span>&#123;</span><br><span class="line">            System.out.println(age);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//匿名内部类</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Runner</span>()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;正在运行&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第五部分：常用类"><a href="#第五部分：常用类" class="headerlink" title="第五部分：常用类"></a>第五部分：常用类</h2><h3 id="equals和-的区别"><a href="#equals和-的区别" class="headerlink" title="equals和==的区别"></a>equals和==的区别</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">一、对象类型不同</span><br><span class="line"></span><br><span class="line">1、equals()：是超类Object中的方法。</span><br><span class="line"></span><br><span class="line">2、==：是操作符。</span><br><span class="line"></span><br><span class="line">二、比较的对象不同</span><br><span class="line"></span><br><span class="line">1、equals()：用来检测两个对象是否相等，即两个对象的内容是否相等。</span><br><span class="line"></span><br><span class="line">2、==：用于比较引用和比较基本数据类型时具有不同的功能，具体如下：</span><br><span class="line"></span><br><span class="line">（1）、基础数据类型：比较的是他们的值是否相等，比如两个int类型的变量，比较的是变量的值是否一样。</span><br><span class="line"></span><br><span class="line">（2）、引用数据类型：比较的是引用的地址是否相同，比如说新建了两个User对象，比较的是两个User的地址是否一样。</span><br><span class="line"></span><br><span class="line">三、运行速度不同</span><br><span class="line"></span><br><span class="line">1、equals()：没有==运行速度快。</span><br><span class="line"></span><br><span class="line">2、==：运行速度比equals()快，因为==只是比较引用。</span><br><span class="line"></span><br><span class="line">扩展资料：</span><br><span class="line">equals()和==的源码定义：</span><br><span class="line"></span><br><span class="line">public boolean equals(Object obj) &#123;</span><br><span class="line"></span><br><span class="line">return (this == obj);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">由equals的源码可以看出这里定义的equals与==是等效的（Object类中的equals没什么区别），不同的原因就在于有些类（像String、Integer等类）对equals进行了重写。</span><br><span class="line"></span><br><span class="line">但是没有对equals进行重写的类就只能从Object类中继承equals方法，其equals方法与==就也是等效的，除非在此类中重写equals。</span><br><span class="line"></span><br><span class="line">对equals重新需要注意五点：</span><br><span class="line"></span><br><span class="line">1、自反性：对任意引用值X，x.equals(x)的返回值一定为true；</span><br><span class="line"></span><br><span class="line">2、对称性：对于任何引用值x,y,当且仅当y.equals(x)返回值为true时，x.equals(y)的返回值一定为true；</span><br><span class="line"></span><br><span class="line">3、传递性：如果x.equals(y)=true, y.equals(z)=true,则x.equals(z)=true ；</span><br><span class="line"></span><br><span class="line">4、 一致性：如果参与比较的对象没任何改变，则对象比较的结果也不应该有任何改变；</span><br><span class="line"></span><br><span class="line">5、非空性：任何非空的引用值X，x.equals(null)的返回值一定为false 。</span><br><span class="line"></span><br><span class="line">==：</span><br><span class="line">== 比较的是变量(栈)内存中存放的对象的(堆)内存地址，用来判断两个对象的地址是否相同，即是否是指相同一个对象。比较的是真正意义上的指针操作。</span><br><span class="line"></span><br><span class="line">1、比较的是操作符两端的操作数是否是同一个对象。</span><br><span class="line"></span><br><span class="line">2、两边的操作数必须是同一类型的（可以是父子类之间）才能编译通过。</span><br><span class="line"></span><br><span class="line">3、比较的是地址，如果是具体的阿拉伯数字的比较，值相等则为true，如：</span><br><span class="line"></span><br><span class="line">int a=10 与 long b=10L 与 double c=10.0都是相同的（为true），因为他们都指向地址为10的堆。</span><br><span class="line"></span><br><span class="line">equals：</span><br><span class="line">equals用来比较的是两个对象的内容是否相等，由于所有的类都是继承自java.lang.Object类的，所以适用于所有对象，如果没有对该方法进行覆盖的话，调用的仍然是Object类中的方法，而Object中的equals方法返回的却是==的判断。</span><br><span class="line"></span><br><span class="line">String s=&quot;abce&quot;是一种非常特殊的形式,和new 有本质的区别。它是java中唯一不需要new 就可以产生对象的途径。</span><br><span class="line"></span><br><span class="line">以String s=&quot;abce&quot;;形式赋值在java中叫直接量,它是在常量池中而不是象new一样放在压缩堆中。这种形式的字符串，在JVM内部发生字符串拘留，即当声明这样的一个字符串后，JVM会在常量池中先查找有有没有一个值为&quot;abcd&quot;的对象。</span><br><span class="line"></span><br><span class="line">如果有，就会把它赋给当前引用.即原来那个引用和现在这个引用指点向了同一对象，如果没有，则在常量池中新创建一个“abcd&quot;”，下一次如果有Strings1=&quot;abcd&quot;；又会将s1指向“abcd”这个对象，即以这形式声明的字符串，只要值相等，任何多个引用都指向同一对象。</span><br><span class="line"></span><br><span class="line">而String s=new String（&quot;abcd”）；和其它任何对象一样.每调用一次就产生一个对象，只要它们调用。</span><br><span class="line"></span><br><span class="line">也可以这么理解：String str=&quot;hello”；先在内存中找是不是有“hello”这个对象，如果有，就让str指向那个“hello”。</span><br><span class="line"></span><br><span class="line">如果内存里没有&quot;hello&quot;，就创建一个新的对象保存&quot;hello”.String str=new String（“hello&quot;）就是不管内存里是不是已经有&quot;hello&quot;这个对象，都新建一个对象保存&quot;hello&quot;。</span><br></pre></td></tr></table></figure>

<h3 id="String常用方法"><a href="#String常用方法" class="headerlink" title="String常用方法"></a>String常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011162154691.png" alt="image-20231011162154691"></p>
<h3 id="自动装箱和拆箱"><a href="#自动装箱和拆箱" class="headerlink" title="自动装箱和拆箱"></a>自动装箱和拆箱</h3><p>自动装箱：基本数据类型-&gt;包装类（包装类的valueOf来转化的，-128~127，在的话在Integer缓存的数组当中拿到对应的Integer对象返回，在这个里面的话就相等，不在这个范围里面，就会new一个Integer对象）</p>
<p>Integer引用数据类型，比较地址值是否相同</p>
<p>自动拆箱：包装类-&gt;基本数据类型</p>
<h3 id="StringBuilder的常用方法"><a href="#StringBuilder的常用方法" class="headerlink" title="StringBuilder的常用方法"></a>StringBuilder的常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011165640479.png" alt="image-20231011165640479"></p>
<p>String-&gt; StringBuffer/StringBuilder</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//String ------- StringBuffer</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="comment">//通过构造方法</span></span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(s);</span><br></pre></td></tr></table></figure>

<h3 id="String-和-StringBuilder、StringBuffer-的区别？"><a href="#String-和-StringBuilder、StringBuffer-的区别？" class="headerlink" title="String 和 StringBuilder、StringBuffer 的区别？"></a>String 和 StringBuilder、StringBuffer 的区别？</h3><ul>
<li>String：String 的值被创建后不能修改，任何对 String 的修改都会引发新的 String 对象的生成。</li>
<li>StringBuffer：跟 String 类似，但是值可以被修改，使用 synchronized 来保证线程安全。</li>
<li>StringBuilder：StringBuffer 的非线程安全版本，性能上更高一些</li>
</ul>
<h2 id="第六部分：异常"><a href="#第六部分：异常" class="headerlink" title="第六部分：异常"></a>第六部分：异常</h2><h3 id="try-catch"><a href="#try-catch" class="headerlink" title="try catch"></a>try catch</h3><p>直接处理</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011172005678.png" alt="image-20231011172005678"></p>
<h3 id="throws"><a href="#throws" class="headerlink" title="throws"></a>throws</h3><p>把异常抛出，让调用者来处理</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011171904538.png" alt="image-20231011171904538"></p>
<h3 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyException</span><span class="params">(String msg)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>(msg);<span class="comment">//调用父类</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MyException</span>(<span class="string">&quot;编译时异常&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>异常的作用：</p>
<ul>
<li>可以帮我们获得具体的错误原因</li>
<li>可以让方法调用方知道错误的地方</li>
</ul>
<h2 id="第七部分：集合"><a href="#第七部分：集合" class="headerlink" title="第七部分：集合"></a>第七部分：集合</h2><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><h3 id="List集合特点"><a href="#List集合特点" class="headerlink" title="List集合特点"></a>List集合特点</h3><ul>
<li>有索引</li>
<li>可以存储重复元素</li>
<li>元素存入的顺序和实际存储的顺序相同</li>
</ul>
<h3 id="ArrayList常用方法"><a href="#ArrayList常用方法" class="headerlink" title="ArrayList常用方法"></a>ArrayList常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011183335381.png" alt="image-20231011183335381"></p>
<h3 id="遍历方式"><a href="#遍历方式" class="headerlink" title="遍历方式"></a>遍历方式</h3><ul>
<li><p>索引遍历</p>
<p>集合.size()  get()</p>
</li>
<li><p>迭代器遍历</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;Object&gt; iterator = arrayList.iterator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">    System.out.println(iterator.next());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在迭代器删除增加数据的时候会引发并发修改异常</p>
</li>
<li><p>可以使用for循环遍历来避免；或者就是新建一个集合，然后将需要删除的元素增加到新的集合中，再用原来的集合将新的集合中的元素移除removeAll()</p>
</li>
<li><p>foreach也会出现并发修改异常，循环集合的时候（相当于迭代器）</p>
</li>
<li><p>集合变数组-&gt;toArray()</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String[] strings = arrayList.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<p>​              后面是new什么类型的返回什么样的数组</p>
<p><strong>集合遍历四种形式</strong></p>
<ul>
<li>for循环遍历</li>
<li>迭代器遍历</li>
<li>foreach遍历</li>
<li>转化为数组再遍历</li>
</ul>
<h3 id="LinkedList常用方法"><a href="#LinkedList常用方法" class="headerlink" title="LinkedList常用方法"></a>LinkedList常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011193855883.png" alt="image-20231011193855883"></p>
<p>遍历同ArrayList</p>
<h3 id="ArrayList和LinkedList有什么区别？"><a href="#ArrayList和LinkedList有什么区别？" class="headerlink" title="ArrayList和LinkedList有什么区别？"></a>ArrayList和LinkedList有什么区别？</h3><p>ArrayList数组：查找快，增删慢</p>
<p>LinkedList链表：相反</p>
<p><strong>（1）</strong>数据结构不同</p>
<ul>
<li>ArrayList基于数组实现</li>
<li>LinkedList基于双向链表实现</li>
</ul>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-2.png" alt="ArrayList和LinkedList的数据结构">ArrayList和LinkedList的数据结构</p>
<p><strong>（2）</strong> 多数情况下，ArrayList更利于查找，LinkedList更利于增删</p>
<ul>
<li>ArrayList基于数组实现，get(int index)可以直接通过数组下标获取，时间复杂度是O(1)；LinkedList基于链表实现，get(int index)需要遍历链表，时间复杂度是O(n)；当然，get(E element)这种查找，两种集合都需要遍历，时间复杂度都是O(n)。</li>
<li>ArrayList增删如果是数组末尾的位置，直接插入或者删除就可以了，但是如果插入中间的位置，就需要把插入位置后的元素都向前或者向后移动，甚至还有可能触发扩容；双向链表的插入和删除只需要改变前驱节点、后继节点和插入节点的指向就行了，不需要移动元素。</li>
</ul>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-3.png" alt="ArrayList和LinkedList中间插入">ArrayList和LinkedList中间插入</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-4.png" alt="ArrayList和LinkedList中间删除">ArrayList和LinkedList中间删除</p>
<blockquote>
<p>注意，这个地方可能会出陷阱，LinkedList更利于增删更多是体现在平均步长上，不是体现在时间复杂度上，二者增删的时间复杂度都是O(n)</p>
</blockquote>
<p><strong>（3）</strong>是否支持随机访问</p>
<ul>
<li>ArrayList基于数组，所以它可以根据下标查找，支持随机访问，当然，它也实现了RandmoAccess 接口，这个接口只是用来标识是否支持随机访问。</li>
<li>LinkedList基于链表，所以它没法根据序号直接获取元素，它没有实现RandmoAccess 接口，标记不支持随机访问。</li>
</ul>
<p><strong>（4）</strong>内存占用，ArrayList基于数组，是一块连续的内存空间，LinkedList基于链表，内存空间不连续，它们在空间占用上都有一些额外的消耗：</p>
<ul>
<li>ArrayList是预先定义好的数组，可能会有空的内存空间，存在一定空间浪费</li>
<li>LinkedList每个节点，需要存储前驱和后继，所以每个节点会占用更多的空间</li>
</ul>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><h4 id="Set集合的特点"><a href="#Set集合的特点" class="headerlink" title="Set集合的特点"></a>Set集合的特点</h4><p>不存储重复值</p>
<p>没有索引</p>
<p>不按顺序存储，随机存储</p>
<h4 id="HashSet集合的特点"><a href="#HashSet集合的特点" class="headerlink" title="HashSet集合的特点"></a>HashSet集合的特点</h4><ul>
<li>底层数据结构是哈希表</li>
<li>存储元素和遍历元素顺序可能不一样</li>
<li>没有索引</li>
<li>不存在重复元素</li>
</ul>
<h4 id="HashSet集合的常用方法"><a href="#HashSet集合的常用方法" class="headerlink" title="HashSet集合的常用方法"></a>HashSet集合的常用方法</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011195713951.png" alt="image-20231011195713951"></p>
<h4 id="HashSet集合的遍历"><a href="#HashSet集合的遍历" class="headerlink" title="HashSet集合的遍历"></a>HashSet集合的遍历</h4><p>转为数组</p>
<p>迭代器</p>
<p>foreach</p>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011200259331.png" alt="image-20231011200259331"></p>
<p>key有了之后，然后再添加，会覆盖前面的设置value</p>
<ul>
<li><p>对象创建</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,String&gt; mm = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure></li>
<li><p>常用方法</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011205506742.png" alt="image-20231011205506742"></p>
<p>map.put()，如果key已存在，则会覆盖原先的值，并会返回老的值</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;k&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">HashMap&lt;String,String&gt; mm = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">map.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;k&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;z&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;3&quot;</span>,<span class="string">&quot;y&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//key 1存在</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> map.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;康&quot;</span>);</span><br><span class="line"><span class="comment">//s1=康</span></span><br><span class="line">System.out.println(<span class="string">&quot;s1&quot;</span>+s1);</span><br><span class="line"><span class="comment">//获取</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> map.get(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;s = &quot;</span> + s);</span><br><span class="line"></span><br><span class="line"><span class="comment">//移除</span></span><br><span class="line"><span class="type">String</span> <span class="variable">remove</span> <span class="operator">=</span> map.remove(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;remove = &quot;</span> + remove);</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断是否存在键再不再</span></span><br><span class="line"><span class="keyword">if</span> (map.containsKey(<span class="string">&quot;1&quot;</span>))&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> mm.get(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;s1 = &quot;</span> + s1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//清空所有键值对</span></span><br><span class="line">mm.clear();</span><br></pre></td></tr></table></figure>

<p><strong>map集合的遍历</strong></p>
<ul>
<li><p>map.entrySet() 获取所有key和value，存到set集合中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;k&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Set&lt;Map.Entry&lt;String, String&gt;&gt; entries = map.entrySet();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : entries) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;entry.getKey() = &quot;</span> + entry.getKey()+entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>map.keySet 获取的是所有key的值，然后遍历key再获取value</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; strings = map.keySet();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (String key : strings) &#123;</span><br><span class="line">    System.out.println(key+<span class="string">&quot;+++++&quot;</span>+map.get(key));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>equals和hashCode重写的话，属性值相同就相同，就是同一个对象</p>
<p>不重写的话，比较的是地址值</p>
<h2 id="第八部分：泛型"><a href="#第八部分：泛型" class="headerlink" title="第八部分：泛型"></a>第八部分：泛型</h2><h3 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h3><p>创建子类的时候可以指定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Test&lt;T&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型方法"><a href="#泛型方法" class="headerlink" title="泛型方法"></a>泛型方法</h3><p>方法调用时可以指定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">test</span><span class="params">(T t)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>向上转型 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span> <span class="params">(List&lt;? extends Student&gt;)</span></span><br></pre></td></tr></table></figure>

<p>只能传入Student类本身和Student类的子类</p>
<p>向下转型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span> <span class="params">(List&lt;? <span class="built_in">super</span> Student&gt;)</span></span><br></pre></td></tr></table></figure>

<p>只能传入泛型为Student类本身和Student类的父类</p>
<p>泛型上限是在定义类可以使用但是？用E来代替</p>
<p>泛型下限是在定义方法时常使用</p>
<h2 id="第九部分：IO"><a href="#第九部分：IO" class="headerlink" title="第九部分：IO"></a>第九部分：IO</h2><h3 id="建对象"><a href="#建对象" class="headerlink" title="建对象"></a>建对象</h3><p>绝对路径：C:\Users\康\Desktop\git\1.txt</p>
<p>相对路径：1.txt</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231012190150277.png" alt="image-20231012190150277"></p>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231012191119070.png" alt="image-20231012191119070"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">newFile</span> <span class="operator">=</span> file.createNewFile();</span><br><span class="line">    System.out.println(<span class="string">&quot;newFile = &quot;</span> + newFile);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\2&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">newFile1</span> <span class="operator">=</span> file.mkdir();</span><br><span class="line">    System.out.println(<span class="string">&quot;newFile1 = &quot;</span> + newFile1);</span><br><span class="line"></span><br><span class="line">    <span class="type">File</span> <span class="variable">file3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1\\2&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">a</span> <span class="operator">=</span> file3.mkdirs();</span><br><span class="line">    System.out.println(<span class="string">&quot;a = &quot;</span> + a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第十部分：递归"><a href="#第十部分：递归" class="headerlink" title="第十部分：递归"></a>第十部分：递归</h2><p>一般循环和递归都能解决，用循环来解决。递归可能导致栈溢出</p>
<h3 id="求阶乘"><a href="#求阶乘" class="headerlink" title="求阶乘"></a>求阶乘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">jiecheng</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i*jiecheng(i-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//递归删除文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deleteFile</span><span class="params">(File file)</span>&#123;</span><br><span class="line">    File[] files = file.listFiles();</span><br><span class="line">    <span class="keyword">if</span> (files!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (File file1 : files) &#123;</span><br><span class="line">            <span class="keyword">if</span>(file1.isFile())</span><br><span class="line">            &#123;</span><br><span class="line">                file1.delete();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (file1.isDirectory())&#123;</span><br><span class="line">                &#123;</span><br><span class="line">                deleteFile(file1);</span><br><span class="line">                file1.delete();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="第十一部分：IO流"><a href="#第十一部分：IO流" class="headerlink" title="第十一部分：IO流"></a>第十一部分：IO流</h2><h3 id="IO流的分类"><a href="#IO流的分类" class="headerlink" title="IO流的分类"></a>IO流的分类</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231013181910168.png" alt="image-20231013181910168"></p>
<h3 id="字节输入流"><a href="#字节输入流" class="headerlink" title="字节输入流"></a>字节输入流</h3><p>创建对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入流读对象</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fileInputStream1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">System.out.println(<span class="string">&quot;fileInputStream1 = &quot;</span> + fileInputStream1);</span><br></pre></td></tr></table></figure>

<p>读取fileInputStream 对象</p>
<p><strong>一次读取一个字节数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入流读对象</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> fileInputStream.read();</span><br><span class="line">sout(read);<span class="comment">//返回值为-1时，停止读取</span></span><br><span class="line"></span><br><span class="line">fileInputStream.close();</span><br></pre></td></tr></table></figure>

<p><strong>一次读取一个字节数组</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">5</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> fileInputStream.read(bytes); <span class="comment">//读取到的长度</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len);</span><br><span class="line">System.out.println(<span class="string">&quot;s = &quot;</span> + s);</span><br><span class="line">fileInputStream.close();</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入流读对象</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">        </span><br><span class="line"><span class="comment">//将读到的数据放到数组里</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">2</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((len=fileInputStream.read(bytes))!=-<span class="number">1</span>)&#123; </span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len)); <span class="comment">//把数组中元素从0到len长度转换成字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="资源释放的写法"><a href="#资源释放的写法" class="headerlink" title="资源释放的写法"></a>资源释放的写法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入流读对象</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    fileInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="keyword">while</span>((len=fileInputStream.read(bytes))!=-<span class="number">1</span>)&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len));</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (fileInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileInputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">exceptionq</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//输入流读对象</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">2</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span>((len=fileInputStream.read(bytes))!=-<span class="number">1</span>)&#123;</span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//可以省略,但最后会执行</span></span><br><span class="line"><span class="comment">//            fileInputStream.close();</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>字节流，复制文件</p>
<p>字符流，写文本什么的</p>
<h3 id="字节输出流"><a href="#字节输出流" class="headerlink" title="字节输出流"></a>字节输出流</h3><p>输出流FileOutputStream写对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws IOException &#123;</span><br><span class="line">    //输出流写对象</span><br><span class="line">    FileOutputStream fileOutputStream = new FileOutputStream(&quot;D:\\kzy\\1.txt&quot;);</span><br><span class="line"></span><br><span class="line">    byte[] bytes = &quot;123&quot;.getBytes();</span><br><span class="line">    fileOutputStream.write(bytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件续写"><a href="#文件续写" class="headerlink" title="文件续写"></a>文件续写</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileOutputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//append默认为 ：false 在建这个输出流对象的时候就会把原先文件删除</span></span><br><span class="line"><span class="comment">//append默认为 ：true 在建这个输出流对象的时候就会在原先文件继续写</span></span><br><span class="line"><span class="type">byte</span>[] bytes = <span class="string">&quot;123&quot;</span>.getBytes();</span><br><span class="line"></span><br><span class="line">fis.write(bytes);</span><br></pre></td></tr></table></figure>

<h3 id="文件复制"><a href="#文件复制" class="headerlink" title="文件复制"></a>文件复制</h3><p>首先在目标文件夹中建立一个和原文件一样名字的文件，然后通过输入流读原文件，输出流写文件到目标文件中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件复制</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">/*FileOutputStream fis = new FileOutputStream(&quot;D:\\kzy\\1.txt&quot;, true);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        byte[] bytes = &quot;123&quot;.getBytes();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        fis.write(bytes);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//编写一个方法来实现文件的复制</span></span><br><span class="line">        <span class="comment">//相当于循环读写，直到数据读取完</span></span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1697274314932.jpg&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">destDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\c&quot;</span>);</span><br><span class="line">        copyFile(srcFile, destDir);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//原文件的绝对路径 srcFile</span></span><br><span class="line">    <span class="comment">//目标文件的存放目录路径 destDir</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFile</span><span class="params">(File srcFile, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcFile.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(srcFile);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取原文件，把读到的文件放到目标文件中</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">//先读到数组里，再从数组中写入</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            fileOutputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件夹的复制"><a href="#文件夹的复制" class="headerlink" title="文件夹的复制"></a>文件夹的复制</h3><p><strong>不考虑有子文件夹</strong></p>
<p>首先在目标文件夹中建立一个和原文件夹一样名字的文件夹，然后遍历原文件夹，获取所有文件，然后通过以上文件复制，将文件复制到对应的文件夹中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件夹复制</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//编写一个方法来实现文件的复制</span></span><br><span class="line">        <span class="comment">//相当于循环读写，直到数据读取完</span></span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test1&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">destDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        copyDir(srcFile,destDir);</span><br><span class="line">        <span class="comment">//复制一个文件夹，不考虑有子文件夹的</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyDir</span><span class="params">(File srcDir, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(srcDir.exists() &amp;&amp; srcDir.isDirectory())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;原文件夹必须存在，并且是文件夹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!destDir.exists()&amp;&amp; destDir.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;文件夹必须存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcDir.getName());</span><br><span class="line">        dir.mkdirs();</span><br><span class="line">        <span class="comment">/*FileInputStream fileInputStream = new FileInputStream(srcDir);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        FileOutputStream fileOutputStream = new FileOutputStream(file);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取原文件夹中所有文件</span></span><br><span class="line">        File[] files = srcDir.listFiles();</span><br><span class="line">        <span class="comment">//把读到的文件放到目标文件夹中</span></span><br><span class="line">        <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">            copyFile(file, dir);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFile</span><span class="params">(File srcFile, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcFile.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(srcFile);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取原文件，把读到的文件放到目标文件中</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">//先读到数组里，再从数组中写入</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            fileOutputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>考虑有子文件夹</strong></p>
<p>首先在目标文件夹中建立一个和原文件夹一样名字的文件夹，然后遍历原文件夹，获取所有文件，判断是否是文件夹，是文件夹的话通过递归复制，是文件，直接通过以上文件复制，将文件复制到对应的文件夹中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//编写一个方法来实现文件的复制</span></span><br><span class="line">        <span class="comment">//相当于循环读写，直到数据读取完</span></span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test1&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">destDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        copyDir(srcFile,destDir);</span><br><span class="line">        <span class="comment">//复制一个文件夹，考虑有子文件夹的</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyDir</span><span class="params">(File srcDir, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(srcDir.exists() &amp;&amp; srcDir.isDirectory())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;原文件夹必须存在，并且是文件夹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!destDir.exists()&amp;&amp; destDir.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;文件夹必须存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcDir.getName());</span><br><span class="line">        dir.mkdirs();</span><br><span class="line">        <span class="comment">/*FileInputStream fileInputStream = new FileInputStream(srcDir);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        FileOutputStream fileOutputStream = new FileOutputStream(file);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取原文件夹中所有文件</span></span><br><span class="line">        File[] files = srcDir.listFiles();</span><br><span class="line">        <span class="comment">//把读到的文件放到目标文件夹中</span></span><br><span class="line">        <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file.isFile()) &#123;</span><br><span class="line">                copyFile(file, dir);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (file.isDirectory())&#123;</span><br><span class="line">                copyDir(file,dir);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFile</span><span class="params">(File srcFile, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcFile.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(srcFile);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取原文件，把读到的文件放到目标文件中</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">//先读到数组里，再从数组中写入</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            fileOutputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编码和解码（字节流）"><a href="#编码和解码（字节流）" class="headerlink" title="编码和解码（字节流）"></a>编码和解码（字节流）</h3><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231014193530811.png" alt="image-20231014193530811" style="zoom:150%;" />

<p>编码和解码方式相同才不会乱码</p>
<p>默认时UTF-8</p>
<h3 id="字符流"><a href="#字符流" class="headerlink" title="字符流"></a>字符流</h3><p>当我们读取（写入）的是纯文本的形式时，我们可以用字符流来进行操作</p>
<ul>
<li><h3 id="字符输入流"><a href="#字符输入流" class="headerlink" title="字符输入流"></a>字符输入流</h3></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字符输入流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//        FileReader fileReader = new FileReader(&quot;D:\\kzy\\test1\\1.txt&quot;);</span></span><br><span class="line">        <span class="type">FileReader</span> <span class="variable">fileReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test1\\1.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*        //读一个字符</span></span><br><span class="line"><span class="comment">        int len;</span></span><br><span class="line"><span class="comment">        while ((len = fileReader.read())!=-1)&#123;</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;fileReader.read() = &quot; + (char)len);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//读一个字符数组</span></span><br><span class="line">        <span class="type">char</span>[] chars = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span>*<span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len2;</span><br><span class="line">        <span class="keyword">while</span> ((len2 = fileReader.read(chars))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;fileReader.read() = &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(chars));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fileReader.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h3 id="字符输出流"><a href="#字符输出流" class="headerlink" title="字符输出流"></a>字符输出流</h3><p>write会先将写入的数据放在内存缓冲区,flush或者close时，才会真正写入</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取一个字符</span></span><br><span class="line"><span class="comment">//必须是文件，不能是文件夹</span></span><br><span class="line"><span class="type">FileWriter</span> <span class="variable">fileWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="keyword">new</span>         <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test1\\1.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line">fileWriter.write(<span class="string">&quot;你&quot;</span>);</span><br><span class="line">fileWriter.flush();</span><br><span class="line">fileWriter.write(<span class="string">&quot;最&quot;</span>);</span><br><span class="line">fileWriter.write(<span class="string">&quot;棒&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//写入字符数组</span></span><br><span class="line"><span class="type">char</span>[] chars = <span class="string">&quot;三更草堂&quot;</span>.toCharArray();</span><br><span class="line">fileWriter.write(chars);</span><br><span class="line">fileWriter.flush();</span><br><span class="line"></span><br><span class="line"><span class="comment">//写入字符串</span></span><br><span class="line">fileWriter.write(<span class="string">&quot;三更草堂&quot;</span>);</span><br><span class="line">fileWriter.close();</span><br></pre></td></tr></table></figure>

<p>复制最好使用字节流，可以复制任意的。字符流只能复制文本</p>
<p><em><strong>字符流会读取字符数组。字节流会读取字节数组</strong></em></p>
<ul>
<li>文件复制（字符流）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件复制</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo7</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">destDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\c&quot;</span>);</span><br><span class="line">        copyFile(srcFile, destDir);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//原文件的绝对路径 srcFile</span></span><br><span class="line">    <span class="comment">//目标文件的存放目录路径 destDir</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFile</span><span class="params">(File srcFile, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcFile.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">FileReader</span> <span class="variable">fr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(srcFile);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileWriter</span> <span class="variable">fw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(file);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取原文件，把读到的文件放到目标文件中</span></span><br><span class="line">        <span class="type">char</span>[] chars = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span> * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">//先读到数组里，再从数组中写入</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fr.read(chars)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            fw.write(chars, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fr.close();</span><br><span class="line">        fw.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字符流编码的设置"><a href="#字符流编码的设置" class="headerlink" title="字符流编码的设置"></a>字符流编码的设置</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231014202813190.png" alt="image-20231014202813190"></p>
<h3 id="高效缓冲流"><a href="#高效缓冲流" class="headerlink" title="高效缓冲流"></a>高效缓冲流</h3><p>读数据，先将磁盘的部分数据读到内存缓冲区，然后内存直接读取缓冲区的数据，更快。。。借助内存的缓冲区来减少磁盘IO的次数，提高性能</p>
<p><strong>分类</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231015144307536.png" alt="image-20231015144307536"></p>
<p><strong>对象创建</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231015144359968.png" alt="image-20231015144359968"></p>
<p><strong>特有方法</strong></p>
<p>BufferedRead:   readLine() 一次读一行，不包括换行符</p>
<p>BufferedWriter: newLine() 换行符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;D:\\kzy\\test1\\2.txt&quot;</span>));</span><br><span class="line">    String len;</span><br><span class="line">    <span class="keyword">while</span> ((len=bufferedReader.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;bufferedReader.readLine() = &quot;</span> + len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>文件内容的复制</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">bfr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;D:\\kzy\\test1\\2.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">BufferedWriter</span> <span class="variable">bfw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;D:\\kzy\\test1\\1.txt&quot;</span>,<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">    String len;</span><br><span class="line">    <span class="keyword">while</span> ((len=bfr.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">            bfw.write(len);</span><br><span class="line">            bfw.newLine();</span><br><span class="line">    &#125;</span><br><span class="line">    bfr.close();</span><br><span class="line">    bfw.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="跟着三更学JAVA-函数式编程"><a href="#跟着三更学JAVA-函数式编程" class="headerlink" title="跟着三更学JAVA-函数式编程"></a>跟着三更学JAVA-函数式编程</h1><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul>
<li><p>代码简洁，开发迅速</p>
</li>
<li><p>接近自然语言，易于理解</p>
</li>
<li><p>易于并发编程</p>
</li>
<li><p>条件：是有函数式接口中只有一个abstract方法</p>
</li>
</ul>
<h2 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h2><p>不注重方法名，只注重参数和所进行的操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;线程被启动了&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;又被启动了&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*int cal = cal(new IntBinaryOperator() &#123;</span></span><br><span class="line"><span class="comment">        @Override</span></span><br><span class="line"><span class="comment">        public int applyAsInt(int left, int right) &#123;</span></span><br><span class="line"><span class="comment">            return left + right;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;);*/</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">cal</span> <span class="operator">=</span> cal((left, right) -&gt; left + right);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;cal = &quot;</span> + cal);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">cal</span><span class="params">(IntBinaryOperator intBinaryOperator)</span>&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> b=<span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> intBinaryOperator.applyAsInt(a,b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><ul>
<li>参数类型可以省略</li>
<li>方法体内只有一句代码时大括号的return和唯一依据代码的分号可以省略</li>
<li>方法只有一个参数时小括号可以省略</li>
</ul>
<h2 id="Stream流"><a href="#Stream流" class="headerlink" title="Stream流"></a>Stream流</h2><p>更方便的对集合和数组进行操作</p>
<h3 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h3><ul>
<li>单列集合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 单列集合</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">       ArrayList&lt;Integer&gt; arr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       arr.add(<span class="number">1</span>);</span><br><span class="line">       arr.add(<span class="number">4</span>);</span><br><span class="line">       arr.add(<span class="number">3</span>);</span><br><span class="line">       arr.add(<span class="number">2</span>);</span><br><span class="line">       <span class="comment">//创建对象</span></span><br><span class="line">       Stream&lt;Integer&gt; stream = arr.stream();</span><br><span class="line">       stream.distinct()</span><br><span class="line">               .filter(integer -&gt; integer&gt;<span class="number">2</span>)</span><br><span class="line">               .forEach(System.out::println);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>数组</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 数组</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">       Integer[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>&#125;;</span><br><span class="line">       <span class="comment">//创建对象</span></span><br><span class="line">       Stream&lt;Integer&gt; stream = Arrays.stream(arr);</span><br><span class="line">       <span class="comment">//Stream&lt;Integer&gt; stream = Stream.of(arr);</span></span><br><span class="line">       stream.distinct()</span><br><span class="line">               .filter(integer -&gt; integer&gt;<span class="number">2</span>)</span><br><span class="line">               .forEach(System.out::println);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>多列集合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 多列集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        HashMap&lt;String,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;1&quot;</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="string">&quot;2&quot;</span>,<span class="number">3</span>);</span><br><span class="line">        map.put(<span class="string">&quot;3&quot;</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建对象</span></span><br><span class="line">        Stream&lt;Map.Entry&lt;String, Integer&gt;&gt; stream = map.entrySet().stream();</span><br><span class="line">        stream.filter(entry -&gt; entry.getValue()&gt;<span class="number">2</span>)</span><br><span class="line">                .forEach(entry -&gt; System.out.println(entry.getKey()+entry.getValue()));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="中间操作"><a href="#中间操作" class="headerlink" title="中间操作"></a>中间操作</h3><h4 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h4><p>去重，去掉相同的元素。如果是判断对象是否相同，要重写equals方法，否则用的是==来比较，比较的是地址值。应该比较属性值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 去重</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; arr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    arr.add(<span class="number">1</span>);</span><br><span class="line">    arr.add(<span class="number">4</span>);</span><br><span class="line">    arr.add(<span class="number">3</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    System.out.println(arr);</span><br><span class="line">    <span class="comment">//创建对象</span></span><br><span class="line">    Stream&lt;Integer&gt; stream = arr.stream();</span><br><span class="line">    <span class="comment">//Stream&lt;Integer&gt; stream = Stream.of(arr);</span></span><br><span class="line">    stream.distinct()</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>过滤（筛选）；可以对流中的元素进行条件过滤，符合条件的数据继续存在流中</p>
<p>例子：查询年龄大于20的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">    HashMap&lt;String,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    map.put(<span class="string">&quot;康志远&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    map.put(<span class="string">&quot;翟龙浩&quot;</span>,<span class="number">21</span>);</span><br><span class="line">    map.put(<span class="string">&quot;魏晓静&quot;</span>,<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line">    Stream&lt;Map.Entry&lt;String, Integer&gt;&gt; stream = map.entrySet().stream();</span><br><span class="line"></span><br><span class="line">    stream.filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Map.Entry&lt;String, Integer&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Map.Entry&lt;String, Integer&gt; entry)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> entry.getValue()&gt;<span class="number">19</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>可以对流进行类型转换和计算</p>
<p>将流中的Person转为String流获取所有人的名字和每个人的年龄加一</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * map转换类型和计算</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span> &#123;</span><br><span class="line">       ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>,<span class="number">20</span>));</span><br><span class="line">       arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>,<span class="number">21</span>));</span><br><span class="line">       arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康之源&quot;</span>,<span class="number">18</span>));</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取所有名字</span></span><br><span class="line">       arrayList.stream()</span><br><span class="line">               .map(person -&gt; person.getName())</span><br><span class="line">               .forEach(s -&gt; System.out.println(s));</span><br><span class="line">       <span class="comment">//年龄加一操作</span></span><br><span class="line">       arrayList.stream()</span><br><span class="line">               .map(person -&gt; person.getAge())</span><br><span class="line">               .map(age-&gt;age+<span class="number">1</span>)</span><br><span class="line">               .forEach(System.out::println);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h4><p>对流中的元素进行排序，</p>
<p><strong>注意：需要对排序的对象进行implements Comparable<T>，并重写compareTo方法</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Person o)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getAge()-o.getAge();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者直接实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.sorted(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Person&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Person o1, Person o2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> o1.getAge()-o2.getAge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h4><p>设置最大流，超出的最终被抛弃</p>
<p>例子：进行降序处理，并去重，然后打印出年龄最大的三位</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进行降序处理，并去重，然后打印出年龄最大的三位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test08</span><span class="params">()</span> &#123;</span><br><span class="line">    ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>,<span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>,<span class="number">21</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>,<span class="number">18</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>,<span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>,<span class="number">13</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>,<span class="number">14</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>,<span class="number">24</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>,<span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">    arrayList.stream()</span><br><span class="line">            .distinct()</span><br><span class="line">            .sorted(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Person&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Person o1, Person o2)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> o2.getAge()-o1.getAge();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .limit(<span class="number">3</span>)</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h4><p>跳过前n个元素，并返回剩下的元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进行降序处理，并去重，然后跳过年龄最大的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test09</span><span class="params">()</span> &#123;</span><br><span class="line">    ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>,<span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>,<span class="number">21</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>,<span class="number">18</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>,<span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>,<span class="number">13</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>,<span class="number">14</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>,<span class="number">24</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>,<span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">    arrayList.stream()</span><br><span class="line">            .distinct()</span><br><span class="line">            .sorted(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Person&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Person o1, Person o2)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> o2.getAge()-o1.getAge();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .skip(<span class="number">1</span>)</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h4><p>map只能把一个对象转化成另一个对象来作为流中的元素，而flatMap可以将一个对象转化为多个对象来体现</p>
<ol>
<li>把一个元素转化为多个元素。比如一个类里面有一个集合元素，flatMap先将这个类中的集合，将他转化为新的流</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    Integer age;</span><br><span class="line">    List&lt;Person&gt; list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印Person中的集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test10</span><span class="params">()</span> &#123;</span><br><span class="line">        ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>, <span class="number">21</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>, <span class="number">18</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>, <span class="number">13</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>, <span class="number">14</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>, <span class="number">24</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>, <span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        person.setList(arrayList);</span><br><span class="line">        arrayList.stream()</span><br><span class="line">                .distinct()</span><br><span class="line">                .flatMap((Function&lt;Person, Stream&lt;Person&gt;&gt;) person1 -&gt; &#123;</span><br><span class="line">                    <span class="comment">//拿到Person中集合</span></span><br><span class="line">                    <span class="keyword">return</span> person1.getList().stream();</span><br><span class="line">                &#125;).forEach(<span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;Person&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Person o)</span> &#123;</span><br><span class="line">                System.out.println(o.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="终结操作"><a href="#终结操作" class="headerlink" title="终结操作"></a>终结操作</h3><h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><p>遍历输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取所有的名字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test11</span><span class="params">()</span>&#123;</span><br><span class="line">    ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>, <span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>, <span class="number">21</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康之源&quot;</span>, <span class="number">18</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取所有名字</span></span><br><span class="line">    arrayList.stream()</span><br><span class="line">            .map(person -&gt; person.getName())</span><br><span class="line">            .forEach(s -&gt; System.out.println(s));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="count"><a href="#count" class="headerlink" title="count"></a>count</h4><p>用来获取数目，注意有返回值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 去掉相同的元素，并统计数目</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test12</span><span class="params">()</span>&#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; arr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        arr.add(<span class="number">1</span>);</span><br><span class="line">        arr.add(<span class="number">4</span>);</span><br><span class="line">        arr.add(<span class="number">3</span>);</span><br><span class="line">        arr.add(<span class="number">2</span>);</span><br><span class="line">        arr.add(<span class="number">2</span>);</span><br><span class="line">        arr.add(<span class="number">2</span>);</span><br><span class="line">        System.out.println(arr);</span><br><span class="line">        <span class="comment">//创建对象</span></span><br><span class="line">        Stream&lt;Integer&gt; stream = arr.stream();</span><br><span class="line"><span class="comment">//        Stream&lt;Integer&gt; stream = Stream.of(arr);</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> stream.distinct()</span><br><span class="line">                .count();</span><br><span class="line">        System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="min和max"><a href="#min和max" class="headerlink" title="min和max"></a>min和max</h4><p>注意有返回值Optional<Integer>,一个流完之后，需要在获取另一个流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 最大值，最小值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test13</span><span class="params">()</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; arr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    arr.add(<span class="number">1</span>);</span><br><span class="line">    arr.add(<span class="number">4</span>);</span><br><span class="line">    arr.add(<span class="number">3</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    System.out.println(arr);</span><br><span class="line">    <span class="comment">//创建对象</span></span><br><span class="line">    Stream&lt;Integer&gt; stream = arr.stream();</span><br><span class="line">    Optional&lt;Integer&gt; max = stream</span><br><span class="line">            .max(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> o1 - o2;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    Stream&lt;Integer&gt; stream2 = arr.stream();</span><br><span class="line">    Optional&lt;Integer&gt; min = stream2</span><br><span class="line">            .min(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> o1 - o2;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;max.get() = &quot;</span> + max.get());</span><br><span class="line">    System.out.println(<span class="string">&quot;min.get() = &quot;</span> + min.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="collect"><a href="#collect" class="headerlink" title="collect"></a>collect</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;Person&gt; arrayList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>, <span class="number">21</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>, <span class="number">18</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>, <span class="number">13</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>, <span class="number">14</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>, <span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h6 id="List集合"><a href="#List集合" class="headerlink" title="List集合"></a>List集合</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取一个存放名字的集合List</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test14</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Person&gt; stream = arrayList.stream();</span><br><span class="line">    List&lt;String&gt; names = stream.map(person -&gt; person.getName())</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    System.out.println(names);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Set集合"><a href="#Set集合" class="headerlink" title="Set集合"></a>Set集合</h6><p>可以去重</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取一个存放名字的集合Set</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test15</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Person&gt; stream = arrayList.stream();</span><br><span class="line">    Set&lt;String&gt; names = stream.map(person -&gt; person.getName())</span><br><span class="line">            .collect(Collectors.toSet());</span><br><span class="line">    System.out.println(names);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Map集合"><a href="#Map集合" class="headerlink" title="Map集合"></a>Map集合</h6><p>需要new两个Function，一个是key，一个是value</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取一个存放名字的集合Map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test16</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Person&gt; stream = arrayList.stream();</span><br><span class="line">    Map&lt;String, Integer&gt; collects = stream.collect(Collectors.toMap(person -&gt; person.getName(), person -&gt; person.getAge()));</span><br><span class="line">    System.out.println(collects);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="anyMatch"><a href="#anyMatch" class="headerlink" title="anyMatch"></a>anyMatch</h6><p>查询是否有任意一个元素符合匹配条件，有一个符合就为true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询是否有任意一个年龄大于20的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">                .anyMatch(person -&gt; person.getAge() &gt; <span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;b = &quot;</span> + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="allMatch"><a href="#allMatch" class="headerlink" title="allMatch"></a>allMatch</h6><p>查询是否所有元素符合匹配条件，所有符合就为true，有不符合的就为false</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询是否所有年龄大于20的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">                .allMatch(person -&gt; person.getAge() &gt; <span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;b = &quot;</span> + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="noneMatch"><a href="#noneMatch" class="headerlink" title="noneMatch"></a>noneMatch</h6><p>查询是否所有元素都不符合匹配条件，都不符合就为true，有符合的就为false</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询是否都不符合年龄大于23 noneMatch</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">            .noneMatch(person -&gt; person.getAge() &gt; <span class="number">23</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;b = &quot;</span> + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="findAny"><a href="#findAny" class="headerlink" title="findAny"></a>findAny</h6><p>获取任意一个符合条件的元素，不一定是第一个元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询是否有年龄大于19的，有的话给出任意一个人的名字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">    Optional&lt;Person&gt; persons = arrayList.stream()</span><br><span class="line">            .filter(person -&gt; person.getAge() &gt; <span class="number">19</span>)</span><br><span class="line">            .findAny();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Optional来避免出现空指针异常的情况。以下是如果返回的结果中有对象的话，打印对象的名字</span></span><br><span class="line">       persons.ifPresent(person -&gt; System.out.println(<span class="string">&quot;person = &quot;</span> + person.getName()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="findFirst"><a href="#findFirst" class="headerlink" title="findFirst"></a>findFirst</h6><p>查找第一个元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询年龄最小的人的名字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span> &#123;</span><br><span class="line">    Optional&lt;Person&gt; person = arrayList.stream()</span><br><span class="line">            .sorted((o1, o2) -&gt; o1.getAge() - o2.getAge())</span><br><span class="line">            .findFirst();</span><br><span class="line">    person.ifPresent(person1 -&gt; System.out.println(<span class="string">&quot;person1 = &quot;</span> + person1.getName()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h6><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017110844185.png" alt="image-20231017110844185"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017111013908.png" alt="image-20231017111013908"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017111714683.png" alt="image-20231017111714683"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算所有年龄的和</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">            .map(person -&gt; person.getAge()) <span class="comment">//先将流中的person转化为年龄integer类型</span></span><br><span class="line">            .reduce(<span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">BinaryOperator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Integer <span class="title function_">apply</span><span class="params">(Integer result, Integer integer)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> result + integer;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;sum = &quot;</span> + sum);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算年龄中的最大值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">max</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">                .map(person -&gt; person.getAge()) <span class="comment">//先将流中的person转化为年龄integer类型</span></span><br><span class="line">                .reduce(Integer.MIN_VALUE, (result, element) -&gt; result &lt; element ? element : result);</span><br><span class="line">        System.out.println(<span class="string">&quot;max = &quot;</span> + max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算年龄中的最最小值，初始值默认为第一个</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test08</span><span class="params">()</span> &#123;</span><br><span class="line">        Optional&lt;Integer&gt; min = arrayList.stream()</span><br><span class="line">                .map(person -&gt; person.getAge()) <span class="comment">//先将流中的person转化为年龄integer类型</span></span><br><span class="line">                .reduce((result, element) -&gt; result &gt; element ? element : result);</span><br><span class="line">        System.out.println(<span class="string">&quot;min = &quot;</span> + min);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017124616237.png" alt="image-20231017124616237"></p>
<h3 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h3><h4 id="4-1概述"><a href="#4-1概述" class="headerlink" title="4.1概述"></a>4.1概述</h4><p>编写代码最多的是空指针异常，所以我们需要做各种非空判断</p>
<p>利用Optional来处理是否为空</p>
<h4 id="4-2使用"><a href="#4-2使用" class="headerlink" title="4.2使用"></a>4.2使用</h4><h5 id="4-2-1创建对象"><a href="#4-2-1创建对象" class="headerlink" title="4.2.1创建对象"></a>4.2.1<strong>创建对象</strong></h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017142336922.png" alt="image-20231017142336922"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//List&lt;Person&gt; personList = getList();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Optional&lt;List&lt;Person&gt;&gt; personList1 = Optional.ofNullable(personList);</span></span><br><span class="line"></span><br><span class="line">        Optional&lt;List&lt;Person&gt;&gt; list = getList();</span><br><span class="line">        list.ifPresent(people -&gt; System.out.println(<span class="string">&quot;people = &quot;</span> + people));</span><br><span class="line"></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="comment">//        Person person = null;</span></span><br><span class="line">        <span class="comment">//of创建Optional对象，这个必须不为null</span></span><br><span class="line">        Optional&lt;Person&gt; person1 = Optional.of(person);</span><br><span class="line">        person1.ifPresent(person2 -&gt; System.out.println(<span class="string">&quot;person2 = &quot;</span> + person2));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Optional&lt;List&lt;Person&gt;&gt; <span class="title function_">getList</span><span class="params">()</span> &#123;</span><br><span class="line">        ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>, <span class="number">21</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>, <span class="number">18</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>, <span class="number">13</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>, <span class="number">14</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>, <span class="number">24</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>, <span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(arrayList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-2-1安全消费值"><a href="#4-2-1安全消费值" class="headerlink" title="4.2.1安全消费值"></a><strong>4.2.1安全消费值</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.ifPresent(people -&gt; System.out.println(<span class="string">&quot;people = &quot;</span> + people));</span><br></pre></td></tr></table></figure>

<h5 id="4-2-2安全的获取值"><a href="#4-2-2安全的获取值" class="headerlink" title="4.2.2安全的获取值"></a>4.2.2安全的获取值</h5><p>get 获取值</p>
<p>orElseGet 如果有值返回值，没值返回设定的默认值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;List&lt;Person&gt;&gt; list = getList();</span><br><span class="line"><span class="comment">//如果有值返回值，没有值的话返回null</span></span><br><span class="line">List&lt;Person&gt; personList = list.orElseGet(() -&gt; <span class="literal">null</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;personList = &quot;</span> + personList);</span><br></pre></td></tr></table></figure>

<p>orElseThrow 如果有值返回值，没值返回设定异常类型提示信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果有值返回值，没有值的话执行异常</span></span><br><span class="line">List&lt;Person&gt; personList = list.orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;空指针&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;personList = &quot;</span> + personList);</span><br></pre></td></tr></table></figure>

<h5 id="4-2-3过滤"><a href="#4-2-3过滤" class="headerlink" title="4.2.3过滤"></a>4.2.3过滤</h5><p>我们可以使用这个方法对数据进行过滤，如果原本有数据，但是不符合判断，也会变成一个无数据的Optional对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Person&gt; list = Optional.ofNullable(getList());</span><br><span class="line"></span><br><span class="line">list.filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Person&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Person person)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> person.getAge()&gt;<span class="number">18</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).ifPresent(person -&gt; System.out.println(<span class="string">&quot;person = &quot;</span> + person.getName()));</span><br></pre></td></tr></table></figure>

<h5 id="4-2-4判断"><a href="#4-2-4判断" class="headerlink" title="4.2.4判断"></a>4.2.4判断</h5><p>判断是否存在数据进行判断，如果为空fasle不为空true</p>
<p>isPersent()</p>
<h5 id="4-2-5数据转换"><a href="#4-2-5数据转换" class="headerlink" title="4.2.5数据转换"></a>4.2.5数据转换</h5><p>和map、flatMap相似</p>
<h2 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>​    <strong>只有一个抽象方法</strong>的接口我们称之为函数接口。</p>
<p>​    JDK的函数式接口都加上了**@FunctionalInterface** 注解进行标识。但是无论是否加上该注解只要接口中只有一个抽象方法，都是函数式接口。</p>
<h3 id="5-2-常见函数式接口"><a href="#5-2-常见函数式接口" class="headerlink" title="5.2 常见函数式接口"></a>5.2 常见函数式接口</h3><ul>
<li><p>​    Consumer 消费接口</p>
<p>根据其中抽象方法的参数列表和返回值类型知道，我们可以在方法中对传入的参数进行消费。</p>
<p><img src="D:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145622163-16354041894551.png" alt="image-20211028145622163"></p>
</li>
<li><p>​    Function 计算转换接口</p>
<p>根据其中抽象方法的参数列表和返回值类型知道，我们可以在方法中对传入的参数计算或转换，把结果返回</p>
<p><img src="D:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145707862-16354042291112.png" alt="image-20211028145707862"></p>
</li>
<li><p>​    Predicate 判断接口</p>
<p>根据其中抽象方法的参数列表和返回值类型知道，我们可以在方法中对传入的参数条件判断，返回判断结果</p>
<p><img src="D:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145818743-16354043004393.png" alt="image-20211028145818743"></p>
</li>
<li><p>​    Supplier 生产型接口</p>
<p>根据其中抽象方法的参数列表和返回值类型知道，我们可以在方法中创建对象，把创建好的对象返回</p>
</li>
</ul>
<p><img src="D:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145843368-16354043246954.png" alt="image-20211028145843368"></p>
<h3 id="5-3-常用的默认方法"><a href="#5-3-常用的默认方法" class="headerlink" title="5.3 常用的默认方法"></a>5.3 常用的默认方法</h3><ul>
<li><p>and</p>
<p>我们在使用Predicate接口时候可能需要进行判断条件的拼接。而and方法相当于是使用&amp;&amp;来拼接两个判断条件</p>
<p>例如：</p>
<p>打印作家中年龄大于17并且姓名的长度大于1的作家。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line">authorStream.filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> author.getAge()&gt;<span class="number">17</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.and(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> author.getName().length()&gt;<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)).forEach(author -&gt; System.out.println(author));</span><br></pre></td></tr></table></figure></li>
<li><p>or </p>
<p>我们在使用Predicate接口时候可能需要进行判断条件的拼接。而or方法相当于是使用||来拼接两个判断条件。</p>
<p>例如：</p>
<p>打印作家中年龄大于17或者姓名的长度小于2的作家。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        打印作家中年龄大于17或者姓名的长度小于2的作家。</span></span><br><span class="line">        List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">        authors.stream()</span><br><span class="line">                .filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> author.getAge()&gt;<span class="number">17</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;.or(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> author.getName().length()&lt;<span class="number">2</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)).forEach(author -&gt; System.out.println(author.getName()));</span><br></pre></td></tr></table></figure></li>
<li><p>negate</p>
<p>Predicate接口中的方法。negate方法相当于是在判断添加前面加了个! 表示取反</p>
<p>例如：</p>
<p>打印作家中年龄不大于17的作家。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        打印作家中年龄不大于17的作家。</span></span><br><span class="line">        List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">        authors.stream()</span><br><span class="line">                .filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> author.getAge()&gt;<span class="number">17</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;.negate()).forEach(author -&gt; System.out.println(author.getAge()));</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="方法引用"><a href="#方法引用" class="headerlink" title="方法引用"></a>方法引用</h2><p>​    我们在使用lambda时，如果方法体中只有一个方法的调用的话（包括构造方法）,我们可以用方法引用进一步简化代码。</p>
<h3 id="6-1-推荐用法"><a href="#6-1-推荐用法" class="headerlink" title="6.1 推荐用法"></a>6.1 推荐用法</h3><p>​    我们在使用lambda时不需要考虑什么时候用方法引用，用哪种方法引用，方法引用的格式是什么。我们只需要在写完lambda方法发现方法体只有一行代码，并且是方法的调用时使用快捷键尝试是否能够转换成方法引用即可。</p>
<p>​    当我们方法引用使用的多了慢慢的也可以直接写出方法引用。</p>
<h3 id="6-2-基本格式"><a href="#6-2-基本格式" class="headerlink" title="6.2 基本格式"></a>6.2 基本格式</h3><p>​    类名或者对象名::方法名</p>
<h3 id="6-3-语法详解-了解"><a href="#6-3-语法详解-了解" class="headerlink" title="6.3 语法详解(了解)"></a>6.3 语法详解(了解)</h3><h4 id="6-3-1-引用类的静态方法"><a href="#6-3-1-引用类的静态方法" class="headerlink" title="6.3.1 引用类的静态方法"></a>6.3.1 引用类的静态方法</h4><p>​    其实就是引用类的静态方法</p>
<h5 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类名::方法名</span><br></pre></td></tr></table></figure>



<h5 id="使用前提"><a href="#使用前提" class="headerlink" title="使用前提"></a>使用前提</h5><p>​    如果我们在重写方法的时候，方法体中<strong>只有一行代码</strong>，并且这行代码是<strong>调用了某个类的静态方法</strong>，并且我们把要重写的<strong>抽象方法中所有的参数都按照顺序传入了这个静态方法中</strong>，这个时候我们就可以引用类的静态方法。</p>
<p>​    </p>
<p>例如：</p>
<p>如下代码就可以用方法引用进行简化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line"></span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line"></span><br><span class="line">authorStream.map(author -&gt; author.getAge())</span><br><span class="line">        .map(age-&gt;String.valueOf(age));</span><br></pre></td></tr></table></figure>

<p>注意，如果我们所重写的方法是没有参数的，调用的方法也是没有参数的也相当于符合以上规则。</p>
<p>优化后如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line"></span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line"></span><br><span class="line">authorStream.map(author -&gt; author.getAge())</span><br><span class="line">        .map(String::valueOf);</span><br></pre></td></tr></table></figure>



<h4 id="6-3-2-引用对象的实例方法"><a href="#6-3-2-引用对象的实例方法" class="headerlink" title="6.3.2 引用对象的实例方法"></a>6.3.2 引用对象的实例方法</h4><h5 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对象名::方法名</span><br></pre></td></tr></table></figure>



<h5 id="使用前提-1"><a href="#使用前提-1" class="headerlink" title="使用前提"></a>使用前提</h5><p>​    如果我们在重写方法的时候，方法体中<strong>只有一行代码</strong>，并且这行代码是<strong>调用了某个对象的成员方法</strong>，并且我们把要重写的<strong>抽象方法中所有的参数都按照顺序传入了这个成员方法中</strong>，这个时候我们就可以引用对象的实例方法</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line"></span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">authorStream.map(author -&gt; author.getName())</span><br><span class="line">        .forEach(name-&gt;sb.append(name));</span><br></pre></td></tr></table></figure>

<p>优化后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line"></span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">authorStream.map(author -&gt; author.getName())</span><br><span class="line">        .forEach(sb::append);</span><br></pre></td></tr></table></figure>







<h4 id="6-3-4-引用类的实例方法"><a href="#6-3-4-引用类的实例方法" class="headerlink" title="6.3.4 引用类的实例方法"></a>6.3.4 引用类的实例方法</h4><h5 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类名::方法名</span><br></pre></td></tr></table></figure>



<h5 id="使用前提-2"><a href="#使用前提-2" class="headerlink" title="使用前提"></a>使用前提</h5><p>​    如果我们在重写方法的时候，方法体中<strong>只有一行代码</strong>，并且这行代码是<strong>调用了第一个参数的成员方法</strong>，并且我们把要<strong>重写的抽象方法中剩余的所有的参数都按照顺序传入了这个成员方法中</strong>，这个时候我们就可以引用类的实例方法。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">interface</span> <span class="title class_">UseString</span>&#123;</span><br><span class="line">       String <span class="title function_">use</span><span class="params">(String str,<span class="type">int</span> start,<span class="type">int</span> length)</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">subAuthorName</span><span class="params">(String str, UseString useString)</span>&#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">return</span> useString.use(str,start,length);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">       subAuthorName(<span class="string">&quot;三更草堂&quot;</span>, <span class="keyword">new</span> <span class="title class_">UseString</span>() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> String <span class="title function_">use</span><span class="params">(String str, <span class="type">int</span> start, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">               <span class="keyword">return</span> str.substring(start,length);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优化后如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    subAuthorName(<span class="string">&quot;三更草堂&quot;</span>, String::substring);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="6-3-5-构造器引用"><a href="#6-3-5-构造器引用" class="headerlink" title="6.3.5 构造器引用"></a>6.3.5 构造器引用</h4><p>​    如果方法体中的一行代码是构造器的话就可以使用构造器引用。</p>
<h5 id="格式-3"><a href="#格式-3" class="headerlink" title="格式"></a>格式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类名::<span class="keyword">new</span></span><br></pre></td></tr></table></figure>



<h5 id="使用前提-3"><a href="#使用前提-3" class="headerlink" title="使用前提"></a>使用前提</h5><p>​    如果我们在重写方法的时候，方法体中<strong>只有一行代码</strong>，并且这行代码是<strong>调用了某个类的构造方法</strong>，并且我们把<strong>要重写的抽象方法中的所有的参数都按照顺序传入了这个构造方法中</strong>，这个时候我们就可以引用构造器。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">authors.stream()</span><br><span class="line">        .map(author -&gt; author.getName())</span><br><span class="line">        .map(name-&gt;<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(name))</span><br><span class="line">        .map(sb-&gt;sb.append(<span class="string">&quot;-三更&quot;</span>).toString())</span><br><span class="line">        .forEach(str-&gt; System.out.println(str));</span><br></pre></td></tr></table></figure>

<p>优化后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">authors.stream()</span><br><span class="line">        .map(author -&gt; author.getName())</span><br><span class="line">        .map(StringBuilder::<span class="keyword">new</span>)</span><br><span class="line">        .map(sb-&gt;sb.append(<span class="string">&quot;-三更&quot;</span>).toString())</span><br><span class="line">        .forEach(str-&gt; System.out.println(str));</span><br></pre></td></tr></table></figure>





<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><h3 id="基本数据类型优化"><a href="#基本数据类型优化" class="headerlink" title="基本数据类型优化"></a>基本数据类型优化</h3><p>​    我们之前用到的很多Stream的方法由于都使用了泛型。所以涉及到的参数和返回值都是引用数据类型。</p>
<p>​    即使我们操作的是整数小数，但是实际用的都是他们的包装类。JDK5中引入的自动装箱和自动拆箱让我们在使用对应的包装类时就好像使用基本数据类型一样方便。但是你一定要知道装箱和拆箱肯定是要消耗时间的。虽然这个时间消耗很下。但是在大量的数据不断的重复装箱拆箱的时候，你就不能无视这个时间损耗了。</p>
<p>​    所以为了让我们能够对这部分的时间消耗进行优化。Stream还提供了很多专门针对基本数据类型的方法。</p>
<p>​    例如：mapToInt,mapToLong,mapToDouble,flatMapToInt,flatMapToDouble等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test27</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .map(author -&gt; author.getAge())</span><br><span class="line">            .map(age -&gt; age + <span class="number">10</span>)</span><br><span class="line">            .filter(age-&gt;age&gt;<span class="number">18</span>)</span><br><span class="line">            .map(age-&gt;age+<span class="number">2</span>)</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    authors.stream()</span><br><span class="line">            .mapToInt(author -&gt; author.getAge())</span><br><span class="line">            .map(age -&gt; age + <span class="number">10</span>)</span><br><span class="line">            .filter(age-&gt;age&gt;<span class="number">18</span>)</span><br><span class="line">            .map(age-&gt;age+<span class="number">2</span>)</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="并行流"><a href="#并行流" class="headerlink" title="并行流"></a>并行流</h3><p>​    当流中有大量元素时，我们可以使用并行流去提高操作的效率。其实并行流就是把任务分配给多个线程去完全。如果我们自己去用代码实现的话其实会非常的复杂，并且要求你对并发编程有足够的理解和认识。而如果我们使用Stream的话，我们只需要修改一个方法的调用就可以使用并行流来帮我们实现，从而提高效率。</p>
<p>​    parallel方法可以把串行流转换成并行流。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test28</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Integer&gt; stream = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> stream.parallel()</span><br><span class="line">            .peek(<span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;Integer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Integer num)</span> &#123;</span><br><span class="line">                    System.out.println(num+Thread.currentThread().getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .filter(num -&gt; num &gt; <span class="number">5</span>)</span><br><span class="line">            .reduce((result, ele) -&gt; result + ele)</span><br><span class="line">            .get();</span><br><span class="line">    System.out.println(sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    也可以通过parallelStream直接获取并行流对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">authors.parallelStream()</span><br><span class="line">        .map(author -&gt; author.getAge())</span><br><span class="line">        .map(age -&gt; age + <span class="number">10</span>)</span><br><span class="line">        .filter(age-&gt;age&gt;<span class="number">18</span>)</span><br><span class="line">        .map(age-&gt;age+<span class="number">2</span>)</span><br><span class="line">        .forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h1 id="跟着三更学JAVA-多线程"><a href="#跟着三更学JAVA-多线程" class="headerlink" title="跟着三更学JAVA-多线程"></a>跟着三更学JAVA-多线程</h1><h3 id="1-1实现多线程方式一：继承Thread类【应用】"><a href="#1-1实现多线程方式一：继承Thread类【应用】" class="headerlink" title="1.1实现多线程方式一：继承Thread类【应用】"></a>1.1实现多线程方式一：继承Thread类【应用】</h3><ul>
<li><p>方法介绍</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>void run()</td>
<td>在线程开启后，此方法将被调用执行</td>
</tr>
<tr>
<td>void start()</td>
<td>使此线程开始执行，Java虚拟机会调用run方法()</td>
</tr>
</tbody></table>
</li>
<li><p>实现步骤</p>
<ul>
<li>定义一个类MyThread继承Thread类</li>
<li>在MyThread类中重写run()方法</li>
<li>创建MyThread类的对象</li>
<li>启动线程（必须用start()方法）</li>
</ul>
</li>
<li><p>代码演示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThreadDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">my1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">my2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        my1.run();</span></span><br><span class="line"><span class="comment">//        my2.run();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//void start() 导致此线程开始执行; Java虚拟机调用此线程的run方法</span></span><br><span class="line">        my1.start();</span><br><span class="line">        my2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>两个小问题</p>
<ul>
<li><p>为什么要重写run()方法？</p>
<p>因为run()是用来封装被线程执行的代码</p>
</li>
<li><p>run()方法和start()方法的区别？</p>
<p>run()：封装线程执行的代码，直接调用，相当于普通方法的调用</p>
<p>start()：启动线程；然后由JVM调用此线程的run()方法</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-2实现多线程方式二：实现Runnable接口【应用】"><a href="#1-2实现多线程方式二：实现Runnable接口【应用】" class="headerlink" title="1.2实现多线程方式二：实现Runnable接口【应用】"></a>1.2实现多线程方式二：实现Runnable接口【应用】</h3><ul>
<li><p>Thread构造方法</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Thread(Runnable target)</td>
<td>分配一个新的Thread对象</td>
</tr>
<tr>
<td>Thread(Runnable target, String name)</td>
<td>分配一个新的Thread对象</td>
</tr>
</tbody></table>
</li>
<li><p>实现步骤</p>
<ul>
<li>定义一个类MyRunnable实现Runnable接口</li>
<li>在MyRunnable类中重写run()方法</li>
<li>创建MyRunnable类的对象（注意这是一个任务对象，还需要把它交给线程对象来执行）</li>
<li>创建Thread类的对象，把MyRunnable对象作为构造方法的参数</li>
<li>启动线程</li>
</ul>
</li>
<li><p>代码演示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread01</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;子线程3执行了 = &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread01</span>();</span><br><span class="line"></span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;子线程1执行 = &quot;</span> + i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;子线程2执行 = &quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程执行 = &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>多线程的实现方案有两种</p>
<ul>
<li>继承Thread类</li>
<li>实现Runnable接口</li>
</ul>
</li>
<li><p>相比继承Thread类，实现Runnable接口的好处</p>
<ul>
<li><p>避免了Java单继承的局限性</p>
</li>
<li><p>适合多个相同程序的代码去处理同一个资源的情况，把线程和程序的代码、数据有效分离，较好的体现了面向对象的设计思想</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-3实现多线程方式三：实现Callable接口【应用】"><a href="#1-3实现多线程方式三：实现Callable接口【应用】" class="headerlink" title="1.3实现多线程方式三：实现Callable接口【应用】"></a>1.3实现多线程方式三：实现Callable<T>接口【应用】</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread03</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Thread03</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getN</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setN</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//描述线程任务，返回线程执行的结果</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//实现对1-n的和的返回</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            sum+=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个Callable对象</span></span><br><span class="line">        Callable&lt;Integer&gt; thread03 = <span class="keyword">new</span> <span class="title class_">Thread03</span>(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//把callable的对象封装成一个FutureTask对象（任务对象）未来对象</span></span><br><span class="line">        <span class="comment">//未来对象的作用？</span></span><br><span class="line">        <span class="comment">//是一个任务对象，实现了Runnable接口</span></span><br><span class="line">        <span class="comment">//可以在线程执行完毕之后，用未来任务对象调用get方法获取线程执行完之后的结果</span></span><br><span class="line">        FutureTask&lt;Integer&gt; f1 = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(thread03);</span><br><span class="line">        <span class="comment">//把任务对象交给线程对象</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(f1).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取线程执行完毕后返回的结果</span></span><br><span class="line">        <span class="comment">//如果执行到这，线程没执行完，这里代码会暂停，等待线程执行完毕后才获取结果</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> f1.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;integer = &quot;</span> + integer);</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018192634178.png" alt="image-20231018192634178"></p>
<h3 id="Thread相关的API"><a href="#Thread相关的API" class="headerlink" title="Thread相关的API"></a>Thread相关的API</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018192849584.png" alt="image-20231018192849584"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test04</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread04</span>();</span><br><span class="line">        t1.getName();</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//哪个线程执行她，他就会得到哪个线程</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        thread.setName(<span class="string">&quot;牛逼&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread = &quot;</span> + thread.getName());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(thread.getName()+<span class="string">&quot;线程输出&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread04</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(thread.getName()+<span class="string">&quot;执行了 = &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="线程安全问题"><a href="#线程安全问题" class="headerlink" title="线程安全问题"></a>线程安全问题</h3><p>多个线程同时操作同一个共享资源，并且修改同一个共享资源</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018194932659.png" alt="image-20231018194932659"></p>
<p>两个人同时取钱问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> money;</span><br><span class="line">    <span class="keyword">private</span> String cardId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCardId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cardId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCardId</span><span class="params">(String cardId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cardId = cardId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(<span class="type">double</span> money, String cardId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.money = money;</span><br><span class="line">        <span class="built_in">this</span>.cardId = cardId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawMoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.money&gt;=money)&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;来取了&quot;</span>+money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.money-=money;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;取钱后剩余&quot;</span>+<span class="built_in">this</span>.money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;余额不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DrawThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DrawThread</span><span class="params">(Account acc,String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        <span class="built_in">this</span>.account = acc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//取钱</span></span><br><span class="line">        account.drawMoney(<span class="number">200.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>(<span class="number">1000.0</span>,<span class="string">&quot;ICBC-188&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DrawThread</span>(account,<span class="string">&quot;小明&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DrawThread</span>(account,<span class="string">&quot;小红&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="线程同步（解决线程安全）"><a href="#线程同步（解决线程安全）" class="headerlink" title="线程同步（解决线程安全）"></a>线程同步（解决线程安全）</h3><p>让多个线程先后依次访问共享资源，这样就解决了线程安全问题</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018201111598.png" alt="image-20231018201111598"></p>
<h4 id="加锁方案"><a href="#加锁方案" class="headerlink" title="加锁方案"></a>加锁方案</h4><h5 id="同步代码块"><a href="#同步代码块" class="headerlink" title="同步代码块"></a>同步代码块</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018201303232.png" alt="image-20231018201303232"></p>
<p>多个线程要有同一把钥匙来打开一个共享资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawMoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">    <span class="comment">//this代表共享资源</span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.money&gt;=money)&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;来取了&quot;</span>+money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.money-=money;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;取钱后剩余&quot;</span>+<span class="built_in">this</span>.money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;余额不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018202420434.png" alt="image-20231018202420434"></p>
<h5 id="同步方法"><a href="#同步方法" class="headerlink" title="同步方法"></a>同步方法</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018202609125.png" alt="image-20231018202609125"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018202942512.png" alt="image-20231018202942512"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018203100212.png" alt="image-20231018203100212"></p>
<h5 id="Lock锁"><a href="#Lock锁" class="headerlink" title="Lock锁"></a>Lock锁</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018204407691.png" alt="image-20231018204407691"></p>
<p>定义锁，自己来加锁和解锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> money;</span><br><span class="line">    <span class="keyword">private</span> String cardId;</span><br><span class="line">    <span class="comment">//为什么放在这，因为方法可以直接使用，也便于创建一个对象，就有这个对象所对应的锁</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">//加final，不能进行二次复制</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">drawMoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">    <span class="comment">//this代表共享资源</span></span><br><span class="line">    lk.lock();<span class="comment">//加锁</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.money&gt;=money)&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;来取了&quot;</span>+money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.money-=money;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;取钱后剩余&quot;</span>+<span class="built_in">this</span>.money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;余额不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lk.unlock();<span class="comment">//解锁</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018204500156.png" alt="image-20231018204500156"></p>
<h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3><p>可以复用线程的技术,不会因为线程过多而导致线程瘫痪。可以创建几个线程来执行多个任务</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019141643837.png" alt="image-20231019141643837"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019142025592.png" alt="image-20231019142025592"></p>
<p>线程池可以控制线程的数量和任务的数量（不会导致瘫痪），让线程去反复的去处理任务.</p>
<p>任务队列里面都是实现了Runnable和Callable的对象，因为是把他们交给线程池</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019142852345.png" alt="image-20231019142852345"></p>
<h4 id="ThreadPoolExecutor创建线程池"><a href="#ThreadPoolExecutor创建线程池" class="headerlink" title="ThreadPoolExecutor创建线程池"></a>ThreadPoolExecutor创建线程池</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019143236104.png" alt="image-20231019143236104"></p>
<p><strong>线程池的注意事项</strong></p>
<p>临时线程什么时候创建</p>
<p>新任务提交时核心线程都在忙，并且任务队列都满了，并且还可以在创建临时线程，此时才可以创建临时线程</p>
<p>什么时候会开始拒绝新任务</p>
<p>核心线程和临时线程都在工作，并且任务队列也满了，会根据拒绝策略去拒绝新任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//线程池工厂</span></span><br><span class="line">         <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, TimeUnit.HOURS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">5</span>),Executors.defaultThreadFactory(),<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">       <span class="comment">/* public ThreadPoolExecutor(</span></span><br><span class="line"><span class="comment">        int corePoolSize, //核心线程数量</span></span><br><span class="line"><span class="comment">        int maximumPoolSize, //最大线程数量 核心+临时线程</span></span><br><span class="line"><span class="comment">        long keepAliveTime, //临时线程存活时间</span></span><br><span class="line"><span class="comment">        TimeUnit unit, //时间单位</span></span><br><span class="line"><span class="comment">        B lockingQueue&lt;Runnable&gt; workQueue, //任务队列</span></span><br><span class="line"><span class="comment">        ThreadFactory threadFactory, //线程工厂</span></span><br><span class="line"><span class="comment">        RejectedExecutionHandler handler) //线程都在忙。任务队列也满了 新任务来了之后怎么处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//       new ArrayBlockingQueue&lt;&gt;(5)//基于数组的任务队列</span></span><br><span class="line"><span class="comment">//       new LinkedBlockingDeque //基于链表的任务队列，可以往后加队列</span></span><br><span class="line"><span class="comment">//        Executors.defaultThreadFactory()//默认工厂，会帮我们创建</span></span><br><span class="line"><span class="comment">//         new ThreadPoolExecutor.AbortPolicy()//决绝策略是抛异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="线程池处理Runnable对象"><a href="#线程池处理Runnable对象" class="headerlink" title="线程池处理Runnable对象"></a>线程池处理Runnable对象</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019150803593.png" alt="image-20231019150803593"></p>
<p>拒绝策略</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019153128394.png" alt="image-20231019153128394"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//通过ThreadPoolExecutor创建线程池工厂</span></span><br><span class="line">         <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, TimeUnit.HOURS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">4</span>),Executors.defaultThreadFactory(),<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line"></span><br><span class="line">         <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RunnableP</span>();</span><br><span class="line"></span><br><span class="line">         <span class="comment">//（三个核心线程）</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        <span class="comment">//以上是核心线程，以下四个再任务队列排队(4个任务队列)</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        <span class="comment">//临时线程创建时机，任务队列满了，会创建临时线程(2个临时线程)</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        <span class="comment">//拒绝任务</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        pool.shutdown();//会等线程执行完之后，关闭线程池</span></span><br><span class="line"><span class="comment">//        pool.shutdownNow();//立即关掉</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">       <span class="comment">/* public ThreadPoolExecutor(</span></span><br><span class="line"><span class="comment">        int corePoolSize, //线程池支持的核心线程数量</span></span><br><span class="line"><span class="comment">        int maximumPoolSize, //最大线程数量 核心+临时线程</span></span><br><span class="line"><span class="comment">        long keepAliveTime, //临时线程存活时间</span></span><br><span class="line"><span class="comment">        TimeUnit unit, //时间单位</span></span><br><span class="line"><span class="comment">        B lockingQueue&lt;Runnable&gt; workQueue, //任务队列</span></span><br><span class="line"><span class="comment">        ThreadFactory threadFactory, //线程工厂</span></span><br><span class="line"><span class="comment">        RejectedExecutionHandler handler) //线程都在忙。任务队列也满了 新任务来了之后怎么处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//       new ArrayBlockingQueue&lt;&gt;(5)//基于数组的任务队列</span></span><br><span class="line"><span class="comment">//       new LinkedBlockingDeque //基于链表的任务队列，可以往后加队列</span></span><br><span class="line"><span class="comment">//        Executors.defaultThreadFactory()//默认工厂，会帮我们创建</span></span><br><span class="line"><span class="comment">//         new ThreadPoolExecutor.AbortPolicy()//决绝策略是抛异常</span></span><br><span class="line"><span class="comment">//        new ThreadPoolExecutor.CallerRunsPolicy() //拒绝策略是让主线程去执行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;C:\Program Files\Java\jdk1.8.0_131\bin\java.exe&quot;</span> <span class="string">&quot;-javaagent:D:\JavaP\idea\IntelliJ IDEA 2019.2.4\lib\idea_rt.jar=61317:D:\JavaP\idea\IntelliJ IDEA 2019.2.4\bin&quot;</span> -Dfile.encoding=UTF-<span class="number">8</span> -classpath <span class="string">&quot;C:\Program Files\Java\jdk1.8.0_131\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\rt.jar;D:\JavaP\IdeaProjects\sangengtest\out\production\day09&quot;</span> </span><br><span class="line">    </span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">1</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[main,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">3</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">2</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">5</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">4</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br></pre></td></tr></table></figure>

<h5 id="线程池处理Callable对象"><a href="#线程池处理Callable对象" class="headerlink" title="线程池处理Callable对象"></a>线程池处理Callable对象</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableP</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> a;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CallableP</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; a; i++) &#123;</span><br><span class="line">            sum = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Thread.currentThread()+<span class="string">&quot;he为&quot;</span>+sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> pool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pool2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//通过ThreadPoolExecutor创建线程池工厂</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, TimeUnit.HOURS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">4</span>), Executors.defaultThreadFactory(), <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line">        <span class="type">CallableP</span> <span class="variable">callableP</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CallableP</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取未来对象，获取线程执行完的结果，实质上是任务对象</span></span><br><span class="line">        Future&lt;String&gt; submit1 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit2 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit3 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit4 = pool.submit(callableP);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;submit1 = &quot;</span> + submit1.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit2 = &quot;</span> + submit2.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit3 = &quot;</span> + submit3.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit4 = &quot;</span> + submit4.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Executors创建线程池"><a href="#Executors创建线程池" class="headerlink" title="Executors创建线程池"></a>Executors创建线程池</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019155151828.png" alt="image-20231019155151828"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019160000565.png" alt="image-20231019160000565"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CallableP</span> <span class="variable">callableP</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CallableP</span>(<span class="number">13</span>);</span><br><span class="line">        <span class="comment">//计算密集型的将线程数=CPU核数+1</span></span><br><span class="line"><span class="comment">//        oom内存溢出</span></span><br><span class="line">        <span class="comment">//IO密集型的将线程数=CPU核数*2</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//获取未来对象，获取线程执行完的结果，实质上是任务对象</span></span><br><span class="line">        Future&lt;String&gt; submit1 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit2 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit3 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit4 = pool.submit(callableP);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;submit1 = &quot;</span> + submit1.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit2 = &quot;</span> + submit2.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit3 = &quot;</span> + submit3.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit4 = &quot;</span> + submit4.get());</span><br></pre></td></tr></table></figure>

<h3 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019184532353.png" alt="image-20231019184532353"></p>
<h4 id="并发和并行"><a href="#并发和并行" class="headerlink" title="并发和并行"></a>并发和并行</h4><p>并发：同一间隔内，多个线程被Cpu调度执行，cpu轮询快速切换到不同线程，让其看到是同时执行</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019185318428.png" alt="image-20231019185318428"></p>
<p>并行：同一时刻，多个线程被CPU调度执行</p>
<ul>
<li>解释一：并行是指两个或者多个事件在同一时刻发生；而并发是指两个或多个事件在同一时间间隔发生。</li>
<li>解释二：并行是在不同实体上的多个事件，并发是在同一实体上的多个事件。</li>
<li>解释三：并发是在一台处理器上“同时”处理多个任务，并行是在多台处理器上同时处理多个任务。如 hadoop 分布式集群。 所以并发编程的目标是充分的利用处理器的每一个核，以达到最高的处理性能。</li>
</ul>
<p>并行</p>
<p>并行(parallel)：指在同一时刻，有多条指令在多个处理器上同时执行。所以无论从微观还是从宏观来看，二者都是一起执行的。</p>
<p><img src="https://pics7.baidu.com/feed/0b46f21fbe096b6333a209ed69513d4feaf8ac46.jpeg@f_auto?token=756cdc29eb11f4a51f75466ba32bfa03" alt="img"></p>
<p>并发</p>
<p>并发(concurrency)：指在同一时刻只能有一条指令执行，但多个进程指令被快速的轮换执行，使得在宏观上具有多个进程同时执行的效果，但在微观上并不是同时执行的，只是把时间分成若干段，使多个进程快速交替的执行。</p>
<p><img src="https://pics7.baidu.com/feed/0df3d7ca7bcb0a46d355bde70e014c2f6a60af62.jpeg@f_auto?token=23d6a6c455e8dd01bec353dde030ac64" alt="img"></p>
<h3 id="线程生命周期"><a href="#线程生命周期" class="headerlink" title="线程生命周期"></a>线程生命周期</h3><p>wait释放锁</p>
<p>sleep不释放锁</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019185712773.png" alt="image-20231019185712773"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019190149895.png" alt="image-20231019190149895"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019190203335.png" alt="image-20231019190203335"></p>
<h3 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h3><p>悲观锁：在执行之前加锁，线程安全，性能较差</p>
<p>乐观锁：再执行之前认为他是安全的，等到遇到线程安全之后再加锁,线程安全，性能也好</p>
<p>CAS算法（WeakCompareAndSet比较和修改值）（改之前和原先的值进行比较）</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019192205898.png" alt="image-20231019192205898"></p>
<p>先把10拿出来进行+1，11和原先的10作比较，10没有被其他人改就更新这个值，如果等于11了，这次就作废</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; gift;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCount</span><span class="params">(<span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SendThread</span><span class="params">(List&lt;String&gt; gift, String name)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name);</span><br><span class="line">    <span class="built_in">this</span>.gift=gift;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getGift</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gift;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGift</span><span class="params">(List&lt;String&gt; gift)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gift = gift;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">        <span class="comment">//发礼物</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//锁必须唯一</span></span><br><span class="line">           <span class="keyword">synchronized</span> (gift)&#123;</span><br><span class="line">               <span class="keyword">if</span> (gift.size()&lt;<span class="number">10</span>)&#123;</span><br><span class="line">                   <span class="keyword">return</span>;</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> gift.remove(random.nextInt(gift.size()));</span><br><span class="line">               System.out.println(name+<span class="string">&quot;发出&quot;</span>+s);</span><br><span class="line">               <span class="built_in">this</span>.count++;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//100份礼物，小红和小明两人同时发送，礼品小于10分，停止发送</span></span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; gift = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        String[] names = &#123;<span class="string">&quot;口红&quot;</span>,<span class="string">&quot;包包&quot;</span>,<span class="string">&quot;鲜花&quot;</span>,<span class="string">&quot;皮带&quot;</span>,<span class="string">&quot;手表&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            gift.add(names[random.nextInt(names.length)] +(i+<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">SendThread</span> <span class="variable">xm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendThread</span>(gift, <span class="string">&quot;小明&quot;</span>);</span><br><span class="line">        xm.start();</span><br><span class="line">        <span class="type">SendThread</span> <span class="variable">xh</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendThread</span>(gift, <span class="string">&quot;小红&quot;</span>);</span><br><span class="line">        xh.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//等上面执行完，然后获取分发次数</span></span><br><span class="line">        xm.join();</span><br><span class="line">        xh.join();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;xm.getCount() = &quot;</span> + xm.getCount());</span><br><span class="line">        System.out.println(<span class="string">&quot;xh.getCount() = &quot;</span> + xh.getCount());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="MySQL数据库"><a href="#MySQL数据库" class="headerlink" title="MySQL数据库"></a>MySQL数据库</h1><h2 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h2><p><strong>1、数据定义语言（DDL Data Definition Language）</strong>：创建、修改或删除数据库中表、视图、索引等对象的操作，常用命令为CREATE、DROP；</p>
<p>CREATE语句<br>CREATE TABLE keep(<br>id CHAR(16) ,<br>user_name VARCHAR(16) ,<br>password VARCHAR(15)<br>)<br>执行结果：在test数据库中创建keep表<br><img src="http://img.voycn.com/images/2019/05/0b4704075682889e2cccf454ec5e1921.png" alt="SQL语句与数据库操作语句"> DROP语句<br>DROP TABLE keep<br>执行结果：在test数据库中删除keep表<br><img src="http://img.voycn.com/images/2019/05/7861a32d754c6b5d403e70ae74f1a668.png" alt="SQL语句与数据库操作语句"></p>
<p><strong>2、数据操纵语言（DML Data Manipulation Language）</strong> ：向表中添加、删除、修改数据操作，常用命令有insert、update和delete；</p>
<p>INSERT语句<br>INSERT INTO keep (id,user_name,password) VALUES (‘123’,‘fuliuqingfeng’,‘123456’);<br>执行结果：<br><img src="http://img.voycn.com/images/2019/05/38d50a2c658bb124972bcabe9e33a653.png" alt="SQL语句与数据库操作语句"> UPDATE语句<br>UPDATE keep SET id = ‘111’ WHERE user_name = ‘fuliuqingfeng’<br>执行结果：id改为111<br><img src="http://img.voycn.com/images/2019/05/ac6c85e4a7f41022c80580811927eda7.png" alt="SQL语句与数据库操作语句"> DETELE语句<br>DELETE FROM keep WHERE user_name = ‘fuliuqingfeng’<br>执行结果删除user_name为fuliuqingfeng的信息</p>
<p><strong>3、数据查询语言（DQL Data Query Language）</strong> ：按照指定的组合、条件表达式或排序检索已存在的数据库中数据，不改变数据库中数据，常用命令为select；</p>
<p>SELECT语句<br>SELECT * FROM keep<br>执行结果：列出keep表中所有信息<br><img src="http://img.voycn.com/images/2019/05/b1af252b24b6505be1bf2936c9650ee7.png" alt="SQL语句与数据库操作语句"></p>
<p><strong>4、数据控制语言（DCL Data Control Language）</strong> ：用来授予或收回访问数据库的某种特权、控制数据操纵事务的发生时间及效果、对数据库进行监视等操作，常用命令有GRANT、REVOKE、COMMIT、ROLLBACK；</p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>事务是一组操作的集合这组操作，要么全部成功，要么全部失败</p>
<h3 id="事务操作"><a href="#事务操作" class="headerlink" title="事务操作"></a>事务操作</h3><p>start transaction; –开启事务</p>
<p>commit/rollback; –提交回滚事务</p>
<h3 id="事务的四大特性"><a href="#事务的四大特性" class="headerlink" title="事务的四大特性"></a>事务的四大特性</h3><p>原子性：事务是原子级别，要么全部执行成功，要么全部执行失败</p>
<p>一致性：事务完成时，必须所有的数据都要保持一致状态</p>
<p>隔离性：数据库提供的隔离机制，保证事务在不受外部并发操作影响下的独立环境下运行</p>
<p>持久性：事务一旦提交或者回滚，他对数据库的数据的改变是永久的</p>
<h3 id="并发事务的问题"><a href="#并发事务的问题" class="headerlink" title="并发事务的问题"></a>并发事务的问题</h3><p>脏读：一个事务读取到另一个还未提交的数据（指更新或者删除未提交）</p>
<p>不可重复读：一个事务先后读取同一条数据，在第二次读之前被其他值修改（但是它未提交），但两次读取的数据不同</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231020191530029.png" alt="image-20231020191530029"></p>
<p>幻读：<img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231020191738503.png" alt="image-20231020191738503"></p>
<p>开启一个事务，一个事务查询数据没查到，插入一条数据，在查询还是没查到，提交一下插入数据，然后查询一下又没查询到，但是在插入就显示已存在</p>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231020192329132.png" alt="image-20231020192329132"></p>
<p>设置语句</p>
<p>set session transaction isolation level read uncommit;</p>
<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022142605610.png" alt="image-20231022142605610"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022142656908.png" alt="image-20231022142656908"></p>
<p>不同存储引擎，索引结构是不同的</p>
<h3 id="存储引擎简介"><a href="#存储引擎简介" class="headerlink" title="存储引擎简介"></a>存储引擎简介</h3><p>默认的是InnoDB存储引擎</p>
<p>存储引擎是存储数据、建立索引、更新查询数据等技术的实现方式。存储引擎是基于表而不是基于库，又被叫做表类型</p>
<p>创建表指定存储引擎  engine=InnoDB</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022143400084.png" alt="image-20231022143400084"></p>
<p>展示所支持的存储引擎：shwo  engines;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022143540222.png" alt="image-20231022143540222"></p>
<h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><p>高可靠性，高性能</p>
<p>特点：事务、行级锁、外键</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022143848670.png" alt="image-20231022143848670"></p>
<p>sdi：字典，ibd：每个表对应表空间</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022144214788.png" alt="image-20231022144214788"></p>
<h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><p>有表结构sdi 表数据myd 表索引myi</p>
<p>没有外键，删除和修改更好</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022144444156.png" alt="image-20231022144444156"></p>
<h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022144528740.png" alt="image-20231022144528740"></p>
<h3 id="三者关系"><a href="#三者关系" class="headerlink" title="三者关系"></a>三者关系</h3><p>InnoDB和MyISAM</p>
<p>前者支持外键支持事务支持行级锁</p>
<p>后者不支持外键不支持事务支持表级锁</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022144706217.png" alt="image-20231022144706217"></p>
<h3 id="MyISAM-和-InnoDB区别"><a href="#MyISAM-和-InnoDB区别" class="headerlink" title="MyISAM 和 InnoDB区别"></a>MyISAM 和 InnoDB区别</h3><p>MyISAM 采用表级锁(table-level locking)。InnoDB 支持行级锁(row-level locking)和表级锁,默认为行级锁。</p>
<h3 id="表级锁和行级锁对比"><a href="#表级锁和行级锁对比" class="headerlink" title="表级锁和行级锁对比"></a>表级锁和行级锁对比</h3><p>表级锁： MySQL 中锁 粒度最大 ，对当前操作的整张表加锁，加锁的开销小，加锁快，不会出现死锁，（因为要么一次性获取全部的锁，要么等待）。其锁定粒度最大，触发锁冲突的概率高，并发度低。<br>行级锁： MySQL 中锁 粒度最小 ，只针对当前操作的行进行加锁，加锁的开销大，加锁慢，会出现死锁。 行级锁能大大减少数据库操作的冲突。其锁粒度最小，触发锁冲突的概率低、并发度高。</p>
<h3 id="引擎选择"><a href="#引擎选择" class="headerlink" title="引擎选择"></a>引擎选择</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022145049869.png" alt="image-20231022145049869"></p>
<p>InnoDB：事务完整比较高，数据一致性比较高，除了插入和查询之外，还包含了更新和删除</p>
<p>MyISAM ：读和插入操作比较多时（MongDB）</p>
<p>Memory：访问速度比较快，适用于临时缓存，但表的大的话，就无法缓存到内存中（Redis）</p>
<h3 id="docker配置mysql"><a href="#docker配置mysql" class="headerlink" title="docker配置mysql"></a>docker配置mysql</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_54958293/article/details/128544701">Linux——docker安装mysql8.0.31_牧魂.的博客-CSDN博客</a></p>
<p>–restart=always：总是跟随[docker启动]</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h4 id="索引概述"><a href="#索引概述" class="headerlink" title="索引概述"></a>索引概述</h4><p>索引是高效的数据结构，通过数据结构指向数据，快速查询数据，有序</p>
<p>优点：提高数据检索的效率，降低数据库的IO成本，查新快。</p>
<p>通过索引对数据进行排序，有效降低排序成本，降低cpu的消耗</p>
<p>缺点：索引占据空间，提高查询效率，而增删改的时候效率也会降低</p>
<h4 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022164000278.png" alt="image-20231022164000278"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022164018236.png" alt="image-20231022164018236"></p>
<h5 id="B树"><a href="#B树" class="headerlink" title="B树"></a>B树</h5><p>二叉树（左小右大）</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022164114952.png" alt="image-20231022164114952"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022164358881.png" alt="image-20231022164358881"></p>
<p>红黑树：相对平衡的二叉搜索树，但不是严格意义上的二叉搜索树，叶子和非叶子节点都会存储数据</p>
<h5 id="B-tree树"><a href="#B-tree树" class="headerlink" title="B-tree树"></a>B-tree树</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022200627041.png" alt="image-20231022200627041"></p>
<p>5阶的，如果有四个了之后会发生裂变，让中间的数分裂上去</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022200832824.png" alt="image-20231022200832824"></p>
<p>插入1200，大于4个节点，0345往上分列，形成</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022200938773.png" alt="image-20231022200938773"></p>
<h5 id="B-树"><a href="#B-树" class="headerlink" title="B+树"></a>B+树</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022203004341.png" alt="image-20231022203004341"></p>
<p>最多存储3个key和4个指针</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022202018584.png" alt="image-20231022202018584"></p>
<p>数据都在叶子节点,每个叶子节点都会有一个双向链表，非叶子节点只存储索引的作用</p>
<h5 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h5><p>哈希索引就是采用hash算法，将键值转换成新的hash值，映射到对应的槽位上，然后存储到hash表中。如果存在哈希碰撞，就需要连成链表去找对应的数据</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022202231226.png" alt="image-20231022202231226"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022202318413.png" alt="image-20231022202318413"></p>
<h5 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h5><p>为什么InnoDB存储引擎选择使用B+tree索引结构？</p>
<p>相对于二叉树，层级更少，搜索效率更高</p>
<p>对于B-tree，无论是叶子节点还是非叶子节点，都会存储数据，这样导致一页中存储的键值减少，指针跟着减少，要保存大量数据，只能增加树的高度，导致性能降低。而B+tree只有叶子节点存储数据，而非叶子节点就可以保存更多的键值，指针就会跟着增多</p>
<h4 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023151433702.png" alt="image-20231023151433702"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023144115851.png" alt="image-20231023144115851"></p>
<p>主键索引：如果有主键，会自动创建主键索引</p>
<p>唯一索引：字段值不重复，比如身份证号</p>
<p>聚集索引挂的是一行的数据（是主键索引），而二级索引是挂的是主键</p>
<p>联合索引：多个列同时查询，最左匹配原则，搜索频繁最多的放在前面</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023154851963.png" alt="image-20231023154851963"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023144455046.png" alt="image-20231023144455046"></p>
<p>回表查询是指先到二级索引拿到id，根据id去聚集索引查找行的数据</p>
<h5 id="思考题-1"><a href="#思考题-1" class="headerlink" title="思考题"></a>思考题</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023145201602.png" alt="image-20231023145201602"></p>
<p>第一个查询快，因为第一个（id是主键）直接去聚集索引中根据id查；第二个是根据name所建立的索引，先去二级索引中根据name找所对应的id，再根据查到的id去聚集索引中查找所对应的行数据也称回表查询</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023150609316.png" alt="image-20231023150609316">1页可以有16行，也就是16k ，一页也就1024个字节。n代表当前节点存在key的数量，n+1代表指针，key+指针</p>
<p>高度为3，每个节点都有1171个指针，而每个节点都可以有1171个</p>
<h4 id="索引语法"><a href="#索引语法" class="headerlink" title="索引语法"></a>索引语法</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023151528340.png" alt="image-20231023151528340"></p>
<h4 id="SQL性能分析"><a href="#SQL性能分析" class="headerlink" title="SQL性能分析"></a>SQL性能分析</h4><h6 id="查看执行频次"><a href="#查看执行频次" class="headerlink" title="查看执行频次"></a>查看执行频次</h6><p>select global status like ‘Com_______’;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023155649195.png" alt="image-20231023155649195"></p>
<p>后面7个_    来查看哪个进行优化</p>
<h6 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h6><p>查看谁超过了默认的sql查询时间</p>
<p>只会记录执行时间超过预期时间的sql语句</p>
<p>show variables like ‘slow_query_log’;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023160437000.png" alt="image-20231023160437000"></p>
<h6 id="profile"><a href="#profile" class="headerlink" title="profile"></a>profile</h6><p>select @@have_profiling;查询是否支持</p>
<p>查询每一个sql的执行耗时</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023164010596.png" alt="image-20231023164010596"></p>
<h6 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h6><p>查询性能分析</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023164959433.png" alt="image-20231023164959433"></p>
<p>id值越大先执行</p>
<p>在sql语句前面弄一个explain 然后就可以查看运行顺序</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023170809476.png" alt="image-20231023170809476"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023170845254.png" alt="image-20231023170845254"></p>
<p>type 尽量往前提type，可以显示出性能好不好</p>
<h4 id="索引的使用"><a href="#索引的使用" class="headerlink" title="索引的使用"></a>索引的使用</h4><p>没索引就是全表扫描</p>
<p>用索引就是构造b+树</p>
<h6 id="最左前缀原则"><a href="#最左前缀原则" class="headerlink" title="最左前缀原则"></a><strong>最左前缀原则</strong></h6><p>联合索引，索引最左边的列必须存在，不能跳。如果最左边的列不存在，索引会失效走全表扫描</p>
<p>索引（a,b,c） 如果查询条件只有b和c，索引就失效，因为不符合最左前缀原则，a必须存在</p>
<p>如果查询 a和c 那么c会失效，因为没有b</p>
<p><strong>索引失效和位置无关和存在有关</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023172604805.png" alt="image-20231023172604805"></p>
<p>范围查询</p>
<p>联合查询（复合查询）</p>
<p>建议使用&gt;=查询</p>
<blockquote>
<p>如果是&gt;后面的索引都会失效 </p>
<p>要是&gt;=后面的索引不会失效</p>
</blockquote>
<p>联合查询可以解决回表查询</p>
<h6 id="索引失效情况"><a href="#索引失效情况" class="headerlink" title="索引失效情况"></a>索引失效情况</h6><p><strong>不要在索引列上进行运算操作</strong></p>
<p>比如![1698057842235](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\1698057842235.png)</p>
<p>索引会失效</p>
<p><strong>字符串不加引号，会造成类型转换</strong></p>
<p>字符串类型使用时，不加引号，索引会失效</p>
<p><strong>模糊匹配</strong></p>
<p>%在前面就会失效，%在后面就不会失效，要规避前面是%的模糊查询</p>
<p><strong>or</strong></p>
<p>or左右条件都有索引的话，才会索引生效</p>
<p>or左右有一个就不生效</p>
<p>age没索引</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023190524388.png" alt="image-20231023190524388"></p>
<p>age有索引</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023190716264.png" alt="image-20231023190716264"></p>
<p><strong>数据分布影响</strong></p>
<p>mysql会评估到使用索引比全表更慢，则不使用索引，索引会失效</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023191139650.png" alt="image-20231023191139650"></p>
<h6 id="SQL使用提示"><a href="#SQL使用提示" class="headerlink" title="SQL使用提示"></a>SQL<strong>使用提示</strong></h6><p>要是有一个列即在联合索引又在常规索引里，它默认使用的是联合索引</p>
<p>use index(索引名)  可以在from 表名后使用 use index(索引名)来指定，可能会评估，不使用</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023192318407.png" alt="image-20231023192318407"></p>
<p>ignore index（忽略的索引名）</p>
<p>force index （强制的索引名）</p>
<p><strong>覆盖索引</strong></p>
<p>覆盖索引是在二级索引中，都显示的属性，就不需要回表查询</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023193330630.png" alt="image-20231023193330630"></p>
<h6 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h6><p>截取字符串长的</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023194731205.png" alt="image-20231023194731205"></p>
<p>不重复/总数=选择性</p>
<h6 id="单列索引-联合索引"><a href="#单列索引-联合索引" class="headerlink" title="单列索引/联合索引"></a>单列索引/联合索引</h6><p>优先推荐联合索引，性能高，使用得当就会避免回调查询</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023195634654.png" alt="image-20231023195634654"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023195754043.png" alt="image-20231023195754043"></p>
<p><strong>索引设计原则</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023200002595.png" alt="image-20231023200002595"></p>
<h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><h3 id="insert优化"><a href="#insert优化" class="headerlink" title="insert优化"></a>insert优化</h3><p>批量插入、手动提交事务、主键顺序插入</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024145601764.png" alt="image-20231024145601764"></p>
<p>大批量数据使用load指令local data local infile</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024151004858.png" alt="image-20231024151004858"></p>
<p>主键顺序插入性能高于乱序插入</p>
<h3 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h3><p>页分裂和页合并</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024154540732.png" alt="image-20231024154540732"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024154242681.png" alt="image-20231024154242681"></p>
<p>主键乱序插入会造成页分裂</p>
<p>页分裂：乱序插入，50插入，会开启新的数据页，将第一页中后超出50%的部分插入到第三个数据页，将50插入到第三页，然后第一页双向链表和第三个双向链表连接</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024154416191.png" alt="image-20231024154416191">页合并：如果一个页中删除的数据大于这个页的50%，就可以找前后两个看看是否可以合并</p>
<p>主键过长，查得慢，而且占空间</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024153818204.png" alt="image-20231024153818204"></p>
<h3 id="order-by优化"><a href="#order-by优化" class="headerlink" title="order by优化"></a>order by优化</h3><p>排序字段尽量使用索引，使用覆盖索引</p>
<p>using index 直接通过索引返回数据，性能高</p>
<p>using filesort 需要将返回的结果在缓冲区中排序</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024185543554.png" alt="image-20231024185543554"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024185642783.png" alt="image-20231024185642783"></p>
<p>排序时，先根据想要排序的顺序建立索引，比如想age升序，name降序 然后可以建立索引 create index yb_k on emp(age asc ,name desc)建立索引，就不会出现filesort了，这样不会慢。默认都是升序</p>
<p><strong>order by最左前缀法则 顺序好像必须一致</strong></p>
<p><strong>where 存在就行</strong></p>
<p>查询时出现using temportary就会产生临时表，会使查询变慢</p>
<h3 id="group-by分组优化"><a href="#group-by分组优化" class="headerlink" title="group by分组优化"></a>group by分组优化</h3><p>推荐建立索引使用联合索引</p>
<p>group by最左前缀法则 顺序好像必须一致</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024190731831.png" alt="image-20231024190731831"></p>
<p>用到临时表就是很慢，就需要建立索引</p>
<h3 id="Limit优化"><a href="#Limit优化" class="headerlink" title="Limit优化"></a>Limit优化</h3><p>通过覆盖索引和子查询的优化</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025103859150.png" alt="image-20231025103859150"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025103454016.png" alt="image-20231025103454016"></p>
<h3 id="count优化"><a href="#count优化" class="headerlink" title="count优化"></a>count优化</h3><p>推荐使用count（*） 专门进行了优化 直接进行累加，不需拿值，不需判断为null</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025104718951.png" alt="image-20231025104718951"></p>
<h3 id="update优化"><a href="#update优化" class="headerlink" title="update优化"></a>update优化</h3><p>where要有索引的字段，并且索引不能失效</p>
<p>可以先查出有索引的字段，然后根据查出来的索引字段进行更新</p>
<p>update s set gender=’男’ where id (select id from emp where gender=’女’);</p>
<p>这样就很快，走的是聚集索引，不会进行回表查询</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025105348914.png" alt="image-20231025105348914"></p>
<p>如果根据索引条件更新某一字段值，走的是行锁</p>
<p>如果根据某一字段值更新某一字段值，走的是表锁，因为没有加索引会全表扫描这个条件字段值</p>
<p>行锁升级为表锁，会降低并发访问性能</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025111115203.png" alt="image-20231025111115203"></p>
<p><strong>表锁</strong></p>
<p> 特点：偏向MyISAM存储引擎，开销小，加锁快；无死锁；锁定粒度大，发生锁冲突的概率最高,并发度最低。</p>
<p><strong>行锁</strong></p>
<p> 特点：偏向InnoDB存储引擎，和表锁相反</p>
<p><a target="_blank" rel="noopener" href="https://www.php.cn/faq/418290.html">mysql中表锁和行锁有什么区别-mysql教程-PHP中文网</a></p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><h3 id="视图介绍"><a href="#视图介绍" class="headerlink" title="视图介绍"></a>视图介绍</h3><p>视图是一个虚表，并不真实存在，里面的数据是动态生成的</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025190959807.png" alt="image-20231025190959807"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025191119048.png" alt="image-20231025191119048"></p>
<p>视图相当于一个封装好的select函数</p>
<h3 id="视图语法"><a href="#视图语法" class="headerlink" title="视图语法"></a>视图语法</h3><p>创建视图</p>
<p>create （or repalce） view emp_v1 as select id, name from emp;</p>
<p>查看视图</p>
<p>SHOW CREATE VIEW 视图名称</p>
<p>修改视图</p>
<p>create or repalce view emp_v1 as select id, name from emp;</p>
<p>alter view emp_v1 as select * from emp;</p>
<p>删除视图</p>
<p> drop view if exists emp_v1;</p>
<h3 id="检查选项cascaded"><a href="#检查选项cascaded" class="headerlink" title="检查选项cascaded"></a>检查选项cascaded</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025192127011.png" alt="image-20231025192127011"></p>
<p>哪一句加这个选项，这一句和所依赖的上一句都会检查所插入的是否满足where条件</p>
<p>没有这个选项，就不会检查是否满足索引的条件，都会插到表里面</p>
<p>检查会向上传递</p>
<h3 id="检查选项local"><a href="#检查选项local" class="headerlink" title="检查选项local"></a>检查选项local</h3><p>哪一句加这个选项，这一句会检查是否满足条件，所依赖的上一句如果有with  local check option会判断是否满足条件，没有就不判断</p>
<p>local 不会向上传递</p>
<h3 id="视图的更新"><a href="#视图的更新" class="headerlink" title="视图的更新"></a>视图的更新</h3><p>视图中的行和表中的行必须是一一对应的关系</p>
<p>不能包含以下：</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025194548787.png" alt="image-20231025194548787"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025194942037.png" alt="image-20231025194942037"></p>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025195316867.png" alt="image-20231025195316867"></p>
<p>（1）</p>
<p>创建视图，缺少那两列</p>
<p>（2）将学生选修课程表很常用，可以将其弄成视图，真实表不存在，可以后面操作视图 封装了查询语句，简化了操作</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025200041399.png" alt="image-20231025200041399"></p>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>封装sql语句</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025201806573.png" alt="image-20231025201806573"></p>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025203116766.png" alt="image-20231025203116766"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025203056639.png" alt="image-20231025203056639"></p>
<p>创建存储过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create procedure p1()</span><br><span class="line">begin</span><br><span class="line">    select count(*) from emp</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<p>调用存储过程</p>
<p>call p1();</p>
<p>查看存储过程</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025202707763.png" alt="image-20231025202707763"></p>
<p>删除存储过程</p>
<p>drop procedure if exists p1()</p>
<p>设置结束符 delimiter $$</p>
<p>在结束写上$$表示结束</p>
<h3 id="变量-系统变量"><a href="#变量-系统变量" class="headerlink" title="变量-系统变量"></a>变量-系统变量</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026124625019.png" alt="image-20231026124625019"></p>
<p>show global variables; //所有系统变量</p>
<p>show variables like ‘slow_query_log’; //模糊查询系统变量</p>
<p>select @@global 系统变量名 —查看指定的变量值</p>
<p>不指定的话，默认是会话记录 </p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026130631758.png" alt="image-20231026130631758"></p>
<h3 id="用户定义变量"><a href="#用户定义变量" class="headerlink" title="用户定义变量"></a>用户定义变量</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026131647341.png" alt="image-20231026131647341"></p>
<p>set @myname = ‘kang’;</p>
<p>select @myname </p>
<h3 id="直接跳过存储过程到触发器"><a href="#直接跳过存储过程到触发器" class="headerlink" title="直接跳过存储过程到触发器"></a>直接跳过存储过程到触发器</h3><h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>介绍</p>
<p>保持数据完整性和日志记录和数据校验</p>
<p>在数据的增删改之前或者之后进行日志操作</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026132831360.png" alt="image-20231026132831360"></p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026133059092.png" alt="image-20231026133059092"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026133955027.png" alt="image-20231026133955027"></p>
<h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><h4 id="插入数据的触发器"><a href="#插入数据的触发器" class="headerlink" title="插入数据的触发器"></a>插入数据的触发器</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026134059126.png" alt="image-20231026134059126"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026133922886.png" alt="image-20231026133922886"></p>
<p><strong>字符串拼接</strong>  concat</p>
<h4 id="更改数据的触发器"><a href="#更改数据的触发器" class="headerlink" title="更改数据的触发器"></a>更改数据的触发器</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026135228538.png" alt="image-20231026135228538"></p>
<p>&lt;5触发4次触发器，因为是行级触发器</p>
<h4 id="删除数据的触发器"><a href="#删除数据的触发器" class="headerlink" title="删除数据的触发器"></a>删除数据的触发器</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026135630159.png" alt="image-20231026135630159"></p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026140241868.png" alt="image-20231026140241868"></p>
<h2 id="锁-1"><a href="#锁-1" class="headerlink" title="锁"></a>锁</h2><h3 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h3><p>当前使用哪个数据库，就锁哪个数据库</p>
<p><strong>在对整个库进行逻辑备份时，如果不加全局锁，由于数据库的备份不可能一瞬间完成，那么将可能造成最终数据不一致的问题。</strong></p>
<p>数据备份，加全局锁，不让其他用户对这个表进行DDL，和DML操作，只能进行DQL，保护数据的完整性。只能读</p>
<p>![1698302427347](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\1698302427347.png)</p>
<h4 id="一致性数据备份"><a href="#一致性数据备份" class="headerlink" title="一致性数据备份"></a>一致性数据备份</h4><p>全局锁锁的一般都是当前使用的数据库</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026144544411.png" alt="image-20231026144544411"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026145648705.png" alt="image-20231026145648705"></p>
<p>快照读来备份，不需要加锁 single-transation</p>
<h3 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h3><p>锁定粒度大，每次操作锁住整张表，发生锁冲突的概率最高，并发度最低</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026160844696.png" alt="image-20231026160844696"></p>
<h4 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h4><p>分为：读锁和写锁</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026161049336.png" alt="image-20231026161049336"></p>
<p>读锁：限制DML语句，仅能读表数据 共享锁  本机客户端只能读不能写，其他客户端只能读不能写</p>
<p>写锁：限制其他客户端对表的DML和DQL操作，本机客户端既能进行DML还能进行DQL   排它锁/独占锁</p>
<h4 id="元数据锁"><a href="#元数据锁" class="headerlink" title="元数据锁"></a>元数据锁</h4><p>元数据锁是为了在操作表结构的时候，比如修改表的结构，加上元数据锁，为了避免DML语句对表中的数据做出改变。  默认会加元数据锁</p>
<p>也是在DML操作表数据的时候不能改变表的结构</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026191120359.png" alt="image-20231026191120359"></p>
<h4 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h4><p>避免行锁和表锁加锁的冲突问题</p>
<p>表锁，有行锁然后自动给表加意向锁</p>
<p>InnoDb引擎中，表锁和行锁的冲突问题</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026191738672.png" alt="image-20231026191738672"></p>
<p>意向共享锁：两个事务，事务1读数据，事务2可以加表锁读锁</p>
<p>意向排他锁：事务1写数据，事务2读写都不可以，不兼容。但是和意向锁兼容</p>
<p>再执行select的时候，会自动加上表的意向共享锁，也会加行锁</p>
<p>update 这一行会加行锁。并加上表意向排他锁，然后既不能DML也不能DQL</p>
<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><p>对操作的行加锁，通过对索引上的索引项来加锁，而不是对记录来加锁</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026194210040.png" alt="image-20231026194210040"></p>
<h4 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h4><p>在读一行的时候允许别人读，但是不允许别人改</p>
<p>在修改一行数据的时候，不允许别人读和改</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026194646533.png" alt="image-20231026194646533"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026194957520.png" alt="image-20231026194957520"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026195528203.png" alt="image-20231026195528203"></p>
<p>next-key是临建锁</p>
<h4 id="间隙锁"><a href="#间隙锁" class="headerlink" title="间隙锁"></a>间隙锁</h4><h4 id="临建锁"><a href="#临建锁" class="headerlink" title="临建锁"></a>临建锁</h4><p>间隙锁为了防止幻读    防止其他事务插入数据（但是它不能插入），然后造成事务插入异常</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026200544078.png" alt="image-20231026200544078"></p>
<p>针对第二条：1，3，5，7 在5之前是临建锁，那么在5-7是间隙锁   </p>
<h2 id="InnoDB引擎"><a href="#InnoDB引擎" class="headerlink" title="InnoDB引擎"></a>InnoDB引擎</h2><h3 id="逻辑存储结构"><a href="#逻辑存储结构" class="headerlink" title="逻辑存储结构"></a>逻辑存储结构</h3><p>表空间：一个mysql实例可以对应多个表空间，用于存储记录、索引等数据</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027130026205.png" alt="image-20231027130026205"></p>
<h4 id="架构一"><a href="#架构一" class="headerlink" title="架构一"></a>架构一</h4><p>缓冲池</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027130516178.png" alt="image-20231027130516178"></p>
<p>更改缓冲区</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027131403831.png" alt="image-20231027131403831"></p>
<p>自适应Hash索引</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027131706277.png" alt="image-20231027131706277"></p>
<p>日志缓冲区</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027131830376.png" alt="image-20231027131830376"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132534076.png" alt="image-20231027132534076"></p>
<p>创建表空间</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132552012.png" alt="image-20231027132552012"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132503773.png" alt="image-20231027132503773"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132453280.png" alt="image-20231027132453280"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132810466.png" alt="image-20231027132810466"></p>
<p>架构</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027133052584.png" alt="image-20231027133052584"></p>
<p>架构：</p>
<p>增删改查操作缓冲区，如果缓冲区没有数据就在磁盘中读取放到缓冲区里面。缓冲区里面的数据将通过后台线程异步刷新到磁盘中，保持数据的一致</p>
<h3 id="InnoDB事务管理"><a href="#InnoDB事务管理" class="headerlink" title="InnoDB事务管理"></a>InnoDB事务管理</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027183835739.png" alt="image-20231027183835739"></p>
<p>redo log</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027184615003.png" alt="image-20231027184615003"></p>
<p>操作缓冲区，然后把修改的数据放到redo.log  ，然后这个log会往磁盘中输出一个文件，然后这个文件是为了防止刷新脏页到磁盘出现问题，导致没同步。这个文件就可以将信息同步到磁盘中</p>
<p>undo log</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027190839647.png" alt="image-20231027190839647"></p>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><p>在快照读的时候通过mvcc找到对应的历史版本</p>
<h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027191235556.png" alt="image-20231027191235556"></p>
<h4 id="隐藏字段"><a href="#隐藏字段" class="headerlink" title="隐藏字段"></a>隐藏字段</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027191718789.png" alt="image-20231027191718789"></p>
<p>undo log</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027193913905.png" alt="image-20231027193913905"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027193817375.png" alt="image-20231027193817375"></p>
<p>readview</p>
<p>readview 里面有4个属性，来判断应该读取哪个版本</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027194237759.png" alt="image-20231027194237759"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027194413102.png" alt="image-20231027194413102"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027195441836.png" alt="image-20231027195441836"></p>
<h2 id="MYSQL管理"><a href="#MYSQL管理" class="headerlink" title="MYSQL管理"></a>MYSQL管理</h2><h3 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029102240811.png" alt="image-20231029102240811"></p>
<h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029102444264.png" alt="image-20231029102444264"></p>
<h4 id="mysqladmin-创建删除数据库"><a href="#mysqladmin-创建删除数据库" class="headerlink" title="mysqladmin 创建删除数据库"></a>mysqladmin 创建删除数据库</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029103634995.png" alt="image-20231029103634995"></p>
<h4 id="mysqlbinlog"><a href="#mysqlbinlog" class="headerlink" title="mysqlbinlog"></a>mysqlbinlog</h4><p>二进制日志管理工具</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029103010297.png" alt="image-20231029103010297"></p>
<h4 id="mysqlshow-查看表中列和索引"><a href="#mysqlshow-查看表中列和索引" class="headerlink" title="mysqlshow 查看表中列和索引"></a>mysqlshow 查看表中列和索引<img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029103603071.png" alt="image-20231029103603071"></h4><p>mysqlshow -uroot -p1234 db01 –count</p>
<p>mysqlshow -uroot -p1234 db01 -i</p>
<h4 id="mysqldump数据备份"><a href="#mysqldump数据备份" class="headerlink" title="mysqldump数据备份"></a>mysqldump数据备份</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029105442509.png" alt="image-20231029105442509"></p>
<h4 id="mysqlimport-source"><a href="#mysqlimport-source" class="headerlink" title="mysqlimport/source"></a>mysqlimport/source</h4><p>导入mysqldump 加-T参数后导出的文本文件   source可以导入sql脚本</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029110059680.png" alt="image-20231029110059680"></p>
<h2 id="进阶篇总结"><a href="#进阶篇总结" class="headerlink" title="进阶篇总结"></a>进阶篇总结</h2><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029111211528.png" alt="image-20231029111211528"></p>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h4 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h4><p>记录了mysql启动和停止的日志</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029111603804.png" alt="image-20231029111603804"></p>
<p>tail -f 尾部查看日志 </p>
<h4 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029140643628.png" alt="image-20231029140643628"></p>
<p>show variables like’%log_bin%’;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029141041913.png" alt="image-20231029141041913"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029141216383.png" alt="image-20231029141216383"></p>
<p>-v v 将事件重构为sql语句,并输出注释信息</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029142014175.png" alt="image-20231029142014175"></p>
<p>show variables like ‘%binlog_expire_logs_seconds%’;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029142217185.png" alt="image-20231029142217185"></p>
<p>30天</p>
<h4 id="查询日志"><a href="#查询日志" class="headerlink" title="查询日志"></a>查询日志</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029142756093.png" alt="image-20231029142756093"></p>
<h4 id="慢查询日志-1"><a href="#慢查询日志-1" class="headerlink" title="慢查询日志"></a>慢查询日志</h4><p>查看哪个sql语句超过了执行时间</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029144001807.png" alt="image-20231029144001807"></p>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029170249530.png" alt="image-20231029170249530"></p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>![1698570462620](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\1698570462620.png)</p>
<p>主库有事务提交时，把数据的变更写入二进制文件；</p>
<p>从库IOthread读取主库二进制文件并写入到从库Replay_log（中继）日志中；</p>
<p>从库又会SQLThread重做日志中的事件，改变反映自己的数据；</p>
<h3 id="主库配置"><a href="#主库配置" class="headerlink" title="主库配置"></a>主库配置</h3><p>主库ip   192.168.237.124</p>
<p>从库ip 192.168.237.128</p>
<h4 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h4><p>1.修改配置文件  /etc/my.cnf</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029172312350.png" alt="image-20231029172312350"></p>
<p>2.重启mysql服务器</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029173020536.png" alt="image-20231029173020536"></p>
<p>3.登录，mysql创建远程连接的账号，并授予主从复制的权限</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029173228893.png" alt="image-20231029173228893"></p>
<p>可以让从库用这个账户和密码连接主库</p>
<p>create user ‘kang‘@’%’ identified with mysql_native_password by ‘Root@123456’;</p>
<p>账户名 itcast  %这一用户可以在任意主机都可以访问这台服务器   密码Root@123456</p>
<p>grant replication slave on <em>.</em> to ‘kang‘@’%’;</p>
<p>4.通过指令查看二进制日志文件的坐标</p>
<p>flush privileges;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029174243848.png" alt="image-20231029174243848"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029174342111.png" alt="image-20231029174342111"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029192447282.png" alt="image-20231029192447282"></p>
<h3 id="从库配置"><a href="#从库配置" class="headerlink" title="从库配置"></a>从库配置</h3><h4 id="搭建-1"><a href="#搭建-1" class="headerlink" title="搭建"></a>搭建</h4><p>1.修改配置文件  /etc/my.cnf</p>
<p>2.重启mysql服务器</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029192349266.png" alt="image-20231029192349266"></p>
<p>3.登录mysql，设置主从复制</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029193614919.png" alt="image-20231029193614919"></p>
<p>change master to master_host =’192.168.237.124’,master_user=’kang’,master_password=‘Root@123456’,master_log_file=’ binlog.000028’,master_log_pos=156;</p>
<p>4.开启同步操作</p>
<p>start replica;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029193626846.png" alt="image-20231029193626846"></p>
<p>5.查看从库状态</p>
<p> show slave status\G;</p>
<p>uuid 所在目录  /var/lib/docker/volumes/9294e8036fb5c1fd3eb8a1f691be8f1d62ea8475821976a1e016a7a251701533/_data/auto.cnf</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44895681/article/details/106574216">Mysql主从同步报错解决：Fatal error: The slave I/O thread stops because master and slave have equal..-CSDN博客</a></p>
<p>CHANGE MASTER TO<br>  MASTER_HOST=’192.168.237.124’,<br>  MASTER_USER=’kang’,<br>  MASTER_PASSWORD=‘Root@123456’,<br>  MASTER_PORT=3306,<br>  MASTER_LOG_FILE=’binlog.000031’,<br>  MASTER_LOG_POS=156;</p>
<p>解决：server相同，日志不是第一个问题</p>
<p><strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29974229/article/details/120037734">Mysql报错:Got fatal error 1236 from master when reading data from binary log: ‘Could not find first lo_上海运维Q先生的博客-CSDN博客</a></strong></p>
<p> <strong>set global server_id=128;</strong></p>
<p> <strong>select @@server_id;</strong></p>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><p>主库写从库读</p>
<h3 id="ShardingJDBC"><a href="#ShardingJDBC" class="headerlink" title="ShardingJDBC"></a>ShardingJDBC</h3><p>1.导入依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--sharding-jdbc依赖--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;4.0.0-RC1&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2.在yml配置读写分离规则</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">names:</span></span><br><span class="line">        <span class="string">master,slave</span></span><br><span class="line">      <span class="comment"># 主数据源</span></span><br><span class="line">      <span class="attr">master:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.237.124:3306/rw?characterEncoding=utf-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="comment"># 从数据源</span></span><br><span class="line">      <span class="attr">slave:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.237.128:3306/rw?characterEncoding=utf-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">masterslave:</span></span><br><span class="line">      <span class="comment"># 读写分离配置</span></span><br><span class="line">      <span class="attr">load-balance-algorithm-type:</span> <span class="string">round_robin</span> <span class="comment">#轮询,针对不同从库的，负载均衡</span></span><br><span class="line">      <span class="comment"># 最终的数据源名称</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dataSource</span></span><br><span class="line">      <span class="comment"># 主库数据源名称</span></span><br><span class="line">      <span class="attr">master-data-source-name:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment"># 从库数据源名称列表，多个逗号分隔</span></span><br><span class="line">      <span class="attr">slave-data-source-names:</span> <span class="string">slave</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">sql:</span></span><br><span class="line">        <span class="attr">show:</span> <span class="literal">true</span> <span class="comment">#开启SQL显示，默认false</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span> <span class="comment">#开启的话，控制台输出sql</span></span><br></pre></td></tr></table></figure>

<p>3.在配置文件中配置允许bean定义覆盖配置项</p>
<p>SpringBootConfiguration 和 DruidDataSourceAutoConfigure 都会创建一个数据源，导致报错。所以必须允许bean定义覆盖，用最新的</p>
<h1 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h1><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231119174233868.png" alt="image-20231119174233868"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117171012488.png" alt="image-20231117171012488"></p>
<p>生成</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117171840772.png" alt="image-20231117171840772"></p>
<p>解析</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117224222957.png" alt="image-20231117224222957"></p>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117232955083.png" alt="image-20231117232955083"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117233516009.png" alt="image-20231117233516009"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117233400108.png" alt="image-20231117233400108"></p>
<h1 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h1><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>我们可以再创建一个父工程 tlias-parent ，然后让上述的三个模块 tlias-pojo、tlias-utils、tlias-web-management 都来继承这个父工程 。 然后再将各个模块中都共有的依赖，都提取到父工程 tlias-parent中进行配置，只要子工程继承了父工程，依赖它也会继承下来，这样就无需在各个子工程中进行配置了。</p>
<ul>
<li>概念：继承描述的是两个工程间的关系，与java中的继承相似，子工程可以继承父工程中的配置信息，常见于依赖关系的继承。</li>
<li>作用：简化依赖配置、统一管理依赖</li>
</ul>
<h2 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h2><ul>
<li><strong>聚合：</strong>将多个模块组织成一个整体，同时进行项目的构建。</li>
<li><strong>聚合工程：</strong>一个不具有业务功能的“空”工程（有且仅有一个pom文件） 【PS：一般来说，继承关系中的父工程与聚合关系中的聚合工程是同一个】</li>
<li><strong>作用：</strong>快速构建项目（无需根据依赖关系手动构建，直接在聚合工程上构建即可）</li>
</ul>
<p>可以统一打包</p>
<h2 id="版本锁定"><a href="#版本锁定" class="headerlink" title="版本锁定"></a>版本锁定</h2><p>在maven中，可以在父工程的pom文件中通过 <dependencyManagement> 来统一管理依赖版本。</p>
<p>父工程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--统一管理依赖版本--&gt;</span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--JWT令牌--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">0.9</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>


<p>子工程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!--JWT令牌--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>




<p>注意：</p>
<p>在父工程中所配置的 <dependencyManagement> 只能统一管理依赖版本，并不会将这个依赖直接引入进来。 这点和 <dependencies> 是不同的。<br>子工程要使用这个依赖，还是需要引入的，只是此时就无需指定 <version> 版本号了，父工程统一管理。变更依赖版本，只需在父工程中统一变更。</p>
<h2 id="分模块开发"><a href="#分模块开发" class="headerlink" title="分模块开发"></a>分模块开发</h2><p>分模块设计之后，如果我们需要用到另外一个模块的功能，我们直接依赖模块就可以了。比如商品模块、搜索模块、购物车订单模块都需要依赖于通用组件当中封装的一些工具类，我只需要引入通用组件的坐标就可以了。</p>
<p><strong>分模块设计就是将项目按照功能/结构拆分成若干个子模块，方便项目的管理维护、拓展，也方便模块键的相互调用、资源共享。</strong></p>
<h1 id="三更Blog"><a href="#三更Blog" class="headerlink" title="三更Blog"></a>三更Blog</h1><h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><p>项目介绍: 博客项目，前端有两个系统，分别是负责博客页面(前台系统)、管理页面(后台系统)。后端也有两个系统，分别是前端两个系统的具体实现</p>
<p>思考: 后端两个系统的代码复用性较高，所以后端创建的是多模块(3个模块)项目，把后端两个系统(两个子模块)都会用到的代码写到一个公共模块(第3个模块)</p>
<p>3个子模块在父模块里面，父模块叫SpringBootBlog</p>
<p>3个子模块分别是dykang-framework(公共模块)、dykang-blog(博客前台模块)、dykang-admin(博客后台模块)</p>
<h2 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h2><h3 id="创建父模块dy-Blog"><a href="#创建父模块dy-Blog" class="headerlink" title="创建父模块dy-Blog"></a>创建父模块dy-Blog</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025131624543.png" alt="image-20231025131624543"></p>
<p>把src目录删掉</p>
<p>在pom.xml添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;dy-Blog&lt;/artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;!--    聚合工程，可以一起打包，一起清理，更加方便--&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;<span class="keyword">module</span>&gt;dykang-framework&lt;/<span class="keyword">module</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">module</span>&gt;dykang-blog&lt;/<span class="keyword">module</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">module</span>&gt;dykang-admin&lt;/<span class="keyword">module</span>&gt;</span><br><span class="line">    &lt;/modules&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    多模块开发，提高系统的复用性--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--编码方式、jdk版本--&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-<span class="number">8</span>&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;java.version&gt;<span class="number">1.8</span>&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--依赖的版本控制--&gt;</span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- SpringBoot的依赖配置--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">2.5</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">                &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--fastjson依赖--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">1.2</span><span class="number">.33</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--jwt依赖--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">0.9</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--mybatisPlus依赖--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">3.4</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--阿里云OSS--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">3.10</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">3.0</span><span class="number">.5</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">2.9</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">2.9</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">        &lt;/dependencies&gt;</span><br><span class="line">    &lt;/dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;!--配置maven版本--&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">3.1</span>&lt;/version&gt;</span><br><span class="line">                &lt;!--配置jdk版本--&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;$&#123;java.version&#125;&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;$&#123;java.version&#125;&lt;/target&gt;</span><br><span class="line">                    &lt;encoding&gt;$&#123;project.build.sourceEncoding&#125;&lt;/encoding&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="创建公共子模块dykang-framework"><a href="#创建公共子模块dykang-framework" class="headerlink" title="创建公共子模块dykang-framework"></a>创建公共子模块dykang-framework</h3><p>在pox.xml添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;dy-Blog&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--    公共模块--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;dykang-framework&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--lombok--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;<span class="literal">true</span>&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--junit--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--SpringSecurity启动器--&gt;</span><br><span class="line">        &lt;!--&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;--&gt;</span><br><span class="line">        &lt;!--redis依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--fastjson依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--jwt依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--mybatisPlus依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--mysql数据库驱动--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--阿里云OSS--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--AOP--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="创建博客后台模块dykang-admin"><a href="#创建博客后台模块dykang-admin" class="headerlink" title="创建博客后台模块dykang-admin"></a>创建博客后台模块dykang-admin</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;dy-Blog&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    管理后台页面--&gt;</span><br><span class="line">    &lt;artifactId&gt;dykang-admin&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!--用dykang-framework模块里面的依赖--&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dykang-framework&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="创建博客前台模块dykang-blog"><a href="#创建博客前台模块dykang-blog" class="headerlink" title="创建博客前台模块dykang-blog"></a>创建博客前台模块dykang-blog</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;dy-Blog&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    管理前台页面--&gt;</span><br><span class="line">    &lt;artifactId&gt;dy-blog&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--用dykang-framework模块里面的依赖--&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dykang-framework&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h2 id="EasyCode插件"><a href="#EasyCode插件" class="headerlink" title="EasyCode插件"></a>EasyCode插件</h2><p>快速生成实体类等代码</p>
<h2 id="公共模块-准备工作"><a href="#公共模块-准备工作" class="headerlink" title="公共模块-准备工作"></a>公共模块-准备工作</h2><p>导入数据库</p>
<p>测试</p>
<h2 id="博客前台模块-准备工作"><a href="#博客前台模块-准备工作" class="headerlink" title="博客前台模块-准备工作"></a>博客前台模块-准备工作</h2><p>整合mybatisplus</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025132845175.png" alt="image-20231025132845175"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025133125795.png" alt="image-20231025133125795"></p>
<h2 id="博客前台模块-文章列表"><a href="#博客前台模块-文章列表" class="headerlink" title="博客前台模块-文章列表"></a>博客前台模块-文章列表</h2><h3 id="接口分析"><a href="#接口分析" class="headerlink" title="接口分析"></a>接口分析</h3><p>需要查询浏览量最高的前10篇文章的信息。要求展示文章标题和浏览量。把能让用户自己点击跳转到具体的文章详情进行浏览</p>
<p>注意：不能把草稿展示出来，不能把删除了的文章查询出来。要按照浏览量进行降序排序</p>
<h3 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h3><p>构造查询条件：已发布文章，未删除文章（yml逻辑删除字段已自动判断是否删除，在这就不用加入此条件） ，通过降序排序 并只查看10条数据 所以用分页查询，直接表明是第一页显示10个数据即可  通过查询条件查询出文章表信息 通过BeanCopy给VO，并返回给前端</p>
<h3 id="统一响应格式"><a href="#统一响应格式" class="headerlink" title="统一响应格式"></a>统一响应格式</h3><h4 id="1-代码实现"><a href="#1-代码实现" class="headerlink" title="1.代码实现"></a>1.代码实现</h4><p>第一步: 在huanf-framework公共模块的src/main/java目录新建com.huanf.enums.AppHttpCodeEnum类，写入如下，作用是封装code和msg</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/19 0019 12:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AppHttpCodeEnum</span> &#123;</span><br><span class="line">    <span class="comment">// 成功</span></span><br><span class="line">    SUCCESS(<span class="number">200</span>,<span class="string">&quot;操作成功&quot;</span>),</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    NEED_LOGIN(<span class="number">401</span>,<span class="string">&quot;需要登录后操作&quot;</span>),</span><br><span class="line">    NO_OPERATOR_AUTH(<span class="number">403</span>,<span class="string">&quot;无权限操作&quot;</span>),</span><br><span class="line">    SYSTEM_ERROR(<span class="number">500</span>,<span class="string">&quot;出现错误&quot;</span>),</span><br><span class="line">    USERNAME_EXIST(<span class="number">501</span>,<span class="string">&quot;用户名已存在&quot;</span>),</span><br><span class="line">    PHONENUMBER_EXIST(<span class="number">502</span>,<span class="string">&quot;手机号已存在&quot;</span>), EMAIL_EXIST(<span class="number">503</span>, <span class="string">&quot;邮箱已存在&quot;</span>),</span><br><span class="line">    REQUIRE_USERNAME(<span class="number">504</span>, <span class="string">&quot;必需填写用户名&quot;</span>),</span><br><span class="line">    LOGIN_ERROR(<span class="number">505</span>,<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">    <span class="type">int</span> code;</span><br><span class="line">    String msg;</span><br><span class="line"></span><br><span class="line">    AppHttpCodeEnum(<span class="type">int</span> code, String errorMessage)&#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = errorMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步: 在huanf-framework公共模块的domain目录新建ResponseResult类，写入如下，作为统一响应格式的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.domain;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> ResponseResult&lt;?&gt; ok(Integer code, T data) &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.code = code;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.data = data;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> ResponseResult&lt;?&gt; ok(Integer code, T data, String msg) &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.code = code;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.data = data;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.msg = msg;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> ResponseResult&lt;?&gt; ok(T data) &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.data = data;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> code;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.code = code;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> msg;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.msg = msg;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> T <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> data;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(T data)</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.data = data;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-后端解决跨域"><a href="#2-后端解决跨域" class="headerlink" title="2.后端解决跨域"></a>2.后端解决跨域</h4><p>在huanf-framework工程的src/main/java目录新建com.huanf.config.WebConfig类，写入如下，然后重新运行huanf-blog工程的HuanfBlogApplication类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/19 0019 14:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 设置允许跨域的路径</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">// 设置允许跨域请求的域名</span></span><br><span class="line">                .allowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// 是否允许cookie</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 设置允许的请求方式</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;PUT&quot;</span>)</span><br><span class="line">                <span class="comment">// 设置允许的header属性</span></span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// 跨域允许时间</span></span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">//ServiceImpl是mybatisPlus官方提供的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ArticleMapper, Article&gt; <span class="keyword">implements</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">hotArticleList</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询热门文章，封装成ResponseResult返回。把所有查询条件写在queryWrapper里面</span></span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//查询的不能是草稿。也就是Status字段不能是0</span></span><br><span class="line">        queryWrapper.eq(Article::getStatus,<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//按照浏览量进行排序。也就是根据ViewCount字段降序排序</span></span><br><span class="line">        queryWrapper.orderByDesc(Article::getViewCount);</span><br><span class="line">        <span class="comment">//最多只能查询出来10条消息。当前显示第一页的数据，每页显示10条数据</span></span><br><span class="line">        Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">1</span>,<span class="number">10</span>);</span><br><span class="line">        page(page,queryWrapper);</span><br><span class="line">        <span class="comment">//获取最终的查询结果</span></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(articles);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h4 id="3、前端项目的启动"><a href="#3、前端项目的启动" class="headerlink" title="3、前端项目的启动"></a>3、前端项目的启动</h4><p>需要有node.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /SpringBootBlogWeb/sg-blog-vue</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h4 id="4-统一响应格式（优化）"><a href="#4-统一响应格式（优化）" class="headerlink" title="4.统一响应格式（优化）"></a>4.统一响应格式（优化）</h4><h5 id="vo"><a href="#vo" class="headerlink" title="vo"></a>vo</h5><p>在刚刚的响应格式中，其实是不符合接口文档标准的，因为我们返回了很多字段，如下图，有些字段不需要返回，或者比较敏感不能返回给前端</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/jpg/35597420/1693034006959-451cfd5d-5196-49a5-9a7a-f5e9169abb85.jpg" alt="img"></p>
<p>为什么会返回这么多字段: 查询出来的结果是用Article来封装的，由于Article实体类里面的字段比较多，所以返回的字段也就是很多</p>
<p>解决: 用VO (是Value Object的缩写,表示值对象) 来接收查询的结果，一个接口对应一个VO，这样即使接口响应字段要修改也只要修改VO即可</p>
<p>Bean拷贝:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanUtils.copyProperties(xxarticle,xxvo);</span><br></pre></td></tr></table></figure>

<h5 id="字面值处理"><a href="#字面值处理" class="headerlink" title="字面值处理"></a>字面值处理</h5><p>实际项目中都不允许直接在代码中使用字面值(代码中的固定值)。都需要定义成常量来使用。这种方式有利于提高代码的可维护性。字面值如下图</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/jpg/35597420/1693034008056-8dbc6d71-5d02-4ab8-b7eb-4b217db7aa9d.jpg" alt="img"></p>
<p>第一步: 在huanf-framework工程的src/main/java目录新建com.huanf.constants.SystemCanstants类，写入如下，作用是定义常量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.constants;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/19 0019 19:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//字面值(代码中的固定值)处理，把字面值都在这里定义成常量</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemCanstants</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  文章是草稿</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_DRAFT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  文章是正常分布状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_NORMAL</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章列表当前查询页数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_CURRENT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章列表每页显示的数据条数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_SIZE</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Bean拷贝的封装"><a href="#Bean拷贝的封装" class="headerlink" title="Bean拷贝的封装"></a>Bean拷贝的封装</h5><p>在前面的 ‘统一响应格式(优化)’ 的 ‘一、定义并测试VO’，最核心的代码就是ArticleServiceImpl类里面用到的Spring提供的BeanUtils工具类。这个工具类可以把Article类里面拿到的查询结果，拷贝给HotArticleVO类，注意HotArticleVO(少)相对于Article(多)来说，成员变量的数量可以少，但是名称和类型必须一样</p>
<p>我们前面是在ArticleServiceImpl类写了如下核心代码，为了提高代码复用性，我们必须把这段代码抽取出来进行封装</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/19 0019 20:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//这个类用到很多泛型知识，可以对应去补一下</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanCopyUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//私有的空参构造方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">BeanCopyUtils</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.单个实体类的拷贝(暂时还用不上)。第一个参数是要拷贝的对象，第二个参数是类的字节码对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;V&gt; V <span class="title function_">copyBean</span><span class="params">(Object source,Class&lt;V&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="comment">//创建目标对象</span></span><br><span class="line">        <span class="type">V</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            result = clazz.newInstance();</span><br><span class="line">            <span class="comment">//实现属性拷贝。也就是把source的属性拷贝到这个目标对象。BeanUtils是spring提供的工具类</span></span><br><span class="line">            BeanUtils.copyProperties(source, result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回结果</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.集合的拷贝(在ArticleServiceImpl类里面会使用到)。第一个参数是要拷贝的集合，第二个参数是类的字节码对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;O,V&gt; List&lt;V&gt; <span class="title function_">copyBeanList</span><span class="params">(List&lt;O&gt; list,Class&lt;V&gt; clazz)</span>&#123;</span><br><span class="line">        <span class="comment">//不使用for循环，使用stream流进行转换</span></span><br><span class="line">        <span class="keyword">return</span> list.stream()</span><br><span class="line">                .map(o -&gt; copyBean(o, clazz))</span><br><span class="line">                <span class="comment">//把结果转换成集合</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改之前copy代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一行搞定</span></span><br><span class="line">       List&lt;HotArticleVO&gt; articleVos = BeanCopyUtils.copyBeanList(articles, HotArticleVO.class);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-分类列表"><a href="#博客前台模块-分类列表" class="headerlink" title="博客前台模块-分类列表"></a>博客前台模块-分类列表</h2><h3 id="接口分析-1"><a href="#接口分析-1" class="headerlink" title="接口分析"></a>接口分析</h3><p>页面上需要展示分类列表，用户可以点击具体的分类查看该分类下的文章列表。要求只展示有发布正式文章的分类 。要求必须是正常(非禁用)状态的分类</p>
<h3 id="解决思路-1"><a href="#解决思路-1" class="headerlink" title="解决思路"></a>解决思路</h3><p>首先查询文章表中状态正常的文章分类ID集合并去重，通过调用listByIds获取分类相关信息，然后通过stream流过滤出状态正常的分类信息，通过BeanCopy把信息拷贝到VO对象，将VO对象返回给前端</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;categoryService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper,Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="comment">//ArticleService是我们在huanf-framework写的接口</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//查询分类列表的核心代码</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getCategoryList</span><span class="params">()</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; articleWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//要求查的是getStatus字段的值为1，注意SystemCanstants是我们写的一个常量类，用来解决字面值的书写问题</span></span><br><span class="line">        articleWrapper.eq(Article::getStatus, SystemCanstants.ARTICLE_STATUS_NORMAL);</span><br><span class="line">        <span class="comment">//查询文章列表，条件就是上一行的articleWrapper</span></span><br><span class="line">        List&lt;Article&gt; articleList = articleService.list(articleWrapper);</span><br><span class="line">        <span class="comment">//获取文章的分类id，并且去重。使用stream流来处理上一行得到的文章表集合</span></span><br><span class="line">        Set&lt;Long&gt; categoryIds = articleList.stream()</span><br><span class="line">                <span class="comment">//下面那行可以优化为Lambda表达式+方法引用</span></span><br><span class="line">                .map(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Article, Long&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Long <span class="title function_">apply</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> article.getCategoryId();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">//把文章的分类id转换成Set集合</span></span><br><span class="line">                .collect(Collectors.toSet());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询分类表</span></span><br><span class="line">        List&lt;Category&gt; categories = listByIds(categoryIds);</span><br><span class="line">        <span class="comment">//注意SystemCanstants是我们写的一个常量类，用来解决字面值的书写问题</span></span><br><span class="line">        categories = categories.stream()</span><br><span class="line">                .filter(category -&gt; SystemCanstants.STATUS_NORMAL.equals(category.getStatus()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装成CategoryVo实体类后返回给前端，CategoryVo的作用是只返回前端需要的字段。BeanCopyUtils是我们写的工具类</span></span><br><span class="line">        List&lt;CategoryVo&gt; categoryVos = BeanCopyUtils.copyBeanList(categories, CategoryVo.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(categoryVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-分页查询"><a href="#博客前台模块-分页查询" class="headerlink" title="博客前台模块-分页查询"></a>博客前台模块-分页查询</h2><h3 id="接口分析-2"><a href="#接口分析-2" class="headerlink" title="接口分析"></a>接口分析</h3><p>首页需要查询所有的文章列表。分类页面需要查询对应分类下的文章列表。只能查询正式发布的文章，置顶的文章要显示在最前面</p>
<h3 id="解决思路-2"><a href="#解决思路-2" class="headerlink" title="解决思路"></a>解决思路</h3><p>首先看到分页，先配置MP分页插件；</p>
<p>查询条件为 正常发布的文章，置顶的文章（降序排序即可），分类名，文章实体类中没有需要添加，并加入注解TableField（exists=false）在数据库表中实际不存在  ；通过分类ID查找分类表获取分类名，封装分页VO对象返回</p>
<h3 id="配置分页插件"><a href="#配置分页插件" class="headerlink" title="配置分页插件"></a>配置分页插件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//配置MyBatisPlus的分页插件，使得支持分页查询。这个类直接复制就能用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3.4.0之后版本</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//----------------------------------分页查询文章的列表---------------------------------</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> ResponseResult <span class="title function_">articleList</span><span class="params">(Integer pageNum, Integer pageSize, Long categoryId)</span> &#123;</span><br><span class="line"></span><br><span class="line">      LambdaQueryWrapper&lt;Article&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//判空。如果前端传了categoryId这个参数，那么查询时要和传入的相同。第二个参数是数据表的文章id，第三个字段是前端传来的文章id</span></span><br><span class="line">      lambdaQueryWrapper.eq(Objects.nonNull(categoryId)&amp;&amp;categoryId&gt;<span class="number">0</span>,Article::getCategoryId,categoryId);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//只查询状态是正式发布的文章。Article实体类的status字段跟0作比较，一样就表示是正式发布的</span></span><br><span class="line">      lambdaQueryWrapper.eq(Article::getStatus,SystemCanstants.ARTICLE_STATUS_NORMAL);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//对isTop字段进行降序排序，实现置顶的文章(isTop值为1)在最前面</span></span><br><span class="line">      lambdaQueryWrapper.orderByDesc(Article::getIsTop);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//分页查询</span></span><br><span class="line">      Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">      page(page,lambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//把最后的查询结果封装成ArticleListVo(我们写的实体类)。BeanCopyUtils是我们写的工具类</span></span><br><span class="line">      List&lt;ArticleListVo&gt; articleListVos = BeanCopyUtils.copyBeanList(page.getRecords(), ArticleListVo.class);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//把上面那行的查询结果和文章总数封装在PageVo(我们写的实体类)</span></span><br><span class="line">      <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>(articleListVos,page.getTotal());</span><br><span class="line">      <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决categoryName没有名字问题"><a href="#解决categoryName没有名字问题" class="headerlink" title="解决categoryName没有名字问题"></a>解决categoryName没有名字问题</h3><p>for循环解决</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 解决categoryName字段没有返回值的问题。在分页之后，封装成ArticleListVo之前，进行处理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//用categoryId来查询categoryName(category表的name字段)，也就是查询&#x27;分类名称&#x27;。有两种方式来实现，如下</span></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line">        <span class="comment">//第一种方式，用for循环遍历的方式</span></span><br><span class="line">        <span class="keyword">for</span> (Article article : articles) &#123;</span><br><span class="line">            <span class="comment">//&#x27;article.getCategoryId()&#x27;表示从article表获取category_id字段，然后作为查询category表的name字段</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(article.getCategoryId());</span><br><span class="line">            <span class="comment">//把查询出来的category表的name字段值，也就是article，设置给Article实体类的categoryName成员变量</span></span><br><span class="line">            article.setCategoryName(category.getName());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Stream流</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用categoryId来查询categoryName(category表的name字段)，也就是查询&#x27;分类名称&#x27;</span></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line">        articles.stream()</span><br><span class="line">                .map(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Article, Article&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Article <span class="title function_">apply</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">                        <span class="comment">//&#x27;article.getCategoryId()&#x27;表示从article表获取category_id字段，然后作为查询category表的name字段</span></span><br><span class="line">                        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(article.getCategoryId());</span><br><span class="line">                        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> category.getName();</span><br><span class="line">                        <span class="comment">//把查询出来的category表的name字段值，也就是article，设置给Article实体类的categoryName成员变量</span></span><br><span class="line">                        article.setCategoryName(name);</span><br><span class="line">                        <span class="comment">//把查询出来的category表的name字段值，也就是article，设置给Article实体类的categoryName成员变量</span></span><br><span class="line">                        <span class="keyword">return</span> article;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在category类中增加一个字段，为categoryName，由categoryId来查询出</span></span><br><span class="line">   <span class="comment">//由于数据库没有category_name字段，所以要用注解指定一下字段</span></span><br><span class="line">   <span class="meta">@TableField(exist = false)</span><span class="comment">//代表这个字段在数据库中不存在，避免MyBatisPlus在查询时报错</span></span><br><span class="line">   <span class="keyword">private</span> String categoryName;</span><br></pre></td></tr></table></figure>

<h3 id="FastJson配置"><a href="#FastJson配置" class="headerlink" title="FastJson配置"></a>FastJson配置</h3><p>由于ArticleListVO类的createTime成员变量是Date类型，默认是由java的Jackson来处理，使用 ISO-8601 规范来处理日期时间格式。ISO-8601 是一种国际标准的日期时间表示法，例如：”2023-07-21T06:53:24”。我们不希望时间被处理成这种格式，如下图。解决: 使用FastJson</p>
<p>也可以通过注解的方式，在日期字段上面加入@JsonFormat(pattern = “yyyy-MM-dd HH:mm:ss”)也可</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/jpg/35597420/1693034010104-0019ad45-03f8-4751-a7ad-81aea2b76c47.jpg?x-oss-process=image/resize,w_1500,limit_0/interlace,1" alt="img"></p>
<p>第一步(已做可跳过): 在huanf-framework的pom.xml添加如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--fastjson依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<p>第二步: 在huanf-framework的config目录的WebConfig类，修改为如下。用线隔开了。直接复制去用</p>
<h3 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">package com.huanf.config;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.serializer.SerializeConfig;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.serializer.ToStringSerializer;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.support.config.FastJsonConfig;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"></span><br><span class="line"> \* @author 35238</span><br><span class="line"></span><br><span class="line"> \* @date 2023/7/19 0019 14:57</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line"></span><br><span class="line">public class WebConfig implements WebMvcConfigurer &#123;</span><br><span class="line"></span><br><span class="line">​    @Override</span><br><span class="line"></span><br><span class="line">​    public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line"></span><br><span class="line">​        // 设置允许跨域的路径</span><br><span class="line"></span><br><span class="line">​        registry.addMapping(&quot;/**&quot;)</span><br><span class="line"></span><br><span class="line">​                // 设置允许跨域请求的域名</span><br><span class="line"></span><br><span class="line">​                .allowedOriginPatterns(&quot;*&quot;)</span><br><span class="line"></span><br><span class="line">​                // 是否允许cookie</span><br><span class="line"></span><br><span class="line">​                .allowCredentials(true)</span><br><span class="line"></span><br><span class="line">​                // 设置允许的请求方式</span><br><span class="line"></span><br><span class="line">​                .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;DELETE&quot;, &quot;PUT&quot;)</span><br><span class="line"></span><br><span class="line">​                // 设置允许的header属性</span><br><span class="line"></span><br><span class="line">​                .allowedHeaders(&quot;*&quot;)</span><br><span class="line"></span><br><span class="line">​                // 跨域允许时间</span><br><span class="line"></span><br><span class="line">​                .maxAge(3600);</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">​    //-----------------------------------FastJson配置-----------------------------------------</span><br><span class="line"></span><br><span class="line">​    @Bean//使用@Bean注入fastJsonHttpMessageConvert</span><br><span class="line"></span><br><span class="line">​    public HttpMessageConverter fastJsonHttpMessageConverters() &#123;</span><br><span class="line"></span><br><span class="line">​        //1.需要定义一个Convert转换消息的对象</span><br><span class="line"></span><br><span class="line">​        FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();</span><br><span class="line"></span><br><span class="line">​        FastJsonConfig fastJsonConfig = new FastJsonConfig();</span><br><span class="line"></span><br><span class="line">​        fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class="line"></span><br><span class="line">​        fastJsonConfig.setDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line"></span><br><span class="line">​        SerializeConfig.globalInstance.put(Long.class, ToStringSerializer.instance);</span><br><span class="line"></span><br><span class="line">​        fastJsonConfig.setSerializeConfig(SerializeConfig.globalInstance);</span><br><span class="line"></span><br><span class="line">​        fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line"></span><br><span class="line">​        HttpMessageConverter&lt;?&gt; converter = fastConverter;</span><br><span class="line"></span><br><span class="line">​        return converter;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    @Override</span><br><span class="line"></span><br><span class="line">​    //配置消息转换器</span><br><span class="line"></span><br><span class="line">​    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;</span><br><span class="line"></span><br><span class="line">​        //增加我们的消息转换器</span><br><span class="line"></span><br><span class="line">​        converters.add(fastJsonHttpMessageConverters());</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">​    //--------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-文章详情"><a href="#博客前台模块-文章详情" class="headerlink" title="博客前台模块-文章详情"></a>博客前台模块-文章详情</h2><h3 id="接口分析-3"><a href="#接口分析-3" class="headerlink" title="接口分析"></a>接口分析</h3><p>要求在文章列表点击阅读全文时能够跳转到文章详情页面，可以让用户阅读文章正文。并且要在文章详情中展示其分类名</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;categoryName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;文章详情的具体文章内容&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-23 23:20:11&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isComment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SpringSecurity从入门到精通&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;viewCount&quot;</span><span class="punctuation">:</span> <span class="string">&quot;114&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="解决思路-3"><a href="#解决思路-3" class="headerlink" title="解决思路"></a>解决思路</h3><p>路径参数需要加入@PathVariable标明是路径参数</p>
<p>根据传入id，找到这个文章，获取文章分类ID，然后根据文章分类ID获取分类名称，BeanCopy给VO对象</p>
<h3 id="Http请求方式"><a href="#Http请求方式" class="headerlink" title="Http请求方式"></a>Http请求方式</h3><p>以GET /article/{id} 为例的路径参数形式，下面两种是比较常用的。不常用的有’请求体形式’、’请求头形式’</p>
<table>
<thead>
<tr>
<th>请求形式</th>
<th>示例</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>路径参数形式</td>
<td>/articles/{id}</td>
<td>参数作为路径的一部分，表示明确的资源标识符或必需的参数。</td>
</tr>
<tr>
<td>查询参数形式</td>
<td>/articles?id=1&amp;num=1</td>
<td>参数通过 “?” 或 “&amp;” 的方式附加在URL的末尾，适合传递可选参数或过滤条件。</td>
</tr>
</tbody></table>
<p>在上面的业务请求中，我们使用的都是’路径参数形式’，下面的业务请求中，我们将会使用’查询参数形式’</p>
<h3 id="代码实现-3"><a href="#代码实现-3" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------------------------查询文章详情------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span> <span class="comment">//路径参数形式的HTTP请求，注意下面那行只有加@PathVariable注解才能接收路径参数形式的HTTP请求</span></span><br><span class="line">    <span class="comment">//ResponseResult是huanf-framework工程的domain目录的类</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getArticleDetail</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<span class="comment">//注解里指定的id跟上一行保持一致</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据id查询文章详情</span></span><br><span class="line">        <span class="keyword">return</span> articleService.getArticleDetail(id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------根据id查询文章详情---------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getArticleDetail</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据id查询文章</span></span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把最后的查询结果封装成ArticleListVo(我们写的实体类)。BeanCopyUtils是我们写的工具类</span></span><br><span class="line">        <span class="type">ArticleDetailVo</span> <span class="variable">articleDetailVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(article, ArticleDetailVo.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据分类id，来查询分类名</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> articleDetailVo.getCategoryId();</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">        <span class="comment">//如果根据分类id查询的到分类名，那么就把查询到的值设置给ArticleDetailVo实体类的categoryName字段</span></span><br><span class="line">        <span class="keyword">if</span>(category!=<span class="literal">null</span>)&#123;</span><br><span class="line">            articleDetailVo.setCategoryName(category.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装响应返回。ResponseResult是我们在huanf-framework工程的domain目录写的实体类</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(articleDetailVo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-友链功能"><a href="#博客前台模块-友链功能" class="headerlink" title="博客前台模块-友链功能"></a>博客前台模块-友链功能</h2><h3 id="接口分析-4"><a href="#接口分析-4" class="headerlink" title="接口分析"></a>接口分析</h3><p>在友链页面要查询出所有的审核通过的友链，响应格式如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://www.baidu.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sda&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图片url1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sda&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://www.qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dada&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图片url2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sda&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="解决思路-4"><a href="#解决思路-4" class="headerlink" title="解决思路"></a>解决思路</h3><p>条件:审核通过即可，查询出直接BeanCopy对象返回</p>
<h3 id="代码实现-4"><a href="#代码实现-4" class="headerlink" title="代码实现"></a>代码实现</h3><p>@Service(“linkService”)<br>public class LinkServiceImpl extends ServiceImpl&lt;LinkMapper, Link&gt; implements LinkService {</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getAllLink</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询所有审核通过的友链</span></span><br><span class="line">    LambdaQueryWrapper&lt;Link&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//要求查的是友链表status字段的值为0，注意SystemCanstants是我们写的一个常量类，用来解决字面值的书写问题</span></span><br><span class="line">    queryWrapper.eq(Link::getStatus, SystemCanstants.LINK_STATUS_NORMAL);</span><br><span class="line">    List&lt;Link&gt; links = list(queryWrapper);</span><br><span class="line">    <span class="comment">//把最后的查询结果封装成LinkListVo(我们写的实体类)。BeanCopyUtils是我们写的工具类</span></span><br><span class="line">    List&lt;LinkVo&gt; linkVos = BeanCopyUtils.copyBeanList(links, LinkVo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//封装响应返回。ResponseResult是我们在huanf-framework工程的domain目录写的实体类</span></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(linkVos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-登录功能"><a href="#博客前台模块-登录功能" class="headerlink" title="博客前台模块-登录功能"></a>博客前台模块-登录功能</h2><p>SpringSecrity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> 登录：通过过滤器，没有token放行，让他执行登录接口，去查询数据库，将数据库中的用户名、密码和权限信息放到loginuser中，登录管理器会通过BC密码验证规则去验证密码是否正确（管理器里面会首先把得到的密码BC处理，然后和UserDetails对比），正确将loginuser信息存到authiencation中返回，然后在里面获取token并返回给前端，loginuser信息放到redis中，以便于登录过得用户携带相关权限信息进行判断是否能执行相应操作，然后登录成功。                         接口：携带相关权限和token被jwt认证过滤器拦截，判断token是否正确，正确解析token获得登录用户id，然后从redis中获得相关权限信息集合，将权限信息和loginuser 保存到securitycontextholder中，然后放行后续过滤器会从securitycontextholder中获取相关信息选择放行             </span><br><span class="line">权限认证：将controller层接口上携带权限校验的权限信息，和securitycontextholder中的权限信息进行比对，有就返回true就有权限。                                   </span><br><span class="line">因为访问接口前需要经过jwt认证处理器，所以securitycontextholder中会有相关的权限信息拿来比对</span><br></pre></td></tr></table></figure>

<p>![aa6c0199e84c10e2958243224fef91d](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\aa6c0199e84c10e2958243224fef91d.jpg)</p>
<p>![42814ee71a38ad709bc8701bbf009ba](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\42814ee71a38ad709bc8701bbf009ba.jpg)</p>
<p>![92de010666bcc5d2a7a6d7c4ca5b396](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\92de010666bcc5d2a7a6d7c4ca5b396.jpg)</p>
<p>![d0ac7e0fda038b5244dbc9249db2bb2](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\d0ac7e0fda038b5244dbc9249db2bb2.png)</p>
<h3 id="接口分析-5"><a href="#接口分析-5" class="headerlink" title="接口分析"></a>接口分析</h3><p>请求体</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;userName&quot;:&quot;sg&quot;,</span><br><span class="line">    &quot;password&quot;:&quot;1234&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>响应格式</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0ODBmOThmYmJkNmI0NjM0OWUyZjY2NTM0NGNjZWY2NSIsInN1YiI6IjEiLCJpc3MiOiJzZyIsImlhdCI6MTY0Mzg3NDMxNiwiZXhwIjoxNjQzOTYwNzE2fQ.ldLBUvNIxQCGemkCoMgT_0YsjsWndTg5tqfJb77pabk&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;userInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F3bf9c263bc0f2ac5c3a7feb9e218d07475573ec8.gi&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;23412332@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg333&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>登录</p>
<p>​    ①自定义登录接口</p>
<p>​                调用ProviderManager的方法进行认证 如果认证通过生成jwt</p>
<p>​                把用户信息存入redis中</p>
<p>​    ②自定义UserDetailsService</p>
<p>​                在这个实现类中去查询数据库，返回UserDetails实现类对象</p>
<p>​    注意配置passwordEncoder为BCryptPasswordEncoder</p>
<p>UserDetails实现类对象的密码和Authentication密码相比较，相同将UserDetails实现类对象的权限信息交给Authentication对象</p>
<p>校验：</p>
<p>​    ①定义Jwt认证过滤器</p>
<p>​                获取token</p>
<p>​                解析token获取其中的userid</p>
<p>​                从redis中获取用户信息</p>
<p>​                存入SecurityContextHolder，以便后面过滤器拿来使用</p>
<p>配置</p>
<p>​     ① 登录管理器ProviderManager</p>
<p>​          BCryptPasswordEncoder密码校验</p>
<p>​           JWT认证过滤器</p>
<p>​           权限和认证异常处理器</p>
<p>​           crsf攻击</p>
<p>​            cors跨域</p>
<h3 id="代码实现-5"><a href="#代码实现-5" class="headerlink" title="代码实现"></a>代码实现</h3><p>登录接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/25$ 19:17$</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogLoginServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BlogLoginService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">usernamePasswordAuthenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(user.getUserName(),user.getPassword());</span><br><span class="line">        <span class="comment">//登录管理器,去帮我们校验密码和拿到权限</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authenticate</span> <span class="operator">=</span> authenticationManager.authenticate(usernamePasswordAuthenticationToken);</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(authenticate))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获得UserID，形成token</span></span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authenticate.getPrincipal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getUser().getId().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtil.createJWT(userId);</span><br><span class="line">        <span class="comment">//获得用户相关信息，存到Redis</span></span><br><span class="line">        redisCache.setCacheObject(<span class="string">&quot;bloglogin:&quot;</span>+userId,loginUser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先查询出用户信息</span></span><br><span class="line">        <span class="comment">//先将User封装成UserInfoVo</span></span><br><span class="line">        <span class="type">UserInfoVo</span> <span class="variable">userInfoVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(loginUser.getUser(), UserInfoVo.class);</span><br><span class="line">        <span class="comment">//在封装成BlogUserLoginVo返回</span></span><br><span class="line">        <span class="type">BlogUserLoginVo</span> <span class="variable">blogUserLoginVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogUserLoginVo</span>(token,userInfoVo);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(blogUserLoginVo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserDetailsService实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/25 21:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String userName)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="comment">//根据用户名查询用户信息</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(StringUtils.isNoneEmpty(userName),User::getUserName, userName);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectOne(wrapper);</span><br><span class="line">        <span class="comment">//如果查询不到数据就通过抛出异常来给出提示</span></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(user)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        List&lt;String&gt; arrayList = menuMapper.selectPermsByUserId(user.getId());</span></span><br><span class="line">        <span class="comment">//TODO 根据用户查询权限信息 添加到LoginUser中</span></span><br><span class="line">        <span class="comment">//封装成UserDetails对象返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginUser</span>(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>UserDetails</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.annotation.JSONField;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装数据库查询的用户名密码和权限信息，密码校验器会判断authentication中的密码和UserDetails的密码是否一样，一样就把权限存储到authentication中</span></span><br><span class="line"><span class="comment"> *   然后将token返回前端，将权限存到redis中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginUser</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getPassword();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getUserName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JWT认证过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.WebUtils;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首先执行这个</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(token)) &#123;</span><br><span class="line">            <span class="comment">//放行,后面会有过滤器过滤是否有用户信息</span></span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="comment">//return；回来后不想让它执行后面逻辑</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//解析token</span></span><br><span class="line">        String userId;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            claims = JwtUtil.parseJWT(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//未携带token</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line">        userId = claims.getSubject();</span><br><span class="line">        <span class="comment">//从redis中获取用户信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> <span class="string">&quot;bloglogin:&quot;</span> + userId;</span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> redisCache.getCacheObject(redisKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(loginUser)) &#123;</span><br><span class="line">            <span class="comment">//jwt已经过期，redis中获取信息为null</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存入SecurityContextHolder</span></span><br><span class="line">        <span class="comment">//TODO 获取权限信息封装Authentication</span></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">usernamePasswordAuthenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginUser, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);</span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>springSecurity配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*import com.sangeng.filter.JwtAuthenticationTokenFilter;</span></span><br><span class="line"><span class="comment">import com.sangeng.handle.AccessDeniedHandlerImpl;</span></span><br><span class="line"><span class="comment">import com.sangeng.handle.AuthenticationEntryPointImpl;*/</span></span><br><span class="line"><span class="keyword">import</span> com.sangeng.filter.JwtAuthenticationTokenFilter;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.handle.security.AccessDeniedHandlerImpl;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.handle.security.AuthenticationEntryPointImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.AuthenticationFailureHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 授权失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccessDeniedHandlerImpl accessDeniedHandler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 认证失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationEntryPointImpl authenticationEntryPoint;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                 <span class="comment">//关闭csrf</span></span><br><span class="line">                .csrf().disable()</span><br><span class="line">                 <span class="comment">//不通过Session获取SecurityContext</span></span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                 <span class="comment">// 对于登录接口 允许匿名访问 意思是未登录可以访问这个请求，登录成功不能访问这个请求</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/login&quot;</span>).anonymous()</span><br><span class="line">                <span class="comment">//需要登录才能访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/link/getAllLink&quot;</span>).authenticated()</span><br><span class="line">                 <span class="comment">// 除上面外的所有请求全部可以请求</span></span><br><span class="line">                .anyRequest().permitAll();</span><br><span class="line">        <span class="comment">//增加JWT过滤器</span></span><br><span class="line">        http.addFilterBefore(jwtAuthenticationTokenFilter,UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .accessDeniedHandler(accessDeniedHandler)   <span class="comment">//权限异常处理</span></span><br><span class="line">                .authenticationEntryPoint(authenticationEntryPoint);  <span class="comment">//认证异常处理</span></span><br><span class="line">        <span class="comment">//允许跨域</span></span><br><span class="line">        http.cors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * authenticationManager管理器，会去请求调用用户去查询数据库获得权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-异常处理"><a href="#博客前台模块-异常处理" class="headerlink" title="博客前台模块-异常处理"></a>博客前台模块-异常处理</h2><h3 id="认证授权的异常处理"><a href="#认证授权的异常处理" class="headerlink" title="认证授权的异常处理"></a>认证授权的异常处理</h3><p>主要处理业务层的异常</p>
<p>权限认证失败处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.WebUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.AccessDeniedException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.access.AccessDeniedHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 权限不足</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccessDeniedHandlerImpl</span> <span class="keyword">implements</span> <span class="title class_">AccessDeniedHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                       AccessDeniedException accessDeniedException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        accessDeniedException.printStackTrace();</span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NO_OPERATOR_AUTH);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line">        WebUtils.renderString(response, json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>认证失败处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.WebUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.BadCredentialsException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.InsufficientAuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.AuthenticationEntryPoint;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 认证失败，登录用户名密码错误</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationEntryPointImpl</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationEntryPoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object result;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        authException.printStackTrace();</span><br><span class="line">        <span class="comment">//InsufficientAuthenticationException</span></span><br><span class="line">        <span class="comment">//无授权，未登录</span></span><br><span class="line">        <span class="keyword">if</span> (authException <span class="keyword">instanceof</span> InsufficientAuthenticationException)&#123;</span><br><span class="line">            result =  ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//用户名密码错误</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (authException <span class="keyword">instanceof</span> BadCredentialsException)&#123;</span><br><span class="line">            result =  ResponseResult.errorResult(AppHttpCodeEnum.LOGIN_ERROR.getCode(),authException.getMessage());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            result =  ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR.getCode(),<span class="string">&quot;认证或授权失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line">        WebUtils.renderString(response, json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h3><p>主要处理controller层的异常</p>
<p>自定义异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.exception;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/25 21:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//自定义异常处理器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个构造方法，接收的参数是枚举类型，AppHttpCodeEnum是我们在sangeng-framework工程定义的枚举类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SystemException</span><span class="params">(AppHttpCodeEnum httpCodeEnum)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(httpCodeEnum.getMsg());</span><br><span class="line">        <span class="comment">//把某个枚举类里面的code和msg赋值给异常对象</span></span><br><span class="line">        <span class="built_in">this</span>.code = httpCodeEnum.getCode();</span><br><span class="line">        <span class="built_in">this</span>.msg = httpCodeEnum.getMsg();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>全局异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理类（处理controller层）</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/25$ 21:37$</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(SystemException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">exceptionHandler</span><span class="params">(SystemException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;出现了异常：&#123;&#125;&quot;</span>,e);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.errorResult(e.getCode(), e.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">exceptionHandler</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;出现了异常：&#123;&#125;&quot;</span>,e);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR.getCode(), e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-退出功能"><a href="#博客前台模块-退出功能" class="headerlink" title="博客前台模块-退出功能"></a>博客前台模块-退出功能</h2><h3 id="接口分析-6"><a href="#接口分析-6" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126110850159.png" alt="image-20231126110850159"></p>
<h3 id="思路分析-1"><a href="#思路分析-1" class="headerlink" title="思路分析"></a>思路分析</h3><p>直接从SecurityContextHolder中获取登录用户，然后拿到用户ID，删除redis中相关用户ID</p>
<h3 id="代码实现-6"><a href="#代码实现-6" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//从SecurityContextHolder中获取loginUser对象 //获取token，然后解析token值获取其中的userid。</span></span><br><span class="line">        <span class="comment">// SecurityContextHolder是security官方提供的类</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authentication.getPrincipal();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取用户ID</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getUser().getId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从redis中删除此用户ID的登录相关信息</span></span><br><span class="line">        redisCache.deleteObject(<span class="string">&quot;bloglogin:&quot;</span>+userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>注意在配置类中添加</p>
<p>让原本的Sringsecurity的退出登录方法失效</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 对于登录接口 允许匿名访问 意思是未登录可以访问这个请求，登录成功不能访问这个请求</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/login&quot;</span>).anonymous()</span><br><span class="line">                <span class="comment">//需要登录才能访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/logout&quot;</span>).authenticated()</span><br><span class="line"></span><br><span class="line">http.logout().disable();</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-评论列表"><a href="#博客前台模块-评论列表" class="headerlink" title="博客前台模块-评论列表*"></a>博客前台模块-评论列表*</h2><h3 id="接口分析-7"><a href="#接口分析-7" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126171216022.png" alt="image-20231126171216022"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126171245869.png" alt="image-20231126171245869"></p>
<h3 id="思路分析-2"><a href="#思路分析-2" class="headerlink" title="思路分析"></a>思路分析</h3><p>先查询所有根评论，再对已有的根评论，再去查询子评论</p>
<p>根评论 根据条件分页查询根评论的记录 但是创作人的姓名和回复某个人的姓名没有封装，所以需要对评论Vo再进行封装，注意要判断如果（回复：姓名）的id是-1的话，这个评论是根评论，所以不需要封装（回复：姓名）姓名   反之需要</p>
<p>子评论 对根评论的集合再进行封装，根据传入的某个评论id，然后去查询得到所有根评论为这个id的集合，然后对其（名字 回复：名字）名字进行封装</p>
<p>得到所有评论集合</p>
<h3 id="代码实现-7"><a href="#代码实现-7" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.CommentDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Comment;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.CommentVo;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.PageVo;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.CommentService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.BeanCopyUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评论表(Comment)表服务实现类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-11-26 14:37:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(&quot;commentService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CommentDao, Comment&gt; <span class="keyword">implements</span> <span class="title class_">CommentService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">// ----------------------------------------  评论列表   --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">commentList</span><span class="params">(Long articleId, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="comment">//创建条件</span></span><br><span class="line">        LambdaQueryWrapper&lt;Comment&gt; commentLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//文章id</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(articleId!=<span class="literal">null</span>&amp;&amp;articleId&gt;<span class="number">0</span>,Comment::getArticleId,articleId);</span><br><span class="line">        <span class="comment">//是根评论 -1</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(Comment::getRootId, SystemCanstants.COMMENT_ROOT);</span><br><span class="line">        <span class="comment">//分页</span></span><br><span class="line">        Page&lt;Comment&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">        page = page(page,commentLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取分页的评论信息</span></span><br><span class="line">        List&lt;Comment&gt; comments = page.getRecords();</span><br><span class="line">                 comments = comments.stream()</span><br><span class="line">                .sorted(Comparator.comparing(Comment::getCreateTime).reversed())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//封装评论表VO</span></span><br><span class="line">        List&lt;CommentVo&gt; commentVos = toCommentVos(comments);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询根评论下的子评论</span></span><br><span class="line">        commentVos = commentVos.stream().map(commentVo -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//查询哪一条评论所对应的子评论</span></span><br><span class="line">            List&lt;CommentVo&gt; children = getChildren(commentVo.getId());</span><br><span class="line">            commentVo.setChildren(children);</span><br><span class="line">            <span class="keyword">return</span> commentVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(<span class="keyword">new</span> <span class="title class_">PageVo</span>(commentVos,page.getTotal()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;CommentVo&gt; <span class="title function_">getChildren</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Comment&gt; commentLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//查询哪一id下所对应的子评论</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(Comment::getRootId,id);</span><br><span class="line">        <span class="comment">//对子评论按照时间进行排序</span></span><br><span class="line">        commentLambdaQueryWrapper.orderByDesc(Comment::getCreateTime);</span><br><span class="line">        List&lt;Comment&gt; comments = list(commentLambdaQueryWrapper);</span><br><span class="line">        List&lt;CommentVo&gt; commentVos = toCommentVos(comments);</span><br><span class="line">        <span class="keyword">return</span> commentVos;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;CommentVo&gt; <span class="title function_">toCommentVos</span><span class="params">(List&lt;Comment&gt; comments)</span> &#123;</span><br><span class="line">        List&lt;CommentVo&gt; commentVos = BeanCopyUtils.copyBeanList(comments, CommentVo.class);</span><br><span class="line">        <span class="comment">//遍历(可以用for循环，也可以用stream流)。由于封装响应好的数据里面没有username字段，所以我们还不能返回给前端。这个遍历就是用来得到username字段</span></span><br><span class="line">        commentVos = commentVos.stream().map(commentVo -&gt; &#123;</span><br><span class="line">            <span class="comment">//通过CreateBy查询用户的昵称 当前评论的创建人昵称</span></span><br><span class="line">            <span class="comment">//张三回复李四   张三</span></span><br><span class="line">            commentVo.setUsername(userService.getById(commentVo.getCreateBy()).getNickName());</span><br><span class="line">            <span class="comment">// 通过ToCommentUserId 不为-1才查询 就是有子评论   子评论的  =-1是根评论,不等于不是根评论</span></span><br><span class="line">            <span class="comment">//张三回复李四   李四</span></span><br><span class="line">            <span class="keyword">if</span> (commentVo.getToCommentUserId()!=-<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">nickName</span> <span class="operator">=</span> userService.getById(commentVo.getToCommentUserId()).getNickName();</span><br><span class="line">                commentVo.setToCommentUserName(nickName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> commentVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> commentVos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/26 14:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//文章id</span></span><br><span class="line">    <span class="keyword">private</span> Long articleId;</span><br><span class="line">    <span class="comment">//根评论id</span></span><br><span class="line">    <span class="keyword">private</span> Long rootId;</span><br><span class="line">    <span class="comment">//评论内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//发根评论的userid          张三回复了李四  toCommentUserId代表李四的用户id</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentUserId;</span><br><span class="line">    <span class="comment">//发根评论的userName        张三回复了李四  toCommentUserName代表李四的用户昵称</span></span><br><span class="line">    <span class="keyword">private</span> String toCommentUserName;</span><br><span class="line">    <span class="comment">//回复目标评论id            张三回复了李四的什么什么评论  toCommentId代表什么什么评论的ID</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentId;</span><br><span class="line">    <span class="comment">//当前评论的创建人id        最开始评论的创建人id</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//评论是谁发的              最开始评论的创建人昵称</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询子评论</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CommentVo&gt; children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-发送评论"><a href="#博客前台模块-发送评论" class="headerlink" title="博客前台模块-发送评论*"></a>博客前台模块-发送评论*</h2><h4 id="发送文章评论"><a href="#发送文章评论" class="headerlink" title="发送文章评论"></a>发送文章评论</h4><h5 id="接口分析-8"><a href="#接口分析-8" class="headerlink" title="接口分析"></a>接口分析</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126172635520.png" alt="image-20231126172635520"></p>
<h5 id="思路分析-3"><a href="#思路分析-3" class="headerlink" title="思路分析"></a>思路分析</h5><p>可以直接调用mp的save方法将信息保存，但是有的信息不能添加，比如更新人，插入时间等。</p>
<p>利用mp的自动填充可以实现，然后再评论表中的属性上添加@TableField(fill = FieldFill.INSERT)注解，代表再添加时自动填充</p>
<p>获取更新人id，可以在securitycontextholder中来获取，后面还有好多需要这个，直接封装工具类</p>
<h5 id="代码实现-8"><a href="#代码实现-8" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">addComment</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(comment.getContent())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.CONTENT_NOT_NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    save(comment);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>utils</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/26 18:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//在&#x27;发送评论&#x27;功能那里会用到的工具类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户的userid</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoginUser <span class="title function_">getLoginUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (LoginUser) getAuthentication().getPrincipal();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Authentication</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Authentication <span class="title function_">getAuthentication</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定userid为1的用户就是网站管理员</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">isAdmin</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> getLoginUser().getUser().getId();</span><br><span class="line">        <span class="keyword">return</span> id != <span class="literal">null</span> &amp;&amp; <span class="number">1L</span> == id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getLoginUser().getUser().getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mp自动填充</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.mp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/26 0026 20:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//这个类是用来配置mybatis的字段自动填充。用于&#x27;发送评论&#x27;功能，由于我们在评论表无法对下面这四个字段进行插入数据(原因是前端在发送评论时，没有在</span></span><br><span class="line"><span class="comment">//请求体提供下面四个参数，所以后端在往数据库插入数据时，下面四个字段是空值)，所有就需要这个类来帮助我们往下面这四个字段自动的插入值，</span></span><br><span class="line"><span class="comment">//只要我们更新了评论表的字段，那么无法插入值的字段就自动有值了</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//只要对数据库执行了插入语句，那么就会执行到这个方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//        try &#123;</span></span><br><span class="line">            <span class="comment">//获取用户id</span></span><br><span class="line">            userId = SecurityUtils.getUserId();</span><br><span class="line"><span class="comment">/*        &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">            e.printStackTrace();</span></span><br><span class="line"><span class="comment">            userId = -1L;//如果异常了，就说明该用户还没注册，我们就把该用户的userid字段赋值d为-1</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="comment">//自动把下面四个字段新增了值。</span></span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createBy&quot;</span>,userId , metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateBy&quot;</span>, userId, metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot; &quot;</span>, SecurityUtils.getUserId(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评论表(Comment)表实体类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-11-26 14:37:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sg_comment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Comment</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//评论类型（0代表文章评论，1代表友链评论）</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">//文章id</span></span><br><span class="line">    <span class="keyword">private</span> Long articleId;</span><br><span class="line">    <span class="comment">//根评论id</span></span><br><span class="line">    <span class="keyword">private</span> Long rootId;</span><br><span class="line">    <span class="comment">//评论内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//所回复的目标评论的userid</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentUserId;</span><br><span class="line">    <span class="comment">//回复目标评论id</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于我们在MyMetaObjectHandler类配置了mybatisplus的字段自动填充</span></span><br><span class="line">    <span class="comment">//所以就能指定哪个字段在什么时候进行自动填充，例如该类其它字段新增了数据，那么createBy字段就会自动填充值</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于我们在MyMetaObjectHandler类配置了mybatisplus的字段自动填充</span></span><br><span class="line">    <span class="comment">//所以就能指定哪个字段在什么时候进行自动填充，例如该类其它字段新增了数据，那么createTime字段就会自动填充值</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于我们在MyMetaObjectHandler类配置了mybatisplus的字段自动填充</span></span><br><span class="line">    <span class="comment">//所以就能指定哪个字段在什么时候进行自动填充，例如该类其它字段新增或更新了数据，那么createBy字段就会自动填充值</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于我们在MyMetaObjectHandler类配置了mybatisplus的字段自动填充</span></span><br><span class="line">    <span class="comment">//所以就能指定哪个字段在什么时候进行自动填充，例如该类其它字段新增或更新了数据，那么updateTime字段就会自动填充值</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除标志（0代表未删除，1代表已删除）</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="发送友链评论"><a href="#发送友链评论" class="headerlink" title="发送友链评论"></a>发送友链评论</h4><h5 id="接口分析-9"><a href="#接口分析-9" class="headerlink" title="接口分析"></a>接口分析</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126191211641.png" alt="image-20231126191211641"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126191242604.png" alt="image-20231126191242604"></p>
<h5 id="思路分析-4"><a href="#思路分析-4" class="headerlink" title="思路分析"></a>思路分析</h5><p>根据接口可以查看到，和文章评论共用一个接口，在接口的参数上可以加一个文章或者友链的type，然后再实现类里面对文章id（因为再评论表里面有个type分成友链和文章评论）和type类型进行判断</p>
<h5 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/linkCommentList&quot;)</span></span><br><span class="line">    <span class="comment">//在友链的评论区发送评论。ResponseResult是我们在huanf-framework工程写的类</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">linkCommentList</span><span class="params">(Integer pageNum,Integer pageSize)</span>&#123;</span><br><span class="line">        <span class="comment">//commentService是我们刚刚实现文章的评论区发送评论功能时(当时用的是addComment方法，现在用commentList方法)，写的类</span></span><br><span class="line">        <span class="comment">//SystemCanstants是我们写的用来解决字面值的常量类，Article_LINK代表1</span></span><br><span class="line">        <span class="keyword">return</span> commentService.commentList(SystemCanstants.LINK_COMMENT,<span class="literal">null</span>,pageNum,pageSize);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//评论列表</span></span><br><span class="line">    ResponseResult <span class="title function_">commentList</span><span class="params">(String type,Long articleId, Integer pageNum, Integer pageSize)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">commentList</span><span class="params">(String type, Long articleId, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="comment">//创建条件</span></span><br><span class="line">        LambdaQueryWrapper&lt;Comment&gt; commentLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//文章id</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(articleId!=<span class="literal">null</span>&amp;&amp;articleId&gt;<span class="number">0</span>,Comment::getArticleId,articleId);</span><br><span class="line">        <span class="comment">//是根评论 -1</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(Comment::getRootId, SystemCanstants.COMMENT_ROOT);</span><br><span class="line">        <span class="comment">//判断是哪个评论</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(Comment::getType,type);</span><br><span class="line">        <span class="comment">//分页</span></span><br><span class="line">        Page&lt;Comment&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">        page = page(page,commentLambdaQueryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-个人信息"><a href="#博客前台模块-个人信息" class="headerlink" title="博客前台模块-个人信息"></a>博客前台模块-个人信息</h2><h4 id="接口分析-10"><a href="#接口分析-10" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126194757170.png" alt="image-20231126194757170"></p>
<h4 id="思路分析-5"><a href="#思路分析-5" class="headerlink" title="思路分析"></a>思路分析</h4><p>此接口需要再登录之后才能访问，直接获取Security里面的用户id，根据id查询相关信息，并且封装Vo</p>
<h4 id="代码实现-9"><a href="#代码实现-9" class="headerlink" title="代码实现"></a>代码实现</h4><p>在SecurityConfig中配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//为方便测试查询个人信息，我们把查询个人信息的接口设置为需要登录才能访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/user/userInfo&quot;</span>).authenticated()</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  个人信息   --------------------------------------------------</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取userID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId().toString();</span><br><span class="line">        <span class="comment">//得到user对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(userId);</span><br><span class="line">        <span class="comment">//封装Vo返回</span></span><br><span class="line">        <span class="type">UserInfoVo</span> <span class="variable">userInfoVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(user, UserInfoVo.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(userInfoVo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="博客前台模块-文件上传"><a href="#博客前台模块-文件上传" class="headerlink" title="博客前台模块-文件上传*"></a>博客前台模块-文件上传*</h2><p>先解决头像上传</p>
<p><strong>为什么使用OSS？</strong></p>
<p>因为如果把图片视频等文件上传到自己的应用的Web服务器的某个目录下，在读取图片的时候会占用比较多的资源。影响应用服务器的性能。所以我们一般使用OSS(Object Storage Service对象存储服务)存储图片或视频</p>
<p>OSS</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126201236871.png" alt="image-20231126201236871"></p>
<p>用户—上传图片–&gt;Web服务器  —读取—&gt; 用户</p>
<h4 id="接口分析-11"><a href="#接口分析-11" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126211729011.png" alt="image-20231126211729011"></p>
<h4 id="思路分析-6"><a href="#思路分析-6" class="headerlink" title="思路分析"></a>思路分析</h4><p>先将图片上传到web服务器，然后传到oss，用户可直接浏览图片 注意上传需要multipart/form-data; 接口参数为 MultipartFile</p>
<p>需要判断文件类型的合法性和文件类型的大小是否合法，并且将文件名修改为日期+uuid+文件名后缀 密钥什么的保存在yml中，通过</p>
<p>代码@ConfigurationProperties(prefix = “myoss”)获取yml中信息，注意实体属性名需要和yml里面的一样 哦对，一定要加@Data注解，要不然属性值获取不了</p>
<h4 id="代码实现-10"><a href="#代码实现-10" class="headerlink" title="代码实现"></a>代码实现</h4><p>controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//上传头像</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">upload</span><span class="params">(MultipartFile img)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> upLoadService.upLoadImg(img);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>serviceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/27 15:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.QiniuException;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.http.Response;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Region;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.DefaultPutRet;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.handle.exception.SystemException;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.UpLoadService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.PathUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/27 15:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Data</span>  <span class="comment">//需要添加这个</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;myoss&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpLoadServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UpLoadService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bucket;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String yuming;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//上传头像</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">upLoadImg</span><span class="params">(MultipartFile img)</span> &#123;</span><br><span class="line">        <span class="comment">//TODO 判断文件类型或者文件大小</span></span><br><span class="line">        <span class="comment">//判断文件类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> img.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取文件大小</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">fileSize</span> <span class="operator">=</span> img.getSize();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对原始文件名进行判断大小。只能上传png或jpg文件</span></span><br><span class="line">        <span class="keyword">if</span> (!originalFilename.endsWith(<span class="string">&quot;.png&quot;</span>)&amp;&amp;!originalFilename.endsWith(<span class="string">&quot;.jpg&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.FILE_TYPE_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断文件大小是否超过2MB（2MB=2*1024*1024 bytes）</span></span><br><span class="line">        <span class="keyword">if</span> (fileSize &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">            <span class="comment">// 抛出文件大小超过限制的异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.FILE_SIZE_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//以上都通过则上传文件到七牛云OSS，并得到一个图片外链访问地址。PathUtil是我们在sangeng-framework工程写的工具类</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> PathUtils.generateFilePath(originalFilename);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将文件存到OSS</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> uploadOss(img,filePath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上传到七牛云</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadOss</span><span class="params">(MultipartFile img,String filePath)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构造一个带指定 Region 对象的配置类。你的七牛云OSS创建的是哪个区域的，那么就调用Region的什么方法即可</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Region.region1());</span><br><span class="line">        cfg.resumableUploadAPIVersion = Configuration.ResumableUploadAPIVersion.V2;<span class="comment">// 指定分片上传版本</span></span><br><span class="line">        <span class="type">UploadManager</span> <span class="variable">uploadManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadManager</span>(cfg);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> filePath;   <span class="comment">//七牛云里面的文件名</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//byte[] uploadBytes = &quot;hello qiniu cloud&quot;.getBytes(&quot;utf-8&quot;);</span></span><br><span class="line">            <span class="comment">//ByteArrayInputStream byteInputStream=new ByteArrayInputStream(uploadBytes);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//上面两行是官方写的(注释掉)，下面那几行是我们写的</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">xxinputStream</span> <span class="operator">=</span> img.getInputStream();</span><br><span class="line"></span><br><span class="line">            <span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, secretKey);</span><br><span class="line">            <span class="type">String</span> <span class="variable">upToken</span> <span class="operator">=</span> auth.uploadToken(bucket);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> uploadManager.put(xxinputStream, key, upToken, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">                <span class="comment">//解析上传成功的结果</span></span><br><span class="line">                <span class="type">DefaultPutRet</span> <span class="variable">putRet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">                System.out.println(<span class="string">&quot;上传成功! 生成的key是: &quot;</span> + putRet.key);</span><br><span class="line">                System.out.println(<span class="string">&quot;上传成功! 生成的hash是: &quot;</span> + putRet.hash);</span><br><span class="line">                <span class="keyword">return</span> yuming+key;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">                <span class="type">Response</span> <span class="variable">r</span> <span class="operator">=</span> ex.response;</span><br><span class="line">                System.err.println(r.toString());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.err.println(r.bodyString());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">                    <span class="comment">//ignore</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//ignore</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;www:&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>工具包（生成文件名）日期+uuid+后缀</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/29 0029 12:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//对原始文件名进行修改文件名，并修改存放目录</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PathUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateFilePath</span><span class="params">(String fileName)</span>&#123;</span><br><span class="line">        <span class="comment">//根据日期生成路径   2022/1/15/</span></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy/MM/dd/&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">datePath</span> <span class="operator">=</span> sdf.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="comment">//uuid作为文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">//后缀和文件后缀一致</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="comment">// test.jpg -&gt; .jpg</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileType</span> <span class="operator">=</span> fileName.substring(index);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>().append(datePath).append(uuid).append(fileType).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新个人信息"><a href="#更新个人信息" class="headerlink" title="更新个人信息"></a>更新个人信息</h4><h5 id="接口分析-12"><a href="#接口分析-12" class="headerlink" title="接口分析"></a>接口分析</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231127171117154.png" alt="image-20231127171117154"></p>
<h5 id="思路分析-7"><a href="#思路分析-7" class="headerlink" title="思路分析"></a>思路分析</h5><p>将数据封装到请求体内，后端接口从响应体中拿直接根据id进行更新</p>
<h5 id="代码实现-11"><a href="#代码实现-11" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updateById(user);</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-注册信息"><a href="#博客前台模块-注册信息" class="headerlink" title="博客前台模块-注册信息"></a>博客前台模块-注册信息</h2><h3 id="接口分析-13"><a href="#接口分析-13" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231127172135147.png" alt="image-20231127172135147"></p>
<h3 id="思路分析-8"><a href="#思路分析-8" class="headerlink" title="思路分析"></a>思路分析</h3><p>进行非空判断</p>
<p>进行是否重复判断</p>
<p>进行密码加密</p>
<p>存储数据库</p>
<h3 id="代码实现-12"><a href="#代码实现-12" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  注册个人信息   --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">register</span><span class="params">(User user)</span> &#123;</span><br><span class="line">       <span class="comment">//进行非空判断</span></span><br><span class="line">       <span class="comment">//对前端传过来的用户名进行非空判断，例如null、&quot;&quot;，就抛出异常</span></span><br><span class="line">       <span class="keyword">if</span>(!StringUtils.hasText(user.getUserName()))&#123;</span><br><span class="line">           <span class="comment">//SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.USERNAME_NOT_NULL);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//密码</span></span><br><span class="line">       <span class="keyword">if</span>(!StringUtils.hasText(user.getPassword()))&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.PASSWORD_NOT_NULL);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//邮箱</span></span><br><span class="line">       <span class="keyword">if</span>(!StringUtils.hasText(user.getEmail()))&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.EMAIL_NOT_NULL);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//昵称</span></span><br><span class="line">       <span class="keyword">if</span>(!StringUtils.hasText(user.getNickName()))&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.NICKNAME_NOT_NULL);</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="comment">/* //手机号码</span></span><br><span class="line"><span class="comment">       if(!StringUtils.hasText(user.getPhonenumber()))&#123;</span></span><br><span class="line"><span class="comment">           throw new SystemException(AppHttpCodeEnum.PHONENUMBER_NOT_NULL);</span></span><br><span class="line"><span class="comment">       &#125;*/</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//判断用户传给我们的用户名是否在数据库已经存在。userNameExist方法是下面定义的</span></span><br><span class="line">       <span class="keyword">if</span>(userNameExist(user.getUserName()))&#123;</span><br><span class="line">           <span class="comment">//SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.USERNAME_EXIST);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//判断用户传给我们的昵称是否在数据库已经存在。NickNameExist方法是下面定义的</span></span><br><span class="line">       <span class="keyword">if</span>(NickNameExist(user.getNickName()))&#123;</span><br><span class="line">           <span class="comment">//SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.NICKNAME_EXIST);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//判断用户传给我们的邮箱是否在数据库已经存在。NickNameExist方法是下面定义的</span></span><br><span class="line">       <span class="keyword">if</span>(EmailExist(user.getEmail()))&#123;</span><br><span class="line">           <span class="comment">//SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.EMAIL_EXIST);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">/*//判断用户传给我们的手机号码是否在数据库已经存在。PhonenumberExist方法是下面定义的</span></span><br><span class="line"><span class="comment">       if(PhonenumberExist(user.getPhonenumber()))&#123;</span></span><br><span class="line"><span class="comment">           //SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line"><span class="comment">           throw new SystemException(AppHttpCodeEnum.EMAIL_EXIST);</span></span><br><span class="line"><span class="comment">       &#125; */</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//经过上面的判断，可以确保用户传给我们的用户名和昵称是数据库不存在的，且相关字段都不为空。就可以存入数据库</span></span><br><span class="line">       <span class="comment">//注意用户传给我们的密码是明文，对于密码我们要转成密文之后再存入数据库。注意加密要和解密用同一套算法</span></span><br><span class="line">       <span class="comment">//在huanf-blog工程的securityConfig类里面有解密算法，当时我们写了一个passwordEncoder方法，并且注入到了spring容器</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">encodePassword</span> <span class="operator">=</span> passwordEncoder.encode(user.getPassword());<span class="comment">//加密</span></span><br><span class="line">       user.setPassword(encodePassword);</span><br><span class="line">       <span class="comment">//存入数据库。save方法是mybatisplus提供的方法</span></span><br><span class="line">       save(user);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//封装响应返回</span></span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//&#x27;判断用户传给我们的用户名是否在数据库已经存在&#x27; 的方法</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">userNameExist</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">       <span class="comment">//要知道是否存在，首先就是根据条件去数据库查</span></span><br><span class="line">       LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//拿用户写的用户名跟数据库里面的用户名进行比较</span></span><br><span class="line">       queryWrapper.eq(User::getUserName,userName);</span><br><span class="line">       <span class="comment">//如果大于0就说明从数据库查出来了，也就说明是已经存在数据库的</span></span><br><span class="line">       <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> count(queryWrapper) &gt; <span class="number">0</span>;</span><br><span class="line">       <span class="comment">//为true就说明已存在</span></span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//&#x27;判断用户传给我们的昵称是否在数据库已经存在&#x27; 的方法</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">NickNameExist</span><span class="params">(String nickName)</span> &#123;</span><br><span class="line">       <span class="comment">//要知道是否存在，首先就是根据条件去数据库查</span></span><br><span class="line">       LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//拿用户写的昵称跟数据库里面的昵称进行比较</span></span><br><span class="line">       queryWrapper.eq(User::getNickName,nickName);</span><br><span class="line">       <span class="comment">//如果大于0就说明从数据库查出来了，也就说明是已经存在数据库的</span></span><br><span class="line">       <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> count(queryWrapper) &gt; <span class="number">0</span>;</span><br><span class="line">       <span class="comment">//为true就说明已存在</span></span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//&#x27;判断用户传给我们的邮箱是否在数据库已经存在&#x27; 的方法</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">EmailExist</span><span class="params">(String email)</span> &#123;</span><br><span class="line">       <span class="comment">//要知道是否存在，首先就是根据条件去数据库查</span></span><br><span class="line">       LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//拿用户写的昵称跟数据库里面的昵称进行比较</span></span><br><span class="line">       queryWrapper.eq(User::getEmail,email);</span><br><span class="line">       <span class="comment">//如果大于0就说明从数据库查出来了，也就说明是已经存在数据库的</span></span><br><span class="line">       <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> count(queryWrapper) &gt; <span class="number">0</span>;</span><br><span class="line">       <span class="comment">//为true就说明已存在</span></span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* //&#x27;判断用户传给我们的手机号码是否在数据库已经存在&#x27; 的方法</span></span><br><span class="line"><span class="comment">   private boolean PhonenumberExist(String Phonenumber) &#123;</span></span><br><span class="line"><span class="comment">       //要知道是否存在，首先就是根据条件去数据库查</span></span><br><span class="line"><span class="comment">       LambdaQueryWrapper&lt;User&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();</span></span><br><span class="line"><span class="comment">       //拿用户写的手机号码跟数据库里面的手机号码进行比较</span></span><br><span class="line"><span class="comment">       queryWrapper.eq(User::getPhonenumber,Phonenumber);</span></span><br><span class="line"><span class="comment">       //如果大于0就说明从数据库查出来了，也就说明是已经存在数据库的</span></span><br><span class="line"><span class="comment">       boolean result = count(queryWrapper) &gt; 0;</span></span><br><span class="line"><span class="comment">       //为true就说明已存在</span></span><br><span class="line"><span class="comment">       return result;</span></span><br><span class="line"><span class="comment">   &#125;*/</span></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-日志记录"><a href="#博客前台模块-日志记录" class="headerlink" title="博客前台模块-日志记录*"></a>博客前台模块-日志记录*</h2><p>AOP实现日志记录</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231127210559511.png" alt="image-20231127210559511"></p>
<h3 id="思路分析-9"><a href="#思路分析-9" class="headerlink" title="思路分析"></a>思路分析</h3><p>相当于是对原有的功能进行增强。并且是批量的增强，这个时候就非常适合用AOP来进行实现。</p>
<h3 id="代码实现-13"><a href="#代码实现-13" class="headerlink" title="代码实现"></a>代码实现</h3><p>利用注解来实现</p>
<p>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SystemLog &#123;</span><br><span class="line">    String <span class="title function_">businessName</span><span class="params">()</span>;   <span class="comment">//业务的名字</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>切面类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/27 20:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.sangeng.annoation.SystemLog)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//切入点</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通知</span></span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">inform</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Object rel;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//执行目标方法前</span></span><br><span class="line">            handleBefore(joinPoint);</span><br><span class="line">            <span class="comment">//执行目标方法</span></span><br><span class="line">            rel = joinPoint.proceed();</span><br><span class="line">            <span class="comment">//执行目标方法后</span></span><br><span class="line">            handleAfter(rel);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 结束后换行</span></span><br><span class="line">            log.info(<span class="string">&quot;=======End=======&quot;</span> + System.lineSeparator());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleBefore</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        <span class="comment">//获取请求url</span></span><br><span class="line">        <span class="type">ServletRequestAttributes</span> <span class="variable">requestAttributeEvent</span> <span class="operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> requestAttributeEvent.getRequest();</span><br><span class="line">        <span class="comment">//获取描述信息</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取方法上注解的属性</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">businessName</span> <span class="operator">=</span> signature.getMethod().getAnnotation(SystemLog.class).businessName();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//signature 相当于一个完整的方法体</span></span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;=======Start=======&quot;</span>);</span><br><span class="line">        <span class="comment">// 打印请求 URL</span></span><br><span class="line">        log.info(<span class="string">&quot;URL : &#123;&#125;&quot;</span>, request.getRequestURL());</span><br><span class="line">        <span class="comment">// 打印描述信息</span></span><br><span class="line">        log.info(<span class="string">&quot;BusinessName : &#123;&#125;&quot;</span>, businessName);</span><br><span class="line">        <span class="comment">// 打印 Http method put</span></span><br><span class="line">        log.info(<span class="string">&quot;HTTP Method : &#123;&#125;&quot;</span>,request.getMethod());</span><br><span class="line">        <span class="comment">// 打印调用 controller 的全路径以及执行方法</span></span><br><span class="line">        log.info(<span class="string">&quot;Class Method : &#123;&#125;.&#123;&#125;&quot;</span>, signature.getDeclaringTypeName(), signature.getMethod().getName());</span><br><span class="line">        <span class="comment">// 打印请求的 IP</span></span><br><span class="line">        log.info(<span class="string">&quot;IP : &#123;&#125;&quot;</span>, request.getRemoteHost());</span><br><span class="line">        <span class="comment">// 打印请求入参</span></span><br><span class="line">        log.info(<span class="string">&quot;Request Args : &#123;&#125;&quot;</span>, JSON.toJSONString(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleAfter</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        <span class="comment">// 打印出参</span></span><br><span class="line">        log.info(<span class="string">&quot;Response : &#123;&#125;&quot;</span>, JSON.toJSONString(object));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更新个人信息</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;userInfo&quot;)</span></span><br><span class="line">    <span class="meta">@SystemLog(businessName = &quot;更新用户信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">updateUserInfo</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.updateUserInfo(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231127211017762.png" alt="image-20231127211017762"></p>
<h2 id="博客前台模块-更新浏览量"><a href="#博客前台模块-更新浏览量" class="headerlink" title="博客前台模块-更新浏览量*"></a>博客前台模块-更新浏览量*</h2><h3 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h3><p> 在用户浏览博文时要实现对应博客浏览量的增加</p>
<h3 id="思路分析-10"><a href="#思路分析-10" class="headerlink" title="思路分析"></a>思路分析</h3><p>我们只需要在每次用户浏览博客时更新对应的浏览数即可。 但是如果直接操作博客表的浏览量的话，在并发量大的情况下会出现什么问题呢？ 如何去优化呢？ </p>
<p>（因为要更新浏览量的话，会加写锁，只能一个用户占用一条记录，其他不能修改，这就得考虑并发）</p>
<p>①在应用启动时把博客的浏览量存储到redis中 </p>
<p>②更新浏览量时去更新redis中的数据</p>
<p> ③每隔10分钟把Redis中的浏览量更新到数据库中 </p>
<p>④读取文章浏览量时从redis读取</p>
<h3 id="铺垫知识"><a href="#铺垫知识" class="headerlink" title="铺垫知识"></a>铺垫知识</h3><p>①CommandLineRunner实现项目启动时预处理 实现此接口，并加入容器</p>
<p> ③定时任务</p>
<p>定时任务的实现方式有很多，比如XXL-Job等。但是其实核心功能和概念都是类似的，很多情况下只是调 用的API不同而已。 这里就先用SpringBoot为我们提供的定时任务的API来实现一个简单的定时任务，让大家先对定时任务 里面的一些核心概念有个大致的了解。 实现步骤 ① 使用@EnableScheduling注解开启定时任务功能 我们可以在配置类上加上@EnableScheduling</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.sangeng.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SanGengBlogApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(SanGengBlogApplication.class,args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>确定定时任务执行代码，并配置任务执行时间 使用@Scheduled注解标识需要定时执行的代码。注解的cron属性相当于是任务的执行时间。目前可以 使用 0/5 * * * * ? 进行测试，代表从0秒开始，每隔5秒执行一次。 注意：对应的bean要注入容器，否则不会生效。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJob</span> &#123;</span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJob</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//要执行的代码</span></span><br><span class="line">System.out.println(<span class="string">&quot;定时任务执行了&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>corn定时任务表达式</p>
<h3 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231128134903314.png" alt="image-20231128134903314"></p>
<h3 id="代码实现-14"><a href="#代码实现-14" class="headerlink" title="代码实现"></a>代码实现</h3><p>将数据库存到redis中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.runner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.ArticleDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Article;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.ArticleService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在启动项目后将文章id和浏览量存到redis中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewCountRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleDao articleDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO ① 将数据库中文章的浏览量存到redis中</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//首先获取所有文章的浏览量</span></span><br><span class="line">        List&lt;Article&gt; articles = articleDao.selectList(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Integer&gt; viewCounts = articles.stream().collect(Collectors.toMap(article -&gt; article.getId().toString(), article -&gt; article.getViewCount().intValue()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//然后调用rediscache方法将id和浏览量存到redis中</span></span><br><span class="line">        redisCache.setCacheMap(SystemCanstants.VIEW_COUNT_KEY,viewCounts);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>更新浏览量数据到redis中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  更新浏览量到redis   --------------------------------------------------</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updateViewCount</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据id从redis中更新浏览量</span></span><br><span class="line">    redisCache.updateCacheMap(SystemCanstants.VIEW_COUNT_KEY,id.toString(),SystemCanstants.UPDATE_VIEW_COUNT);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>redisCache</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新Map的value值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hashKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCacheMap</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String hashKey, Integer value)</span>&#123;</span><br><span class="line">    redisTemplate.opsForHash().increment(key,hashKey,value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将redis中数据定时推送到数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.job;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Article;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.ArticleService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * //TODO 后面改为MQ消息队列</span></span><br><span class="line"><span class="comment"> *  定时 每5min将Redis中的ViewCount更新到数据库中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/28 14:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateViewCount</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0/5 * * * ?  &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateViewCount</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//首先在Redis中将所有数据拿出来</span></span><br><span class="line">        <span class="comment">//获取所有的key</span></span><br><span class="line">        Map&lt;String, Integer&gt; viewCountMap = redisCache.getCacheMap(SystemCanstants.VIEW_COUNT_KEY);</span><br><span class="line">        <span class="comment">//封装成单列集合</span></span><br><span class="line">        List&lt;Article&gt; articles = viewCountMap.entrySet().stream()</span><br><span class="line">                .map(vv -&gt; &#123;</span><br><span class="line">                    <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Article</span>();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> vv.getKey();</span><br><span class="line">                    <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> vv.getValue();</span><br><span class="line">                    article.setId(Integer.valueOf(id).longValue());</span><br><span class="line">                    article.setViewCount(viewCount.longValue());</span><br><span class="line">                    <span class="keyword">return</span> article;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//然后根据每个id将浏览量更新到数据库中</span></span><br><span class="line">        articleService.updateBatchById(articles);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在redis中查看浏览量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  热门文章   --------------------------------------------------</span></span><br><span class="line"><span class="comment">//在调用这个方法的时候，先直接将redis中的数据更新到数据库中，不用管是否定时任务更新到这个数据，然后在查询数据库</span></span><br><span class="line"><span class="comment">// 避免了数据不一致问题</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">hotArticleList</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取所有的key</span></span><br><span class="line">    Map&lt;String, Integer&gt; viewCountMap = redisCache.getCacheMap(SystemCanstants.VIEW_COUNT_KEY);</span><br><span class="line">    <span class="comment">//封装成单列集合</span></span><br><span class="line">    List&lt;Article&gt; articles = viewCountMap.entrySet().stream()</span><br><span class="line">        .map(vv -&gt; &#123;</span><br><span class="line">            <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Article</span>();</span><br><span class="line">            <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> vv.getKey();</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> vv.getValue();</span><br><span class="line">            article.setId(Integer.valueOf(id).longValue());</span><br><span class="line">            article.setViewCount(viewCount.longValue());</span><br><span class="line">            <span class="keyword">return</span> article;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">//然后根据每个id将浏览量更新到数据库中</span></span><br><span class="line">    updateBatchById(articles);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构建查询</span></span><br><span class="line">    LambdaQueryWrapper&lt;Article&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//非草稿</span></span><br><span class="line">    lambdaQueryWrapper.eq(Article::getStatus, SystemCanstants.ARTICLE_STATUS_NORMAL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//浏览量排前10</span></span><br><span class="line">    lambdaQueryWrapper.orderByDesc(Article::getViewCount);</span><br><span class="line"></span><br><span class="line">    Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>(SystemCanstants.ARTICLE_STATUS_CURRENT, SystemCanstants.ARTICLE_STATUS_SIZE);</span><br><span class="line">    page(page, lambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到分页拿到的热门文章集合数据</span></span><br><span class="line">    List&lt;Article&gt; hotArticleList = page.getRecords();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//封装成前端需要的数据 HotArticleVo</span></span><br><span class="line">    <span class="comment">//通过调用BeanCopyUtils工具类进行BeanCopy</span></span><br><span class="line">    List&lt;HotArticleVo&gt; hotArticleVos = BeanCopyUtils.copyBeanList(hotArticleList, HotArticleVo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回</span></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(hotArticleVos);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------  文章列表   --------------------------------------------------</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">articleList</span><span class="params">(Long pageNum,Long pageSize,Long categoryId)</span> &#123;</span><br><span class="line">    <span class="comment">//构建查询条件</span></span><br><span class="line">    LambdaQueryWrapper&lt;Article&gt; articleLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//已发布的文章</span></span><br><span class="line">    articleLambdaQueryWrapper.eq(Article::getStatus,SystemCanstants.ARTICLE_STATUS_NORMAL);</span><br><span class="line">    <span class="comment">//置顶的文章在上面</span></span><br><span class="line">    articleLambdaQueryWrapper.orderByDesc(Article::getIsTop);</span><br><span class="line">    <span class="comment">//按分类ID查询</span></span><br><span class="line">    articleLambdaQueryWrapper.eq(Objects.nonNull(categoryId)&amp;&amp;categoryId&gt;<span class="number">0</span>,Article::getCategoryId,categoryId);</span><br><span class="line">    <span class="comment">//分页查询</span></span><br><span class="line">    Page&lt;Article&gt; articlePage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">    articlePage = page(articlePage,articleLambdaQueryWrapper);</span><br><span class="line">    List&lt;Article&gt; articles = articlePage.getRecords();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询categoryName</span></span><br><span class="line">    articles = articles.stream().map(article -&gt; &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//从redis中获取浏览量</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> redisCache.getCacheMapValue(SystemCanstants.VIEW_COUNT_KEY, article.getId().toString());</span><br><span class="line">        article.setViewCount(viewCount.longValue());</span><br><span class="line"></span><br><span class="line">        article.setCategoryName(categoryService.getById(article.getCategoryId()).getName());</span><br><span class="line">        <span class="keyword">return</span> article;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">//封装VO</span></span><br><span class="line">    List&lt;ArticleListVo&gt; articleListVos = BeanCopyUtils.copyBeanList(articlePage.getRecords(), ArticleListVo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//封装PageVo对象</span></span><br><span class="line">    <span class="type">PageVo</span> <span class="variable">pageVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>(articleListVos, articlePage.getTotal());</span><br><span class="line">    <span class="comment">//返回对象</span></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(pageVO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------  文章详情   --------------------------------------------------</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getArticleDetail</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">ArticleDetailVo</span> <span class="variable">articleDetailVo</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (Objects.nonNull(id) &amp;&amp; id &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//根据id查询</span></span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从redis中获取浏览量</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> redisCache.getCacheMapValue(SystemCanstants.VIEW_COUNT_KEY, id.toString());</span><br><span class="line">        article.setViewCount(viewCount.longValue());</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> article.getCategoryId();</span><br><span class="line">        <span class="comment">//查询分类名</span></span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">        <span class="keyword">if</span> (category!=<span class="literal">null</span>) &#123;</span><br><span class="line">            article.setCategoryName(category.getName());</span><br><span class="line">            <span class="comment">//封装VO</span></span><br><span class="line">            articleDetailVo = BeanCopyUtils.copyBean(article, ArticleDetailVo.class);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回结果</span></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(articleDetailVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h2><p>引入POM依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<p>在启动类添加@EnableSwagger2注解</p>
<p>Controller层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;用户信息&quot;,description = &quot;用户信息相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;更新个人信息&quot;,notes = &quot;获取个人的相关信息&quot;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接口参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiImplicitParam(name = &quot;user&quot;,value = &quot;更新的用户信息&quot;)</span></span><br></pre></td></tr></table></figure>

<p>实体类，最好封装前端传过来的参数 dto</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModel(value = &quot;增加评论DTO&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddCommentDto</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>实体类属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//评论类型（0代表文章评论，1代表友链评论）</span></span><br><span class="line"><span class="meta">@ApiModelProperty(&quot;0代表文章评论，1代表友链评论&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String type;</span><br></pre></td></tr></table></figure>

<p>文档信息</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231128203652811.png" alt="image-20231128203652811"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicates;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/28 20:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//标识为配置类</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span> <span class="comment">//开启swagger，即可通过swagger为sangeng-blog工程生成接口文档</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">customDocket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//只监控com.sangeng.controller包的api</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sangeng.controller&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 对所有api进行监控</span></span><br><span class="line">                <span class="comment">//.apis(RequestHandlerSelectors.any())</span></span><br><span class="line">                <span class="comment">//不显示错误的接口地址，也就是错误路径不监控</span></span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/error.*&quot;</span>)))</span><br><span class="line"></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Contact</span> <span class="variable">contact</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;久违&quot;</span>, <span class="string">&quot;https://mykang2003.github.io&quot;</span>, <span class="string">&quot;501858029@qq.com&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;博客前台文档&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;博客前台文档&quot;</span>)</span><br><span class="line">                .contact(contact)   <span class="comment">// 联系方式</span></span><br><span class="line">                .version(<span class="string">&quot;1.1.1&quot;</span>)  <span class="comment">// 版本</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231128203712544.png" alt="image-20231128203712544"></p>
<h2 id="博客后台模块-测试"><a href="#博客后台模块-测试" class="headerlink" title="博客后台模块-测试"></a>博客后台模块-测试</h2><h2 id="博客后台模块-登录"><a href="#博客后台模块-登录" class="headerlink" title="博客后台模块-登录"></a>博客后台模块-登录</h2><h3 id="接口分析-14"><a href="#接口分析-14" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231129163739057.png" alt="image-20231129163739057"></p>
<h3 id="解决思路-5"><a href="#解决思路-5" class="headerlink" title="解决思路"></a>解决思路</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231129162352039.png" alt="image-20231129162352039"></p>
<h3 id="代码实现-15"><a href="#代码实现-15" class="headerlink" title="代码实现"></a>代码实现</h3><p>jwt认证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.WebUtils;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JWT认证过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>            <span class="comment">//未携带token</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(token)) &#123;</span><br><span class="line">            <span class="comment">//放行,后面会有过滤器过滤是否有用户信息</span></span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="comment">//return；回来后不想让它执行后面逻辑</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//解析token</span></span><br><span class="line">        String userId;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            claims = JwtUtil.parseJWT(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line">        userId = claims.getSubject();</span><br><span class="line">        <span class="comment">//从redis中获取用户信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> <span class="string">&quot;adminbloglogin:&quot;</span> + userId;</span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> redisCache.getCacheObject(redisKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(loginUser)) &#123;</span><br><span class="line">            <span class="comment">//jwt已经过期，redis中获取信息为null</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存入SecurityContextHolder</span></span><br><span class="line">        <span class="comment">//TODO 获取权限信息封装Authentication</span></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">usernamePasswordAuthenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginUser, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);</span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>登录接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.BlogUserLoginVo;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.UserInfoVo;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.AdminBlogLoginService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.BeanCopyUtils;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 博客后台登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminBlogLoginServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AdminBlogLoginService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ----------------------------------------  登录   --------------------------------------------------</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">usernamePasswordAuthenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(user.getUserName(),user.getPassword());</span><br><span class="line">        <span class="comment">//登录管理器,去帮我们校验密码和拿到权限</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authenticate</span> <span class="operator">=</span> authenticationManager.authenticate(usernamePasswordAuthenticationToken);</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(authenticate))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获得UserID，形成token</span></span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authenticate.getPrincipal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getUser().getId().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtil.createJWT(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得用户相关信息，存到Redis</span></span><br><span class="line">        redisCache.setCacheObject(<span class="string">&quot;adminbloglogin:&quot;</span>+userId,loginUser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装Map集合给前端响应</span></span><br><span class="line">        Map&lt;String,String&gt; tokenMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        tokenMap.put(<span class="string">&quot;token&quot;</span>,token);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(tokenMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ----------------------------------------  退出登录  --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//从SecurityContextHolder中获取loginUser对象 //获取token，然后解析token值获取其中的userid。</span></span><br><span class="line">        <span class="comment">// SecurityContextHolder是security官方提供的类</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//直接调用SecurityUtils方法   获取用户ID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从redis中删除此用户ID的登录相关信息</span></span><br><span class="line">        redisCache.deleteObject(<span class="string">&quot;adminbloglogin:&quot;</span>+userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(AppHttpCodeEnum.SUCCESS.getCode(),<span class="string">&quot;注销成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>userDetails和前面一样</p>
<h2 id="博客后台模块-后台权限控制"><a href="#博客后台模块-后台权限控制" class="headerlink" title="*博客后台模块-后台权限控制"></a>*博客后台模块-后台权限控制</h2><h3 id="接口分析-15"><a href="#接口分析-15" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231129171606246.png" alt="image-20231129171606246"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231129190408032.png" alt="image-20231129190408032"></p>
<h3 id="思路分析-11"><a href="#思路分析-11" class="headerlink" title="思路分析"></a>思路分析</h3><p>查询登录的用户的权限，角色，和用户的信息</p>
<p>获取登录的id，如果是管理员1，就直接查询管理员为1的权限，并且需要有菜单为C或者按钮为F的条件和权限正常的权限列表。如果是普通用户，就连表查询所对应的用户的权限，并且也要有C和F的条件和权限正常的</p>
<p>查询角色，如果是管理员直接返回admin，如果是普通用户，就去连表查询用户的角色的名称</p>
<h3 id="代码实现-16"><a href="#代码实现-16" class="headerlink" title="代码实现"></a>代码实现</h3><p>查询权限信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.MenuDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Menu;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.MenuService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/8/4 0004 13:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MenuServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;MenuDao, Menu&gt; <span class="keyword">implements</span> <span class="title class_">MenuService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//查询用户的权限信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">selectPermsByUserId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//根据用户id查询用户的权限信息。用户id为id代表管理员，如果是管理员就返回所有的权限</span></span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">1L</span>)&#123;</span><br><span class="line">            LambdaQueryWrapper&lt;Menu&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            <span class="comment">//查询条件是permissions中需要有所有菜单类型为C或者F的权限。SystemCanstants是我们在huanf-framework工程写的类</span></span><br><span class="line">            wrapper.in(Menu::getMenuType, SystemCanstants.TYPE_MENU,SystemCanstants.TYPE_BUTTON);</span><br><span class="line">            <span class="comment">//查询条件是permissions中需要有状态为正常的权限。SystemCanstants是我们在huanf-framework工程写的类</span></span><br><span class="line">            wrapper.eq(Menu::getStatus,SystemCanstants.MENU_STATUS_NORMAL);</span><br><span class="line">            <span class="comment">//查询条件是permissions中需要未被删除的权限的权限</span></span><br><span class="line">            List&lt;Menu&gt; menus = list(wrapper);</span><br><span class="line">            List&lt;String&gt; perms = menus.stream()</span><br><span class="line">                    .map(Menu::getPerms)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">return</span> perms;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果不是管理员就返回对应用户所具有的权限</span></span><br><span class="line">        List&lt;String&gt; otherPerms = getBaseMapper().selectPermsByOtherUserId(id);</span><br><span class="line">        <span class="keyword">return</span> otherPerms;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sangeng.dao.MenuDao&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectPermsByOtherUserId&quot;</span> resultType=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span><br><span class="line">        SELECT</span><br><span class="line">            DISTINCT m.perms</span><br><span class="line">        FROM</span><br><span class="line">            `sys_user_role` ur</span><br><span class="line">                LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`</span><br><span class="line">                LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`</span><br><span class="line">        WHERE</span><br><span class="line">            ur.`user_id` = #&#123;userId&#125; AND</span><br><span class="line">            m.`menu_type` IN (<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;F&#x27;</span>) AND</span><br><span class="line">            m.`status` = <span class="number">0</span> AND</span><br><span class="line">            m.`del_flag` = <span class="number">0</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>



<p>查询角色信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.RoleDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Role;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/8/4 0004 13:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;RoleDao, Role&gt; <span class="keyword">implements</span> <span class="title class_">RoleService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//查询用户的角色信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">selectRoleKeyByUserId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//判断是否是管理员，如果是，就返回集合中只需要有admin</span></span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">1L</span>)&#123;</span><br><span class="line">            List&lt;String&gt; roleKeys = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            roleKeys.add(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> roleKeys;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//否则查询对应普通用户所具有的的角色信息</span></span><br><span class="line">        List&lt;String&gt; otherRole = getBaseMapper().selectRoleKeyByOtherUserId(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> otherRole;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sangeng.dao.RoleDao&quot;</span>&gt;</span><br><span class="line">    &lt;!--MenuMapper接口的映射文件--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectRoleKeyByOtherUserId&quot;</span> resultType=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span><br><span class="line">        SELECT</span><br><span class="line">            r.`role_key`</span><br><span class="line">        FROM</span><br><span class="line">            `sys_user_role` ur</span><br><span class="line">                LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id`</span><br><span class="line">        WHERE</span><br><span class="line">            ur.`user_id` = #&#123;userId&#125; AND</span><br><span class="line">            r.`status` = <span class="number">0</span> AND</span><br><span class="line">            r.`del_flag` = <span class="number">0</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------------查询(超级管理员|非超级管理员)的权限和角色信息------------------------------------------</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/getInfo&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult&lt;AdminUserInfoVo&gt; <span class="title function_">getInfo</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//获取当前登录的用户。SecurityUtils是我们在huanf-framework写的类</span></span><br><span class="line">       <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> SecurityUtils.getLoginUser();</span><br><span class="line">       <span class="comment">//根据用户id查询权限信息</span></span><br><span class="line">       List&lt;String&gt; perms = menuService.selectPermsByUserId(loginUser.getUser().getId());</span><br><span class="line">       <span class="comment">//根据用户id查询角色信息</span></span><br><span class="line">       List&lt;String&gt; roleKeyList = roleService.selectRoleKeyByUserId(loginUser.getUser().getId());</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取用户信息</span></span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> loginUser.getUser();</span><br><span class="line">       <span class="comment">//BeanCopyUtils是我们在huanf-framework写的类</span></span><br><span class="line">       <span class="type">UserInfoVo</span> <span class="variable">userInfoVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(user, UserInfoVo.class);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//封装响应返回</span></span><br><span class="line">       <span class="type">AdminUserInfoVo</span> <span class="variable">adminUserInfoVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminUserInfoVo</span>(perms,roleKeyList,userInfoVo);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult(adminUserInfoVo);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="动态路由"><a href="#动态路由" class="headerlink" title="*动态路由"></a>*动态路由</h2><p>实现了这个动态路由功能之后，就能在浏览器web页面登录进博客管理后台了，小期待不是</p>
<h3 id="接口分析-16"><a href="#接口分析-16" class="headerlink" title="接口分析"></a>接口分析</h3><p>接口设计。后台系统需要能实现不同的用户权限可以看到不同的功能，即左侧的导航栏</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>/getRouters</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>响应格式如下: 前端为了实现动态路由的效果，需要后端有接口能返回用户所能访问的菜单数据。注意: 返回的菜单数据需要体现父子菜单的层级关系</p>
<p>如果用户id为1代表管理员，menus中需要有所有菜单类型为C或者M的，C表示菜单，M表示目录，状态为正常的，未被删除的权限</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;menus&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;content/article/write/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-01-08 11:39:58&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2023</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;写博文&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;write&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;content:article:writer&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/user/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:user:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/role/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;peoples&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">101</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;role&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:role:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/menu/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;tree-table&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">102</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;menu&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:menu:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span></span><br><span class="line">				<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;系统管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;M&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><p>先判断是不是管理员，先找出管理员的所有菜单，或者是普通用户的所具有的所有菜单</p>
<p>然后对这些菜单进行建树，先筛选出父菜单为0的，它就是第一层菜单，然后找到他的菜单id（设为第一层菜单id）。在遍历一遍集合，找出父菜单为第一层菜单id的所有菜单，将这个集合赋值给第一层菜单的children</p>
<h3 id="实现代码-1"><a href="#实现代码-1" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//查询用户路由信息，也就是权限信息,包括父子目录</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Menu&gt; <span class="title function_">selectRouterMenuTreeByUserId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">MenuDao</span> <span class="variable">menuDao</span> <span class="operator">=</span> getBaseMapper();</span><br><span class="line">        List&lt;Menu&gt; menus = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是否是超级管理员，用户id为1表示超级管理员，如果是就返回所有要求的权限菜单,不是的话就找到对应的角色所能显示的菜单</span></span><br><span class="line">        <span class="comment">//然后在将这个树进行父子排列</span></span><br><span class="line">        <span class="keyword">if</span> (SecurityUtils.isAdmin())&#123;</span><br><span class="line">            menus = menuDao.selectAllRouterMenu();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            menus = menuDao.selectOtherRouterMenuTreeByUserId(id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建成树，也就是子父菜单树，有层级关系</span></span><br><span class="line">        <span class="comment">//先找出第一层的菜单，然后找第二层的菜单，将第二层菜单结果赋值给Menu类的child</span></span><br><span class="line">        List&lt;Menu&gt; menuTree = buildMenuTree(menus,<span class="number">0L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> menuTree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先找出第一层的菜单，然后找出他的子菜单（其他菜单是其id的菜单）设置到children属性中</span></span><br><span class="line">    <span class="comment">//找出父menu，查询他的子menu</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Menu&gt; <span class="title function_">buildMenuTree</span><span class="params">(List&lt;Menu&gt; menus, <span class="type">long</span> parentId)</span> &#123;</span><br><span class="line">        <span class="comment">//过滤找出父菜单，也就是第一层 父菜单等于0的话就是父目录</span></span><br><span class="line">        List&lt;Menu&gt; menuTree = menus.stream().filter(menu -&gt; menu.getParentId().equals(parentId))</span><br><span class="line">                <span class="comment">//获取父id是0的菜单集合，将设置到children属性中  可以找出菜单id为1,parentId为0的菜单</span></span><br><span class="line">                .map(menu -&gt; menu.setChildren(getChildren(menu, menus))) <span class="comment">//获取Menu集合 再将菜单100 101 102菜单设置到菜单为1的children中</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> menuTree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;Menu&gt; <span class="title function_">getChildren</span><span class="params">(Menu menu, List&lt;Menu&gt; menus)</span> &#123;  <span class="comment">//menu菜单id为1</span></span><br><span class="line">        List&lt;Menu&gt; childrenList = menus.stream()   <span class="comment">//通过上面传过来的是父目录了，然后查所有的父目录是他的id</span></span><br><span class="line">                .filter(menu1 -&gt; menu1.getParentId().equals(menu.getId()))  <span class="comment">//在这找出父类菜单id为1的菜单</span></span><br><span class="line">                .map(menu1 -&gt; menu1.setChildren(getChildren(menu1, menus)))<span class="comment">//如果有三层菜单的话，也就是子菜单的子菜单，我们就用下面那行递归(自己调用自己)来处理</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> childrenList;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Accessors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 菜单权限表(Menu)表实体类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-08-04 13:20:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sys_menu&quot;)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span> <span class="comment">//允许链式编程  ，set get会有返回值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Menu</span>  &#123;</span><br><span class="line">    <span class="comment">//菜单ID</span></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜单名称</span></span><br><span class="line">    <span class="keyword">private</span> String menuName;</span><br><span class="line">    <span class="comment">//父菜单ID</span></span><br><span class="line">    <span class="keyword">private</span> Long parentId;</span><br><span class="line">    <span class="comment">//显示顺序</span></span><br><span class="line">    <span class="keyword">private</span> Integer orderNum;</span><br><span class="line">    <span class="comment">//路由地址</span></span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line">    <span class="comment">//组件路径</span></span><br><span class="line">    <span class="keyword">private</span> String component;</span><br><span class="line">    <span class="comment">//是否为外链（0是 1否）</span></span><br><span class="line">    <span class="keyword">private</span> Integer isFrame;</span><br><span class="line">    <span class="comment">//菜单类型（M目录 C菜单 F按钮）</span></span><br><span class="line">    <span class="keyword">private</span> String menuType;</span><br><span class="line">    <span class="comment">//菜单状态（0显示 1隐藏）</span></span><br><span class="line">    <span class="keyword">private</span> String visible;</span><br><span class="line">    <span class="comment">//菜单状态（0正常 1停用）</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">//权限标识</span></span><br><span class="line">    <span class="keyword">private</span> String perms;</span><br><span class="line">    <span class="comment">//菜单图标</span></span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line">    <span class="comment">//创建者</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    <span class="comment">//创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">//更新者</span></span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line">    <span class="comment">//更新时间</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="comment">//备注</span></span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String delFlag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于数据库没有children字段，所以我们要添加@TableField(exist = false)注解让mybatis在查表时不查询这个字段</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Menu&gt; children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后端把long类型转换为String类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将long类型转化为字符串类型，避免因前端js的长度而导致long类型精度丢失</span></span><br><span class="line">       SerializeConfig.globalInstance.put(Long.class, ToStringSerializer.instance);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>分页total数是long，但是前端要显示数字，所以在前端拦截器地方，在配置一下，字符串转为Long类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//把字符串total 转换成 数字 total</span></span><br><span class="line">    <span class="keyword">if</span> (res.data.data &amp;&amp; res.data.data.total) &#123;</span><br><span class="line">      res.data.data.total = parseInt(res.data.data.total)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.data.data</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130131652659.png" alt="image-20231130131652659"></p>
<h2 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// ----------------------------------------  退出登录  --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//从SecurityContextHolder中获取loginUser对象 //获取token，然后解析token值获取其中的userid。</span></span><br><span class="line">        <span class="comment">// SecurityContextHolder是security官方提供的类</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//直接调用SecurityUtils方法   获取用户ID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从redis中删除此用户ID的登录相关信息</span></span><br><span class="line">        redisCache.deleteObject(<span class="string">&quot;adminbloglogin:&quot;</span>+userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(AppHttpCodeEnum.SUCCESS.getCode(),<span class="string">&quot;注销成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="标签列表"><a href="#标签列表" class="headerlink" title="标签列表"></a>标签列表</h2><h3 id="查询标签"><a href="#查询标签" class="headerlink" title="查询标签"></a>查询标签</h3><h4 id="需求-amp-接口设计"><a href="#需求-amp-接口设计" class="headerlink" title="需求&amp;接口设计"></a>需求&amp;接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130132146167.png" alt="image-20231130132146167"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130132443314.png"></p>
<h4 id="实现思路-1"><a href="#实现思路-1" class="headerlink" title="实现思路"></a>实现思路</h4><p>根据标签名进行分页查询所有标签，然后封装VO返回</p>
<h4 id="代码实现-17"><a href="#代码实现-17" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询标签列表</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult&lt;PageVo&gt; <span class="title function_">pageTagList</span><span class="params">(Integer pageNum, Integer pageSize, TagListDto tagListDto)</span> &#123;</span><br><span class="line">       LambdaQueryWrapper&lt;Tag&gt; tagLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//查看是否有评论 模糊查询</span></span><br><span class="line">       tagLambdaQueryWrapper.like(StringUtils.hasText(tagListDto.getRemark()),Tag::getRemark,tagListDto.getRemark());</span><br><span class="line">       <span class="comment">//查看是否有name模糊查询</span></span><br><span class="line">       tagLambdaQueryWrapper.like(StringUtils.hasText(tagListDto.getName()),Tag::getName,tagListDto.getName());</span><br><span class="line">       <span class="comment">//分页</span></span><br><span class="line">       Page&lt;Tag&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">       page(page,tagLambdaQueryWrapper);</span><br><span class="line">       <span class="comment">//封装vo返回</span></span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult(<span class="keyword">new</span> <span class="title class_">PageVo</span>(page.getRecords(),page.getTotal()));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增标签"><a href="#新增标签" class="headerlink" title="新增标签"></a>新增标签</h3><h4 id="接口分析-17"><a href="#接口分析-17" class="headerlink" title="接口分析"></a>接口分析</h4><p>注意自动填充字段，是否创建MyMetaObjectHandler</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130140707746.png" alt="image-20231130140707746"></p>
<h4 id="代码实现-18"><a href="#代码实现-18" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.mp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/26 0026 20:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//这个类是用来配置mybatis的字段自动填充。用于&#x27;发送评论&#x27;功能，由于我们在评论表无法对下面这四个字段进行插入数据(原因是前端在发送评论时，没有在</span></span><br><span class="line"><span class="comment">//请求体提供下面四个参数，所以后端在往数据库插入数据时，下面四个字段是空值)，所有就需要这个类来帮助我们往下面这四个字段自动的插入值，</span></span><br><span class="line"><span class="comment">//只要我们更新了评论表的字段，那么无法插入值的字段就自动有值了</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//只要对数据库执行了插入语句，那么就会执行到这个方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取用户id</span></span><br><span class="line">            userId = SecurityUtils.getUserId();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            userId = -<span class="number">1L</span>;<span class="comment">//如果异常了，就说明该用户还没注册，我们就把该用户的userid字段赋值d为-1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//自动把下面四个字段新增了值。</span></span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createBy&quot;</span>,userId , metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateBy&quot;</span>, userId, metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot; &quot;</span>, SecurityUtils.getUserId(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增标签</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">addTag</span><span class="params">(AddTagDto addTagDto)</span>&#123;</span><br><span class="line">        <span class="type">Tag</span> <span class="variable">tag</span> <span class="operator">=</span> BeanCopyUtils.copyBean(addTagDto, Tag.class);</span><br><span class="line">        save(tag);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;新增标签&quot;, notes = &quot;新增标签&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">addTag</span><span class="params">(<span class="meta">@RequestBody</span> AddTagDto addTagDto)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> tagService.addTag(addTagDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="删除标签"><a href="#删除标签" class="headerlink" title="删除标签"></a>删除标签</h3><h4 id="接口分析-18"><a href="#接口分析-18" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130140613822.png" alt="image-20231130140613822"></p>
<h4 id="代码实现-19"><a href="#代码实现-19" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除标签&quot;, notes = &quot;删除标签&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> List&lt;Long&gt; id)</span>&#123;</span><br><span class="line">        tagService.removeByIds(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 日志</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment"># 逻辑删除的字段  会自动帮我们判断是否删除</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">delFlag</span></span><br><span class="line">      <span class="comment"># 代表已删除的值</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="comment"># 代表未删除的值</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br><span class="line">      <span class="comment"># 主键自增策略，以mysql数据库为准</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br></pre></td></tr></table></figure>



<h3 id="修改标签"><a href="#修改标签" class="headerlink" title="修改标签"></a>修改标签</h3><h4 id="接口分析-19"><a href="#接口分析-19" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130143113622.png" alt="image-20231130143113622"></p>
<h4 id="思路分析-12"><a href="#思路分析-12" class="headerlink" title="思路分析"></a>思路分析</h4><p>注意要先根据id查询所对应的标签，进行回显，然后再根据id保存相应的数据</p>
<h4 id="代码实现-20"><a href="#代码实现-20" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="comment">//①根据标签的id来查询标签</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;根据id查询标签&quot;, notes = &quot;回显标签信息，去更新标签信息&quot;)</span></span><br><span class="line">   <span class="meta">@ApiImplicitParam(name = &quot;id&quot;,value = &quot;标签id&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">       <span class="type">Tag</span> <span class="variable">tag</span> <span class="operator">=</span> tagService.getById(id);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult(tag);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@PutMapping</span></span><br><span class="line">   <span class="comment">//②根据标签的id来修改标签</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;根据id修改标签&quot;, notes = &quot;修改标签信息&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> EditTagDto tagDto)</span>&#123;</span><br><span class="line">       <span class="type">Tag</span> <span class="variable">tag</span> <span class="operator">=</span> BeanCopyUtils.copyBean(tagDto,Tag.class);</span><br><span class="line">       tagService.updateById(tag);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="发布文章"><a href="#发布文章" class="headerlink" title="*发布文章"></a>*发布文章</h2><h3 id="查询分类"><a href="#查询分类" class="headerlink" title="查询分类"></a>查询分类</h3><h4 id="接口分析-20"><a href="#接口分析-20" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130160302938.png" alt="image-20231130160302938"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130160715358.png" alt="image-20231130160715358"></p>
<h4 id="代码实现-21"><a href="#代码实现-21" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写博文查询所有状态正常的分类</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;CategoryVo&gt; <span class="title function_">listAllCategory</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">//查询状态正常的分类就行</span></span><br><span class="line">       LambdaQueryWrapper&lt;Category&gt; categoryLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       categoryLambdaQueryWrapper.eq(Category::getStatus,SystemCanstants.CATEGORY_NORMAL);</span><br><span class="line">       List&lt;Category&gt; categoryList = list(categoryLambdaQueryWrapper);</span><br><span class="line">       <span class="keyword">return</span> BeanCopyUtils.copyBeanList(categoryList,CategoryVo.class);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询标签-1"><a href="#查询标签-1" class="headerlink" title="查询标签"></a>查询标签</h3><h4 id="接口分析-21"><a href="#接口分析-21" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130164233435.png" alt="image-20231130164233435"></p>
<h4 id="代码实现-22"><a href="#代码实现-22" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写博文-查询文章标签的接口</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;TagVo&gt; <span class="title function_">listAllTag</span><span class="params">()</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Tag&gt; tagLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        tagLambdaQueryWrapper.select(Tag::getId,Tag::getName); <span class="comment">//select 查询出 id和name</span></span><br><span class="line">        List&lt;Tag&gt; tagList = list(tagLambdaQueryWrapper);</span><br><span class="line">        List&lt;TagVo&gt; tagVos = BeanCopyUtils.copyBeanList(tagList, TagVo.class);</span><br><span class="line">        <span class="keyword">return</span> tagVos;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="上传图片"><a href="#上传图片" class="headerlink" title="上传图片"></a>上传图片</h3><h4 id="接口分析-22"><a href="#接口分析-22" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130165912395.png" alt="image-20231130165912395"></p>
<h4 id="代码实现-23"><a href="#代码实现-23" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/26 21:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;写文章-缩略图文件上传&quot;,description = &quot;写文章-缩略图文件上传相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UpLoadService upLoadService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上传缩略图</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;上传图片&quot;,notes = &quot;上传缩略图&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;multipartFile&quot;,value = &quot;头像图片&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;img&quot;)</span> MultipartFile multipartFile)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> upLoadService.upLoadImg(multipartFile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myoss:</span><br><span class="line">  accessKey: x-qfDcVVmiT2m-efSspP5gIUJmvbMgTFBeDxnsTx</span><br><span class="line">  secretKey: NO5vz18JlVozZRWn11fkgwn3unD0KrmRBP6frwto</span><br><span class="line">  bucket: jiuwei-blog</span><br><span class="line">  yuming: http:<span class="comment">//s4qekb2gh.hb-bkt.clouddn.com/</span></span><br></pre></td></tr></table></figure>

<h3 id="新建文章"><a href="#新建文章" class="headerlink" title="新建文章"></a>新建文章</h3><h4 id="接口分析-23"><a href="#接口分析-23" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130171335226.png" alt="image-20231130171335226"></p>
<h4 id="代码实现-24"><a href="#代码实现-24" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  写文章-新建文章   --------------------------------------------------</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(AddArticleDto article)</span> &#123;</span><br><span class="line">       <span class="comment">//将文章保存到数据库</span></span><br><span class="line">       <span class="type">ArticleVo</span> <span class="variable">articleVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(article, ArticleVo.class);</span><br><span class="line">       articleVoService.save(articleVo);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//然后将文章id和标签id放到关联表中   mybatis-plus会自动将新生成的数据的id自动封装到新生成的数据上，所以直接可以用新生成的article去getId</span></span><br><span class="line">       List&lt;ArticleTag&gt; articleTags = article.getTags().stream()  <span class="comment">//获取tag的id集合</span></span><br><span class="line">               .map(tagId -&gt; <span class="keyword">new</span> <span class="title class_">ArticleTag</span>(tagId, articleVo.getId())) <span class="comment">//stream流操作，将tagid和 article的id封装成ArticleTag</span></span><br><span class="line">               .collect(Collectors.toList());    <span class="comment">//将ArticleTag转换成集合</span></span><br><span class="line">       articleTagService.saveBatch(articleTags);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/18 0018 21:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sg_article&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//文章内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//文章摘要</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    <span class="comment">//所属分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加一个字段，为categoryName，由categoryId来查询出</span></span><br><span class="line">    <span class="comment">//由于数据库没有category_name字段，所以要用注解指定一下字段</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span><span class="comment">//代表这个字段在数据库中不存在，避免MyBatisPlus在查询时报错</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//缩略图</span></span><br><span class="line">    <span class="keyword">private</span> String thumbnail;</span><br><span class="line">    <span class="comment">//是否置顶（0否，1是）</span></span><br><span class="line">    <span class="keyword">private</span> String isTop;</span><br><span class="line">    <span class="comment">//状态（0已发布，1草稿）</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">//访问量</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">//是否允许评论 1是，0否</span></span><br><span class="line">    <span class="keyword">private</span> String isComment;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增博客文章-使用mybatisplus的字段自增</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除标志（0代表未删除，1代表已删除）</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArticleVo</span><span class="params">(Long id, <span class="type">long</span> viewCount)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.viewCount = viewCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/30 17:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;新增博客文章&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddArticleDto</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//文章内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//文章摘要</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    <span class="comment">//所属分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//缩略图</span></span><br><span class="line">    <span class="keyword">private</span> String thumbnail;</span><br><span class="line">    <span class="comment">//是否置顶（0否，1是）</span></span><br><span class="line">    <span class="keyword">private</span> String isTop;</span><br><span class="line">    <span class="comment">//状态（0已发布，1草稿）</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">//访问量</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">//是否允许评论 1是，0否</span></span><br><span class="line">    <span class="keyword">private</span> String isComment;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//tags属性是一个List集合，用于接收文章关联标签的id</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; tags;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分类列表"><a href="#分类列表" class="headerlink" title="分类列表"></a>分类列表</h2><h3 id="查询分类-1"><a href="#查询分类-1" class="headerlink" title="查询分类"></a>查询分类</h3><h4 id="接口分析-24"><a href="#接口分析-24" class="headerlink" title="接口分析"></a>接口分析<img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130200554539.png" alt="image-20231130200554539"></h4><h4 id="代码实现-25"><a href="#代码实现-25" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//----------------------------------分页查询分类列表------------------------------------------</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> PageVo <span class="title function_">selectCategoryPage</span><span class="params">(Category category, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">       LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line"></span><br><span class="line">       queryWrapper.like(StringUtils.hasText(category.getName()),Category::getName, category.getName());</span><br><span class="line">       queryWrapper.eq(Objects.nonNull(category.getStatus()),Category::getStatus, category.getStatus());</span><br><span class="line"></span><br><span class="line">       Page&lt;Category&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">       page.setCurrent(pageNum);</span><br><span class="line">       page.setSize(pageSize);</span><br><span class="line">       page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//转换成VO</span></span><br><span class="line">       List&lt;Category&gt; categories = page.getRecords();</span><br><span class="line"></span><br><span class="line">       <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">       pageVo.setTotal(page.getTotal());</span><br><span class="line">       pageVo.setRows(categories);</span><br><span class="line">       <span class="keyword">return</span> pageVo;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增分类"><a href="#新增分类" class="headerlink" title="新增分类"></a>新增分类</h3><h4 id="接口分析-25"><a href="#接口分析-25" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130201117697.png" alt="image-20231130201117697"></p>
<h4 id="代码实现-26"><a href="#代码实现-26" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;增加文章的分类&quot;, notes = &quot;增加文章的分类&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> AddCategoryDto categoryDto)</span>&#123;</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> BeanCopyUtils.copyBean(categoryDto, Category.class);</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除分类"><a href="#删除分类" class="headerlink" title="删除分类"></a>删除分类</h3><h4 id="接口分析-26"><a href="#接口分析-26" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130201618963.png" alt="image-20231130201618963"></p>
<h4 id="代码实现-27"><a href="#代码实现-27" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(value = &quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;删除文章的分类&quot;, notes = &quot;删除文章的分类&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>List&lt;Long&gt; id)</span>&#123;</span><br><span class="line">       categoryService.removeByIds(id);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改分类"><a href="#修改分类" class="headerlink" title="修改分类"></a>修改分类</h3><h4 id="接口分析-27"><a href="#接口分析-27" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130201802839.png" alt="image-20231130201802839"></p>
<h4 id="代码实现-28"><a href="#代码实现-28" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//①根据分类的id来查询分类</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据分类的id来查询分类&quot;, notes = &quot;根据分类的id来查询分类&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(category);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="comment">//②根据分类的id来修改分类</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据分类的id来修改分类&quot;, notes = &quot;根据分类的id来修改分类&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;</span><br><span class="line">        categoryService.updateById(category);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="Excel表格"><a href="#Excel表格" class="headerlink" title="Excel表格"></a>Excel表格</h2><h3 id="接口设计-1"><a href="#接口设计-1" class="headerlink" title="接口设计"></a>接口设计</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130193927468.png" alt="image-20231130193927468"></p>
<h3 id="接口分析-28"><a href="#接口分析-28" class="headerlink" title="接口分析"></a>接口分析</h3><p>使用easyExcel实现Excel的导出操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">官方地址: https://github.com/alibaba/easyexcel</span><br><span class="line"></span><br><span class="line">快速开始: https://easyexcel.opensource.alibaba.com/docs/current/quickstart/write#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1</span><br></pre></td></tr></table></figure>

<p>分析: 把数据库的分类数据查询出来，然后写入到Excel文件中，然后下载这个Excel文件，重点就是怎么往Excel里面写入数据，点击上面提供的快速开始的链接，点击左侧的 ‘写Excel’，就能看到实现的代码了，重点看右侧小导航栏的 ‘web中的写并且失败的时候返回json’</p>
<p>增加响应头，将数据变成输出流响应到浏览器，报错也响应到浏览器</p>
<h3 id="代码实现-29"><a href="#代码实现-29" class="headerlink" title="代码实现"></a>代码实现</h3><p>1.加入pom依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--easyExcel的依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;easyexcel&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;把分类数据写入到Excel并导出&quot;, notes = &quot;把分类数据写入到Excel并导出&quot;)</span></span><br><span class="line">    <span class="comment">//注意返回值类型是void</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//设置下载文件的请求头，下载下来的Excel文件叫&#x27;分类.xlsx&#x27;</span></span><br><span class="line">            WebUtils.setDownLoadHeader(<span class="string">&quot;分类.xlsx&quot;</span>,response);</span><br><span class="line">            <span class="comment">//获取需要导出的数据</span></span><br><span class="line">            List&lt;Category&gt; category = categoryService.list();</span><br><span class="line"></span><br><span class="line">            List&lt;ExcelCategoryVo&gt; excelCategoryVos = BeanCopyUtils.copyBeanList(category, ExcelCategoryVo.class);</span><br><span class="line">            <span class="comment">//把数据写入到Excel中，也就是把ExcelCategoryVo实体类的字段作为Excel表格的列头</span></span><br><span class="line">            <span class="comment">//sheet方法里面的字符串是Excel表格左下角工作簿的名字</span></span><br><span class="line">            EasyExcel.write(response.getOutputStream(), ExcelCategoryVo.class).autoCloseStream(Boolean.FALSE).sheet(<span class="string">&quot;文章分类&quot;</span>)</span><br><span class="line">                    .doWrite(excelCategoryVos);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//如果出现异常,就返回失败的json数据给前端。AppHttpCodeEnum和ResponseResult是我们在huanf-framework工程写的类</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR);</span><br><span class="line">            <span class="comment">//WebUtils是我们在huanf-framework工程写的类，里面的renderString方法是将json字符串写入到请求体，然后返回给前端</span></span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">     <span class="comment">/* 将字符串渲染到客户端</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param response 渲染对象</span></span><br><span class="line"><span class="comment">     * @param string 待渲染的字符串</span></span><br><span class="line"><span class="comment">     * @return null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//easyExcel文件导出失败时候做的操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">renderString</span><span class="params">(HttpServletResponse response, String string)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            response.setStatus(<span class="number">200</span>);</span><br><span class="line">            response.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">            response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            response.getWriter().print(string);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setDownLoadHeader</span><span class="params">(String filename, ServletContext context, HttpServletResponse response)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">mimeType</span> <span class="operator">=</span> context.getMimeType(filename);<span class="comment">//获取文件的mime类型</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;content-type&quot;</span>,mimeType);</span><br><span class="line">        String fname= URLEncoder.encode(filename,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>,<span class="string">&quot;attachment; filename=&quot;</span>+fname);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        response.setContentType(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;);</span></span><br><span class="line"><span class="comment">//        response.setCharacterEncoding(&quot;utf-8&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//easyExcel文件导出</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setDownLoadHeader</span><span class="params">(String filename, HttpServletResponse response)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span>);</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        String fname= URLEncoder.encode(filename,<span class="string">&quot;UTF-8&quot;</span>).replaceAll(<span class="string">&quot;\\+&quot;</span>, <span class="string">&quot;%20&quot;</span>);<span class="comment">//防止中文乱码</span></span><br><span class="line"><span class="comment">//        response.setHeader(&quot;Content-disposition&quot;,&quot;attachment; filename=&quot;+fname);</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>, <span class="string">&quot;attachment;filename*=utf-8&#x27;&#x27;&quot;</span> + fname);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="文章列表"><a href="#文章列表" class="headerlink" title="文章列表"></a>文章列表</h2><h3 id="查询文章"><a href="#查询文章" class="headerlink" title="查询文章"></a>查询文章</h3><h4 id="接口分析-29"><a href="#接口分析-29" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130202552450.png" alt="image-20231130202552450"></p>
<h4 id="代码实现-30"><a href="#代码实现-30" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//---------------------------管理后台(文章管理)-分页查询文章----------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageVo <span class="title function_">selectArticlePage</span><span class="params">(Article article, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line"></span><br><span class="line">        queryWrapper.like(StringUtils.hasText(article.getTitle()),Article::getTitle, article.getTitle());</span><br><span class="line">        queryWrapper.like(StringUtils.hasText(article.getSummary()),Article::getSummary, article.getSummary());</span><br><span class="line"></span><br><span class="line">        Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">        page.setCurrent(pageNum);</span><br><span class="line">        page.setSize(pageSize);</span><br><span class="line">        page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//转换成VO</span></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line"></span><br><span class="line">        <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">        pageVo.setTotal(page.getTotal());</span><br><span class="line">        pageVo.setRows(articles);</span><br><span class="line">        <span class="keyword">return</span> pageVo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改文章"><a href="#修改文章" class="headerlink" title="修改文章"></a>修改文章</h3><h4 id="接口设计-2"><a href="#接口设计-2" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130203501652.png" alt="image-20231130203501652"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130203629930.png" alt="image-20231130203629930"></p>
<h4 id="思路分析-13"><a href="#思路分析-13" class="headerlink" title="思路分析"></a>思路分析</h4><p>首先根据文章id查询文件信息，再根据文章id去标签-文章的表去查询文章id所对应的tagid 然后将tagid赋值给文章实体类的tagid集合</p>
<p>然后根据文章id，去修改文章的分类信息，然后删除旧的文章-标签对应关系，增加新的标签-文章对应关系</p>
<h4 id="代码实现-31"><a href="#代码实现-31" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//①先查询根据文章id查询对应的文章</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;先查询根据文章id查询对应的文章&quot;, notes = &quot;先查询根据文章id查询对应的文章&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="type">ArticleByIdVo</span> <span class="variable">article</span> <span class="operator">=</span> articleService.getInfo(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(article);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="comment">//②然后才是修改文章</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改文章&quot;, notes = &quot;修改文章&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> ArticleDto article)</span>&#123;</span><br><span class="line">        articleService.edit(article);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ArticleByIdVo <span class="title function_">getInfo</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取关联标签   反方向拿到tags的标签</span></span><br><span class="line">        LambdaQueryWrapper&lt;ArticleTag&gt; articleTagLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        articleTagLambdaQueryWrapper.eq(ArticleTag::getArticleId,article.getId());   <span class="comment">//获取article_id的连表的集合，然后分别根据里面的</span></span><br><span class="line">        List&lt;ArticleTag&gt; articleTags = articleTagService.list(articleTagLambdaQueryWrapper);   <span class="comment">//获取articleid连表tagid集合</span></span><br><span class="line">        List&lt;Long&gt; tags = articleTags.stream().map(articleTag -&gt; articleTag.getTagId()).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="type">ArticleByIdVo</span> <span class="variable">articleVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(article,ArticleByIdVo.class);</span><br><span class="line">        articleVo.setTags(tags);</span><br><span class="line">        <span class="keyword">return</span> articleVo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(ArticleDto articleDto)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> BeanCopyUtils.copyBean(articleDto, Article.class);</span><br><span class="line">        <span class="comment">//更新博客信息</span></span><br><span class="line">        updateById(article);</span><br><span class="line">        <span class="comment">//删除原有的 标签和博客的关联</span></span><br><span class="line">        LambdaQueryWrapper&lt;ArticleTag&gt; articleTagLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        articleTagLambdaQueryWrapper.eq(ArticleTag::getArticleId,article.getId());</span><br><span class="line">        articleTagService.remove(articleTagLambdaQueryWrapper);</span><br><span class="line">        <span class="comment">//添加新的博客和标签的关联信息</span></span><br><span class="line">        List&lt;ArticleTag&gt; articleTags = articleDto.getTags().stream()</span><br><span class="line">                .map(tagId -&gt; <span class="keyword">new</span> <span class="title class_">ArticleTag</span>(articleDto.getId(), tagId))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        articleTagService.saveBatch(articleTags);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="删除文章"><a href="#删除文章" class="headerlink" title="删除文章"></a>删除文章</h3><h4 id="接口分析-30"><a href="#接口分析-30" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130205402127.png" alt="image-20231130205402127"></p>
<h4 id="代码实现-32"><a href="#代码实现-32" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除文章&quot;, notes = &quot;删除文章&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> List&lt;Long&gt; id)</span>&#123;</span><br><span class="line">        <span class="comment">//直接使用mybatisplus提供的removeById方法</span></span><br><span class="line">        articleService.removeByIds(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="菜单列表"><a href="#菜单列表" class="headerlink" title="菜单列表"></a>菜单列表</h2><h3 id="查询菜单"><a href="#查询菜单" class="headerlink" title="查询菜单"></a>查询菜单</h3><h4 id="接口分析-31"><a href="#接口分析-31" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201083524731.png" alt="image-20231201083524731"></p>
<p>响应格式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;code&quot;</span>:<span class="number">200</span>,</span><br><span class="line">	<span class="string">&quot;data&quot;</span>:[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;component&quot;</span>:<span class="string">&quot;组件路径&quot;</span>,</span><br><span class="line">			<span class="string">&quot;icon&quot;</span>:<span class="string">&quot;build&quot;</span>,</span><br><span class="line">			<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2023&quot;</span>,</span><br><span class="line">			<span class="string">&quot;isFrame&quot;</span>:<span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;menuName&quot;</span>:<span class="string">&quot;菜单名称&quot;</span>,</span><br><span class="line">			<span class="string">&quot;menuType&quot;</span>:<span class="string">&quot;C&quot;</span>,</span><br><span class="line">			<span class="string">&quot;orderNum&quot;</span>:<span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">			<span class="string">&quot;path&quot;</span>:<span class="string">&quot;write&quot;</span>,</span><br><span class="line">			<span class="string">&quot;perms&quot;</span>:<span class="string">&quot;权限字符串&quot;</span>,</span><br><span class="line">			<span class="string">&quot;remark&quot;</span>:<span class="string">&quot;备注信息&quot;</span>,</span><br><span class="line">			<span class="string">&quot;status&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">			<span class="string">&quot;visible&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;icon&quot;</span>:<span class="string">&quot;system&quot;</span>,</span><br><span class="line">			<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">			<span class="string">&quot;isFrame&quot;</span>:<span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;menuName&quot;</span>:<span class="string">&quot;菜单名称&quot;</span>,</span><br><span class="line">			<span class="string">&quot;menuType&quot;</span>:<span class="string">&quot;M&quot;</span>,</span><br><span class="line">			<span class="string">&quot;orderNum&quot;</span>:<span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">			<span class="string">&quot;path&quot;</span>:<span class="string">&quot;system&quot;</span>,</span><br><span class="line">			<span class="string">&quot;perms&quot;</span>:<span class="string">&quot;权限字符串&quot;</span>,</span><br><span class="line">			<span class="string">&quot;remark&quot;</span>:<span class="string">&quot;备注信息&quot;</span>,</span><br><span class="line">			<span class="string">&quot;status&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">			<span class="string">&quot;visible&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;操作成功&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="代码实现-33"><a href="#代码实现-33" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//---------------------------------查询菜单列表--------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Menu&gt; <span class="title function_">selectMenuList</span><span class="params">(Menu menu)</span> &#123;</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;Menu&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//menuName模糊查询</span></span><br><span class="line">        queryWrapper.like(StringUtils.hasText(menu.getMenuName()),Menu::getMenuName,menu.getMenuName());</span><br><span class="line">        queryWrapper.eq(StringUtils.hasText(menu.getStatus()),Menu::getStatus,menu.getStatus());</span><br><span class="line">        <span class="comment">//排序 parent_id和order_num</span></span><br><span class="line">        queryWrapper.orderByAsc(Menu::getParentId,Menu::getOrderNum);</span><br><span class="line">        List&lt;Menu&gt; menus = list(queryWrapper);;</span><br><span class="line">        <span class="keyword">return</span> menus;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增菜单"><a href="#新增菜单" class="headerlink" title="新增菜单"></a>新增菜单</h3><h4 id="接口分析-32"><a href="#接口分析-32" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201085142322.png" alt="image-20231201085142322"></p>
<h4 id="代码实现-34"><a href="#代码实现-34" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;新增菜单列表&quot;, notes = &quot;新增菜单列表&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> Menu menu)</span> &#123;</span><br><span class="line">     menuService.save(menu);</span><br><span class="line">     <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改菜单"><a href="#修改菜单" class="headerlink" title="修改菜单"></a>修改菜单</h3><h4 id="接口分析-33"><a href="#接口分析-33" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201085730990.png" alt="image-20231201085730990"></p>
<h4 id="思路分析-14"><a href="#思路分析-14" class="headerlink" title="思路分析"></a>思路分析</h4><p>先根据菜单id查询出菜单信息，回显数据</p>
<p>在根据id更新所修改的信息，修改的时候判断所修改的菜单是否是父菜单，不能把父菜单设置为当前菜单</p>
<h4 id="代码实现-35"><a href="#代码实现-35" class="headerlink" title="代码实现"></a>代码实现</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201090245547.png" alt="image-20231201090245547"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/&#123;menuId&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//①先查询根据菜单id查询对应的权限菜单</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询菜单信息&quot;, notes = &quot;查询菜单信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable</span> Long menuId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(menuService.getById(menuId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="comment">//②然后才是更新菜单</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> Menu menu)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (menu.getId().equals(menu.getParentId())) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseResult.errorResult(<span class="number">500</span>,<span class="string">&quot;修改菜单&#x27;&quot;</span> + menu.getMenuName() + <span class="string">&quot;&#x27;失败，上级菜单不能选择自己&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        menuService.updateById(menu);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除菜单"><a href="#删除菜单" class="headerlink" title="删除菜单"></a>删除菜单</h3><h4 id="接口分析-34"><a href="#接口分析-34" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201091746875.png" alt="image-20231201091746875"></p>
<h4 id="思路分析-15"><a href="#思路分析-15" class="headerlink" title="思路分析"></a>思路分析</h4><p>判断是否有子目录，就是看其他的parentid是否有它</p>
<h4 id="代码实现-36"><a href="#代码实现-36" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//---------------------------------查看是否有子目录--------------------------------------</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasChild</span><span class="params">(Long menuId)</span> &#123;</span><br><span class="line">       <span class="comment">//查看是否有子目录</span></span><br><span class="line">       LambdaQueryWrapper&lt;Menu&gt; menulambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       menulambdaQueryWrapper.eq(Menu::getParentId,menuId);   <span class="comment">//如果能查出来，就返回true</span></span><br><span class="line">       <span class="keyword">return</span> count(menulambdaQueryWrapper)&gt;<span class="number">0</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="角色列表"><a href="#角色列表" class="headerlink" title="角色列表"></a>角色列表</h2><h3 id="查询角色"><a href="#查询角色" class="headerlink" title="查询角色"></a>查询角色</h3><h4 id="接口设计-3"><a href="#接口设计-3" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201092512509.png" alt="image-20231201092512509"></p>
<p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;12&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;link&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色名称&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="思路分析-16"><a href="#思路分析-16" class="headerlink" title="思路分析"></a>思路分析</h4><p>根据条件模糊查询，，将分页信息封装到vo返回给前端</p>
<h4 id="代码实现-37"><a href="#代码实现-37" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------------------查询角色列表---------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">selectRolePage</span><span class="params">(Role role, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Role&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        lambdaQueryWrapper.like(StringUtils.hasText(role.getRoleName()),Role::getRoleName,role.getRoleName());</span><br><span class="line">        lambdaQueryWrapper.eq(StringUtils.hasText(role.getStatus()),Role::getStatus,role.getStatus());</span><br><span class="line">        lambdaQueryWrapper.orderByAsc(Role::getRoleSort);</span><br><span class="line"></span><br><span class="line">        Page&lt;Role&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">        page.setCurrent(pageNum);</span><br><span class="line">        page.setSize(pageSize);</span><br><span class="line">        page(page,lambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//转换成VO</span></span><br><span class="line">        List&lt;Role&gt; roles = page.getRecords();</span><br><span class="line"></span><br><span class="line">        <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">        pageVo.setTotal(page.getTotal());</span><br><span class="line">        pageVo.setRows(roles);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改状态"><a href="#修改状态" class="headerlink" title="修改状态"></a>修改状态</h3><h4 id="接口设计-4"><a href="#接口设计-4" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201093155861.png" alt="image-20231201093155861"></p>
<h4 id="思路分析-17"><a href="#思路分析-17" class="headerlink" title="思路分析"></a>思路分析</h4><p>设置Role所要更新的信息，然后调用mp的更新方法去更新</p>
<h4 id="代码实现-38"><a href="#代码实现-38" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/changeStatus&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改角色的状态&quot;, notes = &quot;修改角色的状态&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">changeStatus</span><span class="params">(<span class="meta">@RequestBody</span> ChangeRoleStatusDto roleStatusDto)</span>&#123;</span><br><span class="line">        <span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Role</span>();</span><br><span class="line">        role.setId(roleStatusDto.getRoleId());</span><br><span class="line">        role.setStatus(roleStatusDto.getStatus());</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(roleService.updateById(role));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增角色"><a href="#新增角色" class="headerlink" title="新增角色"></a>新增角色</h3><h4 id="接口设计-5"><a href="#接口设计-5" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101048056.png" alt="image-20231201101048056"></p>
<p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;写博文&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户查询&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1007&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;重置密码&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2024&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链新增&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2025&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链修改&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;内容管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="思路分析-18"><a href="#思路分析-18" class="headerlink" title="思路分析"></a>思路分析</h4><p>首先打开新增窗口，需要查询出菜单树   可以先找出第一层菜单，然后根据i第一层的菜单id，找出其他菜单父类id为它的菜单，然后将这些菜单设置为第一层菜单的children</p>
<p>然后新增所填写的角色信息</p>
<p>并且需要将角色和菜单的对应关系加到角色-菜单关联关系表</p>
<h4 id="代码实现-39"><a href="#代码实现-39" class="headerlink" title="代码实现"></a>代码实现</h4><p>①</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/treeselect&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增角色--获取菜单下拉树列表&quot;, notes = &quot;新增角色--获取菜单下拉树列表&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">treeselect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//复用之前的selectMenuList方法。方法需要参数，参数可以用来进行条件查询，而这个方法不需要条件，所以直接new Menu()传入</span></span><br><span class="line">        List&lt;Menu&gt; menus = menuService.selectMenuList(<span class="keyword">new</span> <span class="title class_">Menu</span>()); <span class="comment">//查询菜单列表</span></span><br><span class="line">        List&lt;MenuTreeVo&gt; options =  SystemConverter.buildMenuSelectTree(menus); <span class="comment">//去构建挑选的菜单树</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(options);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Menu;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.MenuTreeVo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增角色-获取菜单下拉树列表（和动态路由一样）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/12/1 10:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemConverter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SystemConverter</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> menus 所有菜单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;MenuTreeVo&gt; <span class="title function_">buildMenuSelectTree</span><span class="params">(List&lt;Menu&gt; menus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//首先封装成MenuTreeVo</span></span><br><span class="line">        List&lt;MenuTreeVo&gt; menuTreeVos = menus.stream()</span><br><span class="line">                .map(menu -&gt; <span class="keyword">new</span> <span class="title class_">MenuTreeVo</span>(menu.getId(), menu.getMenuName(), menu.getParentId(), <span class="literal">null</span>))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">                 <span class="comment">//先查父菜单为0的菜单</span></span><br><span class="line">        List&lt;MenuTreeVo&gt; menuTree = menuTreeVos.stream().filter(menuTreeVo -&gt; menuTreeVo.getParentId().equals(<span class="number">0L</span>))</span><br><span class="line">                .map(menuTreeVo -&gt; menuTreeVo.setChildren(getChildren(menuTreeVo, menuTreeVos))) <span class="comment">//然后查找别的菜单parentId为前面查到父菜单为0的id，将其设置到这个id的children中</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> menuTree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到子树</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> menuTreeVo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> menuTreeVos</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;MenuTreeVo&gt; <span class="title function_">getChildren</span><span class="params">(MenuTreeVo menuTreeVo,List&lt;MenuTreeVo&gt; menuTreeVos)</span> &#123;</span><br><span class="line">        List&lt;MenuTreeVo&gt; childrenTree = menuTreeVos.stream().filter(m -&gt; m.getParentId().equals(menuTreeVo.getId()))</span><br><span class="line">                .map(m -&gt; m.setChildren(getChildren(m, menuTreeVos))).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> childrenTree;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>②</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------------------新增角色信息---------------------------------------</span></span><br><span class="line">    <span class="comment">//先新增角色信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertRole</span><span class="params">(Role role)</span> &#123;</span><br><span class="line">        save(role);</span><br><span class="line">        <span class="keyword">if</span> (role.getMenuIds()!=<span class="literal">null</span>&amp;&amp;role.getMenuIds().length&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//将角色和菜单的关系执行插入到menu-role表</span></span><br><span class="line">            insertRoleMenu(role);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//再将角色和菜单关系保存到关系表中</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertRoleMenu</span><span class="params">(Role role)</span> &#123;</span><br><span class="line">        List&lt;RoleMenu&gt; roleMenu = Arrays.stream(role.getMenuIds()).map(menuId -&gt; <span class="keyword">new</span> <span class="title class_">RoleMenu</span>(menuId, role.getId()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        roleMenuService.saveBatch(roleMenu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增角色&quot;, notes = &quot;新增角色&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">( <span class="meta">@RequestBody</span> Role role)</span> &#123;</span><br><span class="line">        roleService.insertRole(role);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="修改角色"><a href="#修改角色" class="headerlink" title="修改角色"></a>修改角色</h3><h4 id="接口设计-6"><a href="#接口设计-6" class="headerlink" title="接口设计"></a>接口设计</h4><p>① <img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101339076.png" alt="image-20231201101339076"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;11&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;备注信息&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;aggag&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色名称&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;11&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;备注信息&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;aggag&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色名称&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101412122.png" alt="image-20231201101412122"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;code&quot;</span>:<span class="number">200</span>,</span><br><span class="line">	<span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line">		<span class="string">&quot;menus&quot;</span>:[</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">				<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2023&quot;</span>,</span><br><span class="line">				<span class="string">&quot;label&quot;</span>:<span class="string">&quot;写博文&quot;</span>,</span><br><span class="line">				<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1001&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;用户查询&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;100&quot;</span></span><br><span class="line">							&#125;,</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1002&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;用户新增&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;100&quot;</span></span><br><span class="line">							&#125;</span><br><span class="line">						],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;100&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;1&quot;</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1008&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;角色查询&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;101&quot;</span></span><br><span class="line">							&#125;</span><br><span class="line">						],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;101&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;角色管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;1&quot;</span></span><br><span class="line">					&#125;</span><br><span class="line">				],</span><br><span class="line">				<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">				<span class="string">&quot;label&quot;</span>:<span class="string">&quot;系统管理&quot;</span>,</span><br><span class="line">				<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2019&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;文章管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2017&quot;</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2028&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;导出分类&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2018&quot;</span></span><br><span class="line">							&#125;</span><br><span class="line">						],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2018&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;分类管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2017&quot;</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2024&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;友链新增&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2022&quot;</span></span><br><span class="line">							&#125;,</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2025&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;友链修改&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2022&quot;</span></span><br><span class="line">							&#125;</span><br><span class="line">						],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2022&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;友链管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2017&quot;</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2021&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;标签管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2017&quot;</span></span><br><span class="line">					&#125;</span><br><span class="line">				],</span><br><span class="line">				<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2017&quot;</span>,</span><br><span class="line">				<span class="string">&quot;label&quot;</span>:<span class="string">&quot;内容管理&quot;</span>,</span><br><span class="line">				<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;checkedKeys&quot;</span>:[</span><br><span class="line">			<span class="string">&quot;1001&quot;</span>  </span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;操作成功&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101445405.png" alt="image-20231201101445405"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101458722.png" alt="image-20231201101458722"></p>
<h4 id="思路分析-19"><a href="#思路分析-19" class="headerlink" title="思路分析"></a>思路分析</h4><p>首先根据角色id查询角色信息回显到修改窗口</p>
<p>然后回显菜单树，和这个角色之前选的菜单的id（根据角色id查找对应的菜单id集合）</p>
<p>最后把修改的角色信息保存到数据库中，把菜单角色关联表中的这个角色id之前信息删除，在重新添加关联信息</p>
<h4 id="代码实现-40"><a href="#代码实现-40" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;获取修改id角色信息&quot;, notes = &quot;获取修改id角色信息&quot;)</span></span><br><span class="line">   <span class="meta">@ApiImplicitParam(name = &quot;id&quot;,value = &quot;角色id&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">selectById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">       <span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> roleService.getById(id);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//---------------------修改角色-根据角色id查询对应角色菜单列表树--------------------------</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/roleMenuTreeselect/&#123;roleId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改角色-根据角色id查询对应角色菜单列表树-&quot;, notes = &quot;修改角色-根据角色id查询对应角色菜单列表树-&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">roleMenuTreeSelect</span><span class="params">(<span class="meta">@PathVariable(&quot;roleId&quot;)</span> Long roleId)</span> &#123;</span><br><span class="line">        <span class="comment">//首先给出所有的菜单</span></span><br><span class="line">        List&lt;Menu&gt; menus = menuService.selectMenuList(<span class="keyword">new</span> <span class="title class_">Menu</span>());</span><br><span class="line">        <span class="comment">//然后去建立菜单树</span></span><br><span class="line">        List&lt;MenuTreeVo&gt; menuTreeVos = SystemConverter.buildMenuSelectTree(menus);</span><br><span class="line">        <span class="comment">//然后在去查询这个角色id之前所具有的菜单id，将其和菜单树返回</span></span><br><span class="line">         List&lt;Long&gt; checkedKeys = menuService.selectMenuListByRoleId(roleId);</span><br><span class="line">        <span class="type">RoleMenuTreeSelectVo</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleMenuTreeSelectVo</span>(checkedKeys,menuTreeVos);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(vo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--修改角色-根据角色id查询对应角色的菜单列表树--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectMenuListByRoleId&quot;</span> resultType=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span><br><span class="line">    select *</span><br><span class="line">    from sys_menu m left join sys_role_menu rm on m.id = rm.menu_id</span><br><span class="line">    where rm.role_id = #&#123;roleId&#125;</span><br><span class="line">    order by m.parent_id , m.order_num</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------修改角色-保存修改好的角色信息----------------------------</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateRole</span><span class="params">(Role role)</span> &#123;</span><br><span class="line">        <span class="comment">//先更新角色信息</span></span><br><span class="line">        updateById(role);</span><br><span class="line">        <span class="comment">//然后删除这个角色所对应的菜单关系</span></span><br><span class="line">        roleMenuService.deleteRoleMenuByRoleId(role.getId());</span><br><span class="line">        <span class="comment">//然后重新保存两个表的关系</span></span><br><span class="line">        insertRoleMenu(role);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//修改角色-保存修改好的角色信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRoleMenuByRoleId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;RoleMenu&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(RoleMenu::getRoleId,id);</span><br><span class="line">        remove(queryWrapper);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除角色"><a href="#删除角色" class="headerlink" title="删除角色"></a>删除角色</h3><h4 id="接口设计-7"><a href="#接口设计-7" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101543847.png" alt="image-20231201101543847"></p>
<h4 id="代码实现-41"><a href="#代码实现-41" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;删除角色&quot;, notes = &quot;删除角色&quot;)</span></span><br><span class="line">   <span class="meta">@ApiImplicitParam(name = &quot;id&quot;,value = &quot;角色id&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable(name = &quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">       roleService.removeById(id);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="用户列表"><a href="#用户列表" class="headerlink" title="用户列表"></a>用户列表</h2><h3 id="查询用户"><a href="#查询用户" class="headerlink" title="查询用户"></a>查询用户</h3><h4 id="接口分析-35"><a href="#接口分析-35" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201164913448.png" alt="image-20231201164913448"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span><span class="string">&quot;头像url&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-05 17:01:56&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;23412332@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;昵称&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;phonenumber&quot;</span><span class="punctuation">:</span><span class="string">&quot;18888888888&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-10 21:36:22&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="代码实现-42"><a href="#代码实现-42" class="headerlink" title="代码实现"></a>代码实现</h4><p>//——————————–查询用户列表————————————-<br>    @Override<br>    public ResponseResult selectUserPage (User user, Integer pageNum, Integer pageSize){<br>        LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper();</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    queryWrapper.like(StringUtils.hasText(user.getUserName()), User::getUserName, user.getUserName());</span><br><span class="line">    queryWrapper.eq(StringUtils.hasText(user.getStatus()), User::getStatus, user.getStatus());</span><br><span class="line">    queryWrapper.eq(StringUtils.hasText(user.getPhonenumber()), User::getPhonenumber, user.getPhonenumber());</span><br><span class="line"></span><br><span class="line">    Page&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">    page.setCurrent(pageNum);</span><br><span class="line">    page.setSize(pageSize);</span><br><span class="line">    page(page, queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//转换成VO</span></span><br><span class="line">    List&lt;User&gt; users = page.getRecords();</span><br><span class="line">    List&lt;UserVo&gt; userVoList = users.stream()</span><br><span class="line">            .map(u -&gt; BeanCopyUtils.copyBean(u, UserVo.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">    pageVo.setTotal(page.getTotal());</span><br><span class="line">    pageVo.setRows(userVoList);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h3><h4 id="思路分析-20"><a href="#思路分析-20" class="headerlink" title="思路分析"></a>思路分析</h4><p>首先查出所有角色，然后增加用户,把角色和用户对应关系也需要保存到关联表中</p>
<h4 id="接口分析-36"><a href="#接口分析-36" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201165429716.png" alt="image-20231201165429716"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;common&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-13 06:32:58&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201170004116.png" alt="image-20231201170004116"></p>
<h4 id="代码实现-43"><a href="#代码实现-43" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//--------------------------------新增用户---------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/listAllRole&quot;)</span></span><br><span class="line">    <span class="comment">//①查询角色列表接口</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">listAllRole</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Role&gt; roles = roleService.selectRoleAll();</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(roles);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-------------------------------新增用户-②新增用户--------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRoleService userRoleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkUserNameUnique</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count(Wrappers.&lt;User&gt;lambdaQuery().eq(User::getUserName,userName))==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkPhoneUnique</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count(Wrappers.&lt;User&gt;lambdaQuery().eq(User::getPhonenumber,user.getPhonenumber()))==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkEmailUnique</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count(Wrappers.&lt;User&gt;lambdaQuery().eq(User::getEmail,user.getEmail()))==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="comment">//增加用户</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">addUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">//密码加密处理</span></span><br><span class="line">        user.setPassword(passwordEncoder.encode(user.getPassword()));</span><br><span class="line">        save(user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(user.getRoleIds()!=<span class="literal">null</span>&amp;&amp;user.getRoleIds().length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            insertUserRole(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插入用户和角色关联关系</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertUserRole</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        List&lt;UserRole&gt; sysUserRoles = Arrays.stream(user.getRoleIds())</span><br><span class="line">                .map(roleId -&gt; <span class="keyword">new</span> <span class="title class_">UserRole</span>(user.getId(), roleId)).collect(Collectors.toList());</span><br><span class="line">        userRoleService.saveBatch(sysUserRoles);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增用户&quot;,notes = &quot;新增用户&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasText(user.getUserName()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.REQUIRE_USERNAME);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!userService.checkUserNameUnique(user.getUserName()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.USERNAME_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!userService.checkPhoneUnique(user))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.PHONENUMBER_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!userService.checkEmailUnique(user))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.EMAIL_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userService.addUser(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><h4 id="接口分析-37"><a href="#接口分析-37" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201172144858.png" alt="image-20231201172144858"></p>
<h4 id="代码实现-44"><a href="#代码实现-44" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;userIds&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除用户&quot;,notes = &quot;删除用户&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> List&lt;Long&gt; userIds)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(userIds.contains(SecurityUtils.getUserId()))&#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseResult.errorResult(<span class="number">500</span>,<span class="string">&quot;不能删除当前你正在使用的用户&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        userService.removeByIds(userIds);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改用户"><a href="#修改用户" class="headerlink" title="修改用户"></a>修改用户</h3><h4 id="思路分析-21"><a href="#思路分析-21" class="headerlink" title="思路分析"></a>思路分析</h4><p>先查找出该用户所有的角色信息，然后删除该用户的角色用户的关联关系，</p>
<p>然后插入新的关联信息，最后插入用户表信息</p>
<h4 id="接口分析-38"><a href="#接口分析-38" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203221702948.png" alt="image-20231203221702948"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;roleIds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;11&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roles&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-10 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-10 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;common&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-11 06:32:58&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;weq@2132.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户id&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;昵称&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户名&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203221841556.png" alt="image-20231203221841556"></p>
<h4 id="代码实现-45"><a href="#代码实现-45" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--修改用户-①根据id查询用户角色信息--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectRoleIdByUserId&quot;</span> resultType=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span><br><span class="line">        select r.id</span><br><span class="line">        from sys_role r</span><br><span class="line">                 left join sys_user_role ur on ur.role_id = r.id</span><br><span class="line">        where ur.user_id = #&#123;userId&#125;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入用户和角色关联关系</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertUserRole</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        List&lt;UserRole&gt; sysUserRoles = Arrays.stream(user.getRoleIds())</span><br><span class="line">                .map(roleId -&gt; <span class="keyword">new</span> <span class="title class_">UserRole</span>(user.getId(), roleId)).collect(Collectors.toList());</span><br><span class="line">        userRoleService.saveBatch(sysUserRoles);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----------------------------修改用户-②更新用户信息-------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// 删除用户与角色关联</span></span><br><span class="line">        LambdaQueryWrapper&lt;UserRole&gt; userRoleUpdateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        userRoleUpdateWrapper.eq(UserRole::getUserId,user.getId());</span><br><span class="line">        userRoleService.remove(userRoleUpdateWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新增用户与角色管理</span></span><br><span class="line">        insertUserRole(user);</span><br><span class="line">        <span class="comment">// 更新用户信息</span></span><br><span class="line">        updateById(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="友链列表"><a href="#友链列表" class="headerlink" title="友链列表"></a>友链列表</h2><h3 id="查询友链"><a href="#查询友链" class="headerlink" title="查询友链"></a>查询友链</h3><h4 id="接口分析-39"><a href="#接口分析-39" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203223736546.png" alt="image-20231203223736546"></p>
<h4 id="代码实现-46"><a href="#代码实现-46" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询友链</span></span><br><span class="line">    PageVo <span class="title function_">selectLinkPage</span><span class="params">(Link link, Integer pageNum, Integer pageSize)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------------分页查询友链---------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageVo <span class="title function_">selectLinkPage</span><span class="params">(Link link, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Link&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line"></span><br><span class="line">        queryWrapper.like(StringUtils.hasText(link.getName()),Link::getName, link.getName());</span><br><span class="line">        queryWrapper.eq(Objects.nonNull(link.getStatus()),Link::getStatus, link.getStatus());</span><br><span class="line"></span><br><span class="line">        Page&lt;Link&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">        page.setCurrent(pageNum);</span><br><span class="line">        page.setSize(pageSize);</span><br><span class="line">        page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//转换成VO</span></span><br><span class="line">        List&lt;Link&gt; categories = page.getRecords();</span><br><span class="line"></span><br><span class="line">        <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">        pageVo.setTotal(page.getTotal());</span><br><span class="line">        pageVo.setRows(categories);</span><br><span class="line">        <span class="keyword">return</span> pageVo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增友链"><a href="#新增友链" class="headerlink" title="新增友链"></a>新增友链</h3><h4 id="接口分析-40"><a href="#接口分析-40" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203224101175.png" alt="image-20231203224101175"></p>
<h4 id="代码实现-47"><a href="#代码实现-47" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 友链(Link)表实体类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-07-22 14:39:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sg_link&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Link</span>  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String logo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">//网站地址</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="comment">//审核状态 (0代表审核通过，1代表审核未通过，2代表未审核)</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//字段自增</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除标志（0代表未删除，1代表已删除）</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改友链"><a href="#修改友链" class="headerlink" title="修改友链"></a>修改友链</h3><h4 id="思路分析-22"><a href="#思路分析-22" class="headerlink" title="思路分析"></a>思路分析</h4><p>先根据id查询友链，然后修改友链的状态，最后修改友链</p>
<h4 id="接口分析-41"><a href="#接口分析-41" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203224313475.png" alt="image-20231203224313475"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203224324776.png" alt="image-20231203224324776"></p>
<h4 id="代码实现-48"><a href="#代码实现-48" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-------------------------------修改友链---------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//①根据id查询友链</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="type">Link</span> <span class="variable">link</span> <span class="operator">=</span> linkService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(link);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/changeLinkStatus&quot;)</span></span><br><span class="line">    <span class="comment">//②修改友链状态</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">changeLinkStatus</span><span class="params">(<span class="meta">@RequestBody</span> Link link)</span>&#123;</span><br><span class="line">        linkService.updateById(link);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="comment">//③修改友链</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> Link link)</span>&#123;</span><br><span class="line">        linkService.updateById(link);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除友链"><a href="#删除友链" class="headerlink" title="删除友链"></a>删除友链</h3><h4 id="接口分析-42"><a href="#接口分析-42" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203224654161.png" alt="image-20231203224654161"></p>
<h4 id="代码实现-49"><a href="#代码实现-49" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;删除友链&quot;, notes = &quot;删除友链&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    linkService.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>































<h1 id="Leetcode"><a href="#Leetcode" class="headerlink" title="Leetcode"></a>Leetcode</h1><h2 id="2024-4-2"><a href="#2024-4-2" class="headerlink" title="2024/4/2"></a>2024/4/2</h2><h3 id="404-左叶子之和"><a href="#404-左叶子之和" class="headerlink" title="404. 左叶子之和"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/sum-of-left-leaves/">404. 左叶子之和</a></h3><p>前序遍历，首先判断是不是左叶子（左节点不为null，左节点的左孩和右孩子为null）。然后进行递归遍历左右孩子，最后返回sum</p>
<figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//全局变量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//如果是左叶子节点</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.left.left==<span class="literal">null</span> &amp;&amp; root.left.right==<span class="literal">null</span>) &#123;</span><br><span class="line">        sum+=root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        sumOfLeftLeaves(root.left);</span><br><span class="line">        sumOfLeftLeaves(root.right);</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="513-找树左下角的值"><a href="#513-找树左下角的值" class="headerlink" title="513. 找树左下角的值"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-bottom-left-tree-value/">513. 找树左下角的值</a></h3><p>BFS 广度优先搜索。从右往左对每一层进行遍历，最后一层的最后一个节点就是左下角的值</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="comment">//层序遍历 从右向左进行遍历，最后一个就是最底层最左边的值</span></span><br><span class="line">        Deque&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//将root放入队列</span></span><br><span class="line">        queue.offerLast(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.pollFirst();</span><br><span class="line">            <span class="comment">//最后那个值就是要返回的</span></span><br><span class="line">            res = node.val;</span><br><span class="line">            <span class="comment">//先将右节点放入</span></span><br><span class="line">            <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)</span><br><span class="line">            queue.addLast(node.right);</span><br><span class="line">            <span class="comment">//在放左节点</span></span><br><span class="line">            <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)</span><br><span class="line">            queue.addLast(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="617-合并二叉树"><a href="#617-合并二叉树" class="headerlink" title="617. 合并二叉树"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/merge-two-binary-trees/">617. 合并二叉树</a></h3><p>让root1作为合并后的树，然后让root2上的值加到root1</p>
<p>深度优先遍历</p>
<p>结束条件：root1==null 直接返回root2   相反 root2==null 直接返回root1</p>
<p>过程：roo1+=root2，然后遍历左子树和右子树</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">mergeTrees</span><span class="params">(TreeNode root1, TreeNode root2)</span> &#123;</span><br><span class="line">        <span class="comment">//root1为null了那直接就可以返回root2</span></span><br><span class="line">        <span class="keyword">if</span>(root1==<span class="literal">null</span>) <span class="keyword">return</span> root2;  </span><br><span class="line">        <span class="keyword">if</span>(root2==<span class="literal">null</span>) <span class="keyword">return</span> root1;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//可以把root1作为和的点</span></span><br><span class="line">        root1.val = root1.val+root2.val;</span><br><span class="line">        root1.left = mergeTrees(root1.left,root2.left);</span><br><span class="line">        root1.right = mergeTrees(root1.right,root2.right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="112-路径总和"><a href="#112-路径总和" class="headerlink" title="112. 路径总和"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/path-sum/">112. 路径总和</a></h3><p>思路：DFS遍历 </p>
<p>递归终止条件：左右节点为null，计数器等于targetSum（或者每次用targetSum都减节点数最后为0 ）返回true ，返回false 左右节点都为null</p>
<p>单层递归逻辑</p>
<p>遍历左子树 count+val 如果到最后一个节点 然后执行 count-val回退到上一个根节点 </p>
<p>右子树一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPathSum</span><span class="params">(TreeNode root, <span class="type">int</span> targetSum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//只有一个根节点。需要判断一下减去根节点是否等于目标值</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        targetSum = targetSum - root.val;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> dfs(root,targetSum);</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(TreeNode root, <span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="comment">//终止条件</span></span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right ==<span class="literal">null</span> &amp;&amp; count==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>) &#123;</span><br><span class="line">            count = count-root.left.val;</span><br><span class="line">            <span class="keyword">if</span>(dfs(root.left,count)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">//到这一节点的左节点为叶子时 回溯就相当于count没变，继续去找右孩子</span></span><br><span class="line">            count = count + root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>) &#123;</span><br><span class="line">            count = count - root.right.val;</span><br><span class="line">            <span class="keyword">if</span>(dfs(root.right,count)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">//到这一节点的左节点为叶子时 回溯就相当于count没变，继续去找右孩子</span></span><br><span class="line">            count = count + root.right.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,ALTER,INDEX on *.* TO &#x27;root&#x27;@&#x27;8.130.97.224&#x27; IDENTIFIED BY 123456;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
























          
        

      
        <p>JavaSE-SpringBoot知识点</p>
<span id="more"></span>

<h1 id="跟着三更学JAVA-基础篇"><a href="#跟着三更学JAVA-基础篇" class="headerlink" title="跟着三更学JAVA-基础篇"></a>跟着三更学JAVA-基础篇</h1><h2 id="第一部分：基本数据类型"><a href="#第一部分：基本数据类型" class="headerlink" title="第一部分：基本数据类型"></a>第一部分：基本数据类型</h2><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><table>
<thead>
<tr>
<th></th>
<th>类型名称</th>
<th>字节空间</th>
<th>取值范围</th>
</tr>
</thead>
<tbody><tr>
<td>整数型</td>
<td>byte</td>
<td>1字节(8位)</td>
<td>-128到127 或者 -2^(8-1)到2^7</td>
</tr>
<tr>
<td></td>
<td>short</td>
<td>2</td>
<td>-2^15到2^15-1</td>
</tr>
<tr>
<td></td>
<td>int</td>
<td>4</td>
<td>-2^31到2^31-1</td>
</tr>
<tr>
<td></td>
<td>long</td>
<td>8</td>
<td>-2^63到2^63-1</td>
</tr>
<tr>
<td>浮点型</td>
<td>float</td>
<td>4</td>
<td>单精度，对小数点精确度不够高</td>
</tr>
<tr>
<td></td>
<td>double</td>
<td>8</td>
<td>双精度，对小数点精确度高</td>
</tr>
<tr>
<td>字符型</td>
<td>char</td>
<td>2</td>
<td>0到65535</td>
</tr>
<tr>
<td></td>
<td>boolean</td>
<td>1</td>
<td>true或false</td>
</tr>
</tbody></table>
<p><strong>引用数据类型</strong>：数组，String</p>
<p>整数默认为int，小数默认为double</p>
<h3 id="Java-有哪些数据类型？"><a href="#Java-有哪些数据类型？" class="headerlink" title="Java 有哪些数据类型？"></a>Java 有哪些数据类型？</h3><p><strong>定义：</strong>Java 语言是强类型语言，对于每一种数据都定义了明确的具体的数据类型，在内存中分配了不同大小的内存空间。</p>
<p>Java 语言数据类型分为两种：<strong>基本数据类型</strong>和<strong>引用数据类型</strong>。</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/javase-6.png" alt="Java数据类型">Java数据类型</p>
<p><strong>基本数据类型：</strong></p>
<ul>
<li>数值型<ul>
<li>整数类型（byte、short、int、long）</li>
<li>浮点类型（float、double）</li>
</ul>
</li>
<li>字符型（char）</li>
<li>布尔型（boolean）</li>
</ul>
<p>Java 基本数据类型范围和默认值：</p>
<table>
<thead>
<tr>
<th>基本类型</th>
<th>位数</th>
<th>字节</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td><code>int</code></td>
<td>32</td>
<td>4</td>
<td>0</td>
</tr>
<tr>
<td><code>short</code></td>
<td>16</td>
<td>2</td>
<td>0</td>
</tr>
<tr>
<td><code>long</code></td>
<td>64</td>
<td>8</td>
<td>0L</td>
</tr>
<tr>
<td><code>byte</code></td>
<td>8</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td><code>char</code></td>
<td>16</td>
<td>2</td>
<td>‘u0000’</td>
</tr>
<tr>
<td><code>float</code></td>
<td>32</td>
<td>4</td>
<td>0f</td>
</tr>
<tr>
<td><code>double</code></td>
<td>64</td>
<td>8</td>
<td>0d</td>
</tr>
<tr>
<td><code>boolean</code></td>
<td>8</td>
<td>1</td>
<td>false</td>
</tr>
</tbody></table>
<p><strong>引用数据类型：</strong></p>
<ul>
<li>类（class）</li>
<li>接口（interface）</li>
<li>数组([])</li>
</ul>
<h2 id="第二部分：数组"><a href="#第二部分：数组" class="headerlink" title="第二部分：数组"></a>第二部分：数组</h2><h3 id="动态初始化-长度确定推荐用"><a href="#动态初始化-长度确定推荐用" class="headerlink" title="动态初始化(长度确定推荐用)"></a><strong>动态初始化</strong>(长度确定推荐用)</h3><p>String[] arr = new String[3];初始化字符串数组为3的数组，String为引用数据类型，初始值为null</p>
<p>int[] arr = new int[3];初始化整形数组为3的数组，int的初始值为0</p>
<h3 id="静态初始化（已经确定元素值推荐使用）"><a href="#静态初始化（已经确定元素值推荐使用）" class="headerlink" title="静态初始化（已经确定元素值推荐使用）"></a><strong>静态初始化</strong>（已经确定元素值推荐使用）</h3><p>String[] arr = {“kang”,”wang”,”wei”};</p>
<p>int[] arr = {1,2,3,4};</p>
<h3 id="数组元素的表示"><a href="#数组元素的表示" class="headerlink" title="数组元素的表示"></a><strong>数组元素的表示</strong></h3><p>arr[0] = 1;</p>
<p>arr[2] = 3;</p>
<h3 id="介绍堆栈"><a href="#介绍堆栈" class="headerlink" title="介绍堆栈"></a><strong>介绍堆栈</strong></h3><p><strong>栈</strong>：方法调用都要进栈,局部变量（方法当中定义的变量）都存储在栈中</p>
<p><strong>堆</strong> ：new出来的东西都在堆中</p>
<p><strong>数组的内存图</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231008125840813.png" alt="image-20231008125840813"></p>
<p>数组的实体保存在堆中，数组名实际保存的是数组实体所对应的地址值</p>
<p><strong>数组中最大值</strong></p>
<p>用擂台法，将数组第一个值作为擂主，依次让下一个数进入擂台，大于擂台上的数就成为擂主，最后打印这个擂主（从第二个数开始，分别拿元素值和max比较，如果元素值大于max。就把元素值赋值给max）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> arr[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>; i&lt; arr.length; i++)&#123;</span><br><span class="line">    <span class="keyword">if</span> (arr[i]&gt;max)</span><br><span class="line">    &#123;</span><br><span class="line">        max = arr[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>练习2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入10个值，找出最大值，最小值，总和</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">sc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            arr[i] = sc.nextInt();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> arr[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> arr[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            sum += arr[i];</span><br><span class="line">            <span class="keyword">if</span> (arr[i]&gt;max)</span><br><span class="line">            &#123;</span><br><span class="line">                max = arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (arr[i]&lt;min)</span><br><span class="line">            &#123;</span><br><span class="line">                min = arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;sum = &quot;</span> + sum);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;max = &quot;</span> + max);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;min = &quot;</span> + min);</span><br></pre></td></tr></table></figure>



<p>练习4</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//求个位和十位都是7并且是偶数</span></span><br><span class="line">       <span class="type">int</span>[] arr = &#123;<span class="number">171</span>,<span class="number">72</span>,<span class="number">19</span>,<span class="number">16</span>,<span class="number">118</span>,<span class="number">51</span>,<span class="number">210</span>,<span class="number">7</span>,<span class="number">18</span>&#125;;</span><br><span class="line">       <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">           <span class="keyword">if</span> (arr[i]%<span class="number">10</span>!=<span class="number">7</span>&amp;&amp;arr[i]/<span class="number">10</span>%<span class="number">10</span>!=<span class="number">7</span>&amp;&amp;arr[i]%<span class="number">2</span>==<span class="number">0</span>) &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;i = &quot;</span> + arr[i]);</span><br><span class="line">               sum += arr[i];</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(<span class="string">&quot;sum = &quot;</span> + sum);</span><br><span class="line">       <span class="comment">/*个位数 i%10</span></span><br><span class="line"><span class="comment">       十位数 i/10%10</span></span><br><span class="line"><span class="comment">       百位数 i/100%10</span></span><br><span class="line"><span class="comment">       千位数 i/1000%10</span></span><br><span class="line"><span class="comment">       */</span>  </span><br></pre></td></tr></table></figure>



<h3 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h3><p>对数组元素从大到小进行排序</p>
<p>冒泡排序：从第一个开始往后一个进行比较，小就互换，直到最后一个数是最小的。再循环一次倒数第二个最小…..依次进行</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231008190533447.png" alt="image-20231008190533447"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 冒泡排序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span>[] arr1 = &#123;<span class="number">5</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">13</span>,<span class="number">43</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; arr1.length-<span class="number">1</span>; j++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr1.length - <span class="number">1</span> - j; i++)         &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr1[i] &lt; arr1[i + <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> arr1[i];</span><br><span class="line">            arr1[i] = arr1[i + <span class="number">1</span>];</span><br><span class="line">            arr1[i + <span class="number">1</span>] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr1.length; i++) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;arr1 = &quot;</span> + arr1[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="不死神兔"><a href="#不死神兔" class="headerlink" title="不死神兔"></a><strong>不死神兔</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不死神兔,1,1,2,3,5,8,13,21......</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span>[] arr3 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">20</span>];</span><br><span class="line">arr3[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">arr3[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;arr3.length; i++) &#123;</span><br><span class="line">    arr3[i] = arr3[i-<span class="number">1</span>]+arr3[i-<span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(arr3[<span class="number">19</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="第三部分：方法"><a href="#第三部分：方法" class="headerlink" title="第三部分：方法"></a>第三部分：方法</h2><h3 id="方法定义格式："><a href="#方法定义格式：" class="headerlink" title="方法定义格式："></a>方法定义格式：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">修饰符 返回类型 变量名 （形参）&#123;</span><br><span class="line">       方法体;</span><br><span class="line">       <span class="keyword">return</span> 返回值;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第四部分：面向对象"><a href="#第四部分：面向对象" class="headerlink" title="第四部分：面向对象"></a>第四部分：面向对象</h2><h3 id="this关键字"><a href="#this关键字" class="headerlink" title="this关键字"></a>this关键字</h3><p>this关键字：this可以区分成员变量和局部变量，加了this关键字的是成员变量。</p>
<p>this关键字只能在一个类的成员方法和构造方法中使用</p>
<ul>
<li><p>this关键字代表着什么呢？</p>
<p>哪个对象调用成员方法，就代表那个对象</p>
</li>
</ul>
<h3 id="构造方法和set方法"><a href="#构造方法和set方法" class="headerlink" title="构造方法和set方法"></a>构造方法和set方法</h3><p>构造方法初始化给对象赋值，不能再通过构造方法赋值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> (<span class="string">&quot;张三&quot;</span>,<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line">s = <span class="keyword">new</span> (<span class="string">&quot;李四&quot;</span>,<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这样是不对的</span></span><br></pre></td></tr></table></figure>

<p>但是可以通过set方法给对象重新赋值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Student</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> (<span class="string">&quot;张三&quot;</span>,<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line">s.setName=<span class="string">&quot;李四&quot;</span>;</span><br><span class="line">s.setAge=<span class="number">20</span>;</span><br><span class="line"><span class="comment">//这样是对的</span></span><br></pre></td></tr></table></figure>

<h3 id="this和super关键字"><a href="#this和super关键字" class="headerlink" title="this和super关键字"></a>this和super关键字</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009144754961.png" alt="image-20231009144754961"></p>
<h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a><strong>多态</strong></h3><p>同一个数据类型的不同对象对同一行为有着不同的表现</p>
<p>比如动物（猫、狗对叫和吃有不同的表现）</p>
<p><strong>三个条件：</strong></p>
<ul>
<li>父类引用指向子类对象</li>
<li>方法的重写（子类重写父类的方法）</li>
<li>方法的继承</li>
</ul>
<p><strong>访问特点</strong></p>
<ul>
<li><p>成员变量：编译看左边，运行看左边。意思是编译的时候看Animal有没有age变量，没有报错，运行的时候看Animal的age的值，值为父类的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line">System.out.println(animal.age);</span><br></pre></td></tr></table></figure></li>
<li><p>成员方法：编译看左边，运行看右边。意思是编译的时候看Animal有没有eat方法，没有报错，运行的时候看Dog类中有没有重写父类的eat方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">cat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Cat</span>();</span><br><span class="line">cat.eat();</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>向上转型和向下转型</strong></p>
<ul>
<li><p>向上转型：子类转父类(绝对安全，自动类型转换)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br></pre></td></tr></table></figure></li>
<li><p>向下转型：父类强转为子类(不绝对安全所以必须使用强制类型转化)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Animal</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dog</span>();</span><br><span class="line"><span class="type">Dog</span> <span class="variable">dog</span> <span class="operator">=</span> (Dog)a;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>instanceof进行类型判断</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if(对象 instanceof 类名/接口名)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">if (a instanceof  Dog) &#123;</span><br><span class="line">   //a属于狗,将a强转为狗</span><br><span class="line">   Dog dog = Dog(a);</span><br><span class="line">&#125;</span><br><span class="line">if (a instanceof  Cat) &#123;</span><br><span class="line">   //a属于猫,将a强转为猫</span><br><span class="line">   Cat cat = Cat(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>static关键字</strong></p>
<p>static是一个修饰符，被其修饰的成员就属于类了，会被类所有的对象共享</p>
<p>加了static的变量，可以用类名.变量名/方法名调用</p>
<p>无需构建实例对象就可以调用这个方法或者变量</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009184136416.png" alt="image-20231009184136416"></p>
<ul>
<li><p>静态方法不能访问非静态的成员</p>
</li>
<li><p>静态方法中不能有this关键字</p>
</li>
</ul>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009185104668.png" alt="image-20231009185104668"></p>
<p><strong>final</strong></p>
<p>修饰类、成员方法、局部变量、成员变量</p>
<p>不能继承、不能重写、变为常量赋值之后不能改变、 成员变量必须初始化。有两种初始化方式，一种是直接赋值另一种是再类的所有构造方法中对其赋值</p>
<p><strong>abstract</strong></p>
<p>abstract在方法中加入，然后可以提示·让这个方法来重写</p>
<p>当一个类有一个方法，这个方法在不同的子类中都有不同的实现的时候，在父类中我们没有去写具体的方法体，这个时候就可以使用抽象（不写方法体）</p>
<p>父类方法有个抽象方法，子类必须重写这个抽象方法</p>
<p><strong>注意</strong></p>
<ul>
<li> 抽象类可以有抽象方法</li>
<li>抽象类不能够直接创建对象</li>
<li>父类方法有个抽象方法，子类必须重写这个抽象方法或者把这个子类定义成抽象类</li>
</ul>
<p><strong>接口</strong></p>
<p>变量为 public static final </p>
<p>方法为 public abstract </p>
<p><strong>接口新增成员</strong></p>
<ul>
<li><p>默认方法</p>
<p>默认方法可以有方法体，可以选择不进行重写 default</p>
<p>如果两个接口中有相同的默认方法，一个类同时实现了这个两个接口，必须也要重写该方法</p>
</li>
<li><p>静态方法</p>
<p>不让实现类去重写该方法。直接用方法接口.这个方法来体现 static</p>
</li>
<li><p>私有方法（jdk9以上）</p>
<p>可以存在方法体，方法不可以被重写 private</p>
<p>private static void privateMethod(){</p>
<p>}</p>
<p>private void privateMethod(){</p>
<p>}</p>
<p>对默认方法和静态方法中的代码进行抽取，提高代码的复用</p>
</li>
</ul>
<p><strong>继承和接口的关系</strong></p>
<p>继承单继承  </p>
<p>一个类可以实现多个接口</p>
<p><strong>抽象类和接口的区别</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009195119383.png" alt="image-20231009195119383"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231009195154552.png" alt="image-20231009195154552"></p>
<p><strong>代码块</strong></p>
<ul>
<li><p>局部代码块</p>
<p>控制局部变量的生命周期，想让它再使用完之后尽快销毁，可以把局部变量定义在局部代码块当中，在局部代码块之外不能访问局部代码块里面的内容</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;这是局部代码块&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>构造代码块</p>
<p>创建对象的时候先执行静态代码块，再执行构造方法</p>
<p>构造方法当中重复的代码，放到构造代码块当中，让其先执行，解决代码重复度</p>
<p>（用来抽取构造方法中的重复代码，提高代码的复用性）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;这是构造代码块&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>静态代码块</p>
<p>调用时机：在类的加载的时候会执行，同一个类在程序运行过程中只会加载一次，所以静态代码块也只会执行一次，并且执行顺序是在构造代码块之前的</p>
<p>用来给类当中的静态成员变量初始化，来避免用类名调用这个变量的时候没有被初始化</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> staticNum;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        staticNum = <span class="number">10</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;这里是静态代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">        age=<span class="number">1</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;这里是构造代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="comment">// age =1;</span></span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Demo</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="comment">// age =1;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;这是局部代码块&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>内部类</strong></p>
<ul>
<li><p>局部内部类</p>
<p>如果想定义一个在方法中临时使用的累时可以使用局部内部类</p>
<p>换句话说，如果只想让一个方法使用一个类的另一个方法时，定义局部内部类。</p>
<p>注意事项：局部内部类可以使用外部局部（事实）常量 final</p>
</li>
<li><p>成员内部类</p>
<p>在一个类中定义另外一个类（成员内部类），成员内部类可以访问外部类的私有变量</p>
<p>外部类名.this.成员名来表示外部类的成员</p>
<p>成员内部类不能定义静态成员（非静态中不使用静态）</p>
<p>应用场景：一个类不会单独使用，需要和另外的类一起使用才有意义，并且在用到外部类中的私有方法的时候，可以把这个类定义成内部类</p>
<p>IntegerCache</p>
</li>
<li><p>静态内部类</p>
<p>静态内部类里面可以定义静态成员变量和静态成员方法</p>
<p>静态内部类可以调用外部类的（私有的）静态成员变量（事实常量）</p>
</li>
<li><p>匿名内部类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> 接口名/类名()&#123;</span><br><span class="line">要重写的方法(抽象方法)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果需要创建一个类或者接口的子类对象。但是这个子类只会使用一次，就没有必要创建单独的类。可以使用匿名内部类的形式。</p>
<p>匿名内部类就相当于一个对象，他是某个类（接口）的子类（实现类）的对象</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo02</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Inter <span class="title function_">createItr</span><span class="params">()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//对象的创建格式</span></span><br><span class="line">        <span class="type">Inter</span> <span class="variable">inter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Inter</span>();</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//成员内部类</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Inter</span>&#123;</span><br><span class="line">        String s;</span><br><span class="line">        <span class="type">int</span> age;</span><br><span class="line">        </span><br><span class="line">        Demo02.<span class="built_in">this</span>.age;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Inter</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Inter</span><span class="params">(String s, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.s = s;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//静态内部类</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">staticMethod</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//可以调用外部类的静态成员变量</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testMe</span><span class="params">()</span>&#123;</span><br><span class="line">            System.out.println(age);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//匿名内部类</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Runner</span>()&#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;正在运行&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第五部分：常用类"><a href="#第五部分：常用类" class="headerlink" title="第五部分：常用类"></a>第五部分：常用类</h2><h3 id="equals和-的区别"><a href="#equals和-的区别" class="headerlink" title="equals和==的区别"></a>equals和==的区别</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">一、对象类型不同</span><br><span class="line"></span><br><span class="line">1、equals()：是超类Object中的方法。</span><br><span class="line"></span><br><span class="line">2、==：是操作符。</span><br><span class="line"></span><br><span class="line">二、比较的对象不同</span><br><span class="line"></span><br><span class="line">1、equals()：用来检测两个对象是否相等，即两个对象的内容是否相等。</span><br><span class="line"></span><br><span class="line">2、==：用于比较引用和比较基本数据类型时具有不同的功能，具体如下：</span><br><span class="line"></span><br><span class="line">（1）、基础数据类型：比较的是他们的值是否相等，比如两个int类型的变量，比较的是变量的值是否一样。</span><br><span class="line"></span><br><span class="line">（2）、引用数据类型：比较的是引用的地址是否相同，比如说新建了两个User对象，比较的是两个User的地址是否一样。</span><br><span class="line"></span><br><span class="line">三、运行速度不同</span><br><span class="line"></span><br><span class="line">1、equals()：没有==运行速度快。</span><br><span class="line"></span><br><span class="line">2、==：运行速度比equals()快，因为==只是比较引用。</span><br><span class="line"></span><br><span class="line">扩展资料：</span><br><span class="line">equals()和==的源码定义：</span><br><span class="line"></span><br><span class="line">public boolean equals(Object obj) &#123;</span><br><span class="line"></span><br><span class="line">return (this == obj);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">由equals的源码可以看出这里定义的equals与==是等效的（Object类中的equals没什么区别），不同的原因就在于有些类（像String、Integer等类）对equals进行了重写。</span><br><span class="line"></span><br><span class="line">但是没有对equals进行重写的类就只能从Object类中继承equals方法，其equals方法与==就也是等效的，除非在此类中重写equals。</span><br><span class="line"></span><br><span class="line">对equals重新需要注意五点：</span><br><span class="line"></span><br><span class="line">1、自反性：对任意引用值X，x.equals(x)的返回值一定为true；</span><br><span class="line"></span><br><span class="line">2、对称性：对于任何引用值x,y,当且仅当y.equals(x)返回值为true时，x.equals(y)的返回值一定为true；</span><br><span class="line"></span><br><span class="line">3、传递性：如果x.equals(y)=true, y.equals(z)=true,则x.equals(z)=true ；</span><br><span class="line"></span><br><span class="line">4、 一致性：如果参与比较的对象没任何改变，则对象比较的结果也不应该有任何改变；</span><br><span class="line"></span><br><span class="line">5、非空性：任何非空的引用值X，x.equals(null)的返回值一定为false 。</span><br><span class="line"></span><br><span class="line">==：</span><br><span class="line">== 比较的是变量(栈)内存中存放的对象的(堆)内存地址，用来判断两个对象的地址是否相同，即是否是指相同一个对象。比较的是真正意义上的指针操作。</span><br><span class="line"></span><br><span class="line">1、比较的是操作符两端的操作数是否是同一个对象。</span><br><span class="line"></span><br><span class="line">2、两边的操作数必须是同一类型的（可以是父子类之间）才能编译通过。</span><br><span class="line"></span><br><span class="line">3、比较的是地址，如果是具体的阿拉伯数字的比较，值相等则为true，如：</span><br><span class="line"></span><br><span class="line">int a=10 与 long b=10L 与 double c=10.0都是相同的（为true），因为他们都指向地址为10的堆。</span><br><span class="line"></span><br><span class="line">equals：</span><br><span class="line">equals用来比较的是两个对象的内容是否相等，由于所有的类都是继承自java.lang.Object类的，所以适用于所有对象，如果没有对该方法进行覆盖的话，调用的仍然是Object类中的方法，而Object中的equals方法返回的却是==的判断。</span><br><span class="line"></span><br><span class="line">String s=&quot;abce&quot;是一种非常特殊的形式,和new 有本质的区别。它是java中唯一不需要new 就可以产生对象的途径。</span><br><span class="line"></span><br><span class="line">以String s=&quot;abce&quot;;形式赋值在java中叫直接量,它是在常量池中而不是象new一样放在压缩堆中。这种形式的字符串，在JVM内部发生字符串拘留，即当声明这样的一个字符串后，JVM会在常量池中先查找有有没有一个值为&quot;abcd&quot;的对象。</span><br><span class="line"></span><br><span class="line">如果有，就会把它赋给当前引用.即原来那个引用和现在这个引用指点向了同一对象，如果没有，则在常量池中新创建一个“abcd&quot;”，下一次如果有Strings1=&quot;abcd&quot;；又会将s1指向“abcd”这个对象，即以这形式声明的字符串，只要值相等，任何多个引用都指向同一对象。</span><br><span class="line"></span><br><span class="line">而String s=new String（&quot;abcd”）；和其它任何对象一样.每调用一次就产生一个对象，只要它们调用。</span><br><span class="line"></span><br><span class="line">也可以这么理解：String str=&quot;hello”；先在内存中找是不是有“hello”这个对象，如果有，就让str指向那个“hello”。</span><br><span class="line"></span><br><span class="line">如果内存里没有&quot;hello&quot;，就创建一个新的对象保存&quot;hello”.String str=new String（“hello&quot;）就是不管内存里是不是已经有&quot;hello&quot;这个对象，都新建一个对象保存&quot;hello&quot;。</span><br></pre></td></tr></table></figure>

<h3 id="String常用方法"><a href="#String常用方法" class="headerlink" title="String常用方法"></a>String常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011162154691.png" alt="image-20231011162154691"></p>
<h3 id="自动装箱和拆箱"><a href="#自动装箱和拆箱" class="headerlink" title="自动装箱和拆箱"></a>自动装箱和拆箱</h3><p>自动装箱：基本数据类型-&gt;包装类（包装类的valueOf来转化的，-128~127，在的话在Integer缓存的数组当中拿到对应的Integer对象返回，在这个里面的话就相等，不在这个范围里面，就会new一个Integer对象）</p>
<p>Integer引用数据类型，比较地址值是否相同</p>
<p>自动拆箱：包装类-&gt;基本数据类型</p>
<h3 id="StringBuilder的常用方法"><a href="#StringBuilder的常用方法" class="headerlink" title="StringBuilder的常用方法"></a>StringBuilder的常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011165640479.png" alt="image-20231011165640479"></p>
<p>String-&gt; StringBuffer/StringBuilder</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//String ------- StringBuffer</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="comment">//通过构造方法</span></span><br><span class="line"><span class="type">StringBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>(s);</span><br></pre></td></tr></table></figure>

<h3 id="String-和-StringBuilder、StringBuffer-的区别？"><a href="#String-和-StringBuilder、StringBuffer-的区别？" class="headerlink" title="String 和 StringBuilder、StringBuffer 的区别？"></a>String 和 StringBuilder、StringBuffer 的区别？</h3><ul>
<li>String：String 的值被创建后不能修改，任何对 String 的修改都会引发新的 String 对象的生成。</li>
<li>StringBuffer：跟 String 类似，但是值可以被修改，使用 synchronized 来保证线程安全。</li>
<li>StringBuilder：StringBuffer 的非线程安全版本，性能上更高一些</li>
</ul>
<h2 id="第六部分：异常"><a href="#第六部分：异常" class="headerlink" title="第六部分：异常"></a>第六部分：异常</h2><h3 id="try-catch"><a href="#try-catch" class="headerlink" title="try catch"></a>try catch</h3><p>直接处理</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011172005678.png" alt="image-20231011172005678"></p>
<h3 id="throws"><a href="#throws" class="headerlink" title="throws"></a>throws</h3><p>把异常抛出，让调用者来处理</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011171904538.png" alt="image-20231011171904538"></p>
<h3 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyException</span><span class="params">(String msg)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>(msg);<span class="comment">//调用父类</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MyException</span>(<span class="string">&quot;编译时异常&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>异常的作用：</p>
<ul>
<li>可以帮我们获得具体的错误原因</li>
<li>可以让方法调用方知道错误的地方</li>
</ul>
<h2 id="第七部分：集合"><a href="#第七部分：集合" class="headerlink" title="第七部分：集合"></a>第七部分：集合</h2><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><h3 id="List集合特点"><a href="#List集合特点" class="headerlink" title="List集合特点"></a>List集合特点</h3><ul>
<li>有索引</li>
<li>可以存储重复元素</li>
<li>元素存入的顺序和实际存储的顺序相同</li>
</ul>
<h3 id="ArrayList常用方法"><a href="#ArrayList常用方法" class="headerlink" title="ArrayList常用方法"></a>ArrayList常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011183335381.png" alt="image-20231011183335381"></p>
<h3 id="遍历方式"><a href="#遍历方式" class="headerlink" title="遍历方式"></a>遍历方式</h3><ul>
<li><p>索引遍历</p>
<p>集合.size()  get()</p>
</li>
<li><p>迭代器遍历</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;Object&gt; iterator = arrayList.iterator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">    System.out.println(iterator.next());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在迭代器删除增加数据的时候会引发并发修改异常</p>
</li>
<li><p>可以使用for循环遍历来避免；或者就是新建一个集合，然后将需要删除的元素增加到新的集合中，再用原来的集合将新的集合中的元素移除removeAll()</p>
</li>
<li><p>foreach也会出现并发修改异常，循环集合的时候（相当于迭代器）</p>
</li>
<li><p>集合变数组-&gt;toArray()</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String[] strings = arrayList.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<p>​              后面是new什么类型的返回什么样的数组</p>
<p><strong>集合遍历四种形式</strong></p>
<ul>
<li>for循环遍历</li>
<li>迭代器遍历</li>
<li>foreach遍历</li>
<li>转化为数组再遍历</li>
</ul>
<h3 id="LinkedList常用方法"><a href="#LinkedList常用方法" class="headerlink" title="LinkedList常用方法"></a>LinkedList常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011193855883.png" alt="image-20231011193855883"></p>
<p>遍历同ArrayList</p>
<h3 id="ArrayList和LinkedList有什么区别？"><a href="#ArrayList和LinkedList有什么区别？" class="headerlink" title="ArrayList和LinkedList有什么区别？"></a>ArrayList和LinkedList有什么区别？</h3><p>ArrayList数组：查找快，增删慢</p>
<p>LinkedList链表：相反</p>
<p><strong>（1）</strong>数据结构不同</p>
<ul>
<li>ArrayList基于数组实现</li>
<li>LinkedList基于双向链表实现</li>
</ul>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-2.png" alt="ArrayList和LinkedList的数据结构">ArrayList和LinkedList的数据结构</p>
<p><strong>（2）</strong> 多数情况下，ArrayList更利于查找，LinkedList更利于增删</p>
<ul>
<li>ArrayList基于数组实现，get(int index)可以直接通过数组下标获取，时间复杂度是O(1)；LinkedList基于链表实现，get(int index)需要遍历链表，时间复杂度是O(n)；当然，get(E element)这种查找，两种集合都需要遍历，时间复杂度都是O(n)。</li>
<li>ArrayList增删如果是数组末尾的位置，直接插入或者删除就可以了，但是如果插入中间的位置，就需要把插入位置后的元素都向前或者向后移动，甚至还有可能触发扩容；双向链表的插入和删除只需要改变前驱节点、后继节点和插入节点的指向就行了，不需要移动元素。</li>
</ul>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-3.png" alt="ArrayList和LinkedList中间插入">ArrayList和LinkedList中间插入</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/collection-4.png" alt="ArrayList和LinkedList中间删除">ArrayList和LinkedList中间删除</p>
<blockquote>
<p>注意，这个地方可能会出陷阱，LinkedList更利于增删更多是体现在平均步长上，不是体现在时间复杂度上，二者增删的时间复杂度都是O(n)</p>
</blockquote>
<p><strong>（3）</strong>是否支持随机访问</p>
<ul>
<li>ArrayList基于数组，所以它可以根据下标查找，支持随机访问，当然，它也实现了RandmoAccess 接口，这个接口只是用来标识是否支持随机访问。</li>
<li>LinkedList基于链表，所以它没法根据序号直接获取元素，它没有实现RandmoAccess 接口，标记不支持随机访问。</li>
</ul>
<p><strong>（4）</strong>内存占用，ArrayList基于数组，是一块连续的内存空间，LinkedList基于链表，内存空间不连续，它们在空间占用上都有一些额外的消耗：</p>
<ul>
<li>ArrayList是预先定义好的数组，可能会有空的内存空间，存在一定空间浪费</li>
<li>LinkedList每个节点，需要存储前驱和后继，所以每个节点会占用更多的空间</li>
</ul>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><h4 id="Set集合的特点"><a href="#Set集合的特点" class="headerlink" title="Set集合的特点"></a>Set集合的特点</h4><p>不存储重复值</p>
<p>没有索引</p>
<p>不按顺序存储，随机存储</p>
<h4 id="HashSet集合的特点"><a href="#HashSet集合的特点" class="headerlink" title="HashSet集合的特点"></a>HashSet集合的特点</h4><ul>
<li>底层数据结构是哈希表</li>
<li>存储元素和遍历元素顺序可能不一样</li>
<li>没有索引</li>
<li>不存在重复元素</li>
</ul>
<h4 id="HashSet集合的常用方法"><a href="#HashSet集合的常用方法" class="headerlink" title="HashSet集合的常用方法"></a>HashSet集合的常用方法</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011195713951.png" alt="image-20231011195713951"></p>
<h4 id="HashSet集合的遍历"><a href="#HashSet集合的遍历" class="headerlink" title="HashSet集合的遍历"></a>HashSet集合的遍历</h4><p>转为数组</p>
<p>迭代器</p>
<p>foreach</p>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011200259331.png" alt="image-20231011200259331"></p>
<p>key有了之后，然后再添加，会覆盖前面的设置value</p>
<ul>
<li><p>对象创建</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HashMap&lt;String,String&gt; mm = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure></li>
<li><p>常用方法</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231011205506742.png" alt="image-20231011205506742"></p>
<p>map.put()，如果key已存在，则会覆盖原先的值，并会返回老的值</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;k&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">HashMap&lt;String,String&gt; mm = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">map.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;k&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;z&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;3&quot;</span>,<span class="string">&quot;y&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//key 1存在</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> map.put(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;康&quot;</span>);</span><br><span class="line"><span class="comment">//s1=康</span></span><br><span class="line">System.out.println(<span class="string">&quot;s1&quot;</span>+s1);</span><br><span class="line"><span class="comment">//获取</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> map.get(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;s = &quot;</span> + s);</span><br><span class="line"></span><br><span class="line"><span class="comment">//移除</span></span><br><span class="line"><span class="type">String</span> <span class="variable">remove</span> <span class="operator">=</span> map.remove(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;remove = &quot;</span> + remove);</span><br><span class="line"></span><br><span class="line"><span class="comment">//判断是否存在键再不再</span></span><br><span class="line"><span class="keyword">if</span> (map.containsKey(<span class="string">&quot;1&quot;</span>))&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> mm.get(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;s1 = &quot;</span> + s1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//清空所有键值对</span></span><br><span class="line">mm.clear();</span><br></pre></td></tr></table></figure>

<p><strong>map集合的遍历</strong></p>
<ul>
<li><p>map.entrySet() 获取所有key和value，存到set集合中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;k&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Set&lt;Map.Entry&lt;String, String&gt;&gt; entries = map.entrySet();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : entries) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;entry.getKey() = &quot;</span> + entry.getKey()+entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>map.keySet 获取的是所有key的值，然后遍历key再获取value</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; strings = map.keySet();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (String key : strings) &#123;</span><br><span class="line">    System.out.println(key+<span class="string">&quot;+++++&quot;</span>+map.get(key));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>equals和hashCode重写的话，属性值相同就相同，就是同一个对象</p>
<p>不重写的话，比较的是地址值</p>
<h2 id="第八部分：泛型"><a href="#第八部分：泛型" class="headerlink" title="第八部分：泛型"></a>第八部分：泛型</h2><h3 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h3><p>创建子类的时候可以指定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Test&lt;T&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="泛型方法"><a href="#泛型方法" class="headerlink" title="泛型方法"></a>泛型方法</h3><p>方法调用时可以指定</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">test</span><span class="params">(T t)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>向上转型 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span> <span class="params">(List&lt;? extends Student&gt;)</span></span><br></pre></td></tr></table></figure>

<p>只能传入Student类本身和Student类的子类</p>
<p>向下转型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span> <span class="params">(List&lt;? <span class="built_in">super</span> Student&gt;)</span></span><br></pre></td></tr></table></figure>

<p>只能传入泛型为Student类本身和Student类的父类</p>
<p>泛型上限是在定义类可以使用但是？用E来代替</p>
<p>泛型下限是在定义方法时常使用</p>
<h2 id="第九部分：IO"><a href="#第九部分：IO" class="headerlink" title="第九部分：IO"></a>第九部分：IO</h2><h3 id="建对象"><a href="#建对象" class="headerlink" title="建对象"></a>建对象</h3><p>绝对路径：C:\Users\康\Desktop\git\1.txt</p>
<p>相对路径：1.txt</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231012190150277.png" alt="image-20231012190150277"></p>
<h3 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231012191119070.png" alt="image-20231012191119070"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">newFile</span> <span class="operator">=</span> file.createNewFile();</span><br><span class="line">    System.out.println(<span class="string">&quot;newFile = &quot;</span> + newFile);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\2&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">newFile1</span> <span class="operator">=</span> file.mkdir();</span><br><span class="line">    System.out.println(<span class="string">&quot;newFile1 = &quot;</span> + newFile1);</span><br><span class="line"></span><br><span class="line">    <span class="type">File</span> <span class="variable">file3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1\\2&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">a</span> <span class="operator">=</span> file3.mkdirs();</span><br><span class="line">    System.out.println(<span class="string">&quot;a = &quot;</span> + a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第十部分：递归"><a href="#第十部分：递归" class="headerlink" title="第十部分：递归"></a>第十部分：递归</h2><p>一般循环和递归都能解决，用循环来解决。递归可能导致栈溢出</p>
<h3 id="求阶乘"><a href="#求阶乘" class="headerlink" title="求阶乘"></a>求阶乘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">jiecheng</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i==<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i*jiecheng(i-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//递归删除文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">deleteFile</span><span class="params">(File file)</span>&#123;</span><br><span class="line">    File[] files = file.listFiles();</span><br><span class="line">    <span class="keyword">if</span> (files!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (File file1 : files) &#123;</span><br><span class="line">            <span class="keyword">if</span>(file1.isFile())</span><br><span class="line">            &#123;</span><br><span class="line">                file1.delete();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (file1.isDirectory())&#123;</span><br><span class="line">                &#123;</span><br><span class="line">                deleteFile(file1);</span><br><span class="line">                file1.delete();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="第十一部分：IO流"><a href="#第十一部分：IO流" class="headerlink" title="第十一部分：IO流"></a>第十一部分：IO流</h2><h3 id="IO流的分类"><a href="#IO流的分类" class="headerlink" title="IO流的分类"></a>IO流的分类</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231013181910168.png" alt="image-20231013181910168"></p>
<h3 id="字节输入流"><a href="#字节输入流" class="headerlink" title="字节输入流"></a>字节输入流</h3><p>创建对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入流读对象</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fileInputStream1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(file);</span><br><span class="line">System.out.println(<span class="string">&quot;fileInputStream1 = &quot;</span> + fileInputStream1);</span><br></pre></td></tr></table></figure>

<p>读取fileInputStream 对象</p>
<p><strong>一次读取一个字节数据</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入流读对象</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">read</span> <span class="operator">=</span> fileInputStream.read();</span><br><span class="line">sout(read);<span class="comment">//返回值为-1时，停止读取</span></span><br><span class="line"></span><br><span class="line">fileInputStream.close();</span><br></pre></td></tr></table></figure>

<p><strong>一次读取一个字节数组</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">5</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> fileInputStream.read(bytes); <span class="comment">//读取到的长度</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len);</span><br><span class="line">System.out.println(<span class="string">&quot;s = &quot;</span> + s);</span><br><span class="line">fileInputStream.close();</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入流读对象</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">        </span><br><span class="line"><span class="comment">//将读到的数据放到数组里</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">2</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>((len=fileInputStream.read(bytes))!=-<span class="number">1</span>)&#123; </span><br><span class="line">            System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len)); <span class="comment">//把数组中元素从0到len长度转换成字符串</span></span><br></pre></td></tr></table></figure>

<h3 id="资源释放的写法"><a href="#资源释放的写法" class="headerlink" title="资源释放的写法"></a>资源释放的写法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入流读对象</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    fileInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">    <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">2</span>];</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="keyword">while</span>((len=fileInputStream.read(bytes))!=-<span class="number">1</span>)&#123;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len));</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (fileInputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileInputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">exceptionq</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//输入流读对象</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>*<span class="number">2</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span>((len=fileInputStream.read(bytes))!=-<span class="number">1</span>)&#123;</span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(bytes,<span class="number">0</span>,len));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//可以省略,但最后会执行</span></span><br><span class="line"><span class="comment">//            fileInputStream.close();</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>字节流，复制文件</p>
<p>字符流，写文本什么的</p>
<h3 id="字节输出流"><a href="#字节输出流" class="headerlink" title="字节输出流"></a>字节输出流</h3><p>输出流FileOutputStream写对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws IOException &#123;</span><br><span class="line">    //输出流写对象</span><br><span class="line">    FileOutputStream fileOutputStream = new FileOutputStream(&quot;D:\\kzy\\1.txt&quot;);</span><br><span class="line"></span><br><span class="line">    byte[] bytes = &quot;123&quot;.getBytes();</span><br><span class="line">    fileOutputStream.write(bytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件续写"><a href="#文件续写" class="headerlink" title="文件续写"></a>文件续写</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileOutputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//append默认为 ：false 在建这个输出流对象的时候就会把原先文件删除</span></span><br><span class="line"><span class="comment">//append默认为 ：true 在建这个输出流对象的时候就会在原先文件继续写</span></span><br><span class="line"><span class="type">byte</span>[] bytes = <span class="string">&quot;123&quot;</span>.getBytes();</span><br><span class="line"></span><br><span class="line">fis.write(bytes);</span><br></pre></td></tr></table></figure>

<h3 id="文件复制"><a href="#文件复制" class="headerlink" title="文件复制"></a>文件复制</h3><p>首先在目标文件夹中建立一个和原文件一样名字的文件，然后通过输入流读原文件，输出流写文件到目标文件中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件复制</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">/*FileOutputStream fis = new FileOutputStream(&quot;D:\\kzy\\1.txt&quot;, true);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        byte[] bytes = &quot;123&quot;.getBytes();</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        fis.write(bytes);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//编写一个方法来实现文件的复制</span></span><br><span class="line">        <span class="comment">//相当于循环读写，直到数据读取完</span></span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1697274314932.jpg&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">destDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\c&quot;</span>);</span><br><span class="line">        copyFile(srcFile, destDir);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//原文件的绝对路径 srcFile</span></span><br><span class="line">    <span class="comment">//目标文件的存放目录路径 destDir</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFile</span><span class="params">(File srcFile, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcFile.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(srcFile);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取原文件，把读到的文件放到目标文件中</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">//先读到数组里，再从数组中写入</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            fileOutputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件夹的复制"><a href="#文件夹的复制" class="headerlink" title="文件夹的复制"></a>文件夹的复制</h3><p><strong>不考虑有子文件夹</strong></p>
<p>首先在目标文件夹中建立一个和原文件夹一样名字的文件夹，然后遍历原文件夹，获取所有文件，然后通过以上文件复制，将文件复制到对应的文件夹中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件夹复制</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//编写一个方法来实现文件的复制</span></span><br><span class="line">        <span class="comment">//相当于循环读写，直到数据读取完</span></span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test1&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">destDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        copyDir(srcFile,destDir);</span><br><span class="line">        <span class="comment">//复制一个文件夹，不考虑有子文件夹的</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyDir</span><span class="params">(File srcDir, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(srcDir.exists() &amp;&amp; srcDir.isDirectory())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;原文件夹必须存在，并且是文件夹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!destDir.exists()&amp;&amp; destDir.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;文件夹必须存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcDir.getName());</span><br><span class="line">        dir.mkdirs();</span><br><span class="line">        <span class="comment">/*FileInputStream fileInputStream = new FileInputStream(srcDir);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        FileOutputStream fileOutputStream = new FileOutputStream(file);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取原文件夹中所有文件</span></span><br><span class="line">        File[] files = srcDir.listFiles();</span><br><span class="line">        <span class="comment">//把读到的文件放到目标文件夹中</span></span><br><span class="line">        <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">            copyFile(file, dir);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFile</span><span class="params">(File srcFile, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcFile.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(srcFile);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取原文件，把读到的文件放到目标文件中</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">//先读到数组里，再从数组中写入</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            fileOutputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>考虑有子文件夹</strong></p>
<p>首先在目标文件夹中建立一个和原文件夹一样名字的文件夹，然后遍历原文件夹，获取所有文件，判断是否是文件夹，是文件夹的话通过递归复制，是文件，直接通过以上文件复制，将文件复制到对应的文件夹中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//编写一个方法来实现文件的复制</span></span><br><span class="line">        <span class="comment">//相当于循环读写，直到数据读取完</span></span><br><span class="line"></span><br><span class="line">        <span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test1&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">destDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        copyDir(srcFile,destDir);</span><br><span class="line">        <span class="comment">//复制一个文件夹，考虑有子文件夹的</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyDir</span><span class="params">(File srcDir, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(srcDir.exists() &amp;&amp; srcDir.isDirectory())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;原文件夹必须存在，并且是文件夹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!destDir.exists()&amp;&amp; destDir.isDirectory()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;文件夹必须存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">dir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcDir.getName());</span><br><span class="line">        dir.mkdirs();</span><br><span class="line">        <span class="comment">/*FileInputStream fileInputStream = new FileInputStream(srcDir);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        FileOutputStream fileOutputStream = new FileOutputStream(file);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取原文件夹中所有文件</span></span><br><span class="line">        File[] files = srcDir.listFiles();</span><br><span class="line">        <span class="comment">//把读到的文件放到目标文件夹中</span></span><br><span class="line">        <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file.isFile()) &#123;</span><br><span class="line">                copyFile(file, dir);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (file.isDirectory())&#123;</span><br><span class="line">                copyDir(file,dir);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFile</span><span class="params">(File srcFile, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcFile.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(srcFile);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取原文件，把读到的文件放到目标文件中</span></span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">//先读到数组里，再从数组中写入</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            fileOutputStream.write(bytes, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编码和解码（字节流）"><a href="#编码和解码（字节流）" class="headerlink" title="编码和解码（字节流）"></a>编码和解码（字节流）</h3><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231014193530811.png" alt="image-20231014193530811" style="zoom:150%;" />

<p>编码和解码方式相同才不会乱码</p>
<p>默认时UTF-8</p>
<h3 id="字符流"><a href="#字符流" class="headerlink" title="字符流"></a>字符流</h3><p>当我们读取（写入）的是纯文本的形式时，我们可以用字符流来进行操作</p>
<ul>
<li><h3 id="字符输入流"><a href="#字符输入流" class="headerlink" title="字符输入流"></a>字符输入流</h3></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 字符输入流</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//        FileReader fileReader = new FileReader(&quot;D:\\kzy\\test1\\1.txt&quot;);</span></span><br><span class="line">        <span class="type">FileReader</span> <span class="variable">fileReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test1\\1.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*        //读一个字符</span></span><br><span class="line"><span class="comment">        int len;</span></span><br><span class="line"><span class="comment">        while ((len = fileReader.read())!=-1)&#123;</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;fileReader.read() = &quot; + (char)len);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//读一个字符数组</span></span><br><span class="line">        <span class="type">char</span>[] chars = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span>*<span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len2;</span><br><span class="line">        <span class="keyword">while</span> ((len2 = fileReader.read(chars))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;fileReader.read() = &quot;</span> + <span class="keyword">new</span> <span class="title class_">String</span>(chars));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fileReader.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h3 id="字符输出流"><a href="#字符输出流" class="headerlink" title="字符输出流"></a>字符输出流</h3><p>write会先将写入的数据放在内存缓冲区,flush或者close时，才会真正写入</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取一个字符</span></span><br><span class="line"><span class="comment">//必须是文件，不能是文件夹</span></span><br><span class="line"><span class="type">FileWriter</span> <span class="variable">fileWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="keyword">new</span>         <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\test1\\1.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line">fileWriter.write(<span class="string">&quot;你&quot;</span>);</span><br><span class="line">fileWriter.flush();</span><br><span class="line">fileWriter.write(<span class="string">&quot;最&quot;</span>);</span><br><span class="line">fileWriter.write(<span class="string">&quot;棒&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//写入字符数组</span></span><br><span class="line"><span class="type">char</span>[] chars = <span class="string">&quot;三更草堂&quot;</span>.toCharArray();</span><br><span class="line">fileWriter.write(chars);</span><br><span class="line">fileWriter.flush();</span><br><span class="line"></span><br><span class="line"><span class="comment">//写入字符串</span></span><br><span class="line">fileWriter.write(<span class="string">&quot;三更草堂&quot;</span>);</span><br><span class="line">fileWriter.close();</span><br></pre></td></tr></table></figure>

<p>复制最好使用字节流，可以复制任意的。字符流只能复制文本</p>
<p><em><strong>字符流会读取字符数组。字节流会读取字节数组</strong></em></p>
<ul>
<li>文件复制（字符流）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件复制</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo7</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">srcFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\1.txt&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">destDir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\kzy\\c&quot;</span>);</span><br><span class="line">        copyFile(srcFile, destDir);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//原文件的绝对路径 srcFile</span></span><br><span class="line">    <span class="comment">//目标文件的存放目录路径 destDir</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">copyFile</span><span class="params">(File srcFile, File destDir)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//在目标路径下创建一个和原文件相同的文件,这是按照目录和文件名创建的File对象</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(destDir, srcFile.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">FileReader</span> <span class="variable">fr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(srcFile);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileWriter</span> <span class="variable">fw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(file);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取原文件，把读到的文件放到目标文件中</span></span><br><span class="line">        <span class="type">char</span>[] chars = <span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">1024</span> * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">//先读到数组里，再从数组中写入</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fr.read(chars)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            fw.write(chars, <span class="number">0</span>, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fr.close();</span><br><span class="line">        fw.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字符流编码的设置"><a href="#字符流编码的设置" class="headerlink" title="字符流编码的设置"></a>字符流编码的设置</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231014202813190.png" alt="image-20231014202813190"></p>
<h3 id="高效缓冲流"><a href="#高效缓冲流" class="headerlink" title="高效缓冲流"></a>高效缓冲流</h3><p>读数据，先将磁盘的部分数据读到内存缓冲区，然后内存直接读取缓冲区的数据，更快。。。借助内存的缓冲区来减少磁盘IO的次数，提高性能</p>
<p><strong>分类</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231015144307536.png" alt="image-20231015144307536"></p>
<p><strong>对象创建</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231015144359968.png" alt="image-20231015144359968"></p>
<p><strong>特有方法</strong></p>
<p>BufferedRead:   readLine() 一次读一行，不包括换行符</p>
<p>BufferedWriter: newLine() 换行符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;D:\\kzy\\test1\\2.txt&quot;</span>));</span><br><span class="line">    String len;</span><br><span class="line">    <span class="keyword">while</span> ((len=bufferedReader.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;bufferedReader.readLine() = &quot;</span> + len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>文件内容的复制</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">bfr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;D:\\kzy\\test1\\2.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="type">BufferedWriter</span> <span class="variable">bfw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedWriter</span>(<span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="string">&quot;D:\\kzy\\test1\\1.txt&quot;</span>,<span class="literal">true</span>));</span><br><span class="line"></span><br><span class="line">    String len;</span><br><span class="line">    <span class="keyword">while</span> ((len=bfr.readLine())!=<span class="literal">null</span>)&#123;</span><br><span class="line">            bfw.write(len);</span><br><span class="line">            bfw.newLine();</span><br><span class="line">    &#125;</span><br><span class="line">    bfr.close();</span><br><span class="line">    bfw.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="跟着三更学JAVA-函数式编程"><a href="#跟着三更学JAVA-函数式编程" class="headerlink" title="跟着三更学JAVA-函数式编程"></a>跟着三更学JAVA-函数式编程</h1><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul>
<li><p>代码简洁，开发迅速</p>
</li>
<li><p>接近自然语言，易于理解</p>
</li>
<li><p>易于并发编程</p>
</li>
<li><p>条件：是有函数式接口中只有一个abstract方法</p>
</li>
</ul>
<h2 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h2><p>不注重方法名，只注重参数和所进行的操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;线程被启动了&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;又被启动了&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*int cal = cal(new IntBinaryOperator() &#123;</span></span><br><span class="line"><span class="comment">        @Override</span></span><br><span class="line"><span class="comment">        public int applyAsInt(int left, int right) &#123;</span></span><br><span class="line"><span class="comment">            return left + right;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;);*/</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">cal</span> <span class="operator">=</span> cal((left, right) -&gt; left + right);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;cal = &quot;</span> + cal);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">cal</span><span class="params">(IntBinaryOperator intBinaryOperator)</span>&#123;</span><br><span class="line">    <span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> b=<span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> intBinaryOperator.applyAsInt(a,b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><ul>
<li>参数类型可以省略</li>
<li>方法体内只有一句代码时大括号的return和唯一依据代码的分号可以省略</li>
<li>方法只有一个参数时小括号可以省略</li>
</ul>
<h2 id="Stream流"><a href="#Stream流" class="headerlink" title="Stream流"></a>Stream流</h2><p>更方便的对集合和数组进行操作</p>
<h3 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h3><ul>
<li>单列集合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 单列集合</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">       ArrayList&lt;Integer&gt; arr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       arr.add(<span class="number">1</span>);</span><br><span class="line">       arr.add(<span class="number">4</span>);</span><br><span class="line">       arr.add(<span class="number">3</span>);</span><br><span class="line">       arr.add(<span class="number">2</span>);</span><br><span class="line">       <span class="comment">//创建对象</span></span><br><span class="line">       Stream&lt;Integer&gt; stream = arr.stream();</span><br><span class="line">       stream.distinct()</span><br><span class="line">               .filter(integer -&gt; integer&gt;<span class="number">2</span>)</span><br><span class="line">               .forEach(System.out::println);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>数组</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 数组</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">       Integer[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>&#125;;</span><br><span class="line">       <span class="comment">//创建对象</span></span><br><span class="line">       Stream&lt;Integer&gt; stream = Arrays.stream(arr);</span><br><span class="line">       <span class="comment">//Stream&lt;Integer&gt; stream = Stream.of(arr);</span></span><br><span class="line">       stream.distinct()</span><br><span class="line">               .filter(integer -&gt; integer&gt;<span class="number">2</span>)</span><br><span class="line">               .forEach(System.out::println);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>多列集合</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 多列集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">        HashMap&lt;String,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        map.put(<span class="string">&quot;1&quot;</span>,<span class="number">2</span>);</span><br><span class="line">        map.put(<span class="string">&quot;2&quot;</span>,<span class="number">3</span>);</span><br><span class="line">        map.put(<span class="string">&quot;3&quot;</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建对象</span></span><br><span class="line">        Stream&lt;Map.Entry&lt;String, Integer&gt;&gt; stream = map.entrySet().stream();</span><br><span class="line">        stream.filter(entry -&gt; entry.getValue()&gt;<span class="number">2</span>)</span><br><span class="line">                .forEach(entry -&gt; System.out.println(entry.getKey()+entry.getValue()));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="中间操作"><a href="#中间操作" class="headerlink" title="中间操作"></a>中间操作</h3><h4 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h4><p>去重，去掉相同的元素。如果是判断对象是否相同，要重写equals方法，否则用的是==来比较，比较的是地址值。应该比较属性值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 去重</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; arr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    arr.add(<span class="number">1</span>);</span><br><span class="line">    arr.add(<span class="number">4</span>);</span><br><span class="line">    arr.add(<span class="number">3</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    System.out.println(arr);</span><br><span class="line">    <span class="comment">//创建对象</span></span><br><span class="line">    Stream&lt;Integer&gt; stream = arr.stream();</span><br><span class="line">    <span class="comment">//Stream&lt;Integer&gt; stream = Stream.of(arr);</span></span><br><span class="line">    stream.distinct()</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h4><p>过滤（筛选）；可以对流中的元素进行条件过滤，符合条件的数据继续存在流中</p>
<p>例子：查询年龄大于20的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">    HashMap&lt;String,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    map.put(<span class="string">&quot;康志远&quot;</span>,<span class="number">20</span>);</span><br><span class="line">    map.put(<span class="string">&quot;翟龙浩&quot;</span>,<span class="number">21</span>);</span><br><span class="line">    map.put(<span class="string">&quot;魏晓静&quot;</span>,<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line">    Stream&lt;Map.Entry&lt;String, Integer&gt;&gt; stream = map.entrySet().stream();</span><br><span class="line"></span><br><span class="line">    stream.filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Map.Entry&lt;String, Integer&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Map.Entry&lt;String, Integer&gt; entry)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> entry.getValue()&gt;<span class="number">19</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><p>可以对流进行类型转换和计算</p>
<p>将流中的Person转为String流获取所有人的名字和每个人的年龄加一</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * map转换类型和计算</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span> &#123;</span><br><span class="line">       ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>,<span class="number">20</span>));</span><br><span class="line">       arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>,<span class="number">21</span>));</span><br><span class="line">       arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康之源&quot;</span>,<span class="number">18</span>));</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取所有名字</span></span><br><span class="line">       arrayList.stream()</span><br><span class="line">               .map(person -&gt; person.getName())</span><br><span class="line">               .forEach(s -&gt; System.out.println(s));</span><br><span class="line">       <span class="comment">//年龄加一操作</span></span><br><span class="line">       arrayList.stream()</span><br><span class="line">               .map(person -&gt; person.getAge())</span><br><span class="line">               .map(age-&gt;age+<span class="number">1</span>)</span><br><span class="line">               .forEach(System.out::println);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h4><p>对流中的元素进行排序，</p>
<p><strong>注意：需要对排序的对象进行implements Comparable<T>，并重写compareTo方法</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Person o)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getAge()-o.getAge();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者直接实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.sorted(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Person&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Person o1, Person o2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> o1.getAge()-o2.getAge();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h4><p>设置最大流，超出的最终被抛弃</p>
<p>例子：进行降序处理，并去重，然后打印出年龄最大的三位</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进行降序处理，并去重，然后打印出年龄最大的三位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test08</span><span class="params">()</span> &#123;</span><br><span class="line">    ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>,<span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>,<span class="number">21</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>,<span class="number">18</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>,<span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>,<span class="number">13</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>,<span class="number">14</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>,<span class="number">24</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>,<span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">    arrayList.stream()</span><br><span class="line">            .distinct()</span><br><span class="line">            .sorted(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Person&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Person o1, Person o2)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> o2.getAge()-o1.getAge();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .limit(<span class="number">3</span>)</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h4><p>跳过前n个元素，并返回剩下的元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进行降序处理，并去重，然后跳过年龄最大的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test09</span><span class="params">()</span> &#123;</span><br><span class="line">    ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>,<span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>,<span class="number">21</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>,<span class="number">18</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>,<span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>,<span class="number">13</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>,<span class="number">14</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>,<span class="number">24</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>,<span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">    arrayList.stream()</span><br><span class="line">            .distinct()</span><br><span class="line">            .sorted(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Person&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Person o1, Person o2)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> o2.getAge()-o1.getAge();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .skip(<span class="number">1</span>)</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h4><p>map只能把一个对象转化成另一个对象来作为流中的元素，而flatMap可以将一个对象转化为多个对象来体现</p>
<ol>
<li>把一个元素转化为多个元素。比如一个类里面有一个集合元素，flatMap先将这个类中的集合，将他转化为新的流</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    Integer age;</span><br><span class="line">    List&lt;Person&gt; list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 打印Person中的集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test10</span><span class="params">()</span> &#123;</span><br><span class="line">        ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>, <span class="number">21</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>, <span class="number">18</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>, <span class="number">13</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>, <span class="number">14</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>, <span class="number">24</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>, <span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        person.setList(arrayList);</span><br><span class="line">        arrayList.stream()</span><br><span class="line">                .distinct()</span><br><span class="line">                .flatMap((Function&lt;Person, Stream&lt;Person&gt;&gt;) person1 -&gt; &#123;</span><br><span class="line">                    <span class="comment">//拿到Person中集合</span></span><br><span class="line">                    <span class="keyword">return</span> person1.getList().stream();</span><br><span class="line">                &#125;).forEach(<span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;Person&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Person o)</span> &#123;</span><br><span class="line">                System.out.println(o.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="终结操作"><a href="#终结操作" class="headerlink" title="终结操作"></a>终结操作</h3><h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><p>遍历输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取所有的名字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test11</span><span class="params">()</span>&#123;</span><br><span class="line">    ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>, <span class="number">20</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>, <span class="number">21</span>));</span><br><span class="line">    arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康之源&quot;</span>, <span class="number">18</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取所有名字</span></span><br><span class="line">    arrayList.stream()</span><br><span class="line">            .map(person -&gt; person.getName())</span><br><span class="line">            .forEach(s -&gt; System.out.println(s));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="count"><a href="#count" class="headerlink" title="count"></a>count</h4><p>用来获取数目，注意有返回值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 去掉相同的元素，并统计数目</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test12</span><span class="params">()</span>&#123;</span><br><span class="line">        ArrayList&lt;Integer&gt; arr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        arr.add(<span class="number">1</span>);</span><br><span class="line">        arr.add(<span class="number">4</span>);</span><br><span class="line">        arr.add(<span class="number">3</span>);</span><br><span class="line">        arr.add(<span class="number">2</span>);</span><br><span class="line">        arr.add(<span class="number">2</span>);</span><br><span class="line">        arr.add(<span class="number">2</span>);</span><br><span class="line">        System.out.println(arr);</span><br><span class="line">        <span class="comment">//创建对象</span></span><br><span class="line">        Stream&lt;Integer&gt; stream = arr.stream();</span><br><span class="line"><span class="comment">//        Stream&lt;Integer&gt; stream = Stream.of(arr);</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> stream.distinct()</span><br><span class="line">                .count();</span><br><span class="line">        System.out.println(<span class="string">&quot;count = &quot;</span> + count);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="min和max"><a href="#min和max" class="headerlink" title="min和max"></a>min和max</h4><p>注意有返回值Optional<Integer>,一个流完之后，需要在获取另一个流</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 最大值，最小值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test13</span><span class="params">()</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; arr = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    arr.add(<span class="number">1</span>);</span><br><span class="line">    arr.add(<span class="number">4</span>);</span><br><span class="line">    arr.add(<span class="number">3</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    arr.add(<span class="number">2</span>);</span><br><span class="line">    System.out.println(arr);</span><br><span class="line">    <span class="comment">//创建对象</span></span><br><span class="line">    Stream&lt;Integer&gt; stream = arr.stream();</span><br><span class="line">    Optional&lt;Integer&gt; max = stream</span><br><span class="line">            .max(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> o1 - o2;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    Stream&lt;Integer&gt; stream2 = arr.stream();</span><br><span class="line">    Optional&lt;Integer&gt; min = stream2</span><br><span class="line">            .min(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Integer o1, Integer o2)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> o1 - o2;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;max.get() = &quot;</span> + max.get());</span><br><span class="line">    System.out.println(<span class="string">&quot;min.get() = &quot;</span> + min.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="collect"><a href="#collect" class="headerlink" title="collect"></a>collect</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;Person&gt; arrayList;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>, <span class="number">21</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>, <span class="number">18</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>, <span class="number">13</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>, <span class="number">14</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>, <span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h6 id="List集合"><a href="#List集合" class="headerlink" title="List集合"></a>List集合</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取一个存放名字的集合List</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test14</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Person&gt; stream = arrayList.stream();</span><br><span class="line">    List&lt;String&gt; names = stream.map(person -&gt; person.getName())</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    System.out.println(names);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Set集合"><a href="#Set集合" class="headerlink" title="Set集合"></a>Set集合</h6><p>可以去重</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取一个存放名字的集合Set</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test15</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Person&gt; stream = arrayList.stream();</span><br><span class="line">    Set&lt;String&gt; names = stream.map(person -&gt; person.getName())</span><br><span class="line">            .collect(Collectors.toSet());</span><br><span class="line">    System.out.println(names);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Map集合"><a href="#Map集合" class="headerlink" title="Map集合"></a>Map集合</h6><p>需要new两个Function，一个是key，一个是value</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取一个存放名字的集合Map</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test16</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Person&gt; stream = arrayList.stream();</span><br><span class="line">    Map&lt;String, Integer&gt; collects = stream.collect(Collectors.toMap(person -&gt; person.getName(), person -&gt; person.getAge()));</span><br><span class="line">    System.out.println(collects);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="anyMatch"><a href="#anyMatch" class="headerlink" title="anyMatch"></a>anyMatch</h6><p>查询是否有任意一个元素符合匹配条件，有一个符合就为true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询是否有任意一个年龄大于20的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">                .anyMatch(person -&gt; person.getAge() &gt; <span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;b = &quot;</span> + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="allMatch"><a href="#allMatch" class="headerlink" title="allMatch"></a>allMatch</h6><p>查询是否所有元素符合匹配条件，所有符合就为true，有不符合的就为false</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询是否所有年龄大于20的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">                .allMatch(person -&gt; person.getAge() &gt; <span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;b = &quot;</span> + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="noneMatch"><a href="#noneMatch" class="headerlink" title="noneMatch"></a>noneMatch</h6><p>查询是否所有元素都不符合匹配条件，都不符合就为true，有符合的就为false</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询是否都不符合年龄大于23 noneMatch</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test03</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">            .noneMatch(person -&gt; person.getAge() &gt; <span class="number">23</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;b = &quot;</span> + b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="findAny"><a href="#findAny" class="headerlink" title="findAny"></a>findAny</h6><p>获取任意一个符合条件的元素，不一定是第一个元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询是否有年龄大于19的，有的话给出任意一个人的名字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test04</span><span class="params">()</span> &#123;</span><br><span class="line">    Optional&lt;Person&gt; persons = arrayList.stream()</span><br><span class="line">            .filter(person -&gt; person.getAge() &gt; <span class="number">19</span>)</span><br><span class="line">            .findAny();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Optional来避免出现空指针异常的情况。以下是如果返回的结果中有对象的话，打印对象的名字</span></span><br><span class="line">       persons.ifPresent(person -&gt; System.out.println(<span class="string">&quot;person = &quot;</span> + person.getName()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="findFirst"><a href="#findFirst" class="headerlink" title="findFirst"></a>findFirst</h6><p>查找第一个元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询年龄最小的人的名字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test05</span><span class="params">()</span> &#123;</span><br><span class="line">    Optional&lt;Person&gt; person = arrayList.stream()</span><br><span class="line">            .sorted((o1, o2) -&gt; o1.getAge() - o2.getAge())</span><br><span class="line">            .findFirst();</span><br><span class="line">    person.ifPresent(person1 -&gt; System.out.println(<span class="string">&quot;person1 = &quot;</span> + person1.getName()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h6><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017110844185.png" alt="image-20231017110844185"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017111013908.png" alt="image-20231017111013908"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017111714683.png" alt="image-20231017111714683"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算所有年龄的和</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test06</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">            .map(person -&gt; person.getAge()) <span class="comment">//先将流中的person转化为年龄integer类型</span></span><br><span class="line">            .reduce(<span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">BinaryOperator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Integer <span class="title function_">apply</span><span class="params">(Integer result, Integer integer)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> result + integer;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    System.out.println(<span class="string">&quot;sum = &quot;</span> + sum);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算年龄中的最大值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test07</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">max</span> <span class="operator">=</span> arrayList.stream()</span><br><span class="line">                .map(person -&gt; person.getAge()) <span class="comment">//先将流中的person转化为年龄integer类型</span></span><br><span class="line">                .reduce(Integer.MIN_VALUE, (result, element) -&gt; result &lt; element ? element : result);</span><br><span class="line">        System.out.println(<span class="string">&quot;max = &quot;</span> + max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 计算年龄中的最最小值，初始值默认为第一个</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test08</span><span class="params">()</span> &#123;</span><br><span class="line">        Optional&lt;Integer&gt; min = arrayList.stream()</span><br><span class="line">                .map(person -&gt; person.getAge()) <span class="comment">//先将流中的person转化为年龄integer类型</span></span><br><span class="line">                .reduce((result, element) -&gt; result &gt; element ? element : result);</span><br><span class="line">        System.out.println(<span class="string">&quot;min = &quot;</span> + min);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017124616237.png" alt="image-20231017124616237"></p>
<h3 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h3><h4 id="4-1概述"><a href="#4-1概述" class="headerlink" title="4.1概述"></a>4.1概述</h4><p>编写代码最多的是空指针异常，所以我们需要做各种非空判断</p>
<p>利用Optional来处理是否为空</p>
<h4 id="4-2使用"><a href="#4-2使用" class="headerlink" title="4.2使用"></a>4.2使用</h4><h5 id="4-2-1创建对象"><a href="#4-2-1创建对象" class="headerlink" title="4.2.1创建对象"></a>4.2.1<strong>创建对象</strong></h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231017142336922.png" alt="image-20231017142336922"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//List&lt;Person&gt; personList = getList();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//Optional&lt;List&lt;Person&gt;&gt; personList1 = Optional.ofNullable(personList);</span></span><br><span class="line"></span><br><span class="line">        Optional&lt;List&lt;Person&gt;&gt; list = getList();</span><br><span class="line">        list.ifPresent(people -&gt; System.out.println(<span class="string">&quot;people = &quot;</span> + people));</span><br><span class="line"></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="comment">//        Person person = null;</span></span><br><span class="line">        <span class="comment">//of创建Optional对象，这个必须不为null</span></span><br><span class="line">        Optional&lt;Person&gt; person1 = Optional.of(person);</span><br><span class="line">        person1.ifPresent(person2 -&gt; System.out.println(<span class="string">&quot;person2 = &quot;</span> + person2));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Optional&lt;List&lt;Person&gt;&gt; <span class="title function_">getList</span><span class="params">()</span> &#123;</span><br><span class="line">        ArrayList&lt;Person&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康志远&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;翟龙浩&quot;</span>, <span class="number">21</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康2源&quot;</span>, <span class="number">18</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康3源&quot;</span>, <span class="number">20</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康4源&quot;</span>, <span class="number">13</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康5源&quot;</span>, <span class="number">14</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康6源&quot;</span>, <span class="number">24</span>));</span><br><span class="line">        arrayList.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;康7源&quot;</span>, <span class="number">19</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(arrayList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-2-1安全消费值"><a href="#4-2-1安全消费值" class="headerlink" title="4.2.1安全消费值"></a><strong>4.2.1安全消费值</strong></h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.ifPresent(people -&gt; System.out.println(<span class="string">&quot;people = &quot;</span> + people));</span><br></pre></td></tr></table></figure>

<h5 id="4-2-2安全的获取值"><a href="#4-2-2安全的获取值" class="headerlink" title="4.2.2安全的获取值"></a>4.2.2安全的获取值</h5><p>get 获取值</p>
<p>orElseGet 如果有值返回值，没值返回设定的默认值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;List&lt;Person&gt;&gt; list = getList();</span><br><span class="line"><span class="comment">//如果有值返回值，没有值的话返回null</span></span><br><span class="line">List&lt;Person&gt; personList = list.orElseGet(() -&gt; <span class="literal">null</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;personList = &quot;</span> + personList);</span><br></pre></td></tr></table></figure>

<p>orElseThrow 如果有值返回值，没值返回设定异常类型提示信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果有值返回值，没有值的话执行异常</span></span><br><span class="line">List&lt;Person&gt; personList = list.orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;空指针&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;personList = &quot;</span> + personList);</span><br></pre></td></tr></table></figure>

<h5 id="4-2-3过滤"><a href="#4-2-3过滤" class="headerlink" title="4.2.3过滤"></a>4.2.3过滤</h5><p>我们可以使用这个方法对数据进行过滤，如果原本有数据，但是不符合判断，也会变成一个无数据的Optional对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Person&gt; list = Optional.ofNullable(getList());</span><br><span class="line"></span><br><span class="line">list.filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Person&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Person person)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> person.getAge()&gt;<span class="number">18</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).ifPresent(person -&gt; System.out.println(<span class="string">&quot;person = &quot;</span> + person.getName()));</span><br></pre></td></tr></table></figure>

<h5 id="4-2-4判断"><a href="#4-2-4判断" class="headerlink" title="4.2.4判断"></a>4.2.4判断</h5><p>判断是否存在数据进行判断，如果为空fasle不为空true</p>
<p>isPersent()</p>
<h5 id="4-2-5数据转换"><a href="#4-2-5数据转换" class="headerlink" title="4.2.5数据转换"></a>4.2.5数据转换</h5><p>和map、flatMap相似</p>
<h2 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>​    <strong>只有一个抽象方法</strong>的接口我们称之为函数接口。</p>
<p>​    JDK的函数式接口都加上了**@FunctionalInterface** 注解进行标识。但是无论是否加上该注解只要接口中只有一个抽象方法，都是函数式接口。</p>
<h3 id="5-2-常见函数式接口"><a href="#5-2-常见函数式接口" class="headerlink" title="5.2 常见函数式接口"></a>5.2 常见函数式接口</h3><ul>
<li><p>​    Consumer 消费接口</p>
<p>根据其中抽象方法的参数列表和返回值类型知道，我们可以在方法中对传入的参数进行消费。</p>
<p><img src="D:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145622163-16354041894551.png" alt="image-20211028145622163"></p>
</li>
<li><p>​    Function 计算转换接口</p>
<p>根据其中抽象方法的参数列表和返回值类型知道，我们可以在方法中对传入的参数计算或转换，把结果返回</p>
<p><img src="D:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145707862-16354042291112.png" alt="image-20211028145707862"></p>
</li>
<li><p>​    Predicate 判断接口</p>
<p>根据其中抽象方法的参数列表和返回值类型知道，我们可以在方法中对传入的参数条件判断，返回判断结果</p>
<p><img src="D:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145818743-16354043004393.png" alt="image-20211028145818743"></p>
</li>
<li><p>​    Supplier 生产型接口</p>
<p>根据其中抽象方法的参数列表和返回值类型知道，我们可以在方法中创建对象，把创建好的对象返回</p>
</li>
</ul>
<p><img src="D:/Java自学/函数式编程/函数式编程/函数式编程.assets/image-20211028145843368-16354043246954.png" alt="image-20211028145843368"></p>
<h3 id="5-3-常用的默认方法"><a href="#5-3-常用的默认方法" class="headerlink" title="5.3 常用的默认方法"></a>5.3 常用的默认方法</h3><ul>
<li><p>and</p>
<p>我们在使用Predicate接口时候可能需要进行判断条件的拼接。而and方法相当于是使用&amp;&amp;来拼接两个判断条件</p>
<p>例如：</p>
<p>打印作家中年龄大于17并且姓名的长度大于1的作家。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line">authorStream.filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> author.getAge()&gt;<span class="number">17</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.and(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> author.getName().length()&gt;<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)).forEach(author -&gt; System.out.println(author));</span><br></pre></td></tr></table></figure></li>
<li><p>or </p>
<p>我们在使用Predicate接口时候可能需要进行判断条件的拼接。而or方法相当于是使用||来拼接两个判断条件。</p>
<p>例如：</p>
<p>打印作家中年龄大于17或者姓名的长度小于2的作家。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        打印作家中年龄大于17或者姓名的长度小于2的作家。</span></span><br><span class="line">        List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">        authors.stream()</span><br><span class="line">                .filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> author.getAge()&gt;<span class="number">17</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;.or(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> author.getName().length()&lt;<span class="number">2</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)).forEach(author -&gt; System.out.println(author.getName()));</span><br></pre></td></tr></table></figure></li>
<li><p>negate</p>
<p>Predicate接口中的方法。negate方法相当于是在判断添加前面加了个! 表示取反</p>
<p>例如：</p>
<p>打印作家中年龄不大于17的作家。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//        打印作家中年龄不大于17的作家。</span></span><br><span class="line">        List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">        authors.stream()</span><br><span class="line">                .filter(<span class="keyword">new</span> <span class="title class_">Predicate</span>&lt;Author&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">test</span><span class="params">(Author author)</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> author.getAge()&gt;<span class="number">17</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;.negate()).forEach(author -&gt; System.out.println(author.getAge()));</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="方法引用"><a href="#方法引用" class="headerlink" title="方法引用"></a>方法引用</h2><p>​    我们在使用lambda时，如果方法体中只有一个方法的调用的话（包括构造方法）,我们可以用方法引用进一步简化代码。</p>
<h3 id="6-1-推荐用法"><a href="#6-1-推荐用法" class="headerlink" title="6.1 推荐用法"></a>6.1 推荐用法</h3><p>​    我们在使用lambda时不需要考虑什么时候用方法引用，用哪种方法引用，方法引用的格式是什么。我们只需要在写完lambda方法发现方法体只有一行代码，并且是方法的调用时使用快捷键尝试是否能够转换成方法引用即可。</p>
<p>​    当我们方法引用使用的多了慢慢的也可以直接写出方法引用。</p>
<h3 id="6-2-基本格式"><a href="#6-2-基本格式" class="headerlink" title="6.2 基本格式"></a>6.2 基本格式</h3><p>​    类名或者对象名::方法名</p>
<h3 id="6-3-语法详解-了解"><a href="#6-3-语法详解-了解" class="headerlink" title="6.3 语法详解(了解)"></a>6.3 语法详解(了解)</h3><h4 id="6-3-1-引用类的静态方法"><a href="#6-3-1-引用类的静态方法" class="headerlink" title="6.3.1 引用类的静态方法"></a>6.3.1 引用类的静态方法</h4><p>​    其实就是引用类的静态方法</p>
<h5 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类名::方法名</span><br></pre></td></tr></table></figure>



<h5 id="使用前提"><a href="#使用前提" class="headerlink" title="使用前提"></a>使用前提</h5><p>​    如果我们在重写方法的时候，方法体中<strong>只有一行代码</strong>，并且这行代码是<strong>调用了某个类的静态方法</strong>，并且我们把要重写的<strong>抽象方法中所有的参数都按照顺序传入了这个静态方法中</strong>，这个时候我们就可以引用类的静态方法。</p>
<p>​    </p>
<p>例如：</p>
<p>如下代码就可以用方法引用进行简化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line"></span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line"></span><br><span class="line">authorStream.map(author -&gt; author.getAge())</span><br><span class="line">        .map(age-&gt;String.valueOf(age));</span><br></pre></td></tr></table></figure>

<p>注意，如果我们所重写的方法是没有参数的，调用的方法也是没有参数的也相当于符合以上规则。</p>
<p>优化后如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line"></span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line"></span><br><span class="line">authorStream.map(author -&gt; author.getAge())</span><br><span class="line">        .map(String::valueOf);</span><br></pre></td></tr></table></figure>



<h4 id="6-3-2-引用对象的实例方法"><a href="#6-3-2-引用对象的实例方法" class="headerlink" title="6.3.2 引用对象的实例方法"></a>6.3.2 引用对象的实例方法</h4><h5 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">对象名::方法名</span><br></pre></td></tr></table></figure>



<h5 id="使用前提-1"><a href="#使用前提-1" class="headerlink" title="使用前提"></a>使用前提</h5><p>​    如果我们在重写方法的时候，方法体中<strong>只有一行代码</strong>，并且这行代码是<strong>调用了某个对象的成员方法</strong>，并且我们把要重写的<strong>抽象方法中所有的参数都按照顺序传入了这个成员方法中</strong>，这个时候我们就可以引用对象的实例方法</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line"></span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">authorStream.map(author -&gt; author.getName())</span><br><span class="line">        .forEach(name-&gt;sb.append(name));</span><br></pre></td></tr></table></figure>

<p>优化后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line"></span><br><span class="line">Stream&lt;Author&gt; authorStream = authors.stream();</span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">authorStream.map(author -&gt; author.getName())</span><br><span class="line">        .forEach(sb::append);</span><br></pre></td></tr></table></figure>







<h4 id="6-3-4-引用类的实例方法"><a href="#6-3-4-引用类的实例方法" class="headerlink" title="6.3.4 引用类的实例方法"></a>6.3.4 引用类的实例方法</h4><h5 id="格式-2"><a href="#格式-2" class="headerlink" title="格式"></a>格式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类名::方法名</span><br></pre></td></tr></table></figure>



<h5 id="使用前提-2"><a href="#使用前提-2" class="headerlink" title="使用前提"></a>使用前提</h5><p>​    如果我们在重写方法的时候，方法体中<strong>只有一行代码</strong>，并且这行代码是<strong>调用了第一个参数的成员方法</strong>，并且我们把要<strong>重写的抽象方法中剩余的所有的参数都按照顺序传入了这个成员方法中</strong>，这个时候我们就可以引用类的实例方法。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">interface</span> <span class="title class_">UseString</span>&#123;</span><br><span class="line">       String <span class="title function_">use</span><span class="params">(String str,<span class="type">int</span> start,<span class="type">int</span> length)</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">subAuthorName</span><span class="params">(String str, UseString useString)</span>&#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">return</span> useString.use(str,start,length);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">       subAuthorName(<span class="string">&quot;三更草堂&quot;</span>, <span class="keyword">new</span> <span class="title class_">UseString</span>() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> String <span class="title function_">use</span><span class="params">(String str, <span class="type">int</span> start, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">               <span class="keyword">return</span> str.substring(start,length);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优化后如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">    subAuthorName(<span class="string">&quot;三更草堂&quot;</span>, String::substring);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="6-3-5-构造器引用"><a href="#6-3-5-构造器引用" class="headerlink" title="6.3.5 构造器引用"></a>6.3.5 构造器引用</h4><p>​    如果方法体中的一行代码是构造器的话就可以使用构造器引用。</p>
<h5 id="格式-3"><a href="#格式-3" class="headerlink" title="格式"></a>格式</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类名::<span class="keyword">new</span></span><br></pre></td></tr></table></figure>



<h5 id="使用前提-3"><a href="#使用前提-3" class="headerlink" title="使用前提"></a>使用前提</h5><p>​    如果我们在重写方法的时候，方法体中<strong>只有一行代码</strong>，并且这行代码是<strong>调用了某个类的构造方法</strong>，并且我们把<strong>要重写的抽象方法中的所有的参数都按照顺序传入了这个构造方法中</strong>，这个时候我们就可以引用构造器。</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">authors.stream()</span><br><span class="line">        .map(author -&gt; author.getName())</span><br><span class="line">        .map(name-&gt;<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(name))</span><br><span class="line">        .map(sb-&gt;sb.append(<span class="string">&quot;-三更&quot;</span>).toString())</span><br><span class="line">        .forEach(str-&gt; System.out.println(str));</span><br></pre></td></tr></table></figure>

<p>优化后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">authors.stream()</span><br><span class="line">        .map(author -&gt; author.getName())</span><br><span class="line">        .map(StringBuilder::<span class="keyword">new</span>)</span><br><span class="line">        .map(sb-&gt;sb.append(<span class="string">&quot;-三更&quot;</span>).toString())</span><br><span class="line">        .forEach(str-&gt; System.out.println(str));</span><br></pre></td></tr></table></figure>





<h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><h3 id="基本数据类型优化"><a href="#基本数据类型优化" class="headerlink" title="基本数据类型优化"></a>基本数据类型优化</h3><p>​    我们之前用到的很多Stream的方法由于都使用了泛型。所以涉及到的参数和返回值都是引用数据类型。</p>
<p>​    即使我们操作的是整数小数，但是实际用的都是他们的包装类。JDK5中引入的自动装箱和自动拆箱让我们在使用对应的包装类时就好像使用基本数据类型一样方便。但是你一定要知道装箱和拆箱肯定是要消耗时间的。虽然这个时间消耗很下。但是在大量的数据不断的重复装箱拆箱的时候，你就不能无视这个时间损耗了。</p>
<p>​    所以为了让我们能够对这部分的时间消耗进行优化。Stream还提供了很多专门针对基本数据类型的方法。</p>
<p>​    例如：mapToInt,mapToLong,mapToDouble,flatMapToInt,flatMapToDouble等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test27</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">    authors.stream()</span><br><span class="line">            .map(author -&gt; author.getAge())</span><br><span class="line">            .map(age -&gt; age + <span class="number">10</span>)</span><br><span class="line">            .filter(age-&gt;age&gt;<span class="number">18</span>)</span><br><span class="line">            .map(age-&gt;age+<span class="number">2</span>)</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    authors.stream()</span><br><span class="line">            .mapToInt(author -&gt; author.getAge())</span><br><span class="line">            .map(age -&gt; age + <span class="number">10</span>)</span><br><span class="line">            .filter(age-&gt;age&gt;<span class="number">18</span>)</span><br><span class="line">            .map(age-&gt;age+<span class="number">2</span>)</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="并行流"><a href="#并行流" class="headerlink" title="并行流"></a>并行流</h3><p>​    当流中有大量元素时，我们可以使用并行流去提高操作的效率。其实并行流就是把任务分配给多个线程去完全。如果我们自己去用代码实现的话其实会非常的复杂，并且要求你对并发编程有足够的理解和认识。而如果我们使用Stream的话，我们只需要修改一个方法的调用就可以使用并行流来帮我们实现，从而提高效率。</p>
<p>​    parallel方法可以把串行流转换成并行流。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test28</span><span class="params">()</span> &#123;</span><br><span class="line">    Stream&lt;Integer&gt; stream = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> stream.parallel()</span><br><span class="line">            .peek(<span class="keyword">new</span> <span class="title class_">Consumer</span>&lt;Integer&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Integer num)</span> &#123;</span><br><span class="line">                    System.out.println(num+Thread.currentThread().getName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            .filter(num -&gt; num &gt; <span class="number">5</span>)</span><br><span class="line">            .reduce((result, ele) -&gt; result + ele)</span><br><span class="line">            .get();</span><br><span class="line">    System.out.println(sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    也可以通过parallelStream直接获取并行流对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Author&gt; authors = getAuthors();</span><br><span class="line">authors.parallelStream()</span><br><span class="line">        .map(author -&gt; author.getAge())</span><br><span class="line">        .map(age -&gt; age + <span class="number">10</span>)</span><br><span class="line">        .filter(age-&gt;age&gt;<span class="number">18</span>)</span><br><span class="line">        .map(age-&gt;age+<span class="number">2</span>)</span><br><span class="line">        .forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h1 id="跟着三更学JAVA-多线程"><a href="#跟着三更学JAVA-多线程" class="headerlink" title="跟着三更学JAVA-多线程"></a>跟着三更学JAVA-多线程</h1><h3 id="1-1实现多线程方式一：继承Thread类【应用】"><a href="#1-1实现多线程方式一：继承Thread类【应用】" class="headerlink" title="1.1实现多线程方式一：继承Thread类【应用】"></a>1.1实现多线程方式一：继承Thread类【应用】</h3><ul>
<li><p>方法介绍</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>void run()</td>
<td>在线程开启后，此方法将被调用执行</td>
</tr>
<tr>
<td>void start()</td>
<td>使此线程开始执行，Java虚拟机会调用run方法()</td>
</tr>
</tbody></table>
</li>
<li><p>实现步骤</p>
<ul>
<li>定义一个类MyThread继承Thread类</li>
<li>在MyThread类中重写run()方法</li>
<li>创建MyThread类的对象</li>
<li>启动线程（必须用start()方法）</li>
</ul>
</li>
<li><p>代码演示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThreadDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">my1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        <span class="type">MyThread</span> <span class="variable">my2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        my1.run();</span></span><br><span class="line"><span class="comment">//        my2.run();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//void start() 导致此线程开始执行; Java虚拟机调用此线程的run方法</span></span><br><span class="line">        my1.start();</span><br><span class="line">        my2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>两个小问题</p>
<ul>
<li><p>为什么要重写run()方法？</p>
<p>因为run()是用来封装被线程执行的代码</p>
</li>
<li><p>run()方法和start()方法的区别？</p>
<p>run()：封装线程执行的代码，直接调用，相当于普通方法的调用</p>
<p>start()：启动线程；然后由JVM调用此线程的run()方法</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-2实现多线程方式二：实现Runnable接口【应用】"><a href="#1-2实现多线程方式二：实现Runnable接口【应用】" class="headerlink" title="1.2实现多线程方式二：实现Runnable接口【应用】"></a>1.2实现多线程方式二：实现Runnable接口【应用】</h3><ul>
<li><p>Thread构造方法</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Thread(Runnable target)</td>
<td>分配一个新的Thread对象</td>
</tr>
<tr>
<td>Thread(Runnable target, String name)</td>
<td>分配一个新的Thread对象</td>
</tr>
</tbody></table>
</li>
<li><p>实现步骤</p>
<ul>
<li>定义一个类MyRunnable实现Runnable接口</li>
<li>在MyRunnable类中重写run()方法</li>
<li>创建MyRunnable类的对象（注意这是一个任务对象，还需要把它交给线程对象来执行）</li>
<li>创建Thread类的对象，把MyRunnable对象作为构造方法的参数</li>
<li>启动线程</li>
</ul>
</li>
<li><p>代码演示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread01</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;子线程3执行了 = &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread01</span>();</span><br><span class="line"></span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;子线程1执行 = &quot;</span> + i);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;子线程2执行 = &quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程执行 = &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>多线程的实现方案有两种</p>
<ul>
<li>继承Thread类</li>
<li>实现Runnable接口</li>
</ul>
</li>
<li><p>相比继承Thread类，实现Runnable接口的好处</p>
<ul>
<li><p>避免了Java单继承的局限性</p>
</li>
<li><p>适合多个相同程序的代码去处理同一个资源的情况，把线程和程序的代码、数据有效分离，较好的体现了面向对象的设计思想</p>
</li>
</ul>
</li>
</ul>
<h3 id="1-3实现多线程方式三：实现Callable接口【应用】"><a href="#1-3实现多线程方式三：实现Callable接口【应用】" class="headerlink" title="1.3实现多线程方式三：实现Callable接口【应用】"></a>1.3实现多线程方式三：实现Callable<T>接口【应用】</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread03</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Thread03</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getN</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setN</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.n = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//描述线程任务，返回线程执行的结果</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//实现对1-n的和的返回</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            sum+=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个Callable对象</span></span><br><span class="line">        Callable&lt;Integer&gt; thread03 = <span class="keyword">new</span> <span class="title class_">Thread03</span>(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">//把callable的对象封装成一个FutureTask对象（任务对象）未来对象</span></span><br><span class="line">        <span class="comment">//未来对象的作用？</span></span><br><span class="line">        <span class="comment">//是一个任务对象，实现了Runnable接口</span></span><br><span class="line">        <span class="comment">//可以在线程执行完毕之后，用未来任务对象调用get方法获取线程执行完之后的结果</span></span><br><span class="line">        FutureTask&lt;Integer&gt; f1 = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(thread03);</span><br><span class="line">        <span class="comment">//把任务对象交给线程对象</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(f1).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取线程执行完毕后返回的结果</span></span><br><span class="line">        <span class="comment">//如果执行到这，线程没执行完，这里代码会暂停，等待线程执行完毕后才获取结果</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> f1.get();</span><br><span class="line">        System.out.println(<span class="string">&quot;integer = &quot;</span> + integer);</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018192634178.png" alt="image-20231018192634178"></p>
<h3 id="Thread相关的API"><a href="#Thread相关的API" class="headerlink" title="Thread相关的API"></a>Thread相关的API</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018192849584.png" alt="image-20231018192849584"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test04</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread04</span>();</span><br><span class="line">        t1.getName();</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//哪个线程执行她，他就会得到哪个线程</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        thread.setName(<span class="string">&quot;牛逼&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;thread = &quot;</span> + thread.getName());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(thread.getName()+<span class="string">&quot;线程输出&quot;</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Thread04</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.println(thread.getName()+<span class="string">&quot;执行了 = &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="线程安全问题"><a href="#线程安全问题" class="headerlink" title="线程安全问题"></a>线程安全问题</h3><p>多个线程同时操作同一个共享资源，并且修改同一个共享资源</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018194932659.png" alt="image-20231018194932659"></p>
<p>两个人同时取钱问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> money;</span><br><span class="line">    <span class="keyword">private</span> String cardId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCardId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cardId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCardId</span><span class="params">(String cardId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cardId = cardId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(<span class="type">double</span> money, String cardId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.money = money;</span><br><span class="line">        <span class="built_in">this</span>.cardId = cardId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawMoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.money&gt;=money)&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;来取了&quot;</span>+money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.money-=money;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;取钱后剩余&quot;</span>+<span class="built_in">this</span>.money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;余额不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DrawThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Account account;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DrawThread</span><span class="params">(Account acc,String name)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        <span class="built_in">this</span>.account = acc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//取钱</span></span><br><span class="line">        account.drawMoney(<span class="number">200.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>(<span class="number">1000.0</span>,<span class="string">&quot;ICBC-188&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DrawThread</span>(account,<span class="string">&quot;小明&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">DrawThread</span>(account,<span class="string">&quot;小红&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="线程同步（解决线程安全）"><a href="#线程同步（解决线程安全）" class="headerlink" title="线程同步（解决线程安全）"></a>线程同步（解决线程安全）</h3><p>让多个线程先后依次访问共享资源，这样就解决了线程安全问题</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018201111598.png" alt="image-20231018201111598"></p>
<h4 id="加锁方案"><a href="#加锁方案" class="headerlink" title="加锁方案"></a>加锁方案</h4><h5 id="同步代码块"><a href="#同步代码块" class="headerlink" title="同步代码块"></a>同步代码块</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018201303232.png" alt="image-20231018201303232"></p>
<p>多个线程要有同一把钥匙来打开一个共享资源</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawMoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">    <span class="comment">//this代表共享资源</span></span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.money&gt;=money)&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;来取了&quot;</span>+money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.money-=money;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;取钱后剩余&quot;</span>+<span class="built_in">this</span>.money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;余额不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018202420434.png" alt="image-20231018202420434"></p>
<h5 id="同步方法"><a href="#同步方法" class="headerlink" title="同步方法"></a>同步方法</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018202609125.png" alt="image-20231018202609125"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018202942512.png" alt="image-20231018202942512"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018203100212.png" alt="image-20231018203100212"></p>
<h5 id="Lock锁"><a href="#Lock锁" class="headerlink" title="Lock锁"></a>Lock锁</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018204407691.png" alt="image-20231018204407691"></p>
<p>定义锁，自己来加锁和解锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> money;</span><br><span class="line">    <span class="keyword">private</span> String cardId;</span><br><span class="line">    <span class="comment">//为什么放在这，因为方法可以直接使用，也便于创建一个对象，就有这个对象所对应的锁</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lk</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">//加final，不能进行二次复制</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">drawMoney</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">    <span class="comment">//this代表共享资源</span></span><br><span class="line">    lk.lock();<span class="comment">//加锁</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.money&gt;=money)&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;来取了&quot;</span>+money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">            <span class="built_in">this</span>.money-=money;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;取钱后剩余&quot;</span>+<span class="built_in">this</span>.money+<span class="string">&quot;钱&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;余额不足&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lk.unlock();<span class="comment">//解锁</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231018204500156.png" alt="image-20231018204500156"></p>
<h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3><p>可以复用线程的技术,不会因为线程过多而导致线程瘫痪。可以创建几个线程来执行多个任务</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019141643837.png" alt="image-20231019141643837"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019142025592.png" alt="image-20231019142025592"></p>
<p>线程池可以控制线程的数量和任务的数量（不会导致瘫痪），让线程去反复的去处理任务.</p>
<p>任务队列里面都是实现了Runnable和Callable的对象，因为是把他们交给线程池</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019142852345.png" alt="image-20231019142852345"></p>
<h4 id="ThreadPoolExecutor创建线程池"><a href="#ThreadPoolExecutor创建线程池" class="headerlink" title="ThreadPoolExecutor创建线程池"></a>ThreadPoolExecutor创建线程池</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019143236104.png" alt="image-20231019143236104"></p>
<p><strong>线程池的注意事项</strong></p>
<p>临时线程什么时候创建</p>
<p>新任务提交时核心线程都在忙，并且任务队列都满了，并且还可以在创建临时线程，此时才可以创建临时线程</p>
<p>什么时候会开始拒绝新任务</p>
<p>核心线程和临时线程都在工作，并且任务队列也满了，会根据拒绝策略去拒绝新任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//线程池工厂</span></span><br><span class="line">         <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, TimeUnit.HOURS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">5</span>),Executors.defaultThreadFactory(),<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">       <span class="comment">/* public ThreadPoolExecutor(</span></span><br><span class="line"><span class="comment">        int corePoolSize, //核心线程数量</span></span><br><span class="line"><span class="comment">        int maximumPoolSize, //最大线程数量 核心+临时线程</span></span><br><span class="line"><span class="comment">        long keepAliveTime, //临时线程存活时间</span></span><br><span class="line"><span class="comment">        TimeUnit unit, //时间单位</span></span><br><span class="line"><span class="comment">        B lockingQueue&lt;Runnable&gt; workQueue, //任务队列</span></span><br><span class="line"><span class="comment">        ThreadFactory threadFactory, //线程工厂</span></span><br><span class="line"><span class="comment">        RejectedExecutionHandler handler) //线程都在忙。任务队列也满了 新任务来了之后怎么处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//       new ArrayBlockingQueue&lt;&gt;(5)//基于数组的任务队列</span></span><br><span class="line"><span class="comment">//       new LinkedBlockingDeque //基于链表的任务队列，可以往后加队列</span></span><br><span class="line"><span class="comment">//        Executors.defaultThreadFactory()//默认工厂，会帮我们创建</span></span><br><span class="line"><span class="comment">//         new ThreadPoolExecutor.AbortPolicy()//决绝策略是抛异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="线程池处理Runnable对象"><a href="#线程池处理Runnable对象" class="headerlink" title="线程池处理Runnable对象"></a>线程池处理Runnable对象</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019150803593.png" alt="image-20231019150803593"></p>
<p>拒绝策略</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019153128394.png" alt="image-20231019153128394"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pool</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="comment">//通过ThreadPoolExecutor创建线程池工厂</span></span><br><span class="line">         <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, TimeUnit.HOURS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">4</span>),Executors.defaultThreadFactory(),<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line"></span><br><span class="line">         <span class="type">Runnable</span> <span class="variable">runnable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RunnableP</span>();</span><br><span class="line"></span><br><span class="line">         <span class="comment">//（三个核心线程）</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        <span class="comment">//以上是核心线程，以下四个再任务队列排队(4个任务队列)</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        <span class="comment">//临时线程创建时机，任务队列满了，会创建临时线程(2个临时线程)</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line">        <span class="comment">//拒绝任务</span></span><br><span class="line">        pool.execute(runnable); <span class="comment">//线程池对象会帮我们自动创建新线程、并执行线程</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        pool.shutdown();//会等线程执行完之后，关闭线程池</span></span><br><span class="line"><span class="comment">//        pool.shutdownNow();//立即关掉</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">       <span class="comment">/* public ThreadPoolExecutor(</span></span><br><span class="line"><span class="comment">        int corePoolSize, //线程池支持的核心线程数量</span></span><br><span class="line"><span class="comment">        int maximumPoolSize, //最大线程数量 核心+临时线程</span></span><br><span class="line"><span class="comment">        long keepAliveTime, //临时线程存活时间</span></span><br><span class="line"><span class="comment">        TimeUnit unit, //时间单位</span></span><br><span class="line"><span class="comment">        B lockingQueue&lt;Runnable&gt; workQueue, //任务队列</span></span><br><span class="line"><span class="comment">        ThreadFactory threadFactory, //线程工厂</span></span><br><span class="line"><span class="comment">        RejectedExecutionHandler handler) //线程都在忙。任务队列也满了 新任务来了之后怎么处理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//       new ArrayBlockingQueue&lt;&gt;(5)//基于数组的任务队列</span></span><br><span class="line"><span class="comment">//       new LinkedBlockingDeque //基于链表的任务队列，可以往后加队列</span></span><br><span class="line"><span class="comment">//        Executors.defaultThreadFactory()//默认工厂，会帮我们创建</span></span><br><span class="line"><span class="comment">//         new ThreadPoolExecutor.AbortPolicy()//决绝策略是抛异常</span></span><br><span class="line"><span class="comment">//        new ThreadPoolExecutor.CallerRunsPolicy() //拒绝策略是让主线程去执行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;C:\Program Files\Java\jdk1.8.0_131\bin\java.exe&quot;</span> <span class="string">&quot;-javaagent:D:\JavaP\idea\IntelliJ IDEA 2019.2.4\lib\idea_rt.jar=61317:D:\JavaP\idea\IntelliJ IDEA 2019.2.4\bin&quot;</span> -Dfile.encoding=UTF-<span class="number">8</span> -classpath <span class="string">&quot;C:\Program Files\Java\jdk1.8.0_131\jre\lib\charsets.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\deploy.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\access-bridge-64.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\cldrdata.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\dnsns.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\jaccess.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\jfxrt.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\localedata.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\nashorn.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\sunec.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\sunjce_provider.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\sunmscapi.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\sunpkcs11.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\ext\zipfs.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\javaws.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\jce.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\jfr.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\jfxswt.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\jsse.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\management-agent.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\plugin.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\resources.jar;C:\Program Files\Java\jdk1.8.0_131\jre\lib\rt.jar;D:\JavaP\IdeaProjects\sangengtest\out\production\day09&quot;</span> </span><br><span class="line">    </span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">1</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[main,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">3</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">2</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">5</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br><span class="line">Thread[pool-<span class="number">1</span>-thread-<span class="number">4</span>,<span class="number">5</span>,main]线程打印<span class="number">6666</span></span><br></pre></td></tr></table></figure>

<h5 id="线程池处理Callable对象"><a href="#线程池处理Callable对象" class="headerlink" title="线程池处理Callable对象"></a>线程池处理Callable对象</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableP</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> a;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CallableP</span><span class="params">(<span class="type">int</span> a)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; a; i++) &#123;</span><br><span class="line">            sum = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Thread.currentThread()+<span class="string">&quot;he为&quot;</span>+sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> pool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Pool2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//通过ThreadPoolExecutor创建线程池工厂</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, TimeUnit.HOURS, <span class="keyword">new</span> <span class="title class_">LinkedBlockingDeque</span>&lt;&gt;(<span class="number">4</span>), Executors.defaultThreadFactory(), <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line">        <span class="type">CallableP</span> <span class="variable">callableP</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CallableP</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取未来对象，获取线程执行完的结果，实质上是任务对象</span></span><br><span class="line">        Future&lt;String&gt; submit1 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit2 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit3 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit4 = pool.submit(callableP);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;submit1 = &quot;</span> + submit1.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit2 = &quot;</span> + submit2.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit3 = &quot;</span> + submit3.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit4 = &quot;</span> + submit4.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Executors创建线程池"><a href="#Executors创建线程池" class="headerlink" title="Executors创建线程池"></a>Executors创建线程池</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019155151828.png" alt="image-20231019155151828"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019160000565.png" alt="image-20231019160000565"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CallableP</span> <span class="variable">callableP</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CallableP</span>(<span class="number">13</span>);</span><br><span class="line">        <span class="comment">//计算密集型的将线程数=CPU核数+1</span></span><br><span class="line"><span class="comment">//        oom内存溢出</span></span><br><span class="line">        <span class="comment">//IO密集型的将线程数=CPU核数*2</span></span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//获取未来对象，获取线程执行完的结果，实质上是任务对象</span></span><br><span class="line">        Future&lt;String&gt; submit1 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit2 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit3 = pool.submit(callableP);</span><br><span class="line">        Future&lt;String&gt; submit4 = pool.submit(callableP);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;submit1 = &quot;</span> + submit1.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit2 = &quot;</span> + submit2.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit3 = &quot;</span> + submit3.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;submit4 = &quot;</span> + submit4.get());</span><br></pre></td></tr></table></figure>

<h3 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019184532353.png" alt="image-20231019184532353"></p>
<h4 id="并发和并行"><a href="#并发和并行" class="headerlink" title="并发和并行"></a>并发和并行</h4><p>并发：同一间隔内，多个线程被Cpu调度执行，cpu轮询快速切换到不同线程，让其看到是同时执行</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019185318428.png" alt="image-20231019185318428"></p>
<p>并行：同一时刻，多个线程被CPU调度执行</p>
<ul>
<li>解释一：并行是指两个或者多个事件在同一时刻发生；而并发是指两个或多个事件在同一时间间隔发生。</li>
<li>解释二：并行是在不同实体上的多个事件，并发是在同一实体上的多个事件。</li>
<li>解释三：并发是在一台处理器上“同时”处理多个任务，并行是在多台处理器上同时处理多个任务。如 hadoop 分布式集群。 所以并发编程的目标是充分的利用处理器的每一个核，以达到最高的处理性能。</li>
</ul>
<p>并行</p>
<p>并行(parallel)：指在同一时刻，有多条指令在多个处理器上同时执行。所以无论从微观还是从宏观来看，二者都是一起执行的。</p>
<p><img src="https://pics7.baidu.com/feed/0b46f21fbe096b6333a209ed69513d4feaf8ac46.jpeg@f_auto?token=756cdc29eb11f4a51f75466ba32bfa03" alt="img"></p>
<p>并发</p>
<p>并发(concurrency)：指在同一时刻只能有一条指令执行，但多个进程指令被快速的轮换执行，使得在宏观上具有多个进程同时执行的效果，但在微观上并不是同时执行的，只是把时间分成若干段，使多个进程快速交替的执行。</p>
<p><img src="https://pics7.baidu.com/feed/0df3d7ca7bcb0a46d355bde70e014c2f6a60af62.jpeg@f_auto?token=23d6a6c455e8dd01bec353dde030ac64" alt="img"></p>
<h3 id="线程生命周期"><a href="#线程生命周期" class="headerlink" title="线程生命周期"></a>线程生命周期</h3><p>wait释放锁</p>
<p>sleep不释放锁</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019185712773.png" alt="image-20231019185712773"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019190149895.png" alt="image-20231019190149895"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019190203335.png" alt="image-20231019190203335"></p>
<h3 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h3><p>悲观锁：在执行之前加锁，线程安全，性能较差</p>
<p>乐观锁：再执行之前认为他是安全的，等到遇到线程安全之后再加锁,线程安全，性能也好</p>
<p>CAS算法（WeakCompareAndSet比较和修改值）（改之前和原先的值进行比较）</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231019192205898.png" alt="image-20231019192205898"></p>
<p>先把10拿出来进行+1，11和原先的10作比较，10没有被其他人改就更新这个值，如果等于11了，这次就作废</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SendThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; gift;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCount</span><span class="params">(<span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SendThread</span><span class="params">(List&lt;String&gt; gift, String name)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(name);</span><br><span class="line">    <span class="built_in">this</span>.gift=gift;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">getGift</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> gift;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGift</span><span class="params">(List&lt;String&gt; gift)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gift = gift;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">        <span class="comment">//发礼物</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//锁必须唯一</span></span><br><span class="line">           <span class="keyword">synchronized</span> (gift)&#123;</span><br><span class="line">               <span class="keyword">if</span> (gift.size()&lt;<span class="number">10</span>)&#123;</span><br><span class="line">                   <span class="keyword">return</span>;</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> gift.remove(random.nextInt(gift.size()));</span><br><span class="line">               System.out.println(name+<span class="string">&quot;发出&quot;</span>+s);</span><br><span class="line">               <span class="built_in">this</span>.count++;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="comment">//100份礼物，小红和小明两人同时发送，礼品小于10分，停止发送</span></span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; gift = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        String[] names = &#123;<span class="string">&quot;口红&quot;</span>,<span class="string">&quot;包包&quot;</span>,<span class="string">&quot;鲜花&quot;</span>,<span class="string">&quot;皮带&quot;</span>,<span class="string">&quot;手表&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            gift.add(names[random.nextInt(names.length)] +(i+<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">SendThread</span> <span class="variable">xm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendThread</span>(gift, <span class="string">&quot;小明&quot;</span>);</span><br><span class="line">        xm.start();</span><br><span class="line">        <span class="type">SendThread</span> <span class="variable">xh</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SendThread</span>(gift, <span class="string">&quot;小红&quot;</span>);</span><br><span class="line">        xh.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//等上面执行完，然后获取分发次数</span></span><br><span class="line">        xm.join();</span><br><span class="line">        xh.join();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;xm.getCount() = &quot;</span> + xm.getCount());</span><br><span class="line">        System.out.println(<span class="string">&quot;xh.getCount() = &quot;</span> + xh.getCount());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="MySQL数据库"><a href="#MySQL数据库" class="headerlink" title="MySQL数据库"></a>MySQL数据库</h1><h2 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h2><p><strong>1、数据定义语言（DDL Data Definition Language）</strong>：创建、修改或删除数据库中表、视图、索引等对象的操作，常用命令为CREATE、DROP；</p>
<p>CREATE语句<br>CREATE TABLE keep(<br>id CHAR(16) ,<br>user_name VARCHAR(16) ,<br>password VARCHAR(15)<br>)<br>执行结果：在test数据库中创建keep表<br><img src="http://img.voycn.com/images/2019/05/0b4704075682889e2cccf454ec5e1921.png" alt="SQL语句与数据库操作语句"> DROP语句<br>DROP TABLE keep<br>执行结果：在test数据库中删除keep表<br><img src="http://img.voycn.com/images/2019/05/7861a32d754c6b5d403e70ae74f1a668.png" alt="SQL语句与数据库操作语句"></p>
<p><strong>2、数据操纵语言（DML Data Manipulation Language）</strong> ：向表中添加、删除、修改数据操作，常用命令有insert、update和delete；</p>
<p>INSERT语句<br>INSERT INTO keep (id,user_name,password) VALUES (‘123’,‘fuliuqingfeng’,‘123456’);<br>执行结果：<br><img src="http://img.voycn.com/images/2019/05/38d50a2c658bb124972bcabe9e33a653.png" alt="SQL语句与数据库操作语句"> UPDATE语句<br>UPDATE keep SET id = ‘111’ WHERE user_name = ‘fuliuqingfeng’<br>执行结果：id改为111<br><img src="http://img.voycn.com/images/2019/05/ac6c85e4a7f41022c80580811927eda7.png" alt="SQL语句与数据库操作语句"> DETELE语句<br>DELETE FROM keep WHERE user_name = ‘fuliuqingfeng’<br>执行结果删除user_name为fuliuqingfeng的信息</p>
<p><strong>3、数据查询语言（DQL Data Query Language）</strong> ：按照指定的组合、条件表达式或排序检索已存在的数据库中数据，不改变数据库中数据，常用命令为select；</p>
<p>SELECT语句<br>SELECT * FROM keep<br>执行结果：列出keep表中所有信息<br><img src="http://img.voycn.com/images/2019/05/b1af252b24b6505be1bf2936c9650ee7.png" alt="SQL语句与数据库操作语句"></p>
<p><strong>4、数据控制语言（DCL Data Control Language）</strong> ：用来授予或收回访问数据库的某种特权、控制数据操纵事务的发生时间及效果、对数据库进行监视等操作，常用命令有GRANT、REVOKE、COMMIT、ROLLBACK；</p>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>事务是一组操作的集合这组操作，要么全部成功，要么全部失败</p>
<h3 id="事务操作"><a href="#事务操作" class="headerlink" title="事务操作"></a>事务操作</h3><p>start transaction; –开启事务</p>
<p>commit/rollback; –提交回滚事务</p>
<h3 id="事务的四大特性"><a href="#事务的四大特性" class="headerlink" title="事务的四大特性"></a>事务的四大特性</h3><p>原子性：事务是原子级别，要么全部执行成功，要么全部执行失败</p>
<p>一致性：事务完成时，必须所有的数据都要保持一致状态</p>
<p>隔离性：数据库提供的隔离机制，保证事务在不受外部并发操作影响下的独立环境下运行</p>
<p>持久性：事务一旦提交或者回滚，他对数据库的数据的改变是永久的</p>
<h3 id="并发事务的问题"><a href="#并发事务的问题" class="headerlink" title="并发事务的问题"></a>并发事务的问题</h3><p>脏读：一个事务读取到另一个还未提交的数据（指更新或者删除未提交）</p>
<p>不可重复读：一个事务先后读取同一条数据，在第二次读之前被其他值修改（但是它未提交），但两次读取的数据不同</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231020191530029.png" alt="image-20231020191530029"></p>
<p>幻读：<img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231020191738503.png" alt="image-20231020191738503"></p>
<p>开启一个事务，一个事务查询数据没查到，插入一条数据，在查询还是没查到，提交一下插入数据，然后查询一下又没查询到，但是在插入就显示已存在</p>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231020192329132.png" alt="image-20231020192329132"></p>
<p>设置语句</p>
<p>set session transaction isolation level read uncommit;</p>
<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022142605610.png" alt="image-20231022142605610"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022142656908.png" alt="image-20231022142656908"></p>
<p>不同存储引擎，索引结构是不同的</p>
<h3 id="存储引擎简介"><a href="#存储引擎简介" class="headerlink" title="存储引擎简介"></a>存储引擎简介</h3><p>默认的是InnoDB存储引擎</p>
<p>存储引擎是存储数据、建立索引、更新查询数据等技术的实现方式。存储引擎是基于表而不是基于库，又被叫做表类型</p>
<p>创建表指定存储引擎  engine=InnoDB</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022143400084.png" alt="image-20231022143400084"></p>
<p>展示所支持的存储引擎：shwo  engines;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022143540222.png" alt="image-20231022143540222"></p>
<h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><p>高可靠性，高性能</p>
<p>特点：事务、行级锁、外键</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022143848670.png" alt="image-20231022143848670"></p>
<p>sdi：字典，ibd：每个表对应表空间</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022144214788.png" alt="image-20231022144214788"></p>
<h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><p>有表结构sdi 表数据myd 表索引myi</p>
<p>没有外键，删除和修改更好</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022144444156.png" alt="image-20231022144444156"></p>
<h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022144528740.png" alt="image-20231022144528740"></p>
<h3 id="三者关系"><a href="#三者关系" class="headerlink" title="三者关系"></a>三者关系</h3><p>InnoDB和MyISAM</p>
<p>前者支持外键支持事务支持行级锁</p>
<p>后者不支持外键不支持事务支持表级锁</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022144706217.png" alt="image-20231022144706217"></p>
<h3 id="MyISAM-和-InnoDB区别"><a href="#MyISAM-和-InnoDB区别" class="headerlink" title="MyISAM 和 InnoDB区别"></a>MyISAM 和 InnoDB区别</h3><p>MyISAM 采用表级锁(table-level locking)。InnoDB 支持行级锁(row-level locking)和表级锁,默认为行级锁。</p>
<h3 id="表级锁和行级锁对比"><a href="#表级锁和行级锁对比" class="headerlink" title="表级锁和行级锁对比"></a>表级锁和行级锁对比</h3><p>表级锁： MySQL 中锁 粒度最大 ，对当前操作的整张表加锁，加锁的开销小，加锁快，不会出现死锁，（因为要么一次性获取全部的锁，要么等待）。其锁定粒度最大，触发锁冲突的概率高，并发度低。<br>行级锁： MySQL 中锁 粒度最小 ，只针对当前操作的行进行加锁，加锁的开销大，加锁慢，会出现死锁。 行级锁能大大减少数据库操作的冲突。其锁粒度最小，触发锁冲突的概率低、并发度高。</p>
<h3 id="引擎选择"><a href="#引擎选择" class="headerlink" title="引擎选择"></a>引擎选择</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022145049869.png" alt="image-20231022145049869"></p>
<p>InnoDB：事务完整比较高，数据一致性比较高，除了插入和查询之外，还包含了更新和删除</p>
<p>MyISAM ：读和插入操作比较多时（MongDB）</p>
<p>Memory：访问速度比较快，适用于临时缓存，但表的大的话，就无法缓存到内存中（Redis）</p>
<h3 id="docker配置mysql"><a href="#docker配置mysql" class="headerlink" title="docker配置mysql"></a>docker配置mysql</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_54958293/article/details/128544701">Linux——docker安装mysql8.0.31_牧魂.的博客-CSDN博客</a></p>
<p>–restart=always：总是跟随[docker启动]</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><h4 id="索引概述"><a href="#索引概述" class="headerlink" title="索引概述"></a>索引概述</h4><p>索引是高效的数据结构，通过数据结构指向数据，快速查询数据，有序</p>
<p>优点：提高数据检索的效率，降低数据库的IO成本，查新快。</p>
<p>通过索引对数据进行排序，有效降低排序成本，降低cpu的消耗</p>
<p>缺点：索引占据空间，提高查询效率，而增删改的时候效率也会降低</p>
<h4 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022164000278.png" alt="image-20231022164000278"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022164018236.png" alt="image-20231022164018236"></p>
<h5 id="B树"><a href="#B树" class="headerlink" title="B树"></a>B树</h5><p>二叉树（左小右大）</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022164114952.png" alt="image-20231022164114952"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022164358881.png" alt="image-20231022164358881"></p>
<p>红黑树：相对平衡的二叉搜索树，但不是严格意义上的二叉搜索树，叶子和非叶子节点都会存储数据</p>
<h5 id="B-tree树"><a href="#B-tree树" class="headerlink" title="B-tree树"></a>B-tree树</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022200627041.png" alt="image-20231022200627041"></p>
<p>5阶的，如果有四个了之后会发生裂变，让中间的数分裂上去</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022200832824.png" alt="image-20231022200832824"></p>
<p>插入1200，大于4个节点，0345往上分列，形成</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022200938773.png" alt="image-20231022200938773"></p>
<h5 id="B-树"><a href="#B-树" class="headerlink" title="B+树"></a>B+树</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022203004341.png" alt="image-20231022203004341"></p>
<p>最多存储3个key和4个指针</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022202018584.png" alt="image-20231022202018584"></p>
<p>数据都在叶子节点,每个叶子节点都会有一个双向链表，非叶子节点只存储索引的作用</p>
<h5 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h5><p>哈希索引就是采用hash算法，将键值转换成新的hash值，映射到对应的槽位上，然后存储到hash表中。如果存在哈希碰撞，就需要连成链表去找对应的数据</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022202231226.png" alt="image-20231022202231226"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231022202318413.png" alt="image-20231022202318413"></p>
<h5 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h5><p>为什么InnoDB存储引擎选择使用B+tree索引结构？</p>
<p>相对于二叉树，层级更少，搜索效率更高</p>
<p>对于B-tree，无论是叶子节点还是非叶子节点，都会存储数据，这样导致一页中存储的键值减少，指针跟着减少，要保存大量数据，只能增加树的高度，导致性能降低。而B+tree只有叶子节点存储数据，而非叶子节点就可以保存更多的键值，指针就会跟着增多</p>
<h4 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023151433702.png" alt="image-20231023151433702"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023144115851.png" alt="image-20231023144115851"></p>
<p>主键索引：如果有主键，会自动创建主键索引</p>
<p>唯一索引：字段值不重复，比如身份证号</p>
<p>聚集索引挂的是一行的数据（是主键索引），而二级索引是挂的是主键</p>
<p>联合索引：多个列同时查询，最左匹配原则，搜索频繁最多的放在前面</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023154851963.png" alt="image-20231023154851963"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023144455046.png" alt="image-20231023144455046"></p>
<p>回表查询是指先到二级索引拿到id，根据id去聚集索引查找行的数据</p>
<h5 id="思考题-1"><a href="#思考题-1" class="headerlink" title="思考题"></a>思考题</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023145201602.png" alt="image-20231023145201602"></p>
<p>第一个查询快，因为第一个（id是主键）直接去聚集索引中根据id查；第二个是根据name所建立的索引，先去二级索引中根据name找所对应的id，再根据查到的id去聚集索引中查找所对应的行数据也称回表查询</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023150609316.png" alt="image-20231023150609316">1页可以有16行，也就是16k ，一页也就1024个字节。n代表当前节点存在key的数量，n+1代表指针，key+指针</p>
<p>高度为3，每个节点都有1171个指针，而每个节点都可以有1171个</p>
<h4 id="索引语法"><a href="#索引语法" class="headerlink" title="索引语法"></a>索引语法</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023151528340.png" alt="image-20231023151528340"></p>
<h4 id="SQL性能分析"><a href="#SQL性能分析" class="headerlink" title="SQL性能分析"></a>SQL性能分析</h4><h6 id="查看执行频次"><a href="#查看执行频次" class="headerlink" title="查看执行频次"></a>查看执行频次</h6><p>select global status like ‘Com_______’;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023155649195.png" alt="image-20231023155649195"></p>
<p>后面7个_    来查看哪个进行优化</p>
<h6 id="慢查询日志"><a href="#慢查询日志" class="headerlink" title="慢查询日志"></a>慢查询日志</h6><p>查看谁超过了默认的sql查询时间</p>
<p>只会记录执行时间超过预期时间的sql语句</p>
<p>show variables like ‘slow_query_log’;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023160437000.png" alt="image-20231023160437000"></p>
<h6 id="profile"><a href="#profile" class="headerlink" title="profile"></a>profile</h6><p>select @@have_profiling;查询是否支持</p>
<p>查询每一个sql的执行耗时</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023164010596.png" alt="image-20231023164010596"></p>
<h6 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h6><p>查询性能分析</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023164959433.png" alt="image-20231023164959433"></p>
<p>id值越大先执行</p>
<p>在sql语句前面弄一个explain 然后就可以查看运行顺序</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023170809476.png" alt="image-20231023170809476"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023170845254.png" alt="image-20231023170845254"></p>
<p>type 尽量往前提type，可以显示出性能好不好</p>
<h4 id="索引的使用"><a href="#索引的使用" class="headerlink" title="索引的使用"></a>索引的使用</h4><p>没索引就是全表扫描</p>
<p>用索引就是构造b+树</p>
<h6 id="最左前缀原则"><a href="#最左前缀原则" class="headerlink" title="最左前缀原则"></a><strong>最左前缀原则</strong></h6><p>联合索引，索引最左边的列必须存在，不能跳。如果最左边的列不存在，索引会失效走全表扫描</p>
<p>索引（a,b,c） 如果查询条件只有b和c，索引就失效，因为不符合最左前缀原则，a必须存在</p>
<p>如果查询 a和c 那么c会失效，因为没有b</p>
<p><strong>索引失效和位置无关和存在有关</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023172604805.png" alt="image-20231023172604805"></p>
<p>范围查询</p>
<p>联合查询（复合查询）</p>
<p>建议使用&gt;=查询</p>
<blockquote>
<p>如果是&gt;后面的索引都会失效 </p>
<p>要是&gt;=后面的索引不会失效</p>
</blockquote>
<p>联合查询可以解决回表查询</p>
<h6 id="索引失效情况"><a href="#索引失效情况" class="headerlink" title="索引失效情况"></a>索引失效情况</h6><p><strong>不要在索引列上进行运算操作</strong></p>
<p>比如![1698057842235](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\1698057842235.png)</p>
<p>索引会失效</p>
<p><strong>字符串不加引号，会造成类型转换</strong></p>
<p>字符串类型使用时，不加引号，索引会失效</p>
<p><strong>模糊匹配</strong></p>
<p>%在前面就会失效，%在后面就不会失效，要规避前面是%的模糊查询</p>
<p><strong>or</strong></p>
<p>or左右条件都有索引的话，才会索引生效</p>
<p>or左右有一个就不生效</p>
<p>age没索引</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023190524388.png" alt="image-20231023190524388"></p>
<p>age有索引</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023190716264.png" alt="image-20231023190716264"></p>
<p><strong>数据分布影响</strong></p>
<p>mysql会评估到使用索引比全表更慢，则不使用索引，索引会失效</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023191139650.png" alt="image-20231023191139650"></p>
<h6 id="SQL使用提示"><a href="#SQL使用提示" class="headerlink" title="SQL使用提示"></a>SQL<strong>使用提示</strong></h6><p>要是有一个列即在联合索引又在常规索引里，它默认使用的是联合索引</p>
<p>use index(索引名)  可以在from 表名后使用 use index(索引名)来指定，可能会评估，不使用</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023192318407.png" alt="image-20231023192318407"></p>
<p>ignore index（忽略的索引名）</p>
<p>force index （强制的索引名）</p>
<p><strong>覆盖索引</strong></p>
<p>覆盖索引是在二级索引中，都显示的属性，就不需要回表查询</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023193330630.png" alt="image-20231023193330630"></p>
<h6 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h6><p>截取字符串长的</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023194731205.png" alt="image-20231023194731205"></p>
<p>不重复/总数=选择性</p>
<h6 id="单列索引-联合索引"><a href="#单列索引-联合索引" class="headerlink" title="单列索引/联合索引"></a>单列索引/联合索引</h6><p>优先推荐联合索引，性能高，使用得当就会避免回调查询</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023195634654.png" alt="image-20231023195634654"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023195754043.png" alt="image-20231023195754043"></p>
<p><strong>索引设计原则</strong></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231023200002595.png" alt="image-20231023200002595"></p>
<h2 id="SQL优化"><a href="#SQL优化" class="headerlink" title="SQL优化"></a>SQL优化</h2><h3 id="insert优化"><a href="#insert优化" class="headerlink" title="insert优化"></a>insert优化</h3><p>批量插入、手动提交事务、主键顺序插入</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024145601764.png" alt="image-20231024145601764"></p>
<p>大批量数据使用load指令local data local infile</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024151004858.png" alt="image-20231024151004858"></p>
<p>主键顺序插入性能高于乱序插入</p>
<h3 id="主键优化"><a href="#主键优化" class="headerlink" title="主键优化"></a>主键优化</h3><p>页分裂和页合并</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024154540732.png" alt="image-20231024154540732"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024154242681.png" alt="image-20231024154242681"></p>
<p>主键乱序插入会造成页分裂</p>
<p>页分裂：乱序插入，50插入，会开启新的数据页，将第一页中后超出50%的部分插入到第三个数据页，将50插入到第三页，然后第一页双向链表和第三个双向链表连接</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024154416191.png" alt="image-20231024154416191">页合并：如果一个页中删除的数据大于这个页的50%，就可以找前后两个看看是否可以合并</p>
<p>主键过长，查得慢，而且占空间</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024153818204.png" alt="image-20231024153818204"></p>
<h3 id="order-by优化"><a href="#order-by优化" class="headerlink" title="order by优化"></a>order by优化</h3><p>排序字段尽量使用索引，使用覆盖索引</p>
<p>using index 直接通过索引返回数据，性能高</p>
<p>using filesort 需要将返回的结果在缓冲区中排序</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024185543554.png" alt="image-20231024185543554"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024185642783.png" alt="image-20231024185642783"></p>
<p>排序时，先根据想要排序的顺序建立索引，比如想age升序，name降序 然后可以建立索引 create index yb_k on emp(age asc ,name desc)建立索引，就不会出现filesort了，这样不会慢。默认都是升序</p>
<p><strong>order by最左前缀法则 顺序好像必须一致</strong></p>
<p><strong>where 存在就行</strong></p>
<p>查询时出现using temportary就会产生临时表，会使查询变慢</p>
<h3 id="group-by分组优化"><a href="#group-by分组优化" class="headerlink" title="group by分组优化"></a>group by分组优化</h3><p>推荐建立索引使用联合索引</p>
<p>group by最左前缀法则 顺序好像必须一致</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231024190731831.png" alt="image-20231024190731831"></p>
<p>用到临时表就是很慢，就需要建立索引</p>
<h3 id="Limit优化"><a href="#Limit优化" class="headerlink" title="Limit优化"></a>Limit优化</h3><p>通过覆盖索引和子查询的优化</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025103859150.png" alt="image-20231025103859150"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025103454016.png" alt="image-20231025103454016"></p>
<h3 id="count优化"><a href="#count优化" class="headerlink" title="count优化"></a>count优化</h3><p>推荐使用count（*） 专门进行了优化 直接进行累加，不需拿值，不需判断为null</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025104718951.png" alt="image-20231025104718951"></p>
<h3 id="update优化"><a href="#update优化" class="headerlink" title="update优化"></a>update优化</h3><p>where要有索引的字段，并且索引不能失效</p>
<p>可以先查出有索引的字段，然后根据查出来的索引字段进行更新</p>
<p>update s set gender=’男’ where id (select id from emp where gender=’女’);</p>
<p>这样就很快，走的是聚集索引，不会进行回表查询</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025105348914.png" alt="image-20231025105348914"></p>
<p>如果根据索引条件更新某一字段值，走的是行锁</p>
<p>如果根据某一字段值更新某一字段值，走的是表锁，因为没有加索引会全表扫描这个条件字段值</p>
<p>行锁升级为表锁，会降低并发访问性能</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025111115203.png" alt="image-20231025111115203"></p>
<p><strong>表锁</strong></p>
<p> 特点：偏向MyISAM存储引擎，开销小，加锁快；无死锁；锁定粒度大，发生锁冲突的概率最高,并发度最低。</p>
<p><strong>行锁</strong></p>
<p> 特点：偏向InnoDB存储引擎，和表锁相反</p>
<p><a target="_blank" rel="noopener" href="https://www.php.cn/faq/418290.html">mysql中表锁和行锁有什么区别-mysql教程-PHP中文网</a></p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><h3 id="视图介绍"><a href="#视图介绍" class="headerlink" title="视图介绍"></a>视图介绍</h3><p>视图是一个虚表，并不真实存在，里面的数据是动态生成的</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025190959807.png" alt="image-20231025190959807"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025191119048.png" alt="image-20231025191119048"></p>
<p>视图相当于一个封装好的select函数</p>
<h3 id="视图语法"><a href="#视图语法" class="headerlink" title="视图语法"></a>视图语法</h3><p>创建视图</p>
<p>create （or repalce） view emp_v1 as select id, name from emp;</p>
<p>查看视图</p>
<p>SHOW CREATE VIEW 视图名称</p>
<p>修改视图</p>
<p>create or repalce view emp_v1 as select id, name from emp;</p>
<p>alter view emp_v1 as select * from emp;</p>
<p>删除视图</p>
<p> drop view if exists emp_v1;</p>
<h3 id="检查选项cascaded"><a href="#检查选项cascaded" class="headerlink" title="检查选项cascaded"></a>检查选项cascaded</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025192127011.png" alt="image-20231025192127011"></p>
<p>哪一句加这个选项，这一句和所依赖的上一句都会检查所插入的是否满足where条件</p>
<p>没有这个选项，就不会检查是否满足索引的条件，都会插到表里面</p>
<p>检查会向上传递</p>
<h3 id="检查选项local"><a href="#检查选项local" class="headerlink" title="检查选项local"></a>检查选项local</h3><p>哪一句加这个选项，这一句会检查是否满足条件，所依赖的上一句如果有with  local check option会判断是否满足条件，没有就不判断</p>
<p>local 不会向上传递</p>
<h3 id="视图的更新"><a href="#视图的更新" class="headerlink" title="视图的更新"></a>视图的更新</h3><p>视图中的行和表中的行必须是一一对应的关系</p>
<p>不能包含以下：</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025194548787.png" alt="image-20231025194548787"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025194942037.png" alt="image-20231025194942037"></p>
<h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025195316867.png" alt="image-20231025195316867"></p>
<p>（1）</p>
<p>创建视图，缺少那两列</p>
<p>（2）将学生选修课程表很常用，可以将其弄成视图，真实表不存在，可以后面操作视图 封装了查询语句，简化了操作</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025200041399.png" alt="image-20231025200041399"></p>
<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>封装sql语句</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025201806573.png" alt="image-20231025201806573"></p>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025203116766.png" alt="image-20231025203116766"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025203056639.png" alt="image-20231025203056639"></p>
<p>创建存储过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create procedure p1()</span><br><span class="line">begin</span><br><span class="line">    select count(*) from emp</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<p>调用存储过程</p>
<p>call p1();</p>
<p>查看存储过程</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025202707763.png" alt="image-20231025202707763"></p>
<p>删除存储过程</p>
<p>drop procedure if exists p1()</p>
<p>设置结束符 delimiter $$</p>
<p>在结束写上$$表示结束</p>
<h3 id="变量-系统变量"><a href="#变量-系统变量" class="headerlink" title="变量-系统变量"></a>变量-系统变量</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026124625019.png" alt="image-20231026124625019"></p>
<p>show global variables; //所有系统变量</p>
<p>show variables like ‘slow_query_log’; //模糊查询系统变量</p>
<p>select @@global 系统变量名 —查看指定的变量值</p>
<p>不指定的话，默认是会话记录 </p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026130631758.png" alt="image-20231026130631758"></p>
<h3 id="用户定义变量"><a href="#用户定义变量" class="headerlink" title="用户定义变量"></a>用户定义变量</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026131647341.png" alt="image-20231026131647341"></p>
<p>set @myname = ‘kang’;</p>
<p>select @myname </p>
<h3 id="直接跳过存储过程到触发器"><a href="#直接跳过存储过程到触发器" class="headerlink" title="直接跳过存储过程到触发器"></a>直接跳过存储过程到触发器</h3><h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>介绍</p>
<p>保持数据完整性和日志记录和数据校验</p>
<p>在数据的增删改之前或者之后进行日志操作</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026132831360.png" alt="image-20231026132831360"></p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026133059092.png" alt="image-20231026133059092"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026133955027.png" alt="image-20231026133955027"></p>
<h3 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h3><h4 id="插入数据的触发器"><a href="#插入数据的触发器" class="headerlink" title="插入数据的触发器"></a>插入数据的触发器</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026134059126.png" alt="image-20231026134059126"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026133922886.png" alt="image-20231026133922886"></p>
<p><strong>字符串拼接</strong>  concat</p>
<h4 id="更改数据的触发器"><a href="#更改数据的触发器" class="headerlink" title="更改数据的触发器"></a>更改数据的触发器</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026135228538.png" alt="image-20231026135228538"></p>
<p>&lt;5触发4次触发器，因为是行级触发器</p>
<h4 id="删除数据的触发器"><a href="#删除数据的触发器" class="headerlink" title="删除数据的触发器"></a>删除数据的触发器</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026135630159.png" alt="image-20231026135630159"></p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026140241868.png" alt="image-20231026140241868"></p>
<h2 id="锁-1"><a href="#锁-1" class="headerlink" title="锁"></a>锁</h2><h3 id="全局锁"><a href="#全局锁" class="headerlink" title="全局锁"></a>全局锁</h3><p>当前使用哪个数据库，就锁哪个数据库</p>
<p><strong>在对整个库进行逻辑备份时，如果不加全局锁，由于数据库的备份不可能一瞬间完成，那么将可能造成最终数据不一致的问题。</strong></p>
<p>数据备份，加全局锁，不让其他用户对这个表进行DDL，和DML操作，只能进行DQL，保护数据的完整性。只能读</p>
<p>![1698302427347](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\1698302427347.png)</p>
<h4 id="一致性数据备份"><a href="#一致性数据备份" class="headerlink" title="一致性数据备份"></a>一致性数据备份</h4><p>全局锁锁的一般都是当前使用的数据库</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026144544411.png" alt="image-20231026144544411"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026145648705.png" alt="image-20231026145648705"></p>
<p>快照读来备份，不需要加锁 single-transation</p>
<h3 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h3><p>锁定粒度大，每次操作锁住整张表，发生锁冲突的概率最高，并发度最低</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026160844696.png" alt="image-20231026160844696"></p>
<h4 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h4><p>分为：读锁和写锁</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026161049336.png" alt="image-20231026161049336"></p>
<p>读锁：限制DML语句，仅能读表数据 共享锁  本机客户端只能读不能写，其他客户端只能读不能写</p>
<p>写锁：限制其他客户端对表的DML和DQL操作，本机客户端既能进行DML还能进行DQL   排它锁/独占锁</p>
<h4 id="元数据锁"><a href="#元数据锁" class="headerlink" title="元数据锁"></a>元数据锁</h4><p>元数据锁是为了在操作表结构的时候，比如修改表的结构，加上元数据锁，为了避免DML语句对表中的数据做出改变。  默认会加元数据锁</p>
<p>也是在DML操作表数据的时候不能改变表的结构</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026191120359.png" alt="image-20231026191120359"></p>
<h4 id="意向锁"><a href="#意向锁" class="headerlink" title="意向锁"></a>意向锁</h4><p>避免行锁和表锁加锁的冲突问题</p>
<p>表锁，有行锁然后自动给表加意向锁</p>
<p>InnoDb引擎中，表锁和行锁的冲突问题</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026191738672.png" alt="image-20231026191738672"></p>
<p>意向共享锁：两个事务，事务1读数据，事务2可以加表锁读锁</p>
<p>意向排他锁：事务1写数据，事务2读写都不可以，不兼容。但是和意向锁兼容</p>
<p>再执行select的时候，会自动加上表的意向共享锁，也会加行锁</p>
<p>update 这一行会加行锁。并加上表意向排他锁，然后既不能DML也不能DQL</p>
<h3 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h3><p>对操作的行加锁，通过对索引上的索引项来加锁，而不是对记录来加锁</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026194210040.png" alt="image-20231026194210040"></p>
<h4 id="行锁"><a href="#行锁" class="headerlink" title="行锁"></a>行锁</h4><p>在读一行的时候允许别人读，但是不允许别人改</p>
<p>在修改一行数据的时候，不允许别人读和改</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026194646533.png" alt="image-20231026194646533"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026194957520.png" alt="image-20231026194957520"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026195528203.png" alt="image-20231026195528203"></p>
<p>next-key是临建锁</p>
<h4 id="间隙锁"><a href="#间隙锁" class="headerlink" title="间隙锁"></a>间隙锁</h4><h4 id="临建锁"><a href="#临建锁" class="headerlink" title="临建锁"></a>临建锁</h4><p>间隙锁为了防止幻读    防止其他事务插入数据（但是它不能插入），然后造成事务插入异常</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231026200544078.png" alt="image-20231026200544078"></p>
<p>针对第二条：1，3，5，7 在5之前是临建锁，那么在5-7是间隙锁   </p>
<h2 id="InnoDB引擎"><a href="#InnoDB引擎" class="headerlink" title="InnoDB引擎"></a>InnoDB引擎</h2><h3 id="逻辑存储结构"><a href="#逻辑存储结构" class="headerlink" title="逻辑存储结构"></a>逻辑存储结构</h3><p>表空间：一个mysql实例可以对应多个表空间，用于存储记录、索引等数据</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027130026205.png" alt="image-20231027130026205"></p>
<h4 id="架构一"><a href="#架构一" class="headerlink" title="架构一"></a>架构一</h4><p>缓冲池</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027130516178.png" alt="image-20231027130516178"></p>
<p>更改缓冲区</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027131403831.png" alt="image-20231027131403831"></p>
<p>自适应Hash索引</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027131706277.png" alt="image-20231027131706277"></p>
<p>日志缓冲区</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027131830376.png" alt="image-20231027131830376"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132534076.png" alt="image-20231027132534076"></p>
<p>创建表空间</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132552012.png" alt="image-20231027132552012"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132503773.png" alt="image-20231027132503773"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132453280.png" alt="image-20231027132453280"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027132810466.png" alt="image-20231027132810466"></p>
<p>架构</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027133052584.png" alt="image-20231027133052584"></p>
<p>架构：</p>
<p>增删改查操作缓冲区，如果缓冲区没有数据就在磁盘中读取放到缓冲区里面。缓冲区里面的数据将通过后台线程异步刷新到磁盘中，保持数据的一致</p>
<h3 id="InnoDB事务管理"><a href="#InnoDB事务管理" class="headerlink" title="InnoDB事务管理"></a>InnoDB事务管理</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027183835739.png" alt="image-20231027183835739"></p>
<p>redo log</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027184615003.png" alt="image-20231027184615003"></p>
<p>操作缓冲区，然后把修改的数据放到redo.log  ，然后这个log会往磁盘中输出一个文件，然后这个文件是为了防止刷新脏页到磁盘出现问题，导致没同步。这个文件就可以将信息同步到磁盘中</p>
<p>undo log</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027190839647.png" alt="image-20231027190839647"></p>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><p>在快照读的时候通过mvcc找到对应的历史版本</p>
<h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027191235556.png" alt="image-20231027191235556"></p>
<h4 id="隐藏字段"><a href="#隐藏字段" class="headerlink" title="隐藏字段"></a>隐藏字段</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027191718789.png" alt="image-20231027191718789"></p>
<p>undo log</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027193913905.png" alt="image-20231027193913905"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027193817375.png" alt="image-20231027193817375"></p>
<p>readview</p>
<p>readview 里面有4个属性，来判断应该读取哪个版本</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027194237759.png" alt="image-20231027194237759"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027194413102.png" alt="image-20231027194413102"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231027195441836.png" alt="image-20231027195441836"></p>
<h2 id="MYSQL管理"><a href="#MYSQL管理" class="headerlink" title="MYSQL管理"></a>MYSQL管理</h2><h3 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029102240811.png" alt="image-20231029102240811"></p>
<h3 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h3><h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029102444264.png" alt="image-20231029102444264"></p>
<h4 id="mysqladmin-创建删除数据库"><a href="#mysqladmin-创建删除数据库" class="headerlink" title="mysqladmin 创建删除数据库"></a>mysqladmin 创建删除数据库</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029103634995.png" alt="image-20231029103634995"></p>
<h4 id="mysqlbinlog"><a href="#mysqlbinlog" class="headerlink" title="mysqlbinlog"></a>mysqlbinlog</h4><p>二进制日志管理工具</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029103010297.png" alt="image-20231029103010297"></p>
<h4 id="mysqlshow-查看表中列和索引"><a href="#mysqlshow-查看表中列和索引" class="headerlink" title="mysqlshow 查看表中列和索引"></a>mysqlshow 查看表中列和索引<img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029103603071.png" alt="image-20231029103603071"></h4><p>mysqlshow -uroot -p1234 db01 –count</p>
<p>mysqlshow -uroot -p1234 db01 -i</p>
<h4 id="mysqldump数据备份"><a href="#mysqldump数据备份" class="headerlink" title="mysqldump数据备份"></a>mysqldump数据备份</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029105442509.png" alt="image-20231029105442509"></p>
<h4 id="mysqlimport-source"><a href="#mysqlimport-source" class="headerlink" title="mysqlimport/source"></a>mysqlimport/source</h4><p>导入mysqldump 加-T参数后导出的文本文件   source可以导入sql脚本</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029110059680.png" alt="image-20231029110059680"></p>
<h2 id="进阶篇总结"><a href="#进阶篇总结" class="headerlink" title="进阶篇总结"></a>进阶篇总结</h2><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029111211528.png" alt="image-20231029111211528"></p>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h4 id="错误日志"><a href="#错误日志" class="headerlink" title="错误日志"></a>错误日志</h4><p>记录了mysql启动和停止的日志</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029111603804.png" alt="image-20231029111603804"></p>
<p>tail -f 尾部查看日志 </p>
<h4 id="二进制日志"><a href="#二进制日志" class="headerlink" title="二进制日志"></a>二进制日志</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029140643628.png" alt="image-20231029140643628"></p>
<p>show variables like’%log_bin%’;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029141041913.png" alt="image-20231029141041913"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029141216383.png" alt="image-20231029141216383"></p>
<p>-v v 将事件重构为sql语句,并输出注释信息</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029142014175.png" alt="image-20231029142014175"></p>
<p>show variables like ‘%binlog_expire_logs_seconds%’;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029142217185.png" alt="image-20231029142217185"></p>
<p>30天</p>
<h4 id="查询日志"><a href="#查询日志" class="headerlink" title="查询日志"></a>查询日志</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029142756093.png" alt="image-20231029142756093"></p>
<h4 id="慢查询日志-1"><a href="#慢查询日志-1" class="headerlink" title="慢查询日志"></a>慢查询日志</h4><p>查看哪个sql语句超过了执行时间</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029144001807.png" alt="image-20231029144001807"></p>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029170249530.png" alt="image-20231029170249530"></p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>![1698570462620](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\1698570462620.png)</p>
<p>主库有事务提交时，把数据的变更写入二进制文件；</p>
<p>从库IOthread读取主库二进制文件并写入到从库Replay_log（中继）日志中；</p>
<p>从库又会SQLThread重做日志中的事件，改变反映自己的数据；</p>
<h3 id="主库配置"><a href="#主库配置" class="headerlink" title="主库配置"></a>主库配置</h3><p>主库ip   192.168.237.124</p>
<p>从库ip 192.168.237.128</p>
<h4 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h4><p>1.修改配置文件  /etc/my.cnf</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029172312350.png" alt="image-20231029172312350"></p>
<p>2.重启mysql服务器</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029173020536.png" alt="image-20231029173020536"></p>
<p>3.登录，mysql创建远程连接的账号，并授予主从复制的权限</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029173228893.png" alt="image-20231029173228893"></p>
<p>可以让从库用这个账户和密码连接主库</p>
<p>create user ‘kang‘@’%’ identified with mysql_native_password by ‘Root@123456’;</p>
<p>账户名 itcast  %这一用户可以在任意主机都可以访问这台服务器   密码Root@123456</p>
<p>grant replication slave on <em>.</em> to ‘kang‘@’%’;</p>
<p>4.通过指令查看二进制日志文件的坐标</p>
<p>flush privileges;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029174243848.png" alt="image-20231029174243848"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029174342111.png" alt="image-20231029174342111"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029192447282.png" alt="image-20231029192447282"></p>
<h3 id="从库配置"><a href="#从库配置" class="headerlink" title="从库配置"></a>从库配置</h3><h4 id="搭建-1"><a href="#搭建-1" class="headerlink" title="搭建"></a>搭建</h4><p>1.修改配置文件  /etc/my.cnf</p>
<p>2.重启mysql服务器</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029192349266.png" alt="image-20231029192349266"></p>
<p>3.登录mysql，设置主从复制</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029193614919.png" alt="image-20231029193614919"></p>
<p>change master to master_host =’192.168.237.124’,master_user=’kang’,master_password=‘Root@123456’,master_log_file=’ binlog.000028’,master_log_pos=156;</p>
<p>4.开启同步操作</p>
<p>start replica;</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231029193626846.png" alt="image-20231029193626846"></p>
<p>5.查看从库状态</p>
<p> show slave status\G;</p>
<p>uuid 所在目录  /var/lib/docker/volumes/9294e8036fb5c1fd3eb8a1f691be8f1d62ea8475821976a1e016a7a251701533/_data/auto.cnf</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44895681/article/details/106574216">Mysql主从同步报错解决：Fatal error: The slave I/O thread stops because master and slave have equal..-CSDN博客</a></p>
<p>CHANGE MASTER TO<br>  MASTER_HOST=’192.168.237.124’,<br>  MASTER_USER=’kang’,<br>  MASTER_PASSWORD=‘Root@123456’,<br>  MASTER_PORT=3306,<br>  MASTER_LOG_FILE=’binlog.000031’,<br>  MASTER_LOG_POS=156;</p>
<p>解决：server相同，日志不是第一个问题</p>
<p><strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29974229/article/details/120037734">Mysql报错:Got fatal error 1236 from master when reading data from binary log: ‘Could not find first lo_上海运维Q先生的博客-CSDN博客</a></strong></p>
<p> <strong>set global server_id=128;</strong></p>
<p> <strong>select @@server_id;</strong></p>
<h2 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h2><p>主库写从库读</p>
<h3 id="ShardingJDBC"><a href="#ShardingJDBC" class="headerlink" title="ShardingJDBC"></a>ShardingJDBC</h3><p>1.导入依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--sharding-jdbc依赖--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;sharding-jdbc-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;4.0.0-RC1&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2.在yml配置读写分离规则</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">names:</span></span><br><span class="line">        <span class="string">master,slave</span></span><br><span class="line">      <span class="comment"># 主数据源</span></span><br><span class="line">      <span class="attr">master:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.237.124:3306/rw?characterEncoding=utf-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="comment"># 从数据源</span></span><br><span class="line">      <span class="attr">slave:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.237.128:3306/rw?characterEncoding=utf-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">masterslave:</span></span><br><span class="line">      <span class="comment"># 读写分离配置</span></span><br><span class="line">      <span class="attr">load-balance-algorithm-type:</span> <span class="string">round_robin</span> <span class="comment">#轮询,针对不同从库的，负载均衡</span></span><br><span class="line">      <span class="comment"># 最终的数据源名称</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dataSource</span></span><br><span class="line">      <span class="comment"># 主库数据源名称</span></span><br><span class="line">      <span class="attr">master-data-source-name:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment"># 从库数据源名称列表，多个逗号分隔</span></span><br><span class="line">      <span class="attr">slave-data-source-names:</span> <span class="string">slave</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">sql:</span></span><br><span class="line">        <span class="attr">show:</span> <span class="literal">true</span> <span class="comment">#开启SQL显示，默认false</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span> <span class="comment">#开启的话，控制台输出sql</span></span><br></pre></td></tr></table></figure>

<p>3.在配置文件中配置允许bean定义覆盖配置项</p>
<p>SpringBootConfiguration 和 DruidDataSourceAutoConfigure 都会创建一个数据源，导致报错。所以必须允许bean定义覆盖，用最新的</p>
<h1 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h1><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231119174233868.png" alt="image-20231119174233868"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117171012488.png" alt="image-20231117171012488"></p>
<p>生成</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117171840772.png" alt="image-20231117171840772"></p>
<p>解析</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117224222957.png" alt="image-20231117224222957"></p>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117232955083.png" alt="image-20231117232955083"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117233516009.png" alt="image-20231117233516009"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231117233400108.png" alt="image-20231117233400108"></p>
<h1 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h1><h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>我们可以再创建一个父工程 tlias-parent ，然后让上述的三个模块 tlias-pojo、tlias-utils、tlias-web-management 都来继承这个父工程 。 然后再将各个模块中都共有的依赖，都提取到父工程 tlias-parent中进行配置，只要子工程继承了父工程，依赖它也会继承下来，这样就无需在各个子工程中进行配置了。</p>
<ul>
<li>概念：继承描述的是两个工程间的关系，与java中的继承相似，子工程可以继承父工程中的配置信息，常见于依赖关系的继承。</li>
<li>作用：简化依赖配置、统一管理依赖</li>
</ul>
<h2 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h2><ul>
<li><strong>聚合：</strong>将多个模块组织成一个整体，同时进行项目的构建。</li>
<li><strong>聚合工程：</strong>一个不具有业务功能的“空”工程（有且仅有一个pom文件） 【PS：一般来说，继承关系中的父工程与聚合关系中的聚合工程是同一个】</li>
<li><strong>作用：</strong>快速构建项目（无需根据依赖关系手动构建，直接在聚合工程上构建即可）</li>
</ul>
<p>可以统一打包</p>
<h2 id="版本锁定"><a href="#版本锁定" class="headerlink" title="版本锁定"></a>版本锁定</h2><p>在maven中，可以在父工程的pom文件中通过 <dependencyManagement> 来统一管理依赖版本。</p>
<p>父工程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--统一管理依赖版本--&gt;</span><br><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--JWT令牌--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">0.9</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>


<p>子工程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;!--JWT令牌--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>




<p>注意：</p>
<p>在父工程中所配置的 <dependencyManagement> 只能统一管理依赖版本，并不会将这个依赖直接引入进来。 这点和 <dependencies> 是不同的。<br>子工程要使用这个依赖，还是需要引入的，只是此时就无需指定 <version> 版本号了，父工程统一管理。变更依赖版本，只需在父工程中统一变更。</p>
<h2 id="分模块开发"><a href="#分模块开发" class="headerlink" title="分模块开发"></a>分模块开发</h2><p>分模块设计之后，如果我们需要用到另外一个模块的功能，我们直接依赖模块就可以了。比如商品模块、搜索模块、购物车订单模块都需要依赖于通用组件当中封装的一些工具类，我只需要引入通用组件的坐标就可以了。</p>
<p><strong>分模块设计就是将项目按照功能/结构拆分成若干个子模块，方便项目的管理维护、拓展，也方便模块键的相互调用、资源共享。</strong></p>
<h1 id="三更Blog"><a href="#三更Blog" class="headerlink" title="三更Blog"></a>三更Blog</h1><h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><p>项目介绍: 博客项目，前端有两个系统，分别是负责博客页面(前台系统)、管理页面(后台系统)。后端也有两个系统，分别是前端两个系统的具体实现</p>
<p>思考: 后端两个系统的代码复用性较高，所以后端创建的是多模块(3个模块)项目，把后端两个系统(两个子模块)都会用到的代码写到一个公共模块(第3个模块)</p>
<p>3个子模块在父模块里面，父模块叫SpringBootBlog</p>
<p>3个子模块分别是dykang-framework(公共模块)、dykang-blog(博客前台模块)、dykang-admin(博客后台模块)</p>
<h2 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h2><h3 id="创建父模块dy-Blog"><a href="#创建父模块dy-Blog" class="headerlink" title="创建父模块dy-Blog"></a>创建父模块dy-Blog</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025131624543.png" alt="image-20231025131624543"></p>
<p>把src目录删掉</p>
<p>在pom.xml添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;dy-Blog&lt;/artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;!--    聚合工程，可以一起打包，一起清理，更加方便--&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;<span class="keyword">module</span>&gt;dykang-framework&lt;/<span class="keyword">module</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">module</span>&gt;dykang-blog&lt;/<span class="keyword">module</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">module</span>&gt;dykang-admin&lt;/<span class="keyword">module</span>&gt;</span><br><span class="line">    &lt;/modules&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    多模块开发，提高系统的复用性--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--编码方式、jdk版本--&gt;</span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-<span class="number">8</span>&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">        &lt;java.version&gt;<span class="number">1.8</span>&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--依赖的版本控制--&gt;</span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- SpringBoot的依赖配置--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">2.5</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">                &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--fastjson依赖--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">1.2</span><span class="number">.33</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--jwt依赖--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">0.9</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--mybatisPlus依赖--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">3.4</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--阿里云OSS--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">3.10</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">3.0</span><span class="number">.5</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">2.9</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">2.9</span><span class="number">.2</span>&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">        &lt;/dependencies&gt;</span><br><span class="line">    &lt;/dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;!--配置maven版本--&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;<span class="number">3.1</span>&lt;/version&gt;</span><br><span class="line">                &lt;!--配置jdk版本--&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;$&#123;java.version&#125;&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;$&#123;java.version&#125;&lt;/target&gt;</span><br><span class="line">                    &lt;encoding&gt;$&#123;project.build.sourceEncoding&#125;&lt;/encoding&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="创建公共子模块dykang-framework"><a href="#创建公共子模块dykang-framework" class="headerlink" title="创建公共子模块dykang-framework"></a>创建公共子模块dykang-framework</h3><p>在pox.xml添加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;dy-Blog&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--    公共模块--&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;dykang-framework&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--lombok--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;<span class="literal">true</span>&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--junit--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--SpringSecurity启动器--&gt;</span><br><span class="line">        &lt;!--&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;--&gt;</span><br><span class="line">        &lt;!--redis依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--fastjson依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--jwt依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--mybatisPlus依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--mysql数据库驱动--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--阿里云OSS--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--AOP--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;easyexcel&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="创建博客后台模块dykang-admin"><a href="#创建博客后台模块dykang-admin" class="headerlink" title="创建博客后台模块dykang-admin"></a>创建博客后台模块dykang-admin</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;dy-Blog&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    管理后台页面--&gt;</span><br><span class="line">    &lt;artifactId&gt;dykang-admin&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!--用dykang-framework模块里面的依赖--&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dykang-framework&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="创建博客前台模块dykang-blog"><a href="#创建博客前台模块dykang-blog" class="headerlink" title="创建博客前台模块dykang-blog"></a>创建博客前台模块dykang-blog</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;dy-Blog&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--    管理前台页面--&gt;</span><br><span class="line">    &lt;artifactId&gt;dy-blog&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--用dykang-framework模块里面的依赖--&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.kang&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dykang-framework&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h2 id="EasyCode插件"><a href="#EasyCode插件" class="headerlink" title="EasyCode插件"></a>EasyCode插件</h2><p>快速生成实体类等代码</p>
<h2 id="公共模块-准备工作"><a href="#公共模块-准备工作" class="headerlink" title="公共模块-准备工作"></a>公共模块-准备工作</h2><p>导入数据库</p>
<p>测试</p>
<h2 id="博客前台模块-准备工作"><a href="#博客前台模块-准备工作" class="headerlink" title="博客前台模块-准备工作"></a>博客前台模块-准备工作</h2><p>整合mybatisplus</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025132845175.png" alt="image-20231025132845175"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231025133125795.png" alt="image-20231025133125795"></p>
<h2 id="博客前台模块-文章列表"><a href="#博客前台模块-文章列表" class="headerlink" title="博客前台模块-文章列表"></a>博客前台模块-文章列表</h2><h3 id="接口分析"><a href="#接口分析" class="headerlink" title="接口分析"></a>接口分析</h3><p>需要查询浏览量最高的前10篇文章的信息。要求展示文章标题和浏览量。把能让用户自己点击跳转到具体的文章详情进行浏览</p>
<p>注意：不能把草稿展示出来，不能把删除了的文章查询出来。要按照浏览量进行降序排序</p>
<h3 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a>解决思路</h3><p>构造查询条件：已发布文章，未删除文章（yml逻辑删除字段已自动判断是否删除，在这就不用加入此条件） ，通过降序排序 并只查看10条数据 所以用分页查询，直接表明是第一页显示10个数据即可  通过查询条件查询出文章表信息 通过BeanCopy给VO，并返回给前端</p>
<h3 id="统一响应格式"><a href="#统一响应格式" class="headerlink" title="统一响应格式"></a>统一响应格式</h3><h4 id="1-代码实现"><a href="#1-代码实现" class="headerlink" title="1.代码实现"></a>1.代码实现</h4><p>第一步: 在huanf-framework公共模块的src/main/java目录新建com.huanf.enums.AppHttpCodeEnum类，写入如下，作用是封装code和msg</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/19 0019 12:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">AppHttpCodeEnum</span> &#123;</span><br><span class="line">    <span class="comment">// 成功</span></span><br><span class="line">    SUCCESS(<span class="number">200</span>,<span class="string">&quot;操作成功&quot;</span>),</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    NEED_LOGIN(<span class="number">401</span>,<span class="string">&quot;需要登录后操作&quot;</span>),</span><br><span class="line">    NO_OPERATOR_AUTH(<span class="number">403</span>,<span class="string">&quot;无权限操作&quot;</span>),</span><br><span class="line">    SYSTEM_ERROR(<span class="number">500</span>,<span class="string">&quot;出现错误&quot;</span>),</span><br><span class="line">    USERNAME_EXIST(<span class="number">501</span>,<span class="string">&quot;用户名已存在&quot;</span>),</span><br><span class="line">    PHONENUMBER_EXIST(<span class="number">502</span>,<span class="string">&quot;手机号已存在&quot;</span>), EMAIL_EXIST(<span class="number">503</span>, <span class="string">&quot;邮箱已存在&quot;</span>),</span><br><span class="line">    REQUIRE_USERNAME(<span class="number">504</span>, <span class="string">&quot;必需填写用户名&quot;</span>),</span><br><span class="line">    LOGIN_ERROR(<span class="number">505</span>,<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">    <span class="type">int</span> code;</span><br><span class="line">    String msg;</span><br><span class="line"></span><br><span class="line">    AppHttpCodeEnum(<span class="type">int</span> code, String errorMessage)&#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = errorMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步: 在huanf-framework公共模块的domain目录新建ResponseResult类，写入如下，作为统一响应格式的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.domain;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> ResponseResult&lt;?&gt; ok(Integer code, T data) &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.code = code;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.data = data;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> ResponseResult&lt;?&gt; ok(Integer code, T data, String msg) &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.code = code;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.data = data;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.msg = msg;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> ResponseResult&lt;?&gt; ok(T data) &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.data = data;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> code;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.code = code;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> msg;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.msg = msg;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> T <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="keyword">return</span> data;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(T data)</span> &#123;</span><br><span class="line"></span><br><span class="line">​        <span class="built_in">this</span>.data = data;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-后端解决跨域"><a href="#2-后端解决跨域" class="headerlink" title="2.后端解决跨域"></a>2.后端解决跨域</h4><p>在huanf-framework工程的src/main/java目录新建com.huanf.config.WebConfig类，写入如下，然后重新运行huanf-blog工程的HuanfBlogApplication类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/19 0019 14:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 设置允许跨域的路径</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">// 设置允许跨域请求的域名</span></span><br><span class="line">                .allowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// 是否允许cookie</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 设置允许的请求方式</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;PUT&quot;</span>)</span><br><span class="line">                <span class="comment">// 设置允许的header属性</span></span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// 跨域允许时间</span></span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="comment">//ServiceImpl是mybatisPlus官方提供的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;ArticleMapper, Article&gt; <span class="keyword">implements</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">hotArticleList</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询热门文章，封装成ResponseResult返回。把所有查询条件写在queryWrapper里面</span></span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//查询的不能是草稿。也就是Status字段不能是0</span></span><br><span class="line">        queryWrapper.eq(Article::getStatus,<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//按照浏览量进行排序。也就是根据ViewCount字段降序排序</span></span><br><span class="line">        queryWrapper.orderByDesc(Article::getViewCount);</span><br><span class="line">        <span class="comment">//最多只能查询出来10条消息。当前显示第一页的数据，每页显示10条数据</span></span><br><span class="line">        Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">1</span>,<span class="number">10</span>);</span><br><span class="line">        page(page,queryWrapper);</span><br><span class="line">        <span class="comment">//获取最终的查询结果</span></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(articles);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h4 id="3、前端项目的启动"><a href="#3、前端项目的启动" class="headerlink" title="3、前端项目的启动"></a>3、前端项目的启动</h4><p>需要有node.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /SpringBootBlogWeb/sg-blog-vue</span><br><span class="line">npm install</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h4 id="4-统一响应格式（优化）"><a href="#4-统一响应格式（优化）" class="headerlink" title="4.统一响应格式（优化）"></a>4.统一响应格式（优化）</h4><h5 id="vo"><a href="#vo" class="headerlink" title="vo"></a>vo</h5><p>在刚刚的响应格式中，其实是不符合接口文档标准的，因为我们返回了很多字段，如下图，有些字段不需要返回，或者比较敏感不能返回给前端</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/jpg/35597420/1693034006959-451cfd5d-5196-49a5-9a7a-f5e9169abb85.jpg" alt="img"></p>
<p>为什么会返回这么多字段: 查询出来的结果是用Article来封装的，由于Article实体类里面的字段比较多，所以返回的字段也就是很多</p>
<p>解决: 用VO (是Value Object的缩写,表示值对象) 来接收查询的结果，一个接口对应一个VO，这样即使接口响应字段要修改也只要修改VO即可</p>
<p>Bean拷贝:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BeanUtils.copyProperties(xxarticle,xxvo);</span><br></pre></td></tr></table></figure>

<h5 id="字面值处理"><a href="#字面值处理" class="headerlink" title="字面值处理"></a>字面值处理</h5><p>实际项目中都不允许直接在代码中使用字面值(代码中的固定值)。都需要定义成常量来使用。这种方式有利于提高代码的可维护性。字面值如下图</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/jpg/35597420/1693034008056-8dbc6d71-5d02-4ab8-b7eb-4b217db7aa9d.jpg" alt="img"></p>
<p>第一步: 在huanf-framework工程的src/main/java目录新建com.huanf.constants.SystemCanstants类，写入如下，作用是定义常量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.constants;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/19 0019 19:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//字面值(代码中的固定值)处理，把字面值都在这里定义成常量</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemCanstants</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  文章是草稿</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_DRAFT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  文章是正常分布状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_NORMAL</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章列表当前查询页数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_CURRENT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章列表每页显示的数据条数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ARTICLE_STATUS_SIZE</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Bean拷贝的封装"><a href="#Bean拷贝的封装" class="headerlink" title="Bean拷贝的封装"></a>Bean拷贝的封装</h5><p>在前面的 ‘统一响应格式(优化)’ 的 ‘一、定义并测试VO’，最核心的代码就是ArticleServiceImpl类里面用到的Spring提供的BeanUtils工具类。这个工具类可以把Article类里面拿到的查询结果，拷贝给HotArticleVO类，注意HotArticleVO(少)相对于Article(多)来说，成员变量的数量可以少，但是名称和类型必须一样</p>
<p>我们前面是在ArticleServiceImpl类写了如下核心代码，为了提高代码复用性，我们必须把这段代码抽取出来进行封装</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.huanf.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/19 0019 20:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//这个类用到很多泛型知识，可以对应去补一下</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanCopyUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//私有的空参构造方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">BeanCopyUtils</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.单个实体类的拷贝(暂时还用不上)。第一个参数是要拷贝的对象，第二个参数是类的字节码对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;V&gt; V <span class="title function_">copyBean</span><span class="params">(Object source,Class&lt;V&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="comment">//创建目标对象</span></span><br><span class="line">        <span class="type">V</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            result = clazz.newInstance();</span><br><span class="line">            <span class="comment">//实现属性拷贝。也就是把source的属性拷贝到这个目标对象。BeanUtils是spring提供的工具类</span></span><br><span class="line">            BeanUtils.copyProperties(source, result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回结果</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.集合的拷贝(在ArticleServiceImpl类里面会使用到)。第一个参数是要拷贝的集合，第二个参数是类的字节码对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;O,V&gt; List&lt;V&gt; <span class="title function_">copyBeanList</span><span class="params">(List&lt;O&gt; list,Class&lt;V&gt; clazz)</span>&#123;</span><br><span class="line">        <span class="comment">//不使用for循环，使用stream流进行转换</span></span><br><span class="line">        <span class="keyword">return</span> list.stream()</span><br><span class="line">                .map(o -&gt; copyBean(o, clazz))</span><br><span class="line">                <span class="comment">//把结果转换成集合</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改之前copy代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一行搞定</span></span><br><span class="line">       List&lt;HotArticleVO&gt; articleVos = BeanCopyUtils.copyBeanList(articles, HotArticleVO.class);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-分类列表"><a href="#博客前台模块-分类列表" class="headerlink" title="博客前台模块-分类列表"></a>博客前台模块-分类列表</h2><h3 id="接口分析-1"><a href="#接口分析-1" class="headerlink" title="接口分析"></a>接口分析</h3><p>页面上需要展示分类列表，用户可以点击具体的分类查看该分类下的文章列表。要求只展示有发布正式文章的分类 。要求必须是正常(非禁用)状态的分类</p>
<h3 id="解决思路-1"><a href="#解决思路-1" class="headerlink" title="解决思路"></a>解决思路</h3><p>首先查询文章表中状态正常的文章分类ID集合并去重，通过调用listByIds获取分类相关信息，然后通过stream流过滤出状态正常的分类信息，通过BeanCopy把信息拷贝到VO对象，将VO对象返回给前端</p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;categoryService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CategoryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CategoryMapper,Category&gt; <span class="keyword">implements</span> <span class="title class_">CategoryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="comment">//ArticleService是我们在huanf-framework写的接口</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//查询分类列表的核心代码</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getCategoryList</span><span class="params">()</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; articleWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//要求查的是getStatus字段的值为1，注意SystemCanstants是我们写的一个常量类，用来解决字面值的书写问题</span></span><br><span class="line">        articleWrapper.eq(Article::getStatus, SystemCanstants.ARTICLE_STATUS_NORMAL);</span><br><span class="line">        <span class="comment">//查询文章列表，条件就是上一行的articleWrapper</span></span><br><span class="line">        List&lt;Article&gt; articleList = articleService.list(articleWrapper);</span><br><span class="line">        <span class="comment">//获取文章的分类id，并且去重。使用stream流来处理上一行得到的文章表集合</span></span><br><span class="line">        Set&lt;Long&gt; categoryIds = articleList.stream()</span><br><span class="line">                <span class="comment">//下面那行可以优化为Lambda表达式+方法引用</span></span><br><span class="line">                .map(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Article, Long&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Long <span class="title function_">apply</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> article.getCategoryId();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">//把文章的分类id转换成Set集合</span></span><br><span class="line">                .collect(Collectors.toSet());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询分类表</span></span><br><span class="line">        List&lt;Category&gt; categories = listByIds(categoryIds);</span><br><span class="line">        <span class="comment">//注意SystemCanstants是我们写的一个常量类，用来解决字面值的书写问题</span></span><br><span class="line">        categories = categories.stream()</span><br><span class="line">                .filter(category -&gt; SystemCanstants.STATUS_NORMAL.equals(category.getStatus()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装成CategoryVo实体类后返回给前端，CategoryVo的作用是只返回前端需要的字段。BeanCopyUtils是我们写的工具类</span></span><br><span class="line">        List&lt;CategoryVo&gt; categoryVos = BeanCopyUtils.copyBeanList(categories, CategoryVo.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(categoryVos);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-分页查询"><a href="#博客前台模块-分页查询" class="headerlink" title="博客前台模块-分页查询"></a>博客前台模块-分页查询</h2><h3 id="接口分析-2"><a href="#接口分析-2" class="headerlink" title="接口分析"></a>接口分析</h3><p>首页需要查询所有的文章列表。分类页面需要查询对应分类下的文章列表。只能查询正式发布的文章，置顶的文章要显示在最前面</p>
<h3 id="解决思路-2"><a href="#解决思路-2" class="headerlink" title="解决思路"></a>解决思路</h3><p>首先看到分页，先配置MP分页插件；</p>
<p>查询条件为 正常发布的文章，置顶的文章（降序排序即可），分类名，文章实体类中没有需要添加，并加入注解TableField（exists=false）在数据库表中实际不存在  ；通过分类ID查找分类表获取分类名，封装分页VO对象返回</p>
<h3 id="配置分页插件"><a href="#配置分页插件" class="headerlink" title="配置分页插件"></a>配置分页插件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//配置MyBatisPlus的分页插件，使得支持分页查询。这个类直接复制就能用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3.4.0之后版本</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>());</span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//----------------------------------分页查询文章的列表---------------------------------</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> ResponseResult <span class="title function_">articleList</span><span class="params">(Integer pageNum, Integer pageSize, Long categoryId)</span> &#123;</span><br><span class="line"></span><br><span class="line">      LambdaQueryWrapper&lt;Article&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">      <span class="comment">//判空。如果前端传了categoryId这个参数，那么查询时要和传入的相同。第二个参数是数据表的文章id，第三个字段是前端传来的文章id</span></span><br><span class="line">      lambdaQueryWrapper.eq(Objects.nonNull(categoryId)&amp;&amp;categoryId&gt;<span class="number">0</span>,Article::getCategoryId,categoryId);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//只查询状态是正式发布的文章。Article实体类的status字段跟0作比较，一样就表示是正式发布的</span></span><br><span class="line">      lambdaQueryWrapper.eq(Article::getStatus,SystemCanstants.ARTICLE_STATUS_NORMAL);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//对isTop字段进行降序排序，实现置顶的文章(isTop值为1)在最前面</span></span><br><span class="line">      lambdaQueryWrapper.orderByDesc(Article::getIsTop);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//分页查询</span></span><br><span class="line">      Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">      page(page,lambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//把最后的查询结果封装成ArticleListVo(我们写的实体类)。BeanCopyUtils是我们写的工具类</span></span><br><span class="line">      List&lt;ArticleListVo&gt; articleListVos = BeanCopyUtils.copyBeanList(page.getRecords(), ArticleListVo.class);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//把上面那行的查询结果和文章总数封装在PageVo(我们写的实体类)</span></span><br><span class="line">      <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>(articleListVos,page.getTotal());</span><br><span class="line">      <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决categoryName没有名字问题"><a href="#解决categoryName没有名字问题" class="headerlink" title="解决categoryName没有名字问题"></a>解决categoryName没有名字问题</h3><p>for循环解决</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 解决categoryName字段没有返回值的问题。在分页之后，封装成ArticleListVo之前，进行处理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//用categoryId来查询categoryName(category表的name字段)，也就是查询&#x27;分类名称&#x27;。有两种方式来实现，如下</span></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line">        <span class="comment">//第一种方式，用for循环遍历的方式</span></span><br><span class="line">        <span class="keyword">for</span> (Article article : articles) &#123;</span><br><span class="line">            <span class="comment">//&#x27;article.getCategoryId()&#x27;表示从article表获取category_id字段，然后作为查询category表的name字段</span></span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(article.getCategoryId());</span><br><span class="line">            <span class="comment">//把查询出来的category表的name字段值，也就是article，设置给Article实体类的categoryName成员变量</span></span><br><span class="line">            article.setCategoryName(category.getName());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Stream流</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用categoryId来查询categoryName(category表的name字段)，也就是查询&#x27;分类名称&#x27;</span></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line">        articles.stream()</span><br><span class="line">                .map(<span class="keyword">new</span> <span class="title class_">Function</span>&lt;Article, Article&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Article <span class="title function_">apply</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">                        <span class="comment">//&#x27;article.getCategoryId()&#x27;表示从article表获取category_id字段，然后作为查询category表的name字段</span></span><br><span class="line">                        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(article.getCategoryId());</span><br><span class="line">                        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> category.getName();</span><br><span class="line">                        <span class="comment">//把查询出来的category表的name字段值，也就是article，设置给Article实体类的categoryName成员变量</span></span><br><span class="line">                        article.setCategoryName(name);</span><br><span class="line">                        <span class="comment">//把查询出来的category表的name字段值，也就是article，设置给Article实体类的categoryName成员变量</span></span><br><span class="line">                        <span class="keyword">return</span> article;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在category类中增加一个字段，为categoryName，由categoryId来查询出</span></span><br><span class="line">   <span class="comment">//由于数据库没有category_name字段，所以要用注解指定一下字段</span></span><br><span class="line">   <span class="meta">@TableField(exist = false)</span><span class="comment">//代表这个字段在数据库中不存在，避免MyBatisPlus在查询时报错</span></span><br><span class="line">   <span class="keyword">private</span> String categoryName;</span><br></pre></td></tr></table></figure>

<h3 id="FastJson配置"><a href="#FastJson配置" class="headerlink" title="FastJson配置"></a>FastJson配置</h3><p>由于ArticleListVO类的createTime成员变量是Date类型，默认是由java的Jackson来处理，使用 ISO-8601 规范来处理日期时间格式。ISO-8601 是一种国际标准的日期时间表示法，例如：”2023-07-21T06:53:24”。我们不希望时间被处理成这种格式，如下图。解决: 使用FastJson</p>
<p>也可以通过注解的方式，在日期字段上面加入@JsonFormat(pattern = “yyyy-MM-dd HH:mm:ss”)也可</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/jpg/35597420/1693034010104-0019ad45-03f8-4751-a7ad-81aea2b76c47.jpg?x-oss-process=image/resize,w_1500,limit_0/interlace,1" alt="img"></p>
<p>第一步(已做可跳过): 在huanf-framework的pom.xml添加如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--fastjson依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<p>第二步: 在huanf-framework的config目录的WebConfig类，修改为如下。用线隔开了。直接复制去用</p>
<h3 id="代码实现-2"><a href="#代码实现-2" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">package com.huanf.config;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.serializer.SerializeConfig;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.serializer.ToStringSerializer;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.support.config.FastJsonConfig;</span><br><span class="line"></span><br><span class="line">import com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import org.springframework.http.converter.HttpMessageConverter;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"></span><br><span class="line"> \* @author 35238</span><br><span class="line"></span><br><span class="line"> \* @date 2023/7/19 0019 14:57</span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line"></span><br><span class="line">public class WebConfig implements WebMvcConfigurer &#123;</span><br><span class="line"></span><br><span class="line">​    @Override</span><br><span class="line"></span><br><span class="line">​    public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line"></span><br><span class="line">​        // 设置允许跨域的路径</span><br><span class="line"></span><br><span class="line">​        registry.addMapping(&quot;/**&quot;)</span><br><span class="line"></span><br><span class="line">​                // 设置允许跨域请求的域名</span><br><span class="line"></span><br><span class="line">​                .allowedOriginPatterns(&quot;*&quot;)</span><br><span class="line"></span><br><span class="line">​                // 是否允许cookie</span><br><span class="line"></span><br><span class="line">​                .allowCredentials(true)</span><br><span class="line"></span><br><span class="line">​                // 设置允许的请求方式</span><br><span class="line"></span><br><span class="line">​                .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;DELETE&quot;, &quot;PUT&quot;)</span><br><span class="line"></span><br><span class="line">​                // 设置允许的header属性</span><br><span class="line"></span><br><span class="line">​                .allowedHeaders(&quot;*&quot;)</span><br><span class="line"></span><br><span class="line">​                // 跨域允许时间</span><br><span class="line"></span><br><span class="line">​                .maxAge(3600);</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">​    //-----------------------------------FastJson配置-----------------------------------------</span><br><span class="line"></span><br><span class="line">​    @Bean//使用@Bean注入fastJsonHttpMessageConvert</span><br><span class="line"></span><br><span class="line">​    public HttpMessageConverter fastJsonHttpMessageConverters() &#123;</span><br><span class="line"></span><br><span class="line">​        //1.需要定义一个Convert转换消息的对象</span><br><span class="line"></span><br><span class="line">​        FastJsonHttpMessageConverter fastConverter = new FastJsonHttpMessageConverter();</span><br><span class="line"></span><br><span class="line">​        FastJsonConfig fastJsonConfig = new FastJsonConfig();</span><br><span class="line"></span><br><span class="line">​        fastJsonConfig.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class="line"></span><br><span class="line">​        fastJsonConfig.setDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</span><br><span class="line"></span><br><span class="line">​        SerializeConfig.globalInstance.put(Long.class, ToStringSerializer.instance);</span><br><span class="line"></span><br><span class="line">​        fastJsonConfig.setSerializeConfig(SerializeConfig.globalInstance);</span><br><span class="line"></span><br><span class="line">​        fastConverter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line"></span><br><span class="line">​        HttpMessageConverter&lt;?&gt; converter = fastConverter;</span><br><span class="line"></span><br><span class="line">​        return converter;</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    @Override</span><br><span class="line"></span><br><span class="line">​    //配置消息转换器</span><br><span class="line"></span><br><span class="line">​    public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;</span><br><span class="line"></span><br><span class="line">​        //增加我们的消息转换器</span><br><span class="line"></span><br><span class="line">​        converters.add(fastJsonHttpMessageConverters());</span><br><span class="line"></span><br><span class="line">​    &#125;</span><br><span class="line"></span><br><span class="line">​    </span><br><span class="line"></span><br><span class="line">​    //--------------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-文章详情"><a href="#博客前台模块-文章详情" class="headerlink" title="博客前台模块-文章详情"></a>博客前台模块-文章详情</h2><h3 id="接口分析-3"><a href="#接口分析-3" class="headerlink" title="接口分析"></a>接口分析</h3><p>要求在文章列表点击阅读全文时能够跳转到文章详情页面，可以让用户阅读文章正文。并且要在文章详情中展示其分类名</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;categoryId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;categoryName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;文章详情的具体文章内容&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-23 23:20:11&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;isComment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SpringSecurity从入门到精通&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;viewCount&quot;</span><span class="punctuation">:</span> <span class="string">&quot;114&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="解决思路-3"><a href="#解决思路-3" class="headerlink" title="解决思路"></a>解决思路</h3><p>路径参数需要加入@PathVariable标明是路径参数</p>
<p>根据传入id，找到这个文章，获取文章分类ID，然后根据文章分类ID获取分类名称，BeanCopy给VO对象</p>
<h3 id="Http请求方式"><a href="#Http请求方式" class="headerlink" title="Http请求方式"></a>Http请求方式</h3><p>以GET /article/{id} 为例的路径参数形式，下面两种是比较常用的。不常用的有’请求体形式’、’请求头形式’</p>
<table>
<thead>
<tr>
<th>请求形式</th>
<th>示例</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>路径参数形式</td>
<td>/articles/{id}</td>
<td>参数作为路径的一部分，表示明确的资源标识符或必需的参数。</td>
</tr>
<tr>
<td>查询参数形式</td>
<td>/articles?id=1&amp;num=1</td>
<td>参数通过 “?” 或 “&amp;” 的方式附加在URL的末尾，适合传递可选参数或过滤条件。</td>
</tr>
</tbody></table>
<p>在上面的业务请求中，我们使用的都是’路径参数形式’，下面的业务请求中，我们将会使用’查询参数形式’</p>
<h3 id="代码实现-3"><a href="#代码实现-3" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------------------------查询文章详情------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span> <span class="comment">//路径参数形式的HTTP请求，注意下面那行只有加@PathVariable注解才能接收路径参数形式的HTTP请求</span></span><br><span class="line">    <span class="comment">//ResponseResult是huanf-framework工程的domain目录的类</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getArticleDetail</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<span class="comment">//注解里指定的id跟上一行保持一致</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据id查询文章详情</span></span><br><span class="line">        <span class="keyword">return</span> articleService.getArticleDetail(id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------------------------根据id查询文章详情---------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getArticleDetail</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据id查询文章</span></span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//把最后的查询结果封装成ArticleListVo(我们写的实体类)。BeanCopyUtils是我们写的工具类</span></span><br><span class="line">        <span class="type">ArticleDetailVo</span> <span class="variable">articleDetailVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(article, ArticleDetailVo.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据分类id，来查询分类名</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> articleDetailVo.getCategoryId();</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">        <span class="comment">//如果根据分类id查询的到分类名，那么就把查询到的值设置给ArticleDetailVo实体类的categoryName字段</span></span><br><span class="line">        <span class="keyword">if</span>(category!=<span class="literal">null</span>)&#123;</span><br><span class="line">            articleDetailVo.setCategoryName(category.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装响应返回。ResponseResult是我们在huanf-framework工程的domain目录写的实体类</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(articleDetailVo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-友链功能"><a href="#博客前台模块-友链功能" class="headerlink" title="博客前台模块-友链功能"></a>博客前台模块-友链功能</h2><h3 id="接口分析-4"><a href="#接口分析-4" class="headerlink" title="接口分析"></a>接口分析</h3><p>在友链页面要查询出所有的审核通过的友链，响应格式如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://www.baidu.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sda&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图片url1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sda&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://www.qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dada&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;logo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;图片url2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sda&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="解决思路-4"><a href="#解决思路-4" class="headerlink" title="解决思路"></a>解决思路</h3><p>条件:审核通过即可，查询出直接BeanCopy对象返回</p>
<h3 id="代码实现-4"><a href="#代码实现-4" class="headerlink" title="代码实现"></a>代码实现</h3><p>@Service(“linkService”)<br>public class LinkServiceImpl extends ServiceImpl&lt;LinkMapper, Link&gt; implements LinkService {</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getAllLink</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询所有审核通过的友链</span></span><br><span class="line">    LambdaQueryWrapper&lt;Link&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//要求查的是友链表status字段的值为0，注意SystemCanstants是我们写的一个常量类，用来解决字面值的书写问题</span></span><br><span class="line">    queryWrapper.eq(Link::getStatus, SystemCanstants.LINK_STATUS_NORMAL);</span><br><span class="line">    List&lt;Link&gt; links = list(queryWrapper);</span><br><span class="line">    <span class="comment">//把最后的查询结果封装成LinkListVo(我们写的实体类)。BeanCopyUtils是我们写的工具类</span></span><br><span class="line">    List&lt;LinkVo&gt; linkVos = BeanCopyUtils.copyBeanList(links, LinkVo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//封装响应返回。ResponseResult是我们在huanf-framework工程的domain目录写的实体类</span></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(linkVos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-登录功能"><a href="#博客前台模块-登录功能" class="headerlink" title="博客前台模块-登录功能"></a>博客前台模块-登录功能</h2><p>SpringSecrity</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> 登录：通过过滤器，没有token放行，让他执行登录接口，去查询数据库，将数据库中的用户名、密码和权限信息放到loginuser中，登录管理器会通过BC密码验证规则去验证密码是否正确（管理器里面会首先把得到的密码BC处理，然后和UserDetails对比），正确将loginuser信息存到authiencation中返回，然后在里面获取token并返回给前端，loginuser信息放到redis中，以便于登录过得用户携带相关权限信息进行判断是否能执行相应操作，然后登录成功。                         接口：携带相关权限和token被jwt认证过滤器拦截，判断token是否正确，正确解析token获得登录用户id，然后从redis中获得相关权限信息集合，将权限信息和loginuser 保存到securitycontextholder中，然后放行后续过滤器会从securitycontextholder中获取相关信息选择放行             </span><br><span class="line">权限认证：将controller层接口上携带权限校验的权限信息，和securitycontextholder中的权限信息进行比对，有就返回true就有权限。                                   </span><br><span class="line">因为访问接口前需要经过jwt认证处理器，所以securitycontextholder中会有相关的权限信息拿来比对</span><br></pre></td></tr></table></figure>

<p>![aa6c0199e84c10e2958243224fef91d](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\aa6c0199e84c10e2958243224fef91d.jpg)</p>
<p>![42814ee71a38ad709bc8701bbf009ba](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\42814ee71a38ad709bc8701bbf009ba.jpg)</p>
<p>![92de010666bcc5d2a7a6d7c4ca5b396](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\92de010666bcc5d2a7a6d7c4ca5b396.jpg)</p>
<p>![d0ac7e0fda038b5244dbc9249db2bb2](C:\Users\康\Documents\WeChat Files\wxid_abwrp7kf1qd122\FileStorage\Temp\d0ac7e0fda038b5244dbc9249db2bb2.png)</p>
<h3 id="接口分析-5"><a href="#接口分析-5" class="headerlink" title="接口分析"></a>接口分析</h3><p>请求体</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;userName&quot;:&quot;sg&quot;,</span><br><span class="line">    &quot;password&quot;:&quot;1234&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>响应格式</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiI0ODBmOThmYmJkNmI0NjM0OWUyZjY2NTM0NGNjZWY2NSIsInN1YiI6IjEiLCJpc3MiOiJzZyIsImlhdCI6MTY0Mzg3NDMxNiwiZXhwIjoxNjQzOTYwNzE2fQ.ldLBUvNIxQCGemkCoMgT_0YsjsWndTg5tqfJb77pabk&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;userInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F3bf9c263bc0f2ac5c3a7feb9e218d07475573ec8.gi&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;23412332@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sg333&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p>登录</p>
<p>​    ①自定义登录接口</p>
<p>​                调用ProviderManager的方法进行认证 如果认证通过生成jwt</p>
<p>​                把用户信息存入redis中</p>
<p>​    ②自定义UserDetailsService</p>
<p>​                在这个实现类中去查询数据库，返回UserDetails实现类对象</p>
<p>​    注意配置passwordEncoder为BCryptPasswordEncoder</p>
<p>UserDetails实现类对象的密码和Authentication密码相比较，相同将UserDetails实现类对象的权限信息交给Authentication对象</p>
<p>校验：</p>
<p>​    ①定义Jwt认证过滤器</p>
<p>​                获取token</p>
<p>​                解析token获取其中的userid</p>
<p>​                从redis中获取用户信息</p>
<p>​                存入SecurityContextHolder，以便后面过滤器拿来使用</p>
<p>配置</p>
<p>​     ① 登录管理器ProviderManager</p>
<p>​          BCryptPasswordEncoder密码校验</p>
<p>​           JWT认证过滤器</p>
<p>​           权限和认证异常处理器</p>
<p>​           crsf攻击</p>
<p>​            cors跨域</p>
<h3 id="代码实现-5"><a href="#代码实现-5" class="headerlink" title="代码实现"></a>代码实现</h3><p>登录接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/25$ 19:17$</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogLoginServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BlogLoginService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">usernamePasswordAuthenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(user.getUserName(),user.getPassword());</span><br><span class="line">        <span class="comment">//登录管理器,去帮我们校验密码和拿到权限</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authenticate</span> <span class="operator">=</span> authenticationManager.authenticate(usernamePasswordAuthenticationToken);</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(authenticate))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获得UserID，形成token</span></span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authenticate.getPrincipal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getUser().getId().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtil.createJWT(userId);</span><br><span class="line">        <span class="comment">//获得用户相关信息，存到Redis</span></span><br><span class="line">        redisCache.setCacheObject(<span class="string">&quot;bloglogin:&quot;</span>+userId,loginUser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先查询出用户信息</span></span><br><span class="line">        <span class="comment">//先将User封装成UserInfoVo</span></span><br><span class="line">        <span class="type">UserInfoVo</span> <span class="variable">userInfoVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(loginUser.getUser(), UserInfoVo.class);</span><br><span class="line">        <span class="comment">//在封装成BlogUserLoginVo返回</span></span><br><span class="line">        <span class="type">BlogUserLoginVo</span> <span class="variable">blogUserLoginVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlogUserLoginVo</span>(token,userInfoVo);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(blogUserLoginVo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UserDetailsService实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/25 21:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String userName)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="comment">//根据用户名查询用户信息</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(StringUtils.isNoneEmpty(userName),User::getUserName, userName);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.selectOne(wrapper);</span><br><span class="line">        <span class="comment">//如果查询不到数据就通过抛出异常来给出提示</span></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(user)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        List&lt;String&gt; arrayList = menuMapper.selectPermsByUserId(user.getId());</span></span><br><span class="line">        <span class="comment">//TODO 根据用户查询权限信息 添加到LoginUser中</span></span><br><span class="line">        <span class="comment">//封装成UserDetails对象返回</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoginUser</span>(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>UserDetails</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.annotation.JSONField;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装数据库查询的用户名密码和权限信息，密码校验器会判断authentication中的密码和UserDetails的密码是否一样，一样就把权限存储到authentication中</span></span><br><span class="line"><span class="comment"> *   然后将token返回前端，将权限存到redis中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginUser</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getPassword();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user.getUserName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JWT认证过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.WebUtils;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 首先执行这个</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(token)) &#123;</span><br><span class="line">            <span class="comment">//放行,后面会有过滤器过滤是否有用户信息</span></span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="comment">//return；回来后不想让它执行后面逻辑</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//解析token</span></span><br><span class="line">        String userId;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            claims = JwtUtil.parseJWT(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//未携带token</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line">        userId = claims.getSubject();</span><br><span class="line">        <span class="comment">//从redis中获取用户信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> <span class="string">&quot;bloglogin:&quot;</span> + userId;</span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> redisCache.getCacheObject(redisKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(loginUser)) &#123;</span><br><span class="line">            <span class="comment">//jwt已经过期，redis中获取信息为null</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存入SecurityContextHolder</span></span><br><span class="line">        <span class="comment">//TODO 获取权限信息封装Authentication</span></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">usernamePasswordAuthenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginUser, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);</span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>springSecurity配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.config;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*import com.sangeng.filter.JwtAuthenticationTokenFilter;</span></span><br><span class="line"><span class="comment">import com.sangeng.handle.AccessDeniedHandlerImpl;</span></span><br><span class="line"><span class="comment">import com.sangeng.handle.AuthenticationEntryPointImpl;*/</span></span><br><span class="line"><span class="keyword">import</span> com.sangeng.filter.JwtAuthenticationTokenFilter;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.handle.security.AccessDeniedHandlerImpl;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.handle.security.AuthenticationEntryPointImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.AuthenticationFailureHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 授权失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccessDeniedHandlerImpl accessDeniedHandler;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 认证失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationEntryPointImpl authenticationEntryPoint;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">                 <span class="comment">//关闭csrf</span></span><br><span class="line">                .csrf().disable()</span><br><span class="line">                 <span class="comment">//不通过Session获取SecurityContext</span></span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                 <span class="comment">// 对于登录接口 允许匿名访问 意思是未登录可以访问这个请求，登录成功不能访问这个请求</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/login&quot;</span>).anonymous()</span><br><span class="line">                <span class="comment">//需要登录才能访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/link/getAllLink&quot;</span>).authenticated()</span><br><span class="line">                 <span class="comment">// 除上面外的所有请求全部可以请求</span></span><br><span class="line">                .anyRequest().permitAll();</span><br><span class="line">        <span class="comment">//增加JWT过滤器</span></span><br><span class="line">        http.addFilterBefore(jwtAuthenticationTokenFilter,UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">        http.exceptionHandling()</span><br><span class="line">                .accessDeniedHandler(accessDeniedHandler)   <span class="comment">//权限异常处理</span></span><br><span class="line">                .authenticationEntryPoint(authenticationEntryPoint);  <span class="comment">//认证异常处理</span></span><br><span class="line">        <span class="comment">//允许跨域</span></span><br><span class="line">        http.cors();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * authenticationManager管理器，会去请求调用用户去查询数据库获得权限</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-异常处理"><a href="#博客前台模块-异常处理" class="headerlink" title="博客前台模块-异常处理"></a>博客前台模块-异常处理</h2><h3 id="认证授权的异常处理"><a href="#认证授权的异常处理" class="headerlink" title="认证授权的异常处理"></a>认证授权的异常处理</h3><p>主要处理业务层的异常</p>
<p>权限认证失败处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.WebUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.AccessDeniedException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.access.AccessDeniedHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 权限不足</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccessDeniedHandlerImpl</span> <span class="keyword">implements</span> <span class="title class_">AccessDeniedHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                       AccessDeniedException accessDeniedException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        accessDeniedException.printStackTrace();</span><br><span class="line">        <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NO_OPERATOR_AUTH);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line">        WebUtils.renderString(response, json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>认证失败处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.WebUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.BadCredentialsException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.InsufficientAuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.AuthenticationEntryPoint;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 认证失败，登录用户名密码错误</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthenticationEntryPointImpl</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationEntryPoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object result;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        authException.printStackTrace();</span><br><span class="line">        <span class="comment">//InsufficientAuthenticationException</span></span><br><span class="line">        <span class="comment">//无授权，未登录</span></span><br><span class="line">        <span class="keyword">if</span> (authException <span class="keyword">instanceof</span> InsufficientAuthenticationException)&#123;</span><br><span class="line">            result =  ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//用户名密码错误</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (authException <span class="keyword">instanceof</span> BadCredentialsException)&#123;</span><br><span class="line">            result =  ResponseResult.errorResult(AppHttpCodeEnum.LOGIN_ERROR.getCode(),authException.getMessage());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            result =  ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR.getCode(),<span class="string">&quot;认证或授权失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(result);</span><br><span class="line">        WebUtils.renderString(response, json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h3><p>主要处理controller层的异常</p>
<p>自定义异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.exception;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/25 21:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//自定义异常处理器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个构造方法，接收的参数是枚举类型，AppHttpCodeEnum是我们在sangeng-framework工程定义的枚举类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SystemException</span><span class="params">(AppHttpCodeEnum httpCodeEnum)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(httpCodeEnum.getMsg());</span><br><span class="line">        <span class="comment">//把某个枚举类里面的code和msg赋值给异常对象</span></span><br><span class="line">        <span class="built_in">this</span>.code = httpCodeEnum.getCode();</span><br><span class="line">        <span class="built_in">this</span>.msg = httpCodeEnum.getMsg();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>全局异常处理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理类（处理controller层）</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/25$ 21:37$</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(SystemException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">exceptionHandler</span><span class="params">(SystemException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;出现了异常：&#123;&#125;&quot;</span>,e);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.errorResult(e.getCode(), e.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">exceptionHandler</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;出现了异常：&#123;&#125;&quot;</span>,e);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR.getCode(), e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-退出功能"><a href="#博客前台模块-退出功能" class="headerlink" title="博客前台模块-退出功能"></a>博客前台模块-退出功能</h2><h3 id="接口分析-6"><a href="#接口分析-6" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126110850159.png" alt="image-20231126110850159"></p>
<h3 id="思路分析-1"><a href="#思路分析-1" class="headerlink" title="思路分析"></a>思路分析</h3><p>直接从SecurityContextHolder中获取登录用户，然后拿到用户ID，删除redis中相关用户ID</p>
<h3 id="代码实现-6"><a href="#代码实现-6" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//从SecurityContextHolder中获取loginUser对象 //获取token，然后解析token值获取其中的userid。</span></span><br><span class="line">        <span class="comment">// SecurityContextHolder是security官方提供的类</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authentication.getPrincipal();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取用户ID</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getUser().getId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从redis中删除此用户ID的登录相关信息</span></span><br><span class="line">        redisCache.deleteObject(<span class="string">&quot;bloglogin:&quot;</span>+userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>注意在配置类中添加</p>
<p>让原本的Sringsecurity的退出登录方法失效</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 对于登录接口 允许匿名访问 意思是未登录可以访问这个请求，登录成功不能访问这个请求</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/login&quot;</span>).anonymous()</span><br><span class="line">                <span class="comment">//需要登录才能访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/logout&quot;</span>).authenticated()</span><br><span class="line"></span><br><span class="line">http.logout().disable();</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-评论列表"><a href="#博客前台模块-评论列表" class="headerlink" title="博客前台模块-评论列表*"></a>博客前台模块-评论列表*</h2><h3 id="接口分析-7"><a href="#接口分析-7" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126171216022.png" alt="image-20231126171216022"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126171245869.png" alt="image-20231126171245869"></p>
<h3 id="思路分析-2"><a href="#思路分析-2" class="headerlink" title="思路分析"></a>思路分析</h3><p>先查询所有根评论，再对已有的根评论，再去查询子评论</p>
<p>根评论 根据条件分页查询根评论的记录 但是创作人的姓名和回复某个人的姓名没有封装，所以需要对评论Vo再进行封装，注意要判断如果（回复：姓名）的id是-1的话，这个评论是根评论，所以不需要封装（回复：姓名）姓名   反之需要</p>
<p>子评论 对根评论的集合再进行封装，根据传入的某个评论id，然后去查询得到所有根评论为这个id的集合，然后对其（名字 回复：名字）名字进行封装</p>
<p>得到所有评论集合</p>
<h3 id="代码实现-7"><a href="#代码实现-7" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.pagination.Page;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.CommentDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Comment;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.CommentVo;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.PageVo;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.CommentService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.BeanCopyUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评论表(Comment)表服务实现类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-11-26 14:37:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(&quot;commentService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;CommentDao, Comment&gt; <span class="keyword">implements</span> <span class="title class_">CommentService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="comment">// ----------------------------------------  评论列表   --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">commentList</span><span class="params">(Long articleId, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="comment">//创建条件</span></span><br><span class="line">        LambdaQueryWrapper&lt;Comment&gt; commentLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//文章id</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(articleId!=<span class="literal">null</span>&amp;&amp;articleId&gt;<span class="number">0</span>,Comment::getArticleId,articleId);</span><br><span class="line">        <span class="comment">//是根评论 -1</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(Comment::getRootId, SystemCanstants.COMMENT_ROOT);</span><br><span class="line">        <span class="comment">//分页</span></span><br><span class="line">        Page&lt;Comment&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">        page = page(page,commentLambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取分页的评论信息</span></span><br><span class="line">        List&lt;Comment&gt; comments = page.getRecords();</span><br><span class="line">                 comments = comments.stream()</span><br><span class="line">                .sorted(Comparator.comparing(Comment::getCreateTime).reversed())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//封装评论表VO</span></span><br><span class="line">        List&lt;CommentVo&gt; commentVos = toCommentVos(comments);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询根评论下的子评论</span></span><br><span class="line">        commentVos = commentVos.stream().map(commentVo -&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//查询哪一条评论所对应的子评论</span></span><br><span class="line">            List&lt;CommentVo&gt; children = getChildren(commentVo.getId());</span><br><span class="line">            commentVo.setChildren(children);</span><br><span class="line">            <span class="keyword">return</span> commentVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(<span class="keyword">new</span> <span class="title class_">PageVo</span>(commentVos,page.getTotal()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;CommentVo&gt; <span class="title function_">getChildren</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Comment&gt; commentLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//查询哪一id下所对应的子评论</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(Comment::getRootId,id);</span><br><span class="line">        <span class="comment">//对子评论按照时间进行排序</span></span><br><span class="line">        commentLambdaQueryWrapper.orderByDesc(Comment::getCreateTime);</span><br><span class="line">        List&lt;Comment&gt; comments = list(commentLambdaQueryWrapper);</span><br><span class="line">        List&lt;CommentVo&gt; commentVos = toCommentVos(comments);</span><br><span class="line">        <span class="keyword">return</span> commentVos;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;CommentVo&gt; <span class="title function_">toCommentVos</span><span class="params">(List&lt;Comment&gt; comments)</span> &#123;</span><br><span class="line">        List&lt;CommentVo&gt; commentVos = BeanCopyUtils.copyBeanList(comments, CommentVo.class);</span><br><span class="line">        <span class="comment">//遍历(可以用for循环，也可以用stream流)。由于封装响应好的数据里面没有username字段，所以我们还不能返回给前端。这个遍历就是用来得到username字段</span></span><br><span class="line">        commentVos = commentVos.stream().map(commentVo -&gt; &#123;</span><br><span class="line">            <span class="comment">//通过CreateBy查询用户的昵称 当前评论的创建人昵称</span></span><br><span class="line">            <span class="comment">//张三回复李四   张三</span></span><br><span class="line">            commentVo.setUsername(userService.getById(commentVo.getCreateBy()).getNickName());</span><br><span class="line">            <span class="comment">// 通过ToCommentUserId 不为-1才查询 就是有子评论   子评论的  =-1是根评论,不等于不是根评论</span></span><br><span class="line">            <span class="comment">//张三回复李四   李四</span></span><br><span class="line">            <span class="keyword">if</span> (commentVo.getToCommentUserId()!=-<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">nickName</span> <span class="operator">=</span> userService.getById(commentVo.getToCommentUserId()).getNickName();</span><br><span class="line">                commentVo.setToCommentUserName(nickName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> commentVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> commentVos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/26 14:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//文章id</span></span><br><span class="line">    <span class="keyword">private</span> Long articleId;</span><br><span class="line">    <span class="comment">//根评论id</span></span><br><span class="line">    <span class="keyword">private</span> Long rootId;</span><br><span class="line">    <span class="comment">//评论内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//发根评论的userid          张三回复了李四  toCommentUserId代表李四的用户id</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentUserId;</span><br><span class="line">    <span class="comment">//发根评论的userName        张三回复了李四  toCommentUserName代表李四的用户昵称</span></span><br><span class="line">    <span class="keyword">private</span> String toCommentUserName;</span><br><span class="line">    <span class="comment">//回复目标评论id            张三回复了李四的什么什么评论  toCommentId代表什么什么评论的ID</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentId;</span><br><span class="line">    <span class="comment">//当前评论的创建人id        最开始评论的创建人id</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//评论是谁发的              最开始评论的创建人昵称</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询子评论</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;CommentVo&gt; children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-发送评论"><a href="#博客前台模块-发送评论" class="headerlink" title="博客前台模块-发送评论*"></a>博客前台模块-发送评论*</h2><h4 id="发送文章评论"><a href="#发送文章评论" class="headerlink" title="发送文章评论"></a>发送文章评论</h4><h5 id="接口分析-8"><a href="#接口分析-8" class="headerlink" title="接口分析"></a>接口分析</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126172635520.png" alt="image-20231126172635520"></p>
<h5 id="思路分析-3"><a href="#思路分析-3" class="headerlink" title="思路分析"></a>思路分析</h5><p>可以直接调用mp的save方法将信息保存，但是有的信息不能添加，比如更新人，插入时间等。</p>
<p>利用mp的自动填充可以实现，然后再评论表中的属性上添加@TableField(fill = FieldFill.INSERT)注解，代表再添加时自动填充</p>
<p>获取更新人id，可以在securitycontextholder中来获取，后面还有好多需要这个，直接封装工具类</p>
<h5 id="代码实现-8"><a href="#代码实现-8" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">addComment</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.hasText(comment.getContent())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.CONTENT_NOT_NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    save(comment);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>utils</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/26 18:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//在&#x27;发送评论&#x27;功能那里会用到的工具类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户的userid</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LoginUser <span class="title function_">getLoginUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (LoginUser) getAuthentication().getPrincipal();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Authentication</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Authentication <span class="title function_">getAuthentication</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定userid为1的用户就是网站管理员</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title function_">isAdmin</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> getLoginUser().getUser().getId();</span><br><span class="line">        <span class="keyword">return</span> id != <span class="literal">null</span> &amp;&amp; <span class="number">1L</span> == id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getLoginUser().getUser().getId();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mp自动填充</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.mp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/26 0026 20:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//这个类是用来配置mybatis的字段自动填充。用于&#x27;发送评论&#x27;功能，由于我们在评论表无法对下面这四个字段进行插入数据(原因是前端在发送评论时，没有在</span></span><br><span class="line"><span class="comment">//请求体提供下面四个参数，所以后端在往数据库插入数据时，下面四个字段是空值)，所有就需要这个类来帮助我们往下面这四个字段自动的插入值，</span></span><br><span class="line"><span class="comment">//只要我们更新了评论表的字段，那么无法插入值的字段就自动有值了</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//只要对数据库执行了插入语句，那么就会执行到这个方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//        try &#123;</span></span><br><span class="line">            <span class="comment">//获取用户id</span></span><br><span class="line">            userId = SecurityUtils.getUserId();</span><br><span class="line"><span class="comment">/*        &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="comment">            e.printStackTrace();</span></span><br><span class="line"><span class="comment">            userId = -1L;//如果异常了，就说明该用户还没注册，我们就把该用户的userid字段赋值d为-1</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="comment">//自动把下面四个字段新增了值。</span></span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createBy&quot;</span>,userId , metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateBy&quot;</span>, userId, metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot; &quot;</span>, SecurityUtils.getUserId(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 评论表(Comment)表实体类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-11-26 14:37:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sg_comment&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Comment</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//评论类型（0代表文章评论，1代表友链评论）</span></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="comment">//文章id</span></span><br><span class="line">    <span class="keyword">private</span> Long articleId;</span><br><span class="line">    <span class="comment">//根评论id</span></span><br><span class="line">    <span class="keyword">private</span> Long rootId;</span><br><span class="line">    <span class="comment">//评论内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//所回复的目标评论的userid</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentUserId;</span><br><span class="line">    <span class="comment">//回复目标评论id</span></span><br><span class="line">    <span class="keyword">private</span> Long toCommentId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于我们在MyMetaObjectHandler类配置了mybatisplus的字段自动填充</span></span><br><span class="line">    <span class="comment">//所以就能指定哪个字段在什么时候进行自动填充，例如该类其它字段新增了数据，那么createBy字段就会自动填充值</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于我们在MyMetaObjectHandler类配置了mybatisplus的字段自动填充</span></span><br><span class="line">    <span class="comment">//所以就能指定哪个字段在什么时候进行自动填充，例如该类其它字段新增了数据，那么createTime字段就会自动填充值</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于我们在MyMetaObjectHandler类配置了mybatisplus的字段自动填充</span></span><br><span class="line">    <span class="comment">//所以就能指定哪个字段在什么时候进行自动填充，例如该类其它字段新增或更新了数据，那么createBy字段就会自动填充值</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于我们在MyMetaObjectHandler类配置了mybatisplus的字段自动填充</span></span><br><span class="line">    <span class="comment">//所以就能指定哪个字段在什么时候进行自动填充，例如该类其它字段新增或更新了数据，那么updateTime字段就会自动填充值</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除标志（0代表未删除，1代表已删除）</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="发送友链评论"><a href="#发送友链评论" class="headerlink" title="发送友链评论"></a>发送友链评论</h4><h5 id="接口分析-9"><a href="#接口分析-9" class="headerlink" title="接口分析"></a>接口分析</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126191211641.png" alt="image-20231126191211641"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126191242604.png" alt="image-20231126191242604"></p>
<h5 id="思路分析-4"><a href="#思路分析-4" class="headerlink" title="思路分析"></a>思路分析</h5><p>根据接口可以查看到，和文章评论共用一个接口，在接口的参数上可以加一个文章或者友链的type，然后再实现类里面对文章id（因为再评论表里面有个type分成友链和文章评论）和type类型进行判断</p>
<h5 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/linkCommentList&quot;)</span></span><br><span class="line">    <span class="comment">//在友链的评论区发送评论。ResponseResult是我们在huanf-framework工程写的类</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">linkCommentList</span><span class="params">(Integer pageNum,Integer pageSize)</span>&#123;</span><br><span class="line">        <span class="comment">//commentService是我们刚刚实现文章的评论区发送评论功能时(当时用的是addComment方法，现在用commentList方法)，写的类</span></span><br><span class="line">        <span class="comment">//SystemCanstants是我们写的用来解决字面值的常量类，Article_LINK代表1</span></span><br><span class="line">        <span class="keyword">return</span> commentService.commentList(SystemCanstants.LINK_COMMENT,<span class="literal">null</span>,pageNum,pageSize);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//评论列表</span></span><br><span class="line">    ResponseResult <span class="title function_">commentList</span><span class="params">(String type,Long articleId, Integer pageNum, Integer pageSize)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">commentList</span><span class="params">(String type, Long articleId, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        <span class="comment">//创建条件</span></span><br><span class="line">        LambdaQueryWrapper&lt;Comment&gt; commentLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//文章id</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(articleId!=<span class="literal">null</span>&amp;&amp;articleId&gt;<span class="number">0</span>,Comment::getArticleId,articleId);</span><br><span class="line">        <span class="comment">//是根评论 -1</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(Comment::getRootId, SystemCanstants.COMMENT_ROOT);</span><br><span class="line">        <span class="comment">//判断是哪个评论</span></span><br><span class="line">        commentLambdaQueryWrapper.eq(Comment::getType,type);</span><br><span class="line">        <span class="comment">//分页</span></span><br><span class="line">        Page&lt;Comment&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">        page = page(page,commentLambdaQueryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-个人信息"><a href="#博客前台模块-个人信息" class="headerlink" title="博客前台模块-个人信息"></a>博客前台模块-个人信息</h2><h4 id="接口分析-10"><a href="#接口分析-10" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126194757170.png" alt="image-20231126194757170"></p>
<h4 id="思路分析-5"><a href="#思路分析-5" class="headerlink" title="思路分析"></a>思路分析</h4><p>此接口需要再登录之后才能访问，直接获取Security里面的用户id，根据id查询相关信息，并且封装Vo</p>
<h4 id="代码实现-9"><a href="#代码实现-9" class="headerlink" title="代码实现"></a>代码实现</h4><p>在SecurityConfig中配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//为方便测试查询个人信息，我们把查询个人信息的接口设置为需要登录才能访问</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/user/userInfo&quot;</span>).authenticated()</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  个人信息   --------------------------------------------------</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">userInfo</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取userID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId().toString();</span><br><span class="line">        <span class="comment">//得到user对象</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(userId);</span><br><span class="line">        <span class="comment">//封装Vo返回</span></span><br><span class="line">        <span class="type">UserInfoVo</span> <span class="variable">userInfoVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(user, UserInfoVo.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(userInfoVo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="博客前台模块-文件上传"><a href="#博客前台模块-文件上传" class="headerlink" title="博客前台模块-文件上传*"></a>博客前台模块-文件上传*</h2><p>先解决头像上传</p>
<p><strong>为什么使用OSS？</strong></p>
<p>因为如果把图片视频等文件上传到自己的应用的Web服务器的某个目录下，在读取图片的时候会占用比较多的资源。影响应用服务器的性能。所以我们一般使用OSS(Object Storage Service对象存储服务)存储图片或视频</p>
<p>OSS</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126201236871.png" alt="image-20231126201236871"></p>
<p>用户—上传图片–&gt;Web服务器  —读取—&gt; 用户</p>
<h4 id="接口分析-11"><a href="#接口分析-11" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231126211729011.png" alt="image-20231126211729011"></p>
<h4 id="思路分析-6"><a href="#思路分析-6" class="headerlink" title="思路分析"></a>思路分析</h4><p>先将图片上传到web服务器，然后传到oss，用户可直接浏览图片 注意上传需要multipart/form-data; 接口参数为 MultipartFile</p>
<p>需要判断文件类型的合法性和文件类型的大小是否合法，并且将文件名修改为日期+uuid+文件名后缀 密钥什么的保存在yml中，通过</p>
<p>代码@ConfigurationProperties(prefix = “myoss”)获取yml中信息，注意实体属性名需要和yml里面的一样 哦对，一定要加@Data注解，要不然属性值获取不了</p>
<h4 id="代码实现-10"><a href="#代码实现-10" class="headerlink" title="代码实现"></a>代码实现</h4><p>controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//上传头像</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">upload</span><span class="params">(MultipartFile img)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> upLoadService.upLoadImg(img);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>serviceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/27 15:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.gson.Gson;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.common.QiniuException;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.http.Response;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.Region;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.UploadManager;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.storage.model.DefaultPutRet;</span><br><span class="line"><span class="keyword">import</span> com.qiniu.util.Auth;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.handle.exception.SystemException;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.UpLoadService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.PathUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/27 15:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Data</span>  <span class="comment">//需要添加这个</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;myoss&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpLoadServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UpLoadService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String bucket;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String yuming;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//上传头像</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">upLoadImg</span><span class="params">(MultipartFile img)</span> &#123;</span><br><span class="line">        <span class="comment">//TODO 判断文件类型或者文件大小</span></span><br><span class="line">        <span class="comment">//判断文件类型</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> img.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取文件大小</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">fileSize</span> <span class="operator">=</span> img.getSize();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对原始文件名进行判断大小。只能上传png或jpg文件</span></span><br><span class="line">        <span class="keyword">if</span> (!originalFilename.endsWith(<span class="string">&quot;.png&quot;</span>)&amp;&amp;!originalFilename.endsWith(<span class="string">&quot;.jpg&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.FILE_TYPE_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断文件大小是否超过2MB（2MB=2*1024*1024 bytes）</span></span><br><span class="line">        <span class="keyword">if</span> (fileSize &gt; <span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>) &#123;</span><br><span class="line">            <span class="comment">// 抛出文件大小超过限制的异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.FILE_SIZE_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//以上都通过则上传文件到七牛云OSS，并得到一个图片外链访问地址。PathUtil是我们在sangeng-framework工程写的工具类</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> PathUtils.generateFilePath(originalFilename);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将文件存到OSS</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> uploadOss(img,filePath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上传到七牛云</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadOss</span><span class="params">(MultipartFile img,String filePath)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构造一个带指定 Region 对象的配置类。你的七牛云OSS创建的是哪个区域的，那么就调用Region的什么方法即可</span></span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>(Region.region1());</span><br><span class="line">        cfg.resumableUploadAPIVersion = Configuration.ResumableUploadAPIVersion.V2;<span class="comment">// 指定分片上传版本</span></span><br><span class="line">        <span class="type">UploadManager</span> <span class="variable">uploadManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadManager</span>(cfg);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> filePath;   <span class="comment">//七牛云里面的文件名</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//byte[] uploadBytes = &quot;hello qiniu cloud&quot;.getBytes(&quot;utf-8&quot;);</span></span><br><span class="line">            <span class="comment">//ByteArrayInputStream byteInputStream=new ByteArrayInputStream(uploadBytes);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//上面两行是官方写的(注释掉)，下面那几行是我们写的</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">xxinputStream</span> <span class="operator">=</span> img.getInputStream();</span><br><span class="line"></span><br><span class="line">            <span class="type">Auth</span> <span class="variable">auth</span> <span class="operator">=</span> Auth.create(accessKey, secretKey);</span><br><span class="line">            <span class="type">String</span> <span class="variable">upToken</span> <span class="operator">=</span> auth.uploadToken(bucket);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Response</span> <span class="variable">response</span> <span class="operator">=</span> uploadManager.put(xxinputStream, key, upToken, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">                <span class="comment">//解析上传成功的结果</span></span><br><span class="line">                <span class="type">DefaultPutRet</span> <span class="variable">putRet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(response.bodyString(), DefaultPutRet.class);</span><br><span class="line">                System.out.println(<span class="string">&quot;上传成功! 生成的key是: &quot;</span> + putRet.key);</span><br><span class="line">                System.out.println(<span class="string">&quot;上传成功! 生成的hash是: &quot;</span> + putRet.hash);</span><br><span class="line">                <span class="keyword">return</span> yuming+key;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (QiniuException ex) &#123;</span><br><span class="line">                <span class="type">Response</span> <span class="variable">r</span> <span class="operator">=</span> ex.response;</span><br><span class="line">                System.err.println(r.toString());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.err.println(r.bodyString());</span><br><span class="line">                &#125; <span class="keyword">catch</span> (QiniuException ex2) &#123;</span><br><span class="line">                    <span class="comment">//ignore</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//ignore</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;www:&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>工具包（生成文件名）日期+uuid+后缀</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/29 0029 12:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//对原始文件名进行修改文件名，并修改存放目录</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PathUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateFilePath</span><span class="params">(String fileName)</span>&#123;</span><br><span class="line">        <span class="comment">//根据日期生成路径   2022/1/15/</span></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">sdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy/MM/dd/&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">datePath</span> <span class="operator">=</span> sdf.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="comment">//uuid作为文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">//后缀和文件后缀一致</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="comment">// test.jpg -&gt; .jpg</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fileType</span> <span class="operator">=</span> fileName.substring(index);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>().append(datePath).append(uuid).append(fileType).toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="更新个人信息"><a href="#更新个人信息" class="headerlink" title="更新个人信息"></a>更新个人信息</h4><h5 id="接口分析-12"><a href="#接口分析-12" class="headerlink" title="接口分析"></a>接口分析</h5><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231127171117154.png" alt="image-20231127171117154"></p>
<h5 id="思路分析-7"><a href="#思路分析-7" class="headerlink" title="思路分析"></a>思路分析</h5><p>将数据封装到请求体内，后端接口从响应体中拿直接根据id进行更新</p>
<h5 id="代码实现-11"><a href="#代码实现-11" class="headerlink" title="代码实现"></a>代码实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updateById(user);</span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-注册信息"><a href="#博客前台模块-注册信息" class="headerlink" title="博客前台模块-注册信息"></a>博客前台模块-注册信息</h2><h3 id="接口分析-13"><a href="#接口分析-13" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231127172135147.png" alt="image-20231127172135147"></p>
<h3 id="思路分析-8"><a href="#思路分析-8" class="headerlink" title="思路分析"></a>思路分析</h3><p>进行非空判断</p>
<p>进行是否重复判断</p>
<p>进行密码加密</p>
<p>存储数据库</p>
<h3 id="代码实现-12"><a href="#代码实现-12" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  注册个人信息   --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">register</span><span class="params">(User user)</span> &#123;</span><br><span class="line">       <span class="comment">//进行非空判断</span></span><br><span class="line">       <span class="comment">//对前端传过来的用户名进行非空判断，例如null、&quot;&quot;，就抛出异常</span></span><br><span class="line">       <span class="keyword">if</span>(!StringUtils.hasText(user.getUserName()))&#123;</span><br><span class="line">           <span class="comment">//SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.USERNAME_NOT_NULL);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//密码</span></span><br><span class="line">       <span class="keyword">if</span>(!StringUtils.hasText(user.getPassword()))&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.PASSWORD_NOT_NULL);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//邮箱</span></span><br><span class="line">       <span class="keyword">if</span>(!StringUtils.hasText(user.getEmail()))&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.EMAIL_NOT_NULL);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//昵称</span></span><br><span class="line">       <span class="keyword">if</span>(!StringUtils.hasText(user.getNickName()))&#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.NICKNAME_NOT_NULL);</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="comment">/* //手机号码</span></span><br><span class="line"><span class="comment">       if(!StringUtils.hasText(user.getPhonenumber()))&#123;</span></span><br><span class="line"><span class="comment">           throw new SystemException(AppHttpCodeEnum.PHONENUMBER_NOT_NULL);</span></span><br><span class="line"><span class="comment">       &#125;*/</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//判断用户传给我们的用户名是否在数据库已经存在。userNameExist方法是下面定义的</span></span><br><span class="line">       <span class="keyword">if</span>(userNameExist(user.getUserName()))&#123;</span><br><span class="line">           <span class="comment">//SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.USERNAME_EXIST);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//判断用户传给我们的昵称是否在数据库已经存在。NickNameExist方法是下面定义的</span></span><br><span class="line">       <span class="keyword">if</span>(NickNameExist(user.getNickName()))&#123;</span><br><span class="line">           <span class="comment">//SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.NICKNAME_EXIST);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//判断用户传给我们的邮箱是否在数据库已经存在。NickNameExist方法是下面定义的</span></span><br><span class="line">       <span class="keyword">if</span>(EmailExist(user.getEmail()))&#123;</span><br><span class="line">           <span class="comment">//SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.EMAIL_EXIST);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">/*//判断用户传给我们的手机号码是否在数据库已经存在。PhonenumberExist方法是下面定义的</span></span><br><span class="line"><span class="comment">       if(PhonenumberExist(user.getPhonenumber()))&#123;</span></span><br><span class="line"><span class="comment">           //SystemException是我们写的异常类、AppHttpCodeEnum是我们写的枚举类</span></span><br><span class="line"><span class="comment">           throw new SystemException(AppHttpCodeEnum.EMAIL_EXIST);</span></span><br><span class="line"><span class="comment">       &#125; */</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//经过上面的判断，可以确保用户传给我们的用户名和昵称是数据库不存在的，且相关字段都不为空。就可以存入数据库</span></span><br><span class="line">       <span class="comment">//注意用户传给我们的密码是明文，对于密码我们要转成密文之后再存入数据库。注意加密要和解密用同一套算法</span></span><br><span class="line">       <span class="comment">//在huanf-blog工程的securityConfig类里面有解密算法，当时我们写了一个passwordEncoder方法，并且注入到了spring容器</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">encodePassword</span> <span class="operator">=</span> passwordEncoder.encode(user.getPassword());<span class="comment">//加密</span></span><br><span class="line">       user.setPassword(encodePassword);</span><br><span class="line">       <span class="comment">//存入数据库。save方法是mybatisplus提供的方法</span></span><br><span class="line">       save(user);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//封装响应返回</span></span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//&#x27;判断用户传给我们的用户名是否在数据库已经存在&#x27; 的方法</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">userNameExist</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">       <span class="comment">//要知道是否存在，首先就是根据条件去数据库查</span></span><br><span class="line">       LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//拿用户写的用户名跟数据库里面的用户名进行比较</span></span><br><span class="line">       queryWrapper.eq(User::getUserName,userName);</span><br><span class="line">       <span class="comment">//如果大于0就说明从数据库查出来了，也就说明是已经存在数据库的</span></span><br><span class="line">       <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> count(queryWrapper) &gt; <span class="number">0</span>;</span><br><span class="line">       <span class="comment">//为true就说明已存在</span></span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//&#x27;判断用户传给我们的昵称是否在数据库已经存在&#x27; 的方法</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">NickNameExist</span><span class="params">(String nickName)</span> &#123;</span><br><span class="line">       <span class="comment">//要知道是否存在，首先就是根据条件去数据库查</span></span><br><span class="line">       LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//拿用户写的昵称跟数据库里面的昵称进行比较</span></span><br><span class="line">       queryWrapper.eq(User::getNickName,nickName);</span><br><span class="line">       <span class="comment">//如果大于0就说明从数据库查出来了，也就说明是已经存在数据库的</span></span><br><span class="line">       <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> count(queryWrapper) &gt; <span class="number">0</span>;</span><br><span class="line">       <span class="comment">//为true就说明已存在</span></span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//&#x27;判断用户传给我们的邮箱是否在数据库已经存在&#x27; 的方法</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">EmailExist</span><span class="params">(String email)</span> &#123;</span><br><span class="line">       <span class="comment">//要知道是否存在，首先就是根据条件去数据库查</span></span><br><span class="line">       LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//拿用户写的昵称跟数据库里面的昵称进行比较</span></span><br><span class="line">       queryWrapper.eq(User::getEmail,email);</span><br><span class="line">       <span class="comment">//如果大于0就说明从数据库查出来了，也就说明是已经存在数据库的</span></span><br><span class="line">       <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> count(queryWrapper) &gt; <span class="number">0</span>;</span><br><span class="line">       <span class="comment">//为true就说明已存在</span></span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* //&#x27;判断用户传给我们的手机号码是否在数据库已经存在&#x27; 的方法</span></span><br><span class="line"><span class="comment">   private boolean PhonenumberExist(String Phonenumber) &#123;</span></span><br><span class="line"><span class="comment">       //要知道是否存在，首先就是根据条件去数据库查</span></span><br><span class="line"><span class="comment">       LambdaQueryWrapper&lt;User&gt; queryWrapper = new LambdaQueryWrapper&lt;&gt;();</span></span><br><span class="line"><span class="comment">       //拿用户写的手机号码跟数据库里面的手机号码进行比较</span></span><br><span class="line"><span class="comment">       queryWrapper.eq(User::getPhonenumber,Phonenumber);</span></span><br><span class="line"><span class="comment">       //如果大于0就说明从数据库查出来了，也就说明是已经存在数据库的</span></span><br><span class="line"><span class="comment">       boolean result = count(queryWrapper) &gt; 0;</span></span><br><span class="line"><span class="comment">       //为true就说明已存在</span></span><br><span class="line"><span class="comment">       return result;</span></span><br><span class="line"><span class="comment">   &#125;*/</span></span><br></pre></td></tr></table></figure>

<h2 id="博客前台模块-日志记录"><a href="#博客前台模块-日志记录" class="headerlink" title="博客前台模块-日志记录*"></a>博客前台模块-日志记录*</h2><p>AOP实现日志记录</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231127210559511.png" alt="image-20231127210559511"></p>
<h3 id="思路分析-9"><a href="#思路分析-9" class="headerlink" title="思路分析"></a>思路分析</h3><p>相当于是对原有的功能进行增强。并且是批量的增强，这个时候就非常适合用AOP来进行实现。</p>
<h3 id="代码实现-13"><a href="#代码实现-13" class="headerlink" title="代码实现"></a>代码实现</h3><p>利用注解来实现</p>
<p>注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SystemLog &#123;</span><br><span class="line">    String <span class="title function_">businessName</span><span class="params">()</span>;   <span class="comment">//业务的名字</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>切面类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/27 20:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.sangeng.annoation.SystemLog)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//切入点</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通知</span></span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">inform</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Object rel;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//执行目标方法前</span></span><br><span class="line">            handleBefore(joinPoint);</span><br><span class="line">            <span class="comment">//执行目标方法</span></span><br><span class="line">            rel = joinPoint.proceed();</span><br><span class="line">            <span class="comment">//执行目标方法后</span></span><br><span class="line">            handleAfter(rel);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 结束后换行</span></span><br><span class="line">            log.info(<span class="string">&quot;=======End=======&quot;</span> + System.lineSeparator());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rel;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleBefore</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        <span class="comment">//获取请求url</span></span><br><span class="line">        <span class="type">ServletRequestAttributes</span> <span class="variable">requestAttributeEvent</span> <span class="operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> requestAttributeEvent.getRequest();</span><br><span class="line">        <span class="comment">//获取描述信息</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取方法上注解的属性</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">businessName</span> <span class="operator">=</span> signature.getMethod().getAnnotation(SystemLog.class).businessName();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//signature 相当于一个完整的方法体</span></span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;=======Start=======&quot;</span>);</span><br><span class="line">        <span class="comment">// 打印请求 URL</span></span><br><span class="line">        log.info(<span class="string">&quot;URL : &#123;&#125;&quot;</span>, request.getRequestURL());</span><br><span class="line">        <span class="comment">// 打印描述信息</span></span><br><span class="line">        log.info(<span class="string">&quot;BusinessName : &#123;&#125;&quot;</span>, businessName);</span><br><span class="line">        <span class="comment">// 打印 Http method put</span></span><br><span class="line">        log.info(<span class="string">&quot;HTTP Method : &#123;&#125;&quot;</span>,request.getMethod());</span><br><span class="line">        <span class="comment">// 打印调用 controller 的全路径以及执行方法</span></span><br><span class="line">        log.info(<span class="string">&quot;Class Method : &#123;&#125;.&#123;&#125;&quot;</span>, signature.getDeclaringTypeName(), signature.getMethod().getName());</span><br><span class="line">        <span class="comment">// 打印请求的 IP</span></span><br><span class="line">        log.info(<span class="string">&quot;IP : &#123;&#125;&quot;</span>, request.getRemoteHost());</span><br><span class="line">        <span class="comment">// 打印请求入参</span></span><br><span class="line">        log.info(<span class="string">&quot;Request Args : &#123;&#125;&quot;</span>, JSON.toJSONString(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleAfter</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        <span class="comment">// 打印出参</span></span><br><span class="line">        log.info(<span class="string">&quot;Response : &#123;&#125;&quot;</span>, JSON.toJSONString(object));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//更新个人信息</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;userInfo&quot;)</span></span><br><span class="line">    <span class="meta">@SystemLog(businessName = &quot;更新用户信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">updateUserInfo</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userService.updateUserInfo(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>实现</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231127211017762.png" alt="image-20231127211017762"></p>
<h2 id="博客前台模块-更新浏览量"><a href="#博客前台模块-更新浏览量" class="headerlink" title="博客前台模块-更新浏览量*"></a>博客前台模块-更新浏览量*</h2><h3 id="需求-1"><a href="#需求-1" class="headerlink" title="需求"></a>需求</h3><p> 在用户浏览博文时要实现对应博客浏览量的增加</p>
<h3 id="思路分析-10"><a href="#思路分析-10" class="headerlink" title="思路分析"></a>思路分析</h3><p>我们只需要在每次用户浏览博客时更新对应的浏览数即可。 但是如果直接操作博客表的浏览量的话，在并发量大的情况下会出现什么问题呢？ 如何去优化呢？ </p>
<p>（因为要更新浏览量的话，会加写锁，只能一个用户占用一条记录，其他不能修改，这就得考虑并发）</p>
<p>①在应用启动时把博客的浏览量存储到redis中 </p>
<p>②更新浏览量时去更新redis中的数据</p>
<p> ③每隔10分钟把Redis中的浏览量更新到数据库中 </p>
<p>④读取文章浏览量时从redis读取</p>
<h3 id="铺垫知识"><a href="#铺垫知识" class="headerlink" title="铺垫知识"></a>铺垫知识</h3><p>①CommandLineRunner实现项目启动时预处理 实现此接口，并加入容器</p>
<p> ③定时任务</p>
<p>定时任务的实现方式有很多，比如XXL-Job等。但是其实核心功能和概念都是类似的，很多情况下只是调 用的API不同而已。 这里就先用SpringBoot为我们提供的定时任务的API来实现一个简单的定时任务，让大家先对定时任务 里面的一些核心概念有个大致的了解。 实现步骤 ① 使用@EnableScheduling注解开启定时任务功能 我们可以在配置类上加上@EnableScheduling</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.sangeng.mapper&quot;)</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SanGengBlogApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(SanGengBlogApplication.class,args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>确定定时任务执行代码，并配置任务执行时间 使用@Scheduled注解标识需要定时执行的代码。注解的cron属性相当于是任务的执行时间。目前可以 使用 0/5 * * * * ? 进行测试，代表从0秒开始，每隔5秒执行一次。 注意：对应的bean要注入容器，否则不会生效。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestJob</span> &#123;</span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJob</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//要执行的代码</span></span><br><span class="line">System.out.println(<span class="string">&quot;定时任务执行了&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>corn定时任务表达式</p>
<h3 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231128134903314.png" alt="image-20231128134903314"></p>
<h3 id="代码实现-14"><a href="#代码实现-14" class="headerlink" title="代码实现"></a>代码实现</h3><p>将数据库存到redis中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.runner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.ArticleDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Article;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.ArticleService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.CommandLineRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在启动项目后将文章id和浏览量存到redis中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewCountRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleDao articleDao;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO ① 将数据库中文章的浏览量存到redis中</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//首先获取所有文章的浏览量</span></span><br><span class="line">        List&lt;Article&gt; articles = articleDao.selectList(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Integer&gt; viewCounts = articles.stream().collect(Collectors.toMap(article -&gt; article.getId().toString(), article -&gt; article.getViewCount().intValue()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//然后调用rediscache方法将id和浏览量存到redis中</span></span><br><span class="line">        redisCache.setCacheMap(SystemCanstants.VIEW_COUNT_KEY,viewCounts);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>更新浏览量数据到redis中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  更新浏览量到redis   --------------------------------------------------</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">updateViewCount</span><span class="params">(Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据id从redis中更新浏览量</span></span><br><span class="line">    redisCache.updateCacheMap(SystemCanstants.VIEW_COUNT_KEY,id.toString(),SystemCanstants.UPDATE_VIEW_COUNT);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>redisCache</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新Map的value值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> hashKey</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCacheMap</span><span class="params">(<span class="keyword">final</span> String key, <span class="keyword">final</span> String hashKey, Integer value)</span>&#123;</span><br><span class="line">    redisTemplate.opsForHash().increment(key,hashKey,value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将redis中数据定时推送到数据库</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.job;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Article;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.ArticleService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * //TODO 后面改为MQ消息队列</span></span><br><span class="line"><span class="comment"> *  定时 每5min将Redis中的ViewCount更新到数据库中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/28 14:42</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UpdateViewCount</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0/5 * * * ?  &quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateViewCount</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//首先在Redis中将所有数据拿出来</span></span><br><span class="line">        <span class="comment">//获取所有的key</span></span><br><span class="line">        Map&lt;String, Integer&gt; viewCountMap = redisCache.getCacheMap(SystemCanstants.VIEW_COUNT_KEY);</span><br><span class="line">        <span class="comment">//封装成单列集合</span></span><br><span class="line">        List&lt;Article&gt; articles = viewCountMap.entrySet().stream()</span><br><span class="line">                .map(vv -&gt; &#123;</span><br><span class="line">                    <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Article</span>();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> vv.getKey();</span><br><span class="line">                    <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> vv.getValue();</span><br><span class="line">                    article.setId(Integer.valueOf(id).longValue());</span><br><span class="line">                    article.setViewCount(viewCount.longValue());</span><br><span class="line">                    <span class="keyword">return</span> article;</span><br><span class="line">                &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//然后根据每个id将浏览量更新到数据库中</span></span><br><span class="line">        articleService.updateBatchById(articles);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在redis中查看浏览量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  热门文章   --------------------------------------------------</span></span><br><span class="line"><span class="comment">//在调用这个方法的时候，先直接将redis中的数据更新到数据库中，不用管是否定时任务更新到这个数据，然后在查询数据库</span></span><br><span class="line"><span class="comment">// 避免了数据不一致问题</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">hotArticleList</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取所有的key</span></span><br><span class="line">    Map&lt;String, Integer&gt; viewCountMap = redisCache.getCacheMap(SystemCanstants.VIEW_COUNT_KEY);</span><br><span class="line">    <span class="comment">//封装成单列集合</span></span><br><span class="line">    List&lt;Article&gt; articles = viewCountMap.entrySet().stream()</span><br><span class="line">        .map(vv -&gt; &#123;</span><br><span class="line">            <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Article</span>();</span><br><span class="line">            <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> vv.getKey();</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> vv.getValue();</span><br><span class="line">            article.setId(Integer.valueOf(id).longValue());</span><br><span class="line">            article.setViewCount(viewCount.longValue());</span><br><span class="line">            <span class="keyword">return</span> article;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">//然后根据每个id将浏览量更新到数据库中</span></span><br><span class="line">    updateBatchById(articles);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构建查询</span></span><br><span class="line">    LambdaQueryWrapper&lt;Article&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//非草稿</span></span><br><span class="line">    lambdaQueryWrapper.eq(Article::getStatus, SystemCanstants.ARTICLE_STATUS_NORMAL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//浏览量排前10</span></span><br><span class="line">    lambdaQueryWrapper.orderByDesc(Article::getViewCount);</span><br><span class="line"></span><br><span class="line">    Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>(SystemCanstants.ARTICLE_STATUS_CURRENT, SystemCanstants.ARTICLE_STATUS_SIZE);</span><br><span class="line">    page(page, lambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到分页拿到的热门文章集合数据</span></span><br><span class="line">    List&lt;Article&gt; hotArticleList = page.getRecords();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//封装成前端需要的数据 HotArticleVo</span></span><br><span class="line">    <span class="comment">//通过调用BeanCopyUtils工具类进行BeanCopy</span></span><br><span class="line">    List&lt;HotArticleVo&gt; hotArticleVos = BeanCopyUtils.copyBeanList(hotArticleList, HotArticleVo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回</span></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(hotArticleVos);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------  文章列表   --------------------------------------------------</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">articleList</span><span class="params">(Long pageNum,Long pageSize,Long categoryId)</span> &#123;</span><br><span class="line">    <span class="comment">//构建查询条件</span></span><br><span class="line">    LambdaQueryWrapper&lt;Article&gt; articleLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//已发布的文章</span></span><br><span class="line">    articleLambdaQueryWrapper.eq(Article::getStatus,SystemCanstants.ARTICLE_STATUS_NORMAL);</span><br><span class="line">    <span class="comment">//置顶的文章在上面</span></span><br><span class="line">    articleLambdaQueryWrapper.orderByDesc(Article::getIsTop);</span><br><span class="line">    <span class="comment">//按分类ID查询</span></span><br><span class="line">    articleLambdaQueryWrapper.eq(Objects.nonNull(categoryId)&amp;&amp;categoryId&gt;<span class="number">0</span>,Article::getCategoryId,categoryId);</span><br><span class="line">    <span class="comment">//分页查询</span></span><br><span class="line">    Page&lt;Article&gt; articlePage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">    articlePage = page(articlePage,articleLambdaQueryWrapper);</span><br><span class="line">    List&lt;Article&gt; articles = articlePage.getRecords();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询categoryName</span></span><br><span class="line">    articles = articles.stream().map(article -&gt; &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//从redis中获取浏览量</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> redisCache.getCacheMapValue(SystemCanstants.VIEW_COUNT_KEY, article.getId().toString());</span><br><span class="line">        article.setViewCount(viewCount.longValue());</span><br><span class="line"></span><br><span class="line">        article.setCategoryName(categoryService.getById(article.getCategoryId()).getName());</span><br><span class="line">        <span class="keyword">return</span> article;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">//封装VO</span></span><br><span class="line">    List&lt;ArticleListVo&gt; articleListVos = BeanCopyUtils.copyBeanList(articlePage.getRecords(), ArticleListVo.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//封装PageVo对象</span></span><br><span class="line">    <span class="type">PageVo</span> <span class="variable">pageVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>(articleListVos, articlePage.getTotal());</span><br><span class="line">    <span class="comment">//返回对象</span></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(pageVO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ----------------------------------------  文章详情   --------------------------------------------------</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">getArticleDetail</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">ArticleDetailVo</span> <span class="variable">articleDetailVo</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (Objects.nonNull(id) &amp;&amp; id &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//根据id查询</span></span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从redis中获取浏览量</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> redisCache.getCacheMapValue(SystemCanstants.VIEW_COUNT_KEY, id.toString());</span><br><span class="line">        article.setViewCount(viewCount.longValue());</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">categoryId</span> <span class="operator">=</span> article.getCategoryId();</span><br><span class="line">        <span class="comment">//查询分类名</span></span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(categoryId);</span><br><span class="line">        <span class="keyword">if</span> (category!=<span class="literal">null</span>) &#123;</span><br><span class="line">            article.setCategoryName(category.getName());</span><br><span class="line">            <span class="comment">//封装VO</span></span><br><span class="line">            articleDetailVo = BeanCopyUtils.copyBean(article, ArticleDetailVo.class);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回结果</span></span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(articleDetailVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h2><p>引入POM依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>



<p>在启动类添加@EnableSwagger2注解</p>
<p>Controller层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;用户信息&quot;,description = &quot;用户信息相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;更新个人信息&quot;,notes = &quot;获取个人的相关信息&quot;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接口参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiImplicitParam(name = &quot;user&quot;,value = &quot;更新的用户信息&quot;)</span></span><br></pre></td></tr></table></figure>

<p>实体类，最好封装前端传过来的参数 dto</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModel(value = &quot;增加评论DTO&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddCommentDto</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>实体类属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//评论类型（0代表文章评论，1代表友链评论）</span></span><br><span class="line"><span class="meta">@ApiModelProperty(&quot;0代表文章评论，1代表友链评论&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String type;</span><br></pre></td></tr></table></figure>

<p>文档信息</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231128203652811.png" alt="image-20231128203652811"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.common.base.Predicates;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.service.Contact;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"><span class="keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/28 20:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//标识为配置类</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span> <span class="comment">//开启swagger，即可通过swagger为sangeng-blog工程生成接口文档</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">customDocket</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//只监控com.sangeng.controller包的api</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sangeng.controller&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 对所有api进行监控</span></span><br><span class="line">                <span class="comment">//.apis(RequestHandlerSelectors.any())</span></span><br><span class="line">                <span class="comment">//不显示错误的接口地址，也就是错误路径不监控</span></span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/error.*&quot;</span>)))</span><br><span class="line"></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Contact</span> <span class="variable">contact</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;久违&quot;</span>, <span class="string">&quot;https://mykang2003.github.io&quot;</span>, <span class="string">&quot;501858029@qq.com&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;博客前台文档&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;博客前台文档&quot;</span>)</span><br><span class="line">                .contact(contact)   <span class="comment">// 联系方式</span></span><br><span class="line">                .version(<span class="string">&quot;1.1.1&quot;</span>)  <span class="comment">// 版本</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231128203712544.png" alt="image-20231128203712544"></p>
<h2 id="博客后台模块-测试"><a href="#博客后台模块-测试" class="headerlink" title="博客后台模块-测试"></a>博客后台模块-测试</h2><h2 id="博客后台模块-登录"><a href="#博客后台模块-登录" class="headerlink" title="博客后台模块-登录"></a>博客后台模块-登录</h2><h3 id="接口分析-14"><a href="#接口分析-14" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231129163739057.png" alt="image-20231129163739057"></p>
<h3 id="解决思路-5"><a href="#解决思路-5" class="headerlink" title="解决思路"></a>解决思路</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231129162352039.png" alt="image-20231129162352039"></p>
<h3 id="代码实现-15"><a href="#代码实现-15" class="headerlink" title="代码实现"></a>代码实现</h3><p>jwt认证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.WebUtils;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JWT认证过滤器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>            <span class="comment">//未携带token</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(token)) &#123;</span><br><span class="line">            <span class="comment">//放行,后面会有过滤器过滤是否有用户信息</span></span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="comment">//return；回来后不想让它执行后面逻辑</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//解析token</span></span><br><span class="line">        String userId;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            claims = JwtUtil.parseJWT(token);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line">        userId = claims.getSubject();</span><br><span class="line">        <span class="comment">//从redis中获取用户信息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">redisKey</span> <span class="operator">=</span> <span class="string">&quot;adminbloglogin:&quot;</span> + userId;</span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> redisCache.getCacheObject(redisKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(loginUser)) &#123;</span><br><span class="line">            <span class="comment">//jwt已经过期，redis中获取信息为null</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.NEED_LOGIN);</span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存入SecurityContextHolder</span></span><br><span class="line">        <span class="comment">//TODO 获取权限信息封装Authentication</span></span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">usernamePasswordAuthenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(loginUser, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);</span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>登录接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.common.ResponseResult;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.LoginUser;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.enums.AppHttpCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.BlogUserLoginVo;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.UserInfoVo;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.AdminBlogLoginService;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.BeanCopyUtils;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.RedisCache;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 博客后台登录</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminBlogLoginServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AdminBlogLoginService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisCache redisCache;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AuthenticationManager authenticationManager;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ----------------------------------------  登录   --------------------------------------------------</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">login</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">usernamePasswordAuthenticationToken</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(user.getUserName(),user.getPassword());</span><br><span class="line">        <span class="comment">//登录管理器,去帮我们校验密码和拿到权限</span></span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authenticate</span> <span class="operator">=</span> authenticationManager.authenticate(usernamePasswordAuthenticationToken);</span><br><span class="line">        <span class="keyword">if</span> (Objects.isNull(authenticate))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户名或密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获得UserID，形成token</span></span><br><span class="line">        <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> (LoginUser) authenticate.getPrincipal();</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> loginUser.getUser().getId().toString();</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtil.createJWT(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得用户相关信息，存到Redis</span></span><br><span class="line">        redisCache.setCacheObject(<span class="string">&quot;adminbloglogin:&quot;</span>+userId,loginUser);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//封装Map集合给前端响应</span></span><br><span class="line">        Map&lt;String,String&gt; tokenMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        tokenMap.put(<span class="string">&quot;token&quot;</span>,token);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(tokenMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ----------------------------------------  退出登录  --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//从SecurityContextHolder中获取loginUser对象 //获取token，然后解析token值获取其中的userid。</span></span><br><span class="line">        <span class="comment">// SecurityContextHolder是security官方提供的类</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//直接调用SecurityUtils方法   获取用户ID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从redis中删除此用户ID的登录相关信息</span></span><br><span class="line">        redisCache.deleteObject(<span class="string">&quot;adminbloglogin:&quot;</span>+userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(AppHttpCodeEnum.SUCCESS.getCode(),<span class="string">&quot;注销成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>userDetails和前面一样</p>
<h2 id="博客后台模块-后台权限控制"><a href="#博客后台模块-后台权限控制" class="headerlink" title="*博客后台模块-后台权限控制"></a>*博客后台模块-后台权限控制</h2><h3 id="接口分析-15"><a href="#接口分析-15" class="headerlink" title="接口分析"></a>接口分析</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231129171606246.png" alt="image-20231129171606246"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231129190408032.png" alt="image-20231129190408032"></p>
<h3 id="思路分析-11"><a href="#思路分析-11" class="headerlink" title="思路分析"></a>思路分析</h3><p>查询登录的用户的权限，角色，和用户的信息</p>
<p>获取登录的id，如果是管理员1，就直接查询管理员为1的权限，并且需要有菜单为C或者按钮为F的条件和权限正常的权限列表。如果是普通用户，就连表查询所对应的用户的权限，并且也要有C和F的条件和权限正常的</p>
<p>查询角色，如果是管理员直接返回admin，如果是普通用户，就去连表查询用户的角色的名称</p>
<h3 id="代码实现-16"><a href="#代码实现-16" class="headerlink" title="代码实现"></a>代码实现</h3><p>查询权限信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.MenuDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.constants.SystemCanstants;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Menu;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.MenuService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/8/4 0004 13:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MenuServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;MenuDao, Menu&gt; <span class="keyword">implements</span> <span class="title class_">MenuService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//查询用户的权限信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">selectPermsByUserId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//根据用户id查询用户的权限信息。用户id为id代表管理员，如果是管理员就返回所有的权限</span></span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">1L</span>)&#123;</span><br><span class="line">            LambdaQueryWrapper&lt;Menu&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            <span class="comment">//查询条件是permissions中需要有所有菜单类型为C或者F的权限。SystemCanstants是我们在huanf-framework工程写的类</span></span><br><span class="line">            wrapper.in(Menu::getMenuType, SystemCanstants.TYPE_MENU,SystemCanstants.TYPE_BUTTON);</span><br><span class="line">            <span class="comment">//查询条件是permissions中需要有状态为正常的权限。SystemCanstants是我们在huanf-framework工程写的类</span></span><br><span class="line">            wrapper.eq(Menu::getStatus,SystemCanstants.MENU_STATUS_NORMAL);</span><br><span class="line">            <span class="comment">//查询条件是permissions中需要未被删除的权限的权限</span></span><br><span class="line">            List&lt;Menu&gt; menus = list(wrapper);</span><br><span class="line">            List&lt;String&gt; perms = menus.stream()</span><br><span class="line">                    .map(Menu::getPerms)</span><br><span class="line">                    .collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">return</span> perms;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果不是管理员就返回对应用户所具有的权限</span></span><br><span class="line">        List&lt;String&gt; otherPerms = getBaseMapper().selectPermsByOtherUserId(id);</span><br><span class="line">        <span class="keyword">return</span> otherPerms;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sangeng.dao.MenuDao&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectPermsByOtherUserId&quot;</span> resultType=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span><br><span class="line">        SELECT</span><br><span class="line">            DISTINCT m.perms</span><br><span class="line">        FROM</span><br><span class="line">            `sys_user_role` ur</span><br><span class="line">                LEFT JOIN `sys_role_menu` rm ON ur.`role_id` = rm.`role_id`</span><br><span class="line">                LEFT JOIN `sys_menu` m ON m.`id` = rm.`menu_id`</span><br><span class="line">        WHERE</span><br><span class="line">            ur.`user_id` = #&#123;userId&#125; AND</span><br><span class="line">            m.`menu_type` IN (<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;F&#x27;</span>) AND</span><br><span class="line">            m.`status` = <span class="number">0</span> AND</span><br><span class="line">            m.`del_flag` = <span class="number">0</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>



<p>查询角色信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.dao.RoleDao;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Role;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.service.RoleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/8/4 0004 13:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoleServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;RoleDao, Role&gt; <span class="keyword">implements</span> <span class="title class_">RoleService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//查询用户的角色信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">selectRoleKeyByUserId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">//判断是否是管理员，如果是，就返回集合中只需要有admin</span></span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">1L</span>)&#123;</span><br><span class="line">            List&lt;String&gt; roleKeys = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            roleKeys.add(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> roleKeys;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//否则查询对应普通用户所具有的的角色信息</span></span><br><span class="line">        List&lt;String&gt; otherRole = getBaseMapper().selectRoleKeyByOtherUserId(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> otherRole;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.sangeng.dao.RoleDao&quot;</span>&gt;</span><br><span class="line">    &lt;!--MenuMapper接口的映射文件--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectRoleKeyByOtherUserId&quot;</span> resultType=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span><br><span class="line">        SELECT</span><br><span class="line">            r.`role_key`</span><br><span class="line">        FROM</span><br><span class="line">            `sys_user_role` ur</span><br><span class="line">                LEFT JOIN `sys_role` r ON ur.`role_id` = r.`id`</span><br><span class="line">        WHERE</span><br><span class="line">            ur.`user_id` = #&#123;userId&#125; AND</span><br><span class="line">            r.`status` = <span class="number">0</span> AND</span><br><span class="line">            r.`del_flag` = <span class="number">0</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------------查询(超级管理员|非超级管理员)的权限和角色信息------------------------------------------</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/getInfo&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult&lt;AdminUserInfoVo&gt; <span class="title function_">getInfo</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="comment">//获取当前登录的用户。SecurityUtils是我们在huanf-framework写的类</span></span><br><span class="line">       <span class="type">LoginUser</span> <span class="variable">loginUser</span> <span class="operator">=</span> SecurityUtils.getLoginUser();</span><br><span class="line">       <span class="comment">//根据用户id查询权限信息</span></span><br><span class="line">       List&lt;String&gt; perms = menuService.selectPermsByUserId(loginUser.getUser().getId());</span><br><span class="line">       <span class="comment">//根据用户id查询角色信息</span></span><br><span class="line">       List&lt;String&gt; roleKeyList = roleService.selectRoleKeyByUserId(loginUser.getUser().getId());</span><br><span class="line"></span><br><span class="line">       <span class="comment">//获取用户信息</span></span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> loginUser.getUser();</span><br><span class="line">       <span class="comment">//BeanCopyUtils是我们在huanf-framework写的类</span></span><br><span class="line">       <span class="type">UserInfoVo</span> <span class="variable">userInfoVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(user, UserInfoVo.class);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//封装响应返回</span></span><br><span class="line">       <span class="type">AdminUserInfoVo</span> <span class="variable">adminUserInfoVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminUserInfoVo</span>(perms,roleKeyList,userInfoVo);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult(adminUserInfoVo);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="动态路由"><a href="#动态路由" class="headerlink" title="*动态路由"></a>*动态路由</h2><p>实现了这个动态路由功能之后，就能在浏览器web页面登录进博客管理后台了，小期待不是</p>
<h3 id="接口分析-16"><a href="#接口分析-16" class="headerlink" title="接口分析"></a>接口分析</h3><p>接口设计。后台系统需要能实现不同的用户权限可以看到不同的功能，即左侧的导航栏</p>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>请求地址</th>
<th>请求头</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>/getRouters</td>
<td>需要token请求头</td>
</tr>
</tbody></table>
<p>响应格式如下: 前端为了实现动态路由的效果，需要后端有接口能返回用户所能访问的菜单数据。注意: 返回的菜单数据需要体现父子菜单的层级关系</p>
<p>如果用户id为1代表管理员，menus中需要有所有菜单类型为C或者M的，C表示菜单，M表示目录，状态为正常的，未被删除的权限</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;menus&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;content/article/write/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022-01-08 11:39:58&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;build&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2023</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;写博文&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;write&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;content:article:writer&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/user/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;user&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:user:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/role/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;peoples&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">101</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;role&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:role:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="punctuation">&#123;</span></span><br><span class="line">						<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;component&quot;</span><span class="punctuation">:</span><span class="string">&quot;system/menu/index&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;tree-table&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">102</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;菜单管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;3&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;menu&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;system:menu:list&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">					<span class="punctuation">&#125;</span></span><br><span class="line">				<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2021-11-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;icon&quot;</span><span class="punctuation">:</span><span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuName&quot;</span><span class="punctuation">:</span><span class="string">&quot;系统管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;menuType&quot;</span><span class="punctuation">:</span><span class="string">&quot;M&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;orderNum&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;system&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;perms&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;visible&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><p>先判断是不是管理员，先找出管理员的所有菜单，或者是普通用户的所具有的所有菜单</p>
<p>然后对这些菜单进行建树，先筛选出父菜单为0的，它就是第一层菜单，然后找到他的菜单id（设为第一层菜单id）。在遍历一遍集合，找出父菜单为第一层菜单id的所有菜单，将这个集合赋值给第一层菜单的children</p>
<h3 id="实现代码-1"><a href="#实现代码-1" class="headerlink" title="实现代码"></a>实现代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//查询用户路由信息，也就是权限信息,包括父子目录</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Menu&gt; <span class="title function_">selectRouterMenuTreeByUserId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">MenuDao</span> <span class="variable">menuDao</span> <span class="operator">=</span> getBaseMapper();</span><br><span class="line">        List&lt;Menu&gt; menus = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是否是超级管理员，用户id为1表示超级管理员，如果是就返回所有要求的权限菜单,不是的话就找到对应的角色所能显示的菜单</span></span><br><span class="line">        <span class="comment">//然后在将这个树进行父子排列</span></span><br><span class="line">        <span class="keyword">if</span> (SecurityUtils.isAdmin())&#123;</span><br><span class="line">            menus = menuDao.selectAllRouterMenu();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            menus = menuDao.selectOtherRouterMenuTreeByUserId(id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建成树，也就是子父菜单树，有层级关系</span></span><br><span class="line">        <span class="comment">//先找出第一层的菜单，然后找第二层的菜单，将第二层菜单结果赋值给Menu类的child</span></span><br><span class="line">        List&lt;Menu&gt; menuTree = buildMenuTree(menus,<span class="number">0L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> menuTree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//先找出第一层的菜单，然后找出他的子菜单（其他菜单是其id的菜单）设置到children属性中</span></span><br><span class="line">    <span class="comment">//找出父menu，查询他的子menu</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Menu&gt; <span class="title function_">buildMenuTree</span><span class="params">(List&lt;Menu&gt; menus, <span class="type">long</span> parentId)</span> &#123;</span><br><span class="line">        <span class="comment">//过滤找出父菜单，也就是第一层 父菜单等于0的话就是父目录</span></span><br><span class="line">        List&lt;Menu&gt; menuTree = menus.stream().filter(menu -&gt; menu.getParentId().equals(parentId))</span><br><span class="line">                <span class="comment">//获取父id是0的菜单集合，将设置到children属性中  可以找出菜单id为1,parentId为0的菜单</span></span><br><span class="line">                .map(menu -&gt; menu.setChildren(getChildren(menu, menus))) <span class="comment">//获取Menu集合 再将菜单100 101 102菜单设置到菜单为1的children中</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> menuTree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;Menu&gt; <span class="title function_">getChildren</span><span class="params">(Menu menu, List&lt;Menu&gt; menus)</span> &#123;  <span class="comment">//menu菜单id为1</span></span><br><span class="line">        List&lt;Menu&gt; childrenList = menus.stream()   <span class="comment">//通过上面传过来的是父目录了，然后查所有的父目录是他的id</span></span><br><span class="line">                .filter(menu1 -&gt; menu1.getParentId().equals(menu.getId()))  <span class="comment">//在这找出父类菜单id为1的菜单</span></span><br><span class="line">                .map(menu1 -&gt; menu1.setChildren(getChildren(menu1, menus)))<span class="comment">//如果有三层菜单的话，也就是子菜单的子菜单，我们就用下面那行递归(自己调用自己)来处理</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> childrenList;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Accessors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 菜单权限表(Menu)表实体类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-08-04 13:20:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sys_menu&quot;)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span> <span class="comment">//允许链式编程  ，set get会有返回值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Menu</span>  &#123;</span><br><span class="line">    <span class="comment">//菜单ID</span></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//菜单名称</span></span><br><span class="line">    <span class="keyword">private</span> String menuName;</span><br><span class="line">    <span class="comment">//父菜单ID</span></span><br><span class="line">    <span class="keyword">private</span> Long parentId;</span><br><span class="line">    <span class="comment">//显示顺序</span></span><br><span class="line">    <span class="keyword">private</span> Integer orderNum;</span><br><span class="line">    <span class="comment">//路由地址</span></span><br><span class="line">    <span class="keyword">private</span> String path;</span><br><span class="line">    <span class="comment">//组件路径</span></span><br><span class="line">    <span class="keyword">private</span> String component;</span><br><span class="line">    <span class="comment">//是否为外链（0是 1否）</span></span><br><span class="line">    <span class="keyword">private</span> Integer isFrame;</span><br><span class="line">    <span class="comment">//菜单类型（M目录 C菜单 F按钮）</span></span><br><span class="line">    <span class="keyword">private</span> String menuType;</span><br><span class="line">    <span class="comment">//菜单状态（0显示 1隐藏）</span></span><br><span class="line">    <span class="keyword">private</span> String visible;</span><br><span class="line">    <span class="comment">//菜单状态（0正常 1停用）</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">//权限标识</span></span><br><span class="line">    <span class="keyword">private</span> String perms;</span><br><span class="line">    <span class="comment">//菜单图标</span></span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line">    <span class="comment">//创建者</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    <span class="comment">//创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="comment">//更新者</span></span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line">    <span class="comment">//更新时间</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line">    <span class="comment">//备注</span></span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String delFlag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//由于数据库没有children字段，所以我们要添加@TableField(exist = false)注解让mybatis在查表时不查询这个字段</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Menu&gt; children;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后端把long类型转换为String类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将long类型转化为字符串类型，避免因前端js的长度而导致long类型精度丢失</span></span><br><span class="line">       SerializeConfig.globalInstance.put(Long.class, ToStringSerializer.instance);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>分页total数是long，但是前端要显示数字，所以在前端拦截器地方，在配置一下，字符串转为Long类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//把字符串total 转换成 数字 total</span></span><br><span class="line">    <span class="keyword">if</span> (res.data.data &amp;&amp; res.data.data.total) &#123;</span><br><span class="line">      res.data.data.total = parseInt(res.data.data.total)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.data.data</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130131652659.png" alt="image-20231130131652659"></p>
<h2 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// ----------------------------------------  退出登录  --------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//从SecurityContextHolder中获取loginUser对象 //获取token，然后解析token值获取其中的userid。</span></span><br><span class="line">        <span class="comment">// SecurityContextHolder是security官方提供的类</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//直接调用SecurityUtils方法   获取用户ID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> SecurityUtils.getUserId().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从redis中删除此用户ID的登录相关信息</span></span><br><span class="line">        redisCache.deleteObject(<span class="string">&quot;adminbloglogin:&quot;</span>+userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(AppHttpCodeEnum.SUCCESS.getCode(),<span class="string">&quot;注销成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="标签列表"><a href="#标签列表" class="headerlink" title="标签列表"></a>标签列表</h2><h3 id="查询标签"><a href="#查询标签" class="headerlink" title="查询标签"></a>查询标签</h3><h4 id="需求-amp-接口设计"><a href="#需求-amp-接口设计" class="headerlink" title="需求&amp;接口设计"></a>需求&amp;接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130132146167.png" alt="image-20231130132146167"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130132443314.png"></p>
<h4 id="实现思路-1"><a href="#实现思路-1" class="headerlink" title="实现思路"></a>实现思路</h4><p>根据标签名进行分页查询所有标签，然后封装VO返回</p>
<h4 id="代码实现-17"><a href="#代码实现-17" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询标签列表</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult&lt;PageVo&gt; <span class="title function_">pageTagList</span><span class="params">(Integer pageNum, Integer pageSize, TagListDto tagListDto)</span> &#123;</span><br><span class="line">       LambdaQueryWrapper&lt;Tag&gt; tagLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       <span class="comment">//查看是否有评论 模糊查询</span></span><br><span class="line">       tagLambdaQueryWrapper.like(StringUtils.hasText(tagListDto.getRemark()),Tag::getRemark,tagListDto.getRemark());</span><br><span class="line">       <span class="comment">//查看是否有name模糊查询</span></span><br><span class="line">       tagLambdaQueryWrapper.like(StringUtils.hasText(tagListDto.getName()),Tag::getName,tagListDto.getName());</span><br><span class="line">       <span class="comment">//分页</span></span><br><span class="line">       Page&lt;Tag&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum,pageSize);</span><br><span class="line">       page(page,tagLambdaQueryWrapper);</span><br><span class="line">       <span class="comment">//封装vo返回</span></span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult(<span class="keyword">new</span> <span class="title class_">PageVo</span>(page.getRecords(),page.getTotal()));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增标签"><a href="#新增标签" class="headerlink" title="新增标签"></a>新增标签</h3><h4 id="接口分析-17"><a href="#接口分析-17" class="headerlink" title="接口分析"></a>接口分析</h4><p>注意自动填充字段，是否创建MyMetaObjectHandler</p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130140707746.png" alt="image-20231130140707746"></p>
<h4 id="代码实现-18"><a href="#代码实现-18" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.handle.mp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.utils.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.reflection.MetaObject;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/26 0026 20:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//这个类是用来配置mybatis的字段自动填充。用于&#x27;发送评论&#x27;功能，由于我们在评论表无法对下面这四个字段进行插入数据(原因是前端在发送评论时，没有在</span></span><br><span class="line"><span class="comment">//请求体提供下面四个参数，所以后端在往数据库插入数据时，下面四个字段是空值)，所有就需要这个类来帮助我们往下面这四个字段自动的插入值，</span></span><br><span class="line"><span class="comment">//只要我们更新了评论表的字段，那么无法插入值的字段就自动有值了</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//只要对数据库执行了插入语句，那么就会执行到这个方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取用户id</span></span><br><span class="line">            userId = SecurityUtils.getUserId();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            userId = -<span class="number">1L</span>;<span class="comment">//如果异常了，就说明该用户还没注册，我们就把该用户的userid字段赋值d为-1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//自动把下面四个字段新增了值。</span></span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;createBy&quot;</span>,userId , metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateBy&quot;</span>, userId, metaObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;updateTime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot; &quot;</span>, SecurityUtils.getUserId(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增标签</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">addTag</span><span class="params">(AddTagDto addTagDto)</span>&#123;</span><br><span class="line">        <span class="type">Tag</span> <span class="variable">tag</span> <span class="operator">=</span> BeanCopyUtils.copyBean(addTagDto, Tag.class);</span><br><span class="line">        save(tag);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;新增标签&quot;, notes = &quot;新增标签&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">addTag</span><span class="params">(<span class="meta">@RequestBody</span> AddTagDto addTagDto)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> tagService.addTag(addTagDto);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="删除标签"><a href="#删除标签" class="headerlink" title="删除标签"></a>删除标签</h3><h4 id="接口分析-18"><a href="#接口分析-18" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130140613822.png" alt="image-20231130140613822"></p>
<h4 id="代码实现-19"><a href="#代码实现-19" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除标签&quot;, notes = &quot;删除标签&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> List&lt;Long&gt; id)</span>&#123;</span><br><span class="line">        tagService.removeByIds(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment"># 日志</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment"># 逻辑删除的字段  会自动帮我们判断是否删除</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">delFlag</span></span><br><span class="line">      <span class="comment"># 代表已删除的值</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="comment"># 代表未删除的值</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br><span class="line">      <span class="comment"># 主键自增策略，以mysql数据库为准</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br></pre></td></tr></table></figure>



<h3 id="修改标签"><a href="#修改标签" class="headerlink" title="修改标签"></a>修改标签</h3><h4 id="接口分析-19"><a href="#接口分析-19" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130143113622.png" alt="image-20231130143113622"></p>
<h4 id="思路分析-12"><a href="#思路分析-12" class="headerlink" title="思路分析"></a>思路分析</h4><p>注意要先根据id查询所对应的标签，进行回显，然后再根据id保存相应的数据</p>
<h4 id="代码实现-20"><a href="#代码实现-20" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="comment">//①根据标签的id来查询标签</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;根据id查询标签&quot;, notes = &quot;回显标签信息，去更新标签信息&quot;)</span></span><br><span class="line">   <span class="meta">@ApiImplicitParam(name = &quot;id&quot;,value = &quot;标签id&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">       <span class="type">Tag</span> <span class="variable">tag</span> <span class="operator">=</span> tagService.getById(id);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult(tag);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@PutMapping</span></span><br><span class="line">   <span class="comment">//②根据标签的id来修改标签</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;根据id修改标签&quot;, notes = &quot;修改标签信息&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> EditTagDto tagDto)</span>&#123;</span><br><span class="line">       <span class="type">Tag</span> <span class="variable">tag</span> <span class="operator">=</span> BeanCopyUtils.copyBean(tagDto,Tag.class);</span><br><span class="line">       tagService.updateById(tag);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="发布文章"><a href="#发布文章" class="headerlink" title="*发布文章"></a>*发布文章</h2><h3 id="查询分类"><a href="#查询分类" class="headerlink" title="查询分类"></a>查询分类</h3><h4 id="接口分析-20"><a href="#接口分析-20" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130160302938.png" alt="image-20231130160302938"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130160715358.png" alt="image-20231130160715358"></p>
<h4 id="代码实现-21"><a href="#代码实现-21" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写博文查询所有状态正常的分类</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;CategoryVo&gt; <span class="title function_">listAllCategory</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">//查询状态正常的分类就行</span></span><br><span class="line">       LambdaQueryWrapper&lt;Category&gt; categoryLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       categoryLambdaQueryWrapper.eq(Category::getStatus,SystemCanstants.CATEGORY_NORMAL);</span><br><span class="line">       List&lt;Category&gt; categoryList = list(categoryLambdaQueryWrapper);</span><br><span class="line">       <span class="keyword">return</span> BeanCopyUtils.copyBeanList(categoryList,CategoryVo.class);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="查询标签-1"><a href="#查询标签-1" class="headerlink" title="查询标签"></a>查询标签</h3><h4 id="接口分析-21"><a href="#接口分析-21" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130164233435.png" alt="image-20231130164233435"></p>
<h4 id="代码实现-22"><a href="#代码实现-22" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写博文-查询文章标签的接口</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;TagVo&gt; <span class="title function_">listAllTag</span><span class="params">()</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Tag&gt; tagLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        tagLambdaQueryWrapper.select(Tag::getId,Tag::getName); <span class="comment">//select 查询出 id和name</span></span><br><span class="line">        List&lt;Tag&gt; tagList = list(tagLambdaQueryWrapper);</span><br><span class="line">        List&lt;TagVo&gt; tagVos = BeanCopyUtils.copyBeanList(tagList, TagVo.class);</span><br><span class="line">        <span class="keyword">return</span> tagVos;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="上传图片"><a href="#上传图片" class="headerlink" title="上传图片"></a>上传图片</h3><h4 id="接口分析-22"><a href="#接口分析-22" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130165912395.png" alt="image-20231130165912395"></p>
<h4 id="代码实现-23"><a href="#代码实现-23" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/26 21:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;写文章-缩略图文件上传&quot;,description = &quot;写文章-缩略图文件上传相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UpLoadService upLoadService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上传缩略图</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;上传图片&quot;,notes = &quot;上传缩略图&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;multipartFile&quot;,value = &quot;头像图片&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;img&quot;)</span> MultipartFile multipartFile)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> upLoadService.upLoadImg(multipartFile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myoss:</span><br><span class="line">  accessKey: x-qfDcVVmiT2m-efSspP5gIUJmvbMgTFBeDxnsTx</span><br><span class="line">  secretKey: NO5vz18JlVozZRWn11fkgwn3unD0KrmRBP6frwto</span><br><span class="line">  bucket: jiuwei-blog</span><br><span class="line">  yuming: http:<span class="comment">//s4qekb2gh.hb-bkt.clouddn.com/</span></span><br></pre></td></tr></table></figure>

<h3 id="新建文章"><a href="#新建文章" class="headerlink" title="新建文章"></a>新建文章</h3><h4 id="接口分析-23"><a href="#接口分析-23" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130171335226.png" alt="image-20231130171335226"></p>
<h4 id="代码实现-24"><a href="#代码实现-24" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ----------------------------------------  写文章-新建文章   --------------------------------------------------</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(AddArticleDto article)</span> &#123;</span><br><span class="line">       <span class="comment">//将文章保存到数据库</span></span><br><span class="line">       <span class="type">ArticleVo</span> <span class="variable">articleVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(article, ArticleVo.class);</span><br><span class="line">       articleVoService.save(articleVo);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//然后将文章id和标签id放到关联表中   mybatis-plus会自动将新生成的数据的id自动封装到新生成的数据上，所以直接可以用新生成的article去getId</span></span><br><span class="line">       List&lt;ArticleTag&gt; articleTags = article.getTags().stream()  <span class="comment">//获取tag的id集合</span></span><br><span class="line">               .map(tagId -&gt; <span class="keyword">new</span> <span class="title class_">ArticleTag</span>(tagId, articleVo.getId())) <span class="comment">//stream流操作，将tagid和 article的id封装成ArticleTag</span></span><br><span class="line">               .collect(Collectors.toList());    <span class="comment">//将ArticleTag转换成集合</span></span><br><span class="line">       articleTagService.saveBatch(articleTags);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 35238</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/7/18 0018 21:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sg_article&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//文章内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//文章摘要</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    <span class="comment">//所属分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加一个字段，为categoryName，由categoryId来查询出</span></span><br><span class="line">    <span class="comment">//由于数据库没有category_name字段，所以要用注解指定一下字段</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span><span class="comment">//代表这个字段在数据库中不存在，避免MyBatisPlus在查询时报错</span></span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//缩略图</span></span><br><span class="line">    <span class="keyword">private</span> String thumbnail;</span><br><span class="line">    <span class="comment">//是否置顶（0否，1是）</span></span><br><span class="line">    <span class="keyword">private</span> String isTop;</span><br><span class="line">    <span class="comment">//状态（0已发布，1草稿）</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">//访问量</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">//是否允许评论 1是，0否</span></span><br><span class="line">    <span class="keyword">private</span> String isComment;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增博客文章-使用mybatisplus的字段自增</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除标志（0代表未删除，1代表已删除）</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArticleVo</span><span class="params">(Long id, <span class="type">long</span> viewCount)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.viewCount = viewCount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiModel;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/11/30 17:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;新增博客文章&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddArticleDto</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//标题</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">//文章内容</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">//文章摘要</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    <span class="comment">//所属分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//缩略图</span></span><br><span class="line">    <span class="keyword">private</span> String thumbnail;</span><br><span class="line">    <span class="comment">//是否置顶（0否，1是）</span></span><br><span class="line">    <span class="keyword">private</span> String isTop;</span><br><span class="line">    <span class="comment">//状态（0已发布，1草稿）</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">//访问量</span></span><br><span class="line">    <span class="keyword">private</span> Long viewCount;</span><br><span class="line">    <span class="comment">//是否允许评论 1是，0否</span></span><br><span class="line">    <span class="keyword">private</span> String isComment;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//tags属性是一个List集合，用于接收文章关联标签的id</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; tags;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="分类列表"><a href="#分类列表" class="headerlink" title="分类列表"></a>分类列表</h2><h3 id="查询分类-1"><a href="#查询分类-1" class="headerlink" title="查询分类"></a>查询分类</h3><h4 id="接口分析-24"><a href="#接口分析-24" class="headerlink" title="接口分析"></a>接口分析<img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130200554539.png" alt="image-20231130200554539"></h4><h4 id="代码实现-25"><a href="#代码实现-25" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//----------------------------------分页查询分类列表------------------------------------------</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> PageVo <span class="title function_">selectCategoryPage</span><span class="params">(Category category, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">       LambdaQueryWrapper&lt;Category&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line"></span><br><span class="line">       queryWrapper.like(StringUtils.hasText(category.getName()),Category::getName, category.getName());</span><br><span class="line">       queryWrapper.eq(Objects.nonNull(category.getStatus()),Category::getStatus, category.getStatus());</span><br><span class="line"></span><br><span class="line">       Page&lt;Category&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">       page.setCurrent(pageNum);</span><br><span class="line">       page.setSize(pageSize);</span><br><span class="line">       page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//转换成VO</span></span><br><span class="line">       List&lt;Category&gt; categories = page.getRecords();</span><br><span class="line"></span><br><span class="line">       <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">       pageVo.setTotal(page.getTotal());</span><br><span class="line">       pageVo.setRows(categories);</span><br><span class="line">       <span class="keyword">return</span> pageVo;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增分类"><a href="#新增分类" class="headerlink" title="新增分类"></a>新增分类</h3><h4 id="接口分析-25"><a href="#接口分析-25" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130201117697.png" alt="image-20231130201117697"></p>
<h4 id="代码实现-26"><a href="#代码实现-26" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;增加文章的分类&quot;, notes = &quot;增加文章的分类&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> AddCategoryDto categoryDto)</span>&#123;</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> BeanCopyUtils.copyBean(categoryDto, Category.class);</span><br><span class="line">        categoryService.save(category);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除分类"><a href="#删除分类" class="headerlink" title="删除分类"></a>删除分类</h3><h4 id="接口分析-26"><a href="#接口分析-26" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130201618963.png" alt="image-20231130201618963"></p>
<h4 id="代码实现-27"><a href="#代码实现-27" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(value = &quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;删除文章的分类&quot;, notes = &quot;删除文章的分类&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>List&lt;Long&gt; id)</span>&#123;</span><br><span class="line">       categoryService.removeByIds(id);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改分类"><a href="#修改分类" class="headerlink" title="修改分类"></a>修改分类</h3><h4 id="接口分析-27"><a href="#接口分析-27" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130201802839.png" alt="image-20231130201802839"></p>
<h4 id="代码实现-28"><a href="#代码实现-28" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//①根据分类的id来查询分类</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据分类的id来查询分类&quot;, notes = &quot;根据分类的id来查询分类&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(category);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="comment">//②根据分类的id来修改分类</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;根据分类的id来修改分类&quot;, notes = &quot;根据分类的id来修改分类&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> Category category)</span>&#123;</span><br><span class="line">        categoryService.updateById(category);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="Excel表格"><a href="#Excel表格" class="headerlink" title="Excel表格"></a>Excel表格</h2><h3 id="接口设计-1"><a href="#接口设计-1" class="headerlink" title="接口设计"></a>接口设计</h3><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130193927468.png" alt="image-20231130193927468"></p>
<h3 id="接口分析-28"><a href="#接口分析-28" class="headerlink" title="接口分析"></a>接口分析</h3><p>使用easyExcel实现Excel的导出操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">官方地址: https://github.com/alibaba/easyexcel</span><br><span class="line"></span><br><span class="line">快速开始: https://easyexcel.opensource.alibaba.com/docs/current/quickstart/write#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81-1</span><br></pre></td></tr></table></figure>

<p>分析: 把数据库的分类数据查询出来，然后写入到Excel文件中，然后下载这个Excel文件，重点就是怎么往Excel里面写入数据，点击上面提供的快速开始的链接，点击左侧的 ‘写Excel’，就能看到实现的代码了，重点看右侧小导航栏的 ‘web中的写并且失败的时候返回json’</p>
<p>增加响应头，将数据变成输出流响应到浏览器，报错也响应到浏览器</p>
<h3 id="代码实现-29"><a href="#代码实现-29" class="headerlink" title="代码实现"></a>代码实现</h3><p>1.加入pom依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--easyExcel的依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;easyexcel&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>2.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;把分类数据写入到Excel并导出&quot;, notes = &quot;把分类数据写入到Excel并导出&quot;)</span></span><br><span class="line">    <span class="comment">//注意返回值类型是void</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//设置下载文件的请求头，下载下来的Excel文件叫&#x27;分类.xlsx&#x27;</span></span><br><span class="line">            WebUtils.setDownLoadHeader(<span class="string">&quot;分类.xlsx&quot;</span>,response);</span><br><span class="line">            <span class="comment">//获取需要导出的数据</span></span><br><span class="line">            List&lt;Category&gt; category = categoryService.list();</span><br><span class="line"></span><br><span class="line">            List&lt;ExcelCategoryVo&gt; excelCategoryVos = BeanCopyUtils.copyBeanList(category, ExcelCategoryVo.class);</span><br><span class="line">            <span class="comment">//把数据写入到Excel中，也就是把ExcelCategoryVo实体类的字段作为Excel表格的列头</span></span><br><span class="line">            <span class="comment">//sheet方法里面的字符串是Excel表格左下角工作簿的名字</span></span><br><span class="line">            EasyExcel.write(response.getOutputStream(), ExcelCategoryVo.class).autoCloseStream(Boolean.FALSE).sheet(<span class="string">&quot;文章分类&quot;</span>)</span><br><span class="line">                    .doWrite(excelCategoryVos);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//如果出现异常,就返回失败的json数据给前端。AppHttpCodeEnum和ResponseResult是我们在huanf-framework工程写的类</span></span><br><span class="line">            <span class="type">ResponseResult</span> <span class="variable">result</span> <span class="operator">=</span> ResponseResult.errorResult(AppHttpCodeEnum.SYSTEM_ERROR);</span><br><span class="line">            <span class="comment">//WebUtils是我们在huanf-framework工程写的类，里面的renderString方法是将json字符串写入到请求体，然后返回给前端</span></span><br><span class="line">            WebUtils.renderString(response, JSON.toJSONString(result));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">     <span class="comment">/* 将字符串渲染到客户端</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param response 渲染对象</span></span><br><span class="line"><span class="comment">     * @param string 待渲染的字符串</span></span><br><span class="line"><span class="comment">     * @return null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">//easyExcel文件导出失败时候做的操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">renderString</span><span class="params">(HttpServletResponse response, String string)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            response.setStatus(<span class="number">200</span>);</span><br><span class="line">            response.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">            response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            response.getWriter().print(string);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)</span><br><span class="line">        &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setDownLoadHeader</span><span class="params">(String filename, ServletContext context, HttpServletResponse response)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">mimeType</span> <span class="operator">=</span> context.getMimeType(filename);<span class="comment">//获取文件的mime类型</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;content-type&quot;</span>,mimeType);</span><br><span class="line">        String fname= URLEncoder.encode(filename,<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>,<span class="string">&quot;attachment; filename=&quot;</span>+fname);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        response.setContentType(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;);</span></span><br><span class="line"><span class="comment">//        response.setCharacterEncoding(&quot;utf-8&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//easyExcel文件导出</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setDownLoadHeader</span><span class="params">(String filename, HttpServletResponse response)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        response.setContentType(<span class="string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span>);</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        String fname= URLEncoder.encode(filename,<span class="string">&quot;UTF-8&quot;</span>).replaceAll(<span class="string">&quot;\\+&quot;</span>, <span class="string">&quot;%20&quot;</span>);<span class="comment">//防止中文乱码</span></span><br><span class="line"><span class="comment">//        response.setHeader(&quot;Content-disposition&quot;,&quot;attachment; filename=&quot;+fname);</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>, <span class="string">&quot;attachment;filename*=utf-8&#x27;&#x27;&quot;</span> + fname);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="文章列表"><a href="#文章列表" class="headerlink" title="文章列表"></a>文章列表</h2><h3 id="查询文章"><a href="#查询文章" class="headerlink" title="查询文章"></a>查询文章</h3><h4 id="接口分析-29"><a href="#接口分析-29" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130202552450.png" alt="image-20231130202552450"></p>
<h4 id="代码实现-30"><a href="#代码实现-30" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//---------------------------管理后台(文章管理)-分页查询文章----------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageVo <span class="title function_">selectArticlePage</span><span class="params">(Article article, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Article&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line"></span><br><span class="line">        queryWrapper.like(StringUtils.hasText(article.getTitle()),Article::getTitle, article.getTitle());</span><br><span class="line">        queryWrapper.like(StringUtils.hasText(article.getSummary()),Article::getSummary, article.getSummary());</span><br><span class="line"></span><br><span class="line">        Page&lt;Article&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">        page.setCurrent(pageNum);</span><br><span class="line">        page.setSize(pageSize);</span><br><span class="line">        page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//转换成VO</span></span><br><span class="line">        List&lt;Article&gt; articles = page.getRecords();</span><br><span class="line"></span><br><span class="line">        <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">        pageVo.setTotal(page.getTotal());</span><br><span class="line">        pageVo.setRows(articles);</span><br><span class="line">        <span class="keyword">return</span> pageVo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改文章"><a href="#修改文章" class="headerlink" title="修改文章"></a>修改文章</h3><h4 id="接口设计-2"><a href="#接口设计-2" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130203501652.png" alt="image-20231130203501652"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130203629930.png" alt="image-20231130203629930"></p>
<h4 id="思路分析-13"><a href="#思路分析-13" class="headerlink" title="思路分析"></a>思路分析</h4><p>首先根据文章id查询文件信息，再根据文章id去标签-文章的表去查询文章id所对应的tagid 然后将tagid赋值给文章实体类的tagid集合</p>
<p>然后根据文章id，去修改文章的分类信息，然后删除旧的文章-标签对应关系，增加新的标签-文章对应关系</p>
<h4 id="代码实现-31"><a href="#代码实现-31" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//①先查询根据文章id查询对应的文章</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;先查询根据文章id查询对应的文章&quot;, notes = &quot;先查询根据文章id查询对应的文章&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="type">ArticleByIdVo</span> <span class="variable">article</span> <span class="operator">=</span> articleService.getInfo(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(article);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="comment">//②然后才是修改文章</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改文章&quot;, notes = &quot;修改文章&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> ArticleDto article)</span>&#123;</span><br><span class="line">        articleService.edit(article);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ArticleByIdVo <span class="title function_">getInfo</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取关联标签   反方向拿到tags的标签</span></span><br><span class="line">        LambdaQueryWrapper&lt;ArticleTag&gt; articleTagLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        articleTagLambdaQueryWrapper.eq(ArticleTag::getArticleId,article.getId());   <span class="comment">//获取article_id的连表的集合，然后分别根据里面的</span></span><br><span class="line">        List&lt;ArticleTag&gt; articleTags = articleTagService.list(articleTagLambdaQueryWrapper);   <span class="comment">//获取articleid连表tagid集合</span></span><br><span class="line">        List&lt;Long&gt; tags = articleTags.stream().map(articleTag -&gt; articleTag.getTagId()).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        <span class="type">ArticleByIdVo</span> <span class="variable">articleVo</span> <span class="operator">=</span> BeanCopyUtils.copyBean(article,ArticleByIdVo.class);</span><br><span class="line">        articleVo.setTags(tags);</span><br><span class="line">        <span class="keyword">return</span> articleVo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">edit</span><span class="params">(ArticleDto articleDto)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> BeanCopyUtils.copyBean(articleDto, Article.class);</span><br><span class="line">        <span class="comment">//更新博客信息</span></span><br><span class="line">        updateById(article);</span><br><span class="line">        <span class="comment">//删除原有的 标签和博客的关联</span></span><br><span class="line">        LambdaQueryWrapper&lt;ArticleTag&gt; articleTagLambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        articleTagLambdaQueryWrapper.eq(ArticleTag::getArticleId,article.getId());</span><br><span class="line">        articleTagService.remove(articleTagLambdaQueryWrapper);</span><br><span class="line">        <span class="comment">//添加新的博客和标签的关联信息</span></span><br><span class="line">        List&lt;ArticleTag&gt; articleTags = articleDto.getTags().stream()</span><br><span class="line">                .map(tagId -&gt; <span class="keyword">new</span> <span class="title class_">ArticleTag</span>(articleDto.getId(), tagId))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        articleTagService.saveBatch(articleTags);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="删除文章"><a href="#删除文章" class="headerlink" title="删除文章"></a>删除文章</h3><h4 id="接口分析-30"><a href="#接口分析-30" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231130205402127.png" alt="image-20231130205402127"></p>
<h4 id="代码实现-32"><a href="#代码实现-32" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除文章&quot;, notes = &quot;删除文章&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> List&lt;Long&gt; id)</span>&#123;</span><br><span class="line">        <span class="comment">//直接使用mybatisplus提供的removeById方法</span></span><br><span class="line">        articleService.removeByIds(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="菜单列表"><a href="#菜单列表" class="headerlink" title="菜单列表"></a>菜单列表</h2><h3 id="查询菜单"><a href="#查询菜单" class="headerlink" title="查询菜单"></a>查询菜单</h3><h4 id="接口分析-31"><a href="#接口分析-31" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201083524731.png" alt="image-20231201083524731"></p>
<p>响应格式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;code&quot;</span>:<span class="number">200</span>,</span><br><span class="line">	<span class="string">&quot;data&quot;</span>:[</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;component&quot;</span>:<span class="string">&quot;组件路径&quot;</span>,</span><br><span class="line">			<span class="string">&quot;icon&quot;</span>:<span class="string">&quot;build&quot;</span>,</span><br><span class="line">			<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2023&quot;</span>,</span><br><span class="line">			<span class="string">&quot;isFrame&quot;</span>:<span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;menuName&quot;</span>:<span class="string">&quot;菜单名称&quot;</span>,</span><br><span class="line">			<span class="string">&quot;menuType&quot;</span>:<span class="string">&quot;C&quot;</span>,</span><br><span class="line">			<span class="string">&quot;orderNum&quot;</span>:<span class="number">0</span>,</span><br><span class="line">			<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">			<span class="string">&quot;path&quot;</span>:<span class="string">&quot;write&quot;</span>,</span><br><span class="line">			<span class="string">&quot;perms&quot;</span>:<span class="string">&quot;权限字符串&quot;</span>,</span><br><span class="line">			<span class="string">&quot;remark&quot;</span>:<span class="string">&quot;备注信息&quot;</span>,</span><br><span class="line">			<span class="string">&quot;status&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">			<span class="string">&quot;visible&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">		&#125;,</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">&quot;icon&quot;</span>:<span class="string">&quot;system&quot;</span>,</span><br><span class="line">			<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">			<span class="string">&quot;isFrame&quot;</span>:<span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;menuName&quot;</span>:<span class="string">&quot;菜单名称&quot;</span>,</span><br><span class="line">			<span class="string">&quot;menuType&quot;</span>:<span class="string">&quot;M&quot;</span>,</span><br><span class="line">			<span class="string">&quot;orderNum&quot;</span>:<span class="number">1</span>,</span><br><span class="line">			<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">			<span class="string">&quot;path&quot;</span>:<span class="string">&quot;system&quot;</span>,</span><br><span class="line">			<span class="string">&quot;perms&quot;</span>:<span class="string">&quot;权限字符串&quot;</span>,</span><br><span class="line">			<span class="string">&quot;remark&quot;</span>:<span class="string">&quot;备注信息&quot;</span>,</span><br><span class="line">			<span class="string">&quot;status&quot;</span>:<span class="string">&quot;0&quot;</span>,</span><br><span class="line">			<span class="string">&quot;visible&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;操作成功&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="代码实现-33"><a href="#代码实现-33" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//---------------------------------查询菜单列表--------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Menu&gt; <span class="title function_">selectMenuList</span><span class="params">(Menu menu)</span> &#123;</span><br><span class="line"></span><br><span class="line">        LambdaQueryWrapper&lt;Menu&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//menuName模糊查询</span></span><br><span class="line">        queryWrapper.like(StringUtils.hasText(menu.getMenuName()),Menu::getMenuName,menu.getMenuName());</span><br><span class="line">        queryWrapper.eq(StringUtils.hasText(menu.getStatus()),Menu::getStatus,menu.getStatus());</span><br><span class="line">        <span class="comment">//排序 parent_id和order_num</span></span><br><span class="line">        queryWrapper.orderByAsc(Menu::getParentId,Menu::getOrderNum);</span><br><span class="line">        List&lt;Menu&gt; menus = list(queryWrapper);;</span><br><span class="line">        <span class="keyword">return</span> menus;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增菜单"><a href="#新增菜单" class="headerlink" title="新增菜单"></a>新增菜单</h3><h4 id="接口分析-32"><a href="#接口分析-32" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201085142322.png" alt="image-20231201085142322"></p>
<h4 id="代码实现-34"><a href="#代码实现-34" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"> <span class="meta">@ApiOperation(value = &quot;新增菜单列表&quot;, notes = &quot;新增菜单列表&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> Menu menu)</span> &#123;</span><br><span class="line">     menuService.save(menu);</span><br><span class="line">     <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改菜单"><a href="#修改菜单" class="headerlink" title="修改菜单"></a>修改菜单</h3><h4 id="接口分析-33"><a href="#接口分析-33" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201085730990.png" alt="image-20231201085730990"></p>
<h4 id="思路分析-14"><a href="#思路分析-14" class="headerlink" title="思路分析"></a>思路分析</h4><p>先根据菜单id查询出菜单信息，回显数据</p>
<p>在根据id更新所修改的信息，修改的时候判断所修改的菜单是否是父菜单，不能把父菜单设置为当前菜单</p>
<h4 id="代码实现-35"><a href="#代码实现-35" class="headerlink" title="代码实现"></a>代码实现</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201090245547.png" alt="image-20231201090245547"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(value = &quot;/&#123;menuId&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//①先查询根据菜单id查询对应的权限菜单</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询菜单信息&quot;, notes = &quot;查询菜单信息&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable</span> Long menuId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(menuService.getById(menuId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="comment">//②然后才是更新菜单</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> Menu menu)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (menu.getId().equals(menu.getParentId())) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseResult.errorResult(<span class="number">500</span>,<span class="string">&quot;修改菜单&#x27;&quot;</span> + menu.getMenuName() + <span class="string">&quot;&#x27;失败，上级菜单不能选择自己&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        menuService.updateById(menu);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除菜单"><a href="#删除菜单" class="headerlink" title="删除菜单"></a>删除菜单</h3><h4 id="接口分析-34"><a href="#接口分析-34" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201091746875.png" alt="image-20231201091746875"></p>
<h4 id="思路分析-15"><a href="#思路分析-15" class="headerlink" title="思路分析"></a>思路分析</h4><p>判断是否有子目录，就是看其他的parentid是否有它</p>
<h4 id="代码实现-36"><a href="#代码实现-36" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//---------------------------------查看是否有子目录--------------------------------------</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasChild</span><span class="params">(Long menuId)</span> &#123;</span><br><span class="line">       <span class="comment">//查看是否有子目录</span></span><br><span class="line">       LambdaQueryWrapper&lt;Menu&gt; menulambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">       menulambdaQueryWrapper.eq(Menu::getParentId,menuId);   <span class="comment">//如果能查出来，就返回true</span></span><br><span class="line">       <span class="keyword">return</span> count(menulambdaQueryWrapper)&gt;<span class="number">0</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="角色列表"><a href="#角色列表" class="headerlink" title="角色列表"></a>角色列表</h2><h3 id="查询角色"><a href="#查询角色" class="headerlink" title="查询角色"></a>查询角色</h3><h4 id="接口设计-3"><a href="#接口设计-3" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201092512509.png" alt="image-20231201092512509"></p>
<p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;12&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;link&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色名称&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="思路分析-16"><a href="#思路分析-16" class="headerlink" title="思路分析"></a>思路分析</h4><p>根据条件模糊查询，，将分页信息封装到vo返回给前端</p>
<h4 id="代码实现-37"><a href="#代码实现-37" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------------------查询角色列表---------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">selectRolePage</span><span class="params">(Role role, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Role&gt; lambdaQueryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        lambdaQueryWrapper.like(StringUtils.hasText(role.getRoleName()),Role::getRoleName,role.getRoleName());</span><br><span class="line">        lambdaQueryWrapper.eq(StringUtils.hasText(role.getStatus()),Role::getStatus,role.getStatus());</span><br><span class="line">        lambdaQueryWrapper.orderByAsc(Role::getRoleSort);</span><br><span class="line"></span><br><span class="line">        Page&lt;Role&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">        page.setCurrent(pageNum);</span><br><span class="line">        page.setSize(pageSize);</span><br><span class="line">        page(page,lambdaQueryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//转换成VO</span></span><br><span class="line">        List&lt;Role&gt; roles = page.getRecords();</span><br><span class="line"></span><br><span class="line">        <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">        pageVo.setTotal(page.getTotal());</span><br><span class="line">        pageVo.setRows(roles);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改状态"><a href="#修改状态" class="headerlink" title="修改状态"></a>修改状态</h3><h4 id="接口设计-4"><a href="#接口设计-4" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201093155861.png" alt="image-20231201093155861"></p>
<h4 id="思路分析-17"><a href="#思路分析-17" class="headerlink" title="思路分析"></a>思路分析</h4><p>设置Role所要更新的信息，然后调用mp的更新方法去更新</p>
<h4 id="代码实现-38"><a href="#代码实现-38" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping(&quot;/changeStatus&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改角色的状态&quot;, notes = &quot;修改角色的状态&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">changeStatus</span><span class="params">(<span class="meta">@RequestBody</span> ChangeRoleStatusDto roleStatusDto)</span>&#123;</span><br><span class="line">        <span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Role</span>();</span><br><span class="line">        role.setId(roleStatusDto.getRoleId());</span><br><span class="line">        role.setStatus(roleStatusDto.getStatus());</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(roleService.updateById(role));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增角色"><a href="#新增角色" class="headerlink" title="新增角色"></a>新增角色</h3><h4 id="接口设计-5"><a href="#接口设计-5" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101048056.png" alt="image-20231201101048056"></p>
<p>响应</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;写博文&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户查询&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1007&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;重置密码&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;100&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="punctuation">&#123;</span></span><br><span class="line">					<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2024&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链新增&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">						<span class="punctuation">&#123;</span></span><br><span class="line">							<span class="attr">&quot;children&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2025&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链修改&quot;</span><span class="punctuation">,</span></span><br><span class="line">							<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span></span><br><span class="line">						<span class="punctuation">&#125;</span></span><br><span class="line">					<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2022&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;友链管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">					<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span></span><br><span class="line">				<span class="punctuation">&#125;</span></span><br><span class="line">			<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2017&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;内容管理&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;parentId&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="思路分析-18"><a href="#思路分析-18" class="headerlink" title="思路分析"></a>思路分析</h4><p>首先打开新增窗口，需要查询出菜单树   可以先找出第一层菜单，然后根据i第一层的菜单id，找出其他菜单父类id为它的菜单，然后将这些菜单设置为第一层菜单的children</p>
<p>然后新增所填写的角色信息</p>
<p>并且需要将角色和菜单的对应关系加到角色-菜单关联关系表</p>
<h4 id="代码实现-39"><a href="#代码实现-39" class="headerlink" title="代码实现"></a>代码实现</h4><p>①</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/treeselect&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增角色--获取菜单下拉树列表&quot;, notes = &quot;新增角色--获取菜单下拉树列表&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">treeselect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//复用之前的selectMenuList方法。方法需要参数，参数可以用来进行条件查询，而这个方法不需要条件，所以直接new Menu()传入</span></span><br><span class="line">        List&lt;Menu&gt; menus = menuService.selectMenuList(<span class="keyword">new</span> <span class="title class_">Menu</span>()); <span class="comment">//查询菜单列表</span></span><br><span class="line">        List&lt;MenuTreeVo&gt; options =  SystemConverter.buildMenuSelectTree(menus); <span class="comment">//去构建挑选的菜单树</span></span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(options);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.entity.Menu;</span><br><span class="line"><span class="keyword">import</span> com.sangeng.domain.vo.MenuTreeVo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新增角色-获取菜单下拉树列表（和动态路由一样）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 久违</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/12/1 10:52</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemConverter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SystemConverter</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> menus 所有菜单</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;MenuTreeVo&gt; <span class="title function_">buildMenuSelectTree</span><span class="params">(List&lt;Menu&gt; menus)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//首先封装成MenuTreeVo</span></span><br><span class="line">        List&lt;MenuTreeVo&gt; menuTreeVos = menus.stream()</span><br><span class="line">                .map(menu -&gt; <span class="keyword">new</span> <span class="title class_">MenuTreeVo</span>(menu.getId(), menu.getMenuName(), menu.getParentId(), <span class="literal">null</span>))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">                 <span class="comment">//先查父菜单为0的菜单</span></span><br><span class="line">        List&lt;MenuTreeVo&gt; menuTree = menuTreeVos.stream().filter(menuTreeVo -&gt; menuTreeVo.getParentId().equals(<span class="number">0L</span>))</span><br><span class="line">                .map(menuTreeVo -&gt; menuTreeVo.setChildren(getChildren(menuTreeVo, menuTreeVos))) <span class="comment">//然后查找别的菜单parentId为前面查到父菜单为0的id，将其设置到这个id的children中</span></span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> menuTree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到子树</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> menuTreeVo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> menuTreeVos</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;MenuTreeVo&gt; <span class="title function_">getChildren</span><span class="params">(MenuTreeVo menuTreeVo,List&lt;MenuTreeVo&gt; menuTreeVos)</span> &#123;</span><br><span class="line">        List&lt;MenuTreeVo&gt; childrenTree = menuTreeVos.stream().filter(m -&gt; m.getParentId().equals(menuTreeVo.getId()))</span><br><span class="line">                .map(m -&gt; m.setChildren(getChildren(m, menuTreeVos))).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> childrenTree;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>②</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//------------------------------新增角色信息---------------------------------------</span></span><br><span class="line">    <span class="comment">//先新增角色信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertRole</span><span class="params">(Role role)</span> &#123;</span><br><span class="line">        save(role);</span><br><span class="line">        <span class="keyword">if</span> (role.getMenuIds()!=<span class="literal">null</span>&amp;&amp;role.getMenuIds().length&gt;<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//将角色和菜单的关系执行插入到menu-role表</span></span><br><span class="line">            insertRoleMenu(role);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//再将角色和菜单关系保存到关系表中</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertRoleMenu</span><span class="params">(Role role)</span> &#123;</span><br><span class="line">        List&lt;RoleMenu&gt; roleMenu = Arrays.stream(role.getMenuIds()).map(menuId -&gt; <span class="keyword">new</span> <span class="title class_">RoleMenu</span>(menuId, role.getId()))</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        roleMenuService.saveBatch(roleMenu);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增角色&quot;, notes = &quot;新增角色&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">( <span class="meta">@RequestBody</span> Role role)</span> &#123;</span><br><span class="line">        roleService.insertRole(role);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="修改角色"><a href="#修改角色" class="headerlink" title="修改角色"></a>修改角色</h3><h4 id="接口设计-6"><a href="#接口设计-6" class="headerlink" title="接口设计"></a>接口设计</h4><p>① <img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101339076.png" alt="image-20231201101339076"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;11&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;备注信息&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;aggag&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色名称&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;11&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;备注信息&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;aggag&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;角色名称&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;5&quot;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101412122.png" alt="image-20231201101412122"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;code&quot;</span>:<span class="number">200</span>,</span><br><span class="line">	<span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line">		<span class="string">&quot;menus&quot;</span>:[</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">				<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2023&quot;</span>,</span><br><span class="line">				<span class="string">&quot;label&quot;</span>:<span class="string">&quot;写博文&quot;</span>,</span><br><span class="line">				<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1001&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;用户查询&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;100&quot;</span></span><br><span class="line">							&#125;,</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1002&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;用户新增&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;100&quot;</span></span><br><span class="line">							&#125;</span><br><span class="line">						],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;100&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;用户管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;1&quot;</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1008&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;角色查询&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;101&quot;</span></span><br><span class="line">							&#125;</span><br><span class="line">						],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;101&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;角色管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;1&quot;</span></span><br><span class="line">					&#125;</span><br><span class="line">				],</span><br><span class="line">				<span class="string">&quot;id&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">				<span class="string">&quot;label&quot;</span>:<span class="string">&quot;系统管理&quot;</span>,</span><br><span class="line">				<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">			&#125;,</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2019&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;文章管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2017&quot;</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2028&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;导出分类&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2018&quot;</span></span><br><span class="line">							&#125;</span><br><span class="line">						],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2018&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;分类管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2017&quot;</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2024&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;友链新增&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2022&quot;</span></span><br><span class="line">							&#125;,</span><br><span class="line">							&#123;</span><br><span class="line">								<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">								<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2025&quot;</span>,</span><br><span class="line">								<span class="string">&quot;label&quot;</span>:<span class="string">&quot;友链修改&quot;</span>,</span><br><span class="line">								<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2022&quot;</span></span><br><span class="line">							&#125;</span><br><span class="line">						],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2022&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;友链管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2017&quot;</span></span><br><span class="line">					&#125;,</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="string">&quot;children&quot;</span>:[],</span><br><span class="line">						<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2021&quot;</span>,</span><br><span class="line">						<span class="string">&quot;label&quot;</span>:<span class="string">&quot;标签管理&quot;</span>,</span><br><span class="line">						<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;2017&quot;</span></span><br><span class="line">					&#125;</span><br><span class="line">				],</span><br><span class="line">				<span class="string">&quot;id&quot;</span>:<span class="string">&quot;2017&quot;</span>,</span><br><span class="line">				<span class="string">&quot;label&quot;</span>:<span class="string">&quot;内容管理&quot;</span>,</span><br><span class="line">				<span class="string">&quot;parentId&quot;</span>:<span class="string">&quot;0&quot;</span></span><br><span class="line">			&#125;</span><br><span class="line">		],</span><br><span class="line">		<span class="string">&quot;checkedKeys&quot;</span>:[</span><br><span class="line">			<span class="string">&quot;1001&quot;</span>  </span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;操作成功&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101445405.png" alt="image-20231201101445405"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101458722.png" alt="image-20231201101458722"></p>
<h4 id="思路分析-19"><a href="#思路分析-19" class="headerlink" title="思路分析"></a>思路分析</h4><p>首先根据角色id查询角色信息回显到修改窗口</p>
<p>然后回显菜单树，和这个角色之前选的菜单的id（根据角色id查找对应的菜单id集合）</p>
<p>最后把修改的角色信息保存到数据库中，把菜单角色关联表中的这个角色id之前信息删除，在重新添加关联信息</p>
<h4 id="代码实现-40"><a href="#代码实现-40" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;获取修改id角色信息&quot;, notes = &quot;获取修改id角色信息&quot;)</span></span><br><span class="line">   <span class="meta">@ApiImplicitParam(name = &quot;id&quot;,value = &quot;角色id&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">selectById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">       <span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> roleService.getById(id);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//---------------------修改角色-根据角色id查询对应角色菜单列表树--------------------------</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/roleMenuTreeselect/&#123;roleId&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;修改角色-根据角色id查询对应角色菜单列表树-&quot;, notes = &quot;修改角色-根据角色id查询对应角色菜单列表树-&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">roleMenuTreeSelect</span><span class="params">(<span class="meta">@PathVariable(&quot;roleId&quot;)</span> Long roleId)</span> &#123;</span><br><span class="line">        <span class="comment">//首先给出所有的菜单</span></span><br><span class="line">        List&lt;Menu&gt; menus = menuService.selectMenuList(<span class="keyword">new</span> <span class="title class_">Menu</span>());</span><br><span class="line">        <span class="comment">//然后去建立菜单树</span></span><br><span class="line">        List&lt;MenuTreeVo&gt; menuTreeVos = SystemConverter.buildMenuSelectTree(menus);</span><br><span class="line">        <span class="comment">//然后在去查询这个角色id之前所具有的菜单id，将其和菜单树返回</span></span><br><span class="line">         List&lt;Long&gt; checkedKeys = menuService.selectMenuListByRoleId(roleId);</span><br><span class="line">        <span class="type">RoleMenuTreeSelectVo</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleMenuTreeSelectVo</span>(checkedKeys,menuTreeVos);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(vo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--修改角色-根据角色id查询对应角色的菜单列表树--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectMenuListByRoleId&quot;</span> resultType=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span><br><span class="line">    select *</span><br><span class="line">    from sys_menu m left join sys_role_menu rm on m.id = rm.menu_id</span><br><span class="line">    where rm.role_id = #&#123;roleId&#125;</span><br><span class="line">    order by m.parent_id , m.order_num</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------修改角色-保存修改好的角色信息----------------------------</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateRole</span><span class="params">(Role role)</span> &#123;</span><br><span class="line">        <span class="comment">//先更新角色信息</span></span><br><span class="line">        updateById(role);</span><br><span class="line">        <span class="comment">//然后删除这个角色所对应的菜单关系</span></span><br><span class="line">        roleMenuService.deleteRoleMenuByRoleId(role.getId());</span><br><span class="line">        <span class="comment">//然后重新保存两个表的关系</span></span><br><span class="line">        insertRoleMenu(role);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//修改角色-保存修改好的角色信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRoleMenuByRoleId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;RoleMenu&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(RoleMenu::getRoleId,id);</span><br><span class="line">        remove(queryWrapper);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除角色"><a href="#删除角色" class="headerlink" title="删除角色"></a>删除角色</h3><h4 id="接口设计-7"><a href="#接口设计-7" class="headerlink" title="接口设计"></a>接口设计</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201101543847.png" alt="image-20231201101543847"></p>
<h4 id="代码实现-41"><a href="#代码实现-41" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;删除角色&quot;, notes = &quot;删除角色&quot;)</span></span><br><span class="line">   <span class="meta">@ApiImplicitParam(name = &quot;id&quot;,value = &quot;角色id&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable(name = &quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">       roleService.removeById(id);</span><br><span class="line">       <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="用户列表"><a href="#用户列表" class="headerlink" title="用户列表"></a>用户列表</h2><h3 id="查询用户"><a href="#查询用户" class="headerlink" title="查询用户"></a>查询用户</h3><h4 id="接口分析-35"><a href="#接口分析-35" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201164913448.png" alt="image-20231201164913448"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;avatar&quot;</span><span class="punctuation">:</span><span class="string">&quot;头像url&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-05 17:01:56&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;23412332@qq.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;昵称&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;phonenumber&quot;</span><span class="punctuation">:</span><span class="string">&quot;18888888888&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-10 21:36:22&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;sg&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;total&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="代码实现-42"><a href="#代码实现-42" class="headerlink" title="代码实现"></a>代码实现</h4><p>//——————————–查询用户列表————————————-<br>    @Override<br>    public ResponseResult selectUserPage (User user, Integer pageNum, Integer pageSize){<br>        LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper();</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    queryWrapper.like(StringUtils.hasText(user.getUserName()), User::getUserName, user.getUserName());</span><br><span class="line">    queryWrapper.eq(StringUtils.hasText(user.getStatus()), User::getStatus, user.getStatus());</span><br><span class="line">    queryWrapper.eq(StringUtils.hasText(user.getPhonenumber()), User::getPhonenumber, user.getPhonenumber());</span><br><span class="line"></span><br><span class="line">    Page&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">    page.setCurrent(pageNum);</span><br><span class="line">    page.setSize(pageSize);</span><br><span class="line">    page(page, queryWrapper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//转换成VO</span></span><br><span class="line">    List&lt;User&gt; users = page.getRecords();</span><br><span class="line">    List&lt;UserVo&gt; userVoList = users.stream()</span><br><span class="line">            .map(u -&gt; BeanCopyUtils.copyBean(u, UserVo.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">    pageVo.setTotal(page.getTotal());</span><br><span class="line">    pageVo.setRows(userVoList);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult(pageVo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h3><h4 id="思路分析-20"><a href="#思路分析-20" class="headerlink" title="思路分析"></a>思路分析</h4><p>首先查出所有角色，然后增加用户,把角色和用户对应关系也需要保存到关联表中</p>
<h4 id="接口分析-36"><a href="#接口分析-36" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201165429716.png" alt="image-20231201165429716"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">		<span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-12 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;common&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-13 06:32:58&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201170004116.png" alt="image-20231201170004116"></p>
<h4 id="代码实现-43"><a href="#代码实现-43" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//--------------------------------新增用户---------------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/listAllRole&quot;)</span></span><br><span class="line">    <span class="comment">//①查询角色列表接口</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">listAllRole</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Role&gt; roles = roleService.selectRoleAll();</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(roles);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-------------------------------新增用户-②新增用户--------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRoleService userRoleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkUserNameUnique</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count(Wrappers.&lt;User&gt;lambdaQuery().eq(User::getUserName,userName))==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkPhoneUnique</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count(Wrappers.&lt;User&gt;lambdaQuery().eq(User::getPhonenumber,user.getPhonenumber()))==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkEmailUnique</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count(Wrappers.&lt;User&gt;lambdaQuery().eq(User::getEmail,user.getEmail()))==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="comment">//增加用户</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">addUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">//密码加密处理</span></span><br><span class="line">        user.setPassword(passwordEncoder.encode(user.getPassword()));</span><br><span class="line">        save(user);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(user.getRoleIds()!=<span class="literal">null</span>&amp;&amp;user.getRoleIds().length&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            insertUserRole(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//插入用户和角色关联关系</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertUserRole</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        List&lt;UserRole&gt; sysUserRoles = Arrays.stream(user.getRoleIds())</span><br><span class="line">                .map(roleId -&gt; <span class="keyword">new</span> <span class="title class_">UserRole</span>(user.getId(), roleId)).collect(Collectors.toList());</span><br><span class="line">        userRoleService.saveBatch(sysUserRoles);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;新增用户&quot;,notes = &quot;新增用户&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">add</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.hasText(user.getUserName()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.REQUIRE_USERNAME);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!userService.checkUserNameUnique(user.getUserName()))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.USERNAME_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!userService.checkPhoneUnique(user))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.PHONENUMBER_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!userService.checkEmailUnique(user))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(AppHttpCodeEnum.EMAIL_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> userService.addUser(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><h4 id="接口分析-37"><a href="#接口分析-37" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231201172144858.png" alt="image-20231201172144858"></p>
<h4 id="代码实现-44"><a href="#代码实现-44" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;userIds&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;删除用户&quot;,notes = &quot;删除用户&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">remove</span><span class="params">(<span class="meta">@PathVariable</span> List&lt;Long&gt; userIds)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(userIds.contains(SecurityUtils.getUserId()))&#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseResult.errorResult(<span class="number">500</span>,<span class="string">&quot;不能删除当前你正在使用的用户&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        userService.removeByIds(userIds);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改用户"><a href="#修改用户" class="headerlink" title="修改用户"></a>修改用户</h3><h4 id="思路分析-21"><a href="#思路分析-21" class="headerlink" title="思路分析"></a>思路分析</h4><p>先查找出该用户所有的角色信息，然后删除该用户的角色用户的关联关系，</p>
<p>然后插入新的关联信息，最后插入用户表信息</p>
<h4 id="接口分析-38"><a href="#接口分析-38" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203221702948.png" alt="image-20231203221702948"></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">&quot;code&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">		<span class="attr">&quot;roleIds&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="string">&quot;11&quot;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;roles&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-10 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;超级管理员&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">				<span class="attr">&quot;createBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-10 18:46:19&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;delFlag&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;remark&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleKey&quot;</span><span class="punctuation">:</span><span class="string">&quot;common&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleName&quot;</span><span class="punctuation">:</span><span class="string">&quot;普通角色&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;roleSort&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateBy&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">				<span class="attr">&quot;updateTime&quot;</span><span class="punctuation">:</span><span class="string">&quot;2023-08-11 06:32:58&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">		<span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">			<span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;weq@2132.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户id&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span><span class="string">&quot;昵称&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;status&quot;</span><span class="punctuation">:</span><span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">			<span class="attr">&quot;userName&quot;</span><span class="punctuation">:</span><span class="string">&quot;用户名&quot;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">	<span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span><span class="string">&quot;操作成功&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203221841556.png" alt="image-20231203221841556"></p>
<h4 id="代码实现-45"><a href="#代码实现-45" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--修改用户-①根据id查询用户角色信息--&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectRoleIdByUserId&quot;</span> resultType=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span><br><span class="line">        select r.id</span><br><span class="line">        from sys_role r</span><br><span class="line">                 left join sys_user_role ur on ur.role_id = r.id</span><br><span class="line">        where ur.user_id = #&#123;userId&#125;</span><br><span class="line">    &lt;/select&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入用户和角色关联关系</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertUserRole</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        List&lt;UserRole&gt; sysUserRoles = Arrays.stream(user.getRoleIds())</span><br><span class="line">                .map(roleId -&gt; <span class="keyword">new</span> <span class="title class_">UserRole</span>(user.getId(), roleId)).collect(Collectors.toList());</span><br><span class="line">        userRoleService.saveBatch(sysUserRoles);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----------------------------修改用户-②更新用户信息-------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="comment">// 删除用户与角色关联</span></span><br><span class="line">        LambdaQueryWrapper&lt;UserRole&gt; userRoleUpdateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        userRoleUpdateWrapper.eq(UserRole::getUserId,user.getId());</span><br><span class="line">        userRoleService.remove(userRoleUpdateWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新增用户与角色管理</span></span><br><span class="line">        insertUserRole(user);</span><br><span class="line">        <span class="comment">// 更新用户信息</span></span><br><span class="line">        updateById(user);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="友链列表"><a href="#友链列表" class="headerlink" title="友链列表"></a>友链列表</h2><h3 id="查询友链"><a href="#查询友链" class="headerlink" title="查询友链"></a>查询友链</h3><h4 id="接口分析-39"><a href="#接口分析-39" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203223736546.png" alt="image-20231203223736546"></p>
<h4 id="代码实现-46"><a href="#代码实现-46" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询友链</span></span><br><span class="line">    PageVo <span class="title function_">selectLinkPage</span><span class="params">(Link link, Integer pageNum, Integer pageSize)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------------分页查询友链---------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageVo <span class="title function_">selectLinkPage</span><span class="params">(Link link, Integer pageNum, Integer pageSize)</span> &#123;</span><br><span class="line">        LambdaQueryWrapper&lt;Link&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>();</span><br><span class="line"></span><br><span class="line">        queryWrapper.like(StringUtils.hasText(link.getName()),Link::getName, link.getName());</span><br><span class="line">        queryWrapper.eq(Objects.nonNull(link.getStatus()),Link::getStatus, link.getStatus());</span><br><span class="line"></span><br><span class="line">        Page&lt;Link&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;();</span><br><span class="line">        page.setCurrent(pageNum);</span><br><span class="line">        page.setSize(pageSize);</span><br><span class="line">        page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//转换成VO</span></span><br><span class="line">        List&lt;Link&gt; categories = page.getRecords();</span><br><span class="line"></span><br><span class="line">        <span class="type">PageVo</span> <span class="variable">pageVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageVo</span>();</span><br><span class="line">        pageVo.setTotal(page.getTotal());</span><br><span class="line">        pageVo.setRows(categories);</span><br><span class="line">        <span class="keyword">return</span> pageVo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增友链"><a href="#新增友链" class="headerlink" title="新增友链"></a>新增友链</h3><h4 id="接口分析-40"><a href="#接口分析-40" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203224101175.png" alt="image-20231203224101175"></p>
<h4 id="代码实现-47"><a href="#代码实现-47" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sangeng.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableField;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableId;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.TableName;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 友链(Link)表实体类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> makejava</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-07-22 14:39:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@TableName(&quot;sg_link&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Link</span>  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String logo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">//网站地址</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="comment">//审核状态 (0代表审核通过，1代表审核未通过，2代表未审核)</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//字段自增</span></span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Long createBy;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Long updateBy;</span><br><span class="line">    <span class="meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line">    <span class="keyword">private</span> Date updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除标志（0代表未删除，1代表已删除）</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改友链"><a href="#修改友链" class="headerlink" title="修改友链"></a>修改友链</h3><h4 id="思路分析-22"><a href="#思路分析-22" class="headerlink" title="思路分析"></a>思路分析</h4><p>先根据id查询友链，然后修改友链的状态，最后修改友链</p>
<h4 id="接口分析-41"><a href="#接口分析-41" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203224313475.png" alt="image-20231203224313475"></p>
<p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203224324776.png" alt="image-20231203224324776"></p>
<h4 id="代码实现-48"><a href="#代码实现-48" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-------------------------------修改友链---------------------------------</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//①根据id查询友链</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">getInfo</span><span class="params">(<span class="meta">@PathVariable(value = &quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="type">Link</span> <span class="variable">link</span> <span class="operator">=</span> linkService.getById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult(link);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/changeLinkStatus&quot;)</span></span><br><span class="line">    <span class="comment">//②修改友链状态</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">changeLinkStatus</span><span class="params">(<span class="meta">@RequestBody</span> Link link)</span>&#123;</span><br><span class="line">        linkService.updateById(link);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="comment">//③修改友链</span></span><br><span class="line">    <span class="keyword">public</span> ResponseResult <span class="title function_">edit</span><span class="params">(<span class="meta">@RequestBody</span> Link link)</span>&#123;</span><br><span class="line">        linkService.updateById(link);</span><br><span class="line">        <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除友链"><a href="#删除友链" class="headerlink" title="删除友链"></a>删除友链</h3><h4 id="接口分析-42"><a href="#接口分析-42" class="headerlink" title="接口分析"></a>接口分析</h4><p><img src="C:\Users\康\AppData\Roaming\Typora\typora-user-images\image-20231203224654161.png" alt="image-20231203224654161"></p>
<h4 id="代码实现-49"><a href="#代码实现-49" class="headerlink" title="代码实现"></a>代码实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;删除友链&quot;, notes = &quot;删除友链&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseResult <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    linkService.removeById(id);</span><br><span class="line">    <span class="keyword">return</span> ResponseResult.okResult();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>































<h1 id="Leetcode"><a href="#Leetcode" class="headerlink" title="Leetcode"></a>Leetcode</h1><h2 id="2024-4-2"><a href="#2024-4-2" class="headerlink" title="2024/4/2"></a>2024/4/2</h2><h3 id="404-左叶子之和"><a href="#404-左叶子之和" class="headerlink" title="404. 左叶子之和"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/sum-of-left-leaves/">404. 左叶子之和</a></h3><p>前序遍历，首先判断是不是左叶子（左节点不为null，左节点的左孩和右孩子为null）。然后进行递归遍历左右孩子，最后返回sum</p>
<figure class="highlight java"><figcaption><span>[]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * public class TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode left;</span></span><br><span class="line"><span class="comment"> *     TreeNode right;</span></span><br><span class="line"><span class="comment"> *     TreeNode() &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val) &#123; this.val = val; &#125;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int val, TreeNode left, TreeNode right) &#123;</span></span><br><span class="line"><span class="comment"> *         this.val = val;</span></span><br><span class="line"><span class="comment"> *         this.left = left;</span></span><br><span class="line"><span class="comment"> *         this.right = right;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">//全局变量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//如果是左叶子节点</span></span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span> &amp;&amp; root.left.left==<span class="literal">null</span> &amp;&amp; root.left.right==<span class="literal">null</span>) &#123;</span><br><span class="line">        sum+=root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        sumOfLeftLeaves(root.left);</span><br><span class="line">        sumOfLeftLeaves(root.right);</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="513-找树左下角的值"><a href="#513-找树左下角的值" class="headerlink" title="513. 找树左下角的值"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/find-bottom-left-tree-value/">513. 找树左下角的值</a></h3><p>BFS 广度优先搜索。从右往左对每一层进行遍历，最后一层的最后一个节点就是左下角的值</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="comment">//层序遍历 从右向左进行遍历，最后一个就是最底层最左边的值</span></span><br><span class="line">        Deque&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//将root放入队列</span></span><br><span class="line">        queue.offerLast(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.pollFirst();</span><br><span class="line">            <span class="comment">//最后那个值就是要返回的</span></span><br><span class="line">            res = node.val;</span><br><span class="line">            <span class="comment">//先将右节点放入</span></span><br><span class="line">            <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)</span><br><span class="line">            queue.addLast(node.right);</span><br><span class="line">            <span class="comment">//在放左节点</span></span><br><span class="line">            <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)</span><br><span class="line">            queue.addLast(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="617-合并二叉树"><a href="#617-合并二叉树" class="headerlink" title="617. 合并二叉树"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/merge-two-binary-trees/">617. 合并二叉树</a></h3><p>让root1作为合并后的树，然后让root2上的值加到root1</p>
<p>深度优先遍历</p>
<p>结束条件：root1==null 直接返回root2   相反 root2==null 直接返回root1</p>
<p>过程：roo1+=root2，然后遍历左子树和右子树</p>
<p><strong>代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">mergeTrees</span><span class="params">(TreeNode root1, TreeNode root2)</span> &#123;</span><br><span class="line">        <span class="comment">//root1为null了那直接就可以返回root2</span></span><br><span class="line">        <span class="keyword">if</span>(root1==<span class="literal">null</span>) <span class="keyword">return</span> root2;  </span><br><span class="line">        <span class="keyword">if</span>(root2==<span class="literal">null</span>) <span class="keyword">return</span> root1;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//可以把root1作为和的点</span></span><br><span class="line">        root1.val = root1.val+root2.val;</span><br><span class="line">        root1.left = mergeTrees(root1.left,root2.left);</span><br><span class="line">        root1.right = mergeTrees(root1.right,root2.right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="112-路径总和"><a href="#112-路径总和" class="headerlink" title="112. 路径总和"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/path-sum/">112. 路径总和</a></h3><p>思路：DFS遍历 </p>
<p>递归终止条件：左右节点为null，计数器等于targetSum（或者每次用targetSum都减节点数最后为0 ）返回true ，返回false 左右节点都为null</p>
<p>单层递归逻辑</p>
<p>遍历左子树 count+val 如果到最后一个节点 然后执行 count-val回退到上一个根节点 </p>
<p>右子树一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPathSum</span><span class="params">(TreeNode root, <span class="type">int</span> targetSum)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//只有一个根节点。需要判断一下减去根节点是否等于目标值</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        targetSum = targetSum - root.val;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> dfs(root,targetSum);</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(TreeNode root, <span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="comment">//终止条件</span></span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right ==<span class="literal">null</span> &amp;&amp; count==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left==<span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span>(root.left!=<span class="literal">null</span>) &#123;</span><br><span class="line">            count = count-root.left.val;</span><br><span class="line">            <span class="keyword">if</span>(dfs(root.left,count)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">//到这一节点的左节点为叶子时 回溯就相当于count没变，继续去找右孩子</span></span><br><span class="line">            count = count + root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root.right!=<span class="literal">null</span>) &#123;</span><br><span class="line">            count = count - root.right.val;</span><br><span class="line">            <span class="keyword">if</span>(dfs(root.right,count)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">//到这一节点的左节点为叶子时 回溯就相当于count没变，继续去找右孩子</span></span><br><span class="line">            count = count + root.right.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP,ALTER,INDEX on *.* TO &#x27;root&#x27;@&#x27;8.130.97.224&#x27; IDENTIFIED BY 123456;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
























      

      
        <div class="page-reward">
          <a href="javascript:;" class="page-reward-btn tooltip-top">
            <div class="tooltip tooltip-east">
            <span class="tooltip-item">
              赏
            </span>
            <span class="tooltip-content">
              <span class="tooltip-text">
                <span class="tooltip-inner">
                  <p class="reward-p"><i class="icon icon-quo-left"></i>谢谢你请我吃糖果<i class="icon icon-quo-right"></i></p>
                  <div class="reward-box">
                    
                    <div class="reward-box-item">
                      <img class="reward-img" src="/img/alipay.jpg">
                      <span class="reward-type">支付宝</span>
                    </div>
                    
                    
                    <div class="reward-box-item">
                      <img class="reward-img" src="/img/weixin.jpg">
                      <span class="reward-type">微信</span>
                    </div>
                    
                  </div>
                </span>
              </span>
            </span>
          </div>
          </a>
        </div>
      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">JAVA</a>
        		</li>
      		
		</ul>
	</div>

      
	<div class="article-category tagcloud">
		<i class="icon-book icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="/categories/JAVA//" class="article-tag-list-link color5">JAVA</a>
        		</li>
      		
		</ul>
	</div>


      

      
        
<div class="share-btn share-icons tooltip-left">
  <div class="tooltip tooltip-east">
    <span class="tooltip-item">
      <a href="javascript:;" class="share-sns share-outer">
        <i class="icon icon-share"></i>
      </a>
    </span>
    <span class="tooltip-content">
      <div class="share-wrap">
        <div class="share-icons">
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="icon icon-weibo"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="icon icon-weixin"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="icon icon-qq"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="icon icon-douban"></i>
          </a>
          <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a>
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="icon icon-facebook"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="icon icon-twitter"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="icon icon-google"></i>
          </a>
        </div>
      </div>
    </span>
  </div>
</div>

<div class="page-modal wx-share js-wx-box">
    <a class="close js-modal-close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//pan.baidu.com/share/qrcode?url=http://example.com/2023/05/08/markdown/%E8%B7%9F%E7%9D%80%E4%B8%89%E6%9B%B4%E5%AD%A6JAVA/" alt="微信分享二维码">
    </div>
</div>

<div class="mask js-mask"></div>
      
      <div class="clearfix"></div>
    </div>
</article>

  
<nav id="article-nav">
  
    <a href="/2023/05/08/markdown/%E5%B7%A5%E5%85%B7/" id="article-nav-newer" class="article-nav-link-wrap">
      <i class="icon-circle-left"></i>
      <div class="article-nav-title">
        
          JAVA
        
      </div>
    </a>
  
  
    <a href="/2023/03/31/markdown/%E6%8E%92%E5%BA%8F/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">排序</div>
      <i class="icon-circle-right"></i>
    </a>
  
</nav>


<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>



  
  
  

  
  <div id="SOHUCS" sid="markdown/跟着三更学JAVA" ></div> 
<script charset="utf-8" type="text/javascript" src="//changyan.sohu.com/upload/changyan.js" ></script>
<script type="text/javascript">
    window.changyan.api.config({
        appid: "cywVXFwF6",
        conf: "645329c2f48bfdae78da363938230888"
    });
</script>
</script>
  


  <section id="comments">
<div id="SOHUCS" sid="JAVA"></div>
<script>
  (function(){
    var appid = 'cywVXFwF6',
    conf = '645329c2f48bfdae78da363938230888';
    var doc = document,
    s = doc.createElement('script'),
    h = doc.getElementsByTagName('head')[0] || doc.head || doc.documentElement;
    s.type = 'text/javascript';
    s.charset = 'utf-8';
    s.src =  'http://assets.changyan.sohu.com/upload/changyan.js?conf='+ conf +'&appid=' + appid;
    h.insertBefore(s,h.firstChild);
    window.SCS_NO_IFRAME = true;
  })()
</script>    
  </section>
  

  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2024 是小康呀.
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>




    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: false
	}
</script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(195),t.exports=r(191)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(203);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(382)),d=e(p),y=r(128),g=e(y),b=r(190),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(381),r(391),r(198),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(210),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(202);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(208),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(209)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){
if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(204))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(206),g=r(205),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){
return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(207),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(330),r(269),r(271),r(270),r(273),r(275),r(280),r(274),r(272),r(282),r(281),r(277),r(278),r(276),r(268),r(279),r(283),r(284),r(236),r(238),r(237),r(286),r(285),r(256),r(266),r(267),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(317),r(322),r(329),r(320),r(312),r(313),r(318),r(323),r(325),r(308),r(309),r(310),r(311),r(314),r(315),r(316),r(319),r(321),r(324),r(326),r(327),r(328),r(231),r(233),r(232),r(235),r(234),r(220),r(218),r(224),r(221),r(227),r(229),r(217),r(223),r(214),r(228),r(212),r(226),r(225),r(219),r(222),r(211),r(213),r(216),r(215),r(230),r(155),r(302),r(307),r(184),r(303),r(304),r(305),r(306),r(287),r(183),r(185),r(186),r(342),r(331),r(332),r(337),r(340),r(341),r(335),r(338),r(336),r(339),r(333),r(334),r(288),r(289),r(290),r(291),r(292),r(295),r(293),r(294),r(296),r(297),r(298),r(299),r(301),r(300),r(343),r(369),r(372),r(371),r(373),r(374),r(370),r(375),r(376),r(354),r(357),r(353),r(351),r(352),r(355),r(356),r(346),r(368),r(377),r(345),r(347),r(349),r(348),r(350),r(359),r(360),r(362),r(361),r(364),r(363),r(365),r(366),r(367),r(344),r(358),r(380),r(379),r(378),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/./main.0cf68a.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/slider.e37972.js")}()</script>


<script  async  src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">MySQL</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">Runtime</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">Sort</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">JDBC</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">Maven&&Mybatis</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">动态代理</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">ajax</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">Git</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">JavaWeb</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">JAVA</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">工具</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">刷题</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接1</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接2</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接3</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接4</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接5</a>
            </li>
          
            <li class="search-li">
              <a href="http://localhost:4000/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>友情链接6</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">来自临沂大学射手座帅哥一枚呀~性格腼腆~温柔善良可爱</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/Epsilon2.1.model.json"},"display":{"position":"right","width":300,"height":500,"hOffset":200,"vOffset":-100},"mobile":{"show":true},"log":false});</script></body>
</html>